<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/21/base64%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/21/base64%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-21 20:51:49" itemprop="dateCreated datePublished" datetime="2021-08-21T20:51:49+08:00">2021-08-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-03 08:34:58" itemprop="dateModified" datetime="2021-08-03T08:34:58+08:00">2021-08-03</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="base64编码解码"><a href="#base64编码解码" class="headerlink" title="base64编码解码"></a>base64编码解码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># base64编码解码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 编码</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">dic=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;id&#x27;</span>:<span class="number">1</span>&#125;</span><br><span class="line">user_info_str=json.dumps(dic)</span><br><span class="line"><span class="comment"># res=base64.b64encode(bytes(user_info_str,encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line">res=base64.b64encode(user_info_str.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># eyJuYW1lIjogImxxeiIsICJpZCI6IDF9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###  解码</span></span><br><span class="line">res=base64.b64decode(<span class="string">&#x27;TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ=&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 注意：base64长度是4的倍数，如果不足，需要用&#x27;=&#x27;补齐</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/18/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/18/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/" class="post-title-link" itemprop="url">自定义过滤器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-18 18:20:25" itemprop="dateCreated datePublished" datetime="2019-07-18T18:20:25+08:00">2019-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤功能：安装分类过滤（django-filter）</span></span><br><span class="line">	<span class="number">1.</span>第一种：</span><br><span class="line">		filter_backends=[DjangoFilterBackend]</span><br><span class="line">		filter_fields=[<span class="string">&#x27;course_category&#x27;</span>]  <span class="comment"># 依据的是Course(课程)表</span></span><br><span class="line">	<span class="number">2.</span>第二种：（实现区间过滤）</span><br><span class="line">		filter_backends=[DjangoFilterBackend]</span><br><span class="line">		filter_class = CourseFilterSet</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">CourseFilterSet</span>(<span class="params">FilterSet</span>):</span></span><br><span class="line">    		<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        		model = models.Course</span><br><span class="line">        		fields = [<span class="string">&#x27;course_category&#x27;</span>,]</span><br><span class="line"></span><br><span class="line">	<span class="number">3.</span>第三种：自己写</span><br><span class="line">		自定义一个过滤类：继承基类：BaseFilterBackend，重写filter_queryset，返回的数据，就是过滤后的数据</span><br><span class="line">		配置在视图类上:</span><br><span class="line">			filter_backends=[自定义的类，]</span><br></pre></td></tr></table></figure>

<h2 id="手写自定义过滤器"><a href="#手写自定义过滤器" class="headerlink" title="手写自定义过滤器"></a>手写自定义过滤器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义过滤器:</span></span><br><span class="line">    <span class="number">1.</span>写一个类CourseNameFilter,继承BaseFilterBackend</span><br><span class="line">    <span class="number">2.</span>重写filter_queryset，在内部实现过滤逻辑，返回queryset对象</span><br><span class="line">    <span class="number">3.</span>在视图类中配置</span><br><span class="line">		filter_backends = [CourseNameFilter]</span><br></pre></td></tr></table></figure>

<h2 id="借助Django-filter实现过滤功能"><a href="#借助Django-filter实现过滤功能" class="headerlink" title="借助Django-filter实现过滤功能"></a>借助Django-filter实现过滤功能</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方案一:</span></span><br><span class="line">	只能使用课程(course表)中的字段</span><br><span class="line"><span class="comment"># 视图类中</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filter_fields=[<span class="string">&#x27;course_category&#x27;</span>,<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/api/course/actual_course/?course_category=<span class="number">2</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案二:</span></span><br><span class="line">	可以自定义字段，及规则实现过滤   </span><br><span class="line"><span class="comment"># 视图类中:</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filter_class = CourseFilterSet  <span class="comment">#写一个类</span></span><br><span class="line"><span class="comment"># 过滤类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseFilterSet</span>(<span class="params">FilterSet</span>):</span></span><br><span class="line">    min_price = filters.NumberFilter(field_name=<span class="string">&#x27;price&#x27;</span>, lookup_expr=<span class="string">&#x27;gte&#x27;</span>)</span><br><span class="line">    max_price = filters.NumberFilter(field_name=<span class="string">&#x27;price&#x27;</span>, lookup_expr=<span class="string">&#x27;lte&#x27;</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Course</span><br><span class="line">        fields = [<span class="string">&#x27;course_category&#x27;</span>,<span class="string">&#x27;max_price&#x27;</span>,<span class="string">&#x27;min_price&#x27;</span>]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/10/%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E9%A2%91%E7%8E%87%E6%BA%90%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/10/%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E9%A2%91%E7%8E%87%E6%BA%90%E7%A0%81/" class="post-title-link" itemprop="url">Drf认证权限频率源码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-07-10T18:20:25+08:00">2019-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三大组件源码分析"><a href="#三大组件源码分析" class="headerlink" title="三大组件源码分析"></a>三大组件源码分析</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIView---&gt;dispathch方法的---&gt;self.initial(request, *args, **kwargs)（497行）---&gt;APIView的initial方法---&gt;有三句话</span></span><br><span class="line">    self.perform_authentication(request)  <span class="comment"># 认证</span></span><br><span class="line">    self.check_permissions(request)       <span class="comment"># 权限</span></span><br><span class="line">    self.check_throttles(request)         <span class="comment"># 频率</span></span><br></pre></td></tr></table></figure>

<h2 id="认证源码"><a href="#认证源码" class="headerlink" title="认证源码"></a>认证源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 认证源码分析过程:</span></span><br><span class="line"><span class="comment"># self.perform_authentication(request)---&gt;新的request对象的.user(是个方法，包装成了数据数属性)---&gt;新的Request类中找到了user方法---&gt;self._authenticate()---&gt;Request类中的_authenticate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_authenticate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> authenticator <span class="keyword">in</span> self.authenticators: <span class="comment"># 配置在视图类中认证类实例化得到的对象</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                user_auth_tuple = authenticator.authenticate(self)</span><br><span class="line">            <span class="keyword">except</span> exceptions.APIException:</span><br><span class="line">                self._not_authenticated()</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_auth_tuple <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                self._authenticator = authenticator</span><br><span class="line">                self.user, self.auth = user_auth_tuple</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># self.authenticators,self是Request类的对象,authenticators属性是Request这个类在实例化的时候,传入的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Request类在实例化的时候代码</span></span><br><span class="line">    <span class="keyword">return</span> Request(</span><br><span class="line">            request,</span><br><span class="line">            parsers=self.get_parsers(),</span><br><span class="line">            authenticators=self.get_authenticators(),  <span class="comment"># 要看的</span></span><br><span class="line">            negotiator=self.get_content_negotiator(),</span><br><span class="line">            parser_context=parser_context</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># self.get_authenticators()是APIView的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authenticators</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="comment"># 列表推导式</span></span><br><span class="line">            <span class="keyword">return</span> [auth() <span class="keyword">for</span> auth <span class="keyword">in</span> self.authentication_classes]</span><br><span class="line">            <span class="comment"># 返回结果是我们配在视图类中自己写的认证类列表的对象</span></span><br><span class="line">            <span class="keyword">return</span> [LoginAuth(),]</span><br></pre></td></tr></table></figure>

<h2 id="权限源码"><a href="#权限源码" class="headerlink" title="权限源码"></a>权限源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限源码分析:</span></span><br><span class="line"><span class="comment"># APIView---》dispatch-self.initial---》self.check_permissions(request)</span></span><br><span class="line">   <span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions(): 		<span class="comment"># 一个个权限类对象</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> permission.has_permission(request, self):</span><br><span class="line">                self.permission_denied(</span><br><span class="line">                    request,</span><br><span class="line">                    message=<span class="built_in">getattr</span>(permission, <span class="string">&#x27;message&#x27;</span>, <span class="literal">None</span>),</span><br><span class="line">                    code=<span class="built_in">getattr</span>(permission, <span class="string">&#x27;code&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<h2 id="频率源码"><a href="#频率源码" class="headerlink" title="频率源码"></a>频率源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 频率源码分析</span></span><br><span class="line"><span class="comment"># APIVIew的dispatch--&gt;self.initial(request,*args,**kwargs)-&gt;self.check_throttles(request)</span></span><br><span class="line">        throttle_durations = []</span><br><span class="line">        <span class="keyword">for</span> throttle <span class="keyword">in</span> self.get_throttles():		<span class="comment"># 一个个频率类对象</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> throttle.allow_request(request, self):</span><br><span class="line">                throttle_durations.append(throttle.wait())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> throttle_durations:</span><br><span class="line">            <span class="comment"># Filter out `None` values which may happen in case of config / rate</span></span><br><span class="line">            <span class="comment"># changes, see #1438</span></span><br><span class="line">            durations = [duration <span class="keyword">for</span> duration <span class="keyword">in</span> throttle_durations <span class="keyword">if</span> duration <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">            duration = <span class="built_in">max</span>(durations, default=<span class="literal">None</span>)</span><br><span class="line">            self.throttled(request, duration)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/22/JWT%E8%AE%A4%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/22/JWT%E8%AE%A4%E8%AF%81/" class="post-title-link" itemprop="url">JWT认证</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-22 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-22T18:20:25+08:00">2019-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JWT认证"><a href="#JWT认证" class="headerlink" title="JWT认证"></a>JWT认证</h1><h2 id="1-JWT介绍"><a href="#1-JWT介绍" class="headerlink" title="1.JWT介绍"></a>1.JWT介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jwt是什么?</span></span><br><span class="line">	Json web token (JWT),一种前后端的认证方式</span><br><span class="line">    </span><br><span class="line"><span class="comment"># jwt的构成:</span></span><br><span class="line">	-三段式(header,payload,signature)</span><br><span class="line">    -头：认证方式,加密方式,公司名字...</span><br><span class="line">    	&#123;</span><br><span class="line">          <span class="string">&#x27;typ&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,		<span class="comment"># 声明类型</span></span><br><span class="line">          <span class="string">&#x27;alg&#x27;</span>: <span class="string">&#x27;HS256&#x27;</span>	<span class="comment"># 声明加密算法</span></span><br><span class="line">        &#125;</span><br><span class="line">        使用base64转码:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9   <span class="comment"># jwt第一部分</span></span><br><span class="line">            </span><br><span class="line">    -荷载：用户信息，过期时间，签发时间...</span><br><span class="line">    	&#123;</span><br><span class="line">          <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,	</span><br><span class="line">          <span class="string">&quot;exp&quot;</span>: <span class="number">1214356</span>		<span class="comment"># jwt过期时间</span></span><br><span class="line">        &#125;</span><br><span class="line">        使用base64转码:eyJzdWIiOiIxMjM...Y3ODkwIiwibmFtZSI6I  <span class="comment"># jwt第二部分</span></span><br><span class="line">            </span><br><span class="line">    -签名</span><br><span class="line">    	将前面的头和荷载通过某种加密方式得到的 串 </span><br><span class="line">        结合一二部分通过header中声明加密方式进行加盐secret组合加密	  <span class="comment"># 构成jwt第三部分</span></span><br><span class="line">       	将这三个部分用<span class="string">&#x27;.&#x27;</span>连接成一个完整字符串,构成最终的jwt	`</span><br><span class="line">    	</span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">	secret是保存在服务器端的，jwt的签发生成也是在服务器端的，secret就是用来进行jwt的签发和jwt的验证，所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以签发jwt了</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># (工作原理)签发和校验</span></span><br><span class="line">	签发:</span><br><span class="line">        用户登录成功，构造token的头部(base64编码)，固定的，构造荷载(base64编码)，使用设置好的加密方式对头和荷载加密，得到token，拼到最后，生成一个token串,eg:</span><br><span class="line">  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br><span class="line"></span><br><span class="line">	校验:</span><br><span class="line">        用户携带token,来到后端,把头和荷载再使用同样的加密方式加密,得到签名,比较新签名和旧签名是否一致,如果一致,说明token可以信任,解析出当前用户(荷载)继续往后走</span><br></pre></td></tr></table></figure>

<h2 id="2-JWT快速使用"><a href="#2-JWT快速使用" class="headerlink" title="2.JWT快速使用"></a>2.JWT快速使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 签发和验证</span></span><br><span class="line"><span class="comment"># 使用第三方:</span></span><br><span class="line">	-djangorestframework-jwt			<span class="comment"># 好久不维护，还能用</span></span><br><span class="line">    -djangorestframework-simplejwt		<span class="comment"># 最新的官网:https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># 安装:</span></span><br><span class="line">	pip3 install djangorestframework-jwt</span><br><span class="line">	pip3 install djangorestframework-simplejwt</span><br></pre></td></tr></table></figure>

<h3 id="1-djangorestframework-jwt"><a href="#1-djangorestframework-jwt" class="headerlink" title="1.djangorestframework-jwt"></a>1.djangorestframework-jwt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 签发token串(加密):</span></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的编码方法,传入用户对象返回荷载payload</span></span><br><span class="line">    jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的编码方法,传入payload返回token串</span></span><br><span class="line">    jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">    </span><br><span class="line">        eg:</span><br><span class="line">            payload = jwt_payload_handler(user)</span><br><span class="line">            token = jwt_encode_handler(payload)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 校验token串(反解校验):</span></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的解码方法,传入token返回荷载payload</span></span><br><span class="line">	jwt_decode_handler = api_settings.JWT_DECODE_HANDLER</span><br><span class="line">    </span><br><span class="line">    	eg:</span><br><span class="line">            payload = jwt_decode_handler(token)</span><br></pre></td></tr></table></figure>

<h4 id="1-1签发"><a href="#1-1签发" class="headerlink" title="1.1签发"></a>1.1签发</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 签发:</span></span><br><span class="line">	只需要在路由中加入配置,向这个地址发送post请求，携带用户名密码，就可以签发token(内部使用的是auth的user表)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由层配置</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token</span><br><span class="line">	urlpatterns = [</span><br><span class="line">        <span class="comment"># 签发token，登录功能，不需要写了</span></span><br><span class="line">        path(<span class="string">&#x27;login/&#x27;</span>, obtain_jwt_token),</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只需要在前端向xxx/login/地址发送post请求，携带用户名密码，就可以签发token</span></span><br><span class="line">	eg:</span><br><span class="line">        http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/login/</span><br><span class="line">		&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;lqz&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;lqz12345&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 签发的串:</span></span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImxxeiIsImV4cCI6MTYyNTcyODkwMywiZW1haWwiOiIifQ.SX3kyZJYXQMeJa3MK8raiZNmfGqyR8S3bg1Dvimf_5k</span><br></pre></td></tr></table></figure>

<h4 id="1-2认证"><a href="#1-2认证" class="headerlink" title="1.2认证"></a>1.2认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类中配置，认证类，和权限类</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> JSONWebTokenAuthentication</span><br><span class="line">    <span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        authentication_classes = [JSONWebTokenAuthentication,]</span><br><span class="line">        <span class="comment"># 第三方jwt认证需要结合权限IsAuthenticated才可以正常使用</span></span><br><span class="line">        permission_classes = [IsAuthenticated,]</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 前端访需要认证的接口时,需要在请求头中加入,如果不携带或者篡改就会导致认证不通过</span></span><br><span class="line">	请求头中携带参数:</span><br><span class="line">        Authorization：jwt空格token串</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">	Authorization：jwt eyJ0eXAiOiJKV1QiLChbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJ1c2VybmFtZSI6InJvb3QiLCJleHAiOjE2MjU3Mjk3MDAsImVtYWlsIjoiM0BxcS5jb20ifQ.V6X_4wdBvrrRSPOuUf8z5gENB1kJyGimxiLBEjbiQGY</span><br></pre></td></tr></table></figure>

<h4 id="1-3自定制签发格式"><a href="#1-3自定制签发格式" class="headerlink" title="1.3自定制签发格式"></a>1.3自定制签发格式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义签发格式:</span></span><br><span class="line">	只需要写一个函数，在配置文件中配置即可</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 创建任一py文件书写函数:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span>(<span class="params">token, user=<span class="literal">None</span>, request=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:user.username,</span><br><span class="line">            <span class="string">&#x27;token&#x27;</span>: token,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># settings.py中配置</span></span><br><span class="line">	导入自定义函数并配置到JWT_AUTH相关配置字典中</span><br><span class="line">        JWT_AUTH =&#123;</span><br><span class="line">            <span class="comment"># 设置签发token的过期时间</span></span><br><span class="line">            <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果不自定义,返回的格式是固定只有token字段</span></span><br><span class="line">            <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>:<span class="string">&#x27;自定义返回格式函数绝对路径&#x27;</span>,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-djangorestframework-jwt模块obtain-jwt-token源码分析"><a href="#3-djangorestframework-jwt模块obtain-jwt-token源码分析" class="headerlink" title="3.djangorestframework-jwt模块obtain_jwt_token源码分析"></a>3.djangorestframework-jwt模块obtain_jwt_token源码分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">ObtainJSONWebToken.as_view()---&gt;ObtainJSONWebToken----&gt;post方法</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():  <span class="comment"># 验证用户登录和签发token，都在序列化类的validate方法中完成的</span></span><br><span class="line">            user = serializer.<span class="built_in">object</span>.get(<span class="string">&#x27;user&#x27;</span>) <span class="keyword">or</span> request.user</span><br><span class="line">            token = serializer.<span class="built_in">object</span>.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">            response_data = jwt_response_payload_handler(token, user, request)</span><br><span class="line">            response = Response(response_data)</span><br><span class="line">            <span class="comment"># 返回了咱们自定制的格式 </span></span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               &#123;</span></span><br><span class="line"><span class="string">                	&#x27;code&#x27;:100,</span></span><br><span class="line"><span class="string">                	&#x27;msg&#x27;:&#x27;登录成功&#x27;,</span></span><br><span class="line"><span class="string">                	&#x27;username&#x27;:user.username,</span></span><br><span class="line"><span class="string">                	&#x27;token&#x27;: token,</span></span><br><span class="line"><span class="string">            	&#125;</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        credentials = &#123;</span><br><span class="line">            self.username_field: attrs.get(self.username_field),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: attrs.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(credentials.values()):</span><br><span class="line">            <span class="comment"># 根据用户名密码去auth的user表校验，是否存在</span></span><br><span class="line">            user = authenticate(**credentials)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                    msg = _(<span class="string">&#x27;User account is disabled.&#x27;</span>)</span><br><span class="line">                    <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br><span class="line">				<span class="comment"># 生成payload</span></span><br><span class="line">                payload = jwt_payload_handler(user)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&#x27;token&#x27;</span>: jwt_encode_handler(payload), <span class="comment"># 通过payload生成token</span></span><br><span class="line">                    <span class="string">&#x27;user&#x27;</span>: user</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">               <span class="comment"># 不在抛异常，前端就看到信息了</span></span><br><span class="line">                <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br></pre></td></tr></table></figure>

<h3 id="base64编码解码"><a href="#base64编码解码" class="headerlink" title="base64编码解码"></a>base64编码解码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># base64编码解码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 编码</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">dic=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqz&#x27;</span>,<span class="string">&#x27;id&#x27;</span>:<span class="number">1</span>&#125;</span><br><span class="line">user_info_str=json.dumps(dic)</span><br><span class="line"><span class="comment"># res=base64.b64encode(bytes(user_info_str,encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line">res=base64.b64encode(user_info_str.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># eyJuYW1lIjogImxxeiIsICJpZCI6IDF9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###  解码</span></span><br><span class="line">res=base64.b64decode(<span class="string">&#x27;TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ=&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 注意：base64长度是4的倍数，如果不足，需要用&#x27;=&#x27;补齐</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/" class="post-title-link" itemprop="url">Drf过认证权限频率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-15 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-15T18:20:25+08:00">2019-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-认证Authentication"><a href="#1-认证Authentication" class="headerlink" title="1.认证Authentication"></a>1.认证Authentication</h2><h3 id="1-1自定义认证"><a href="#1-1自定义认证" class="headerlink" title="1.1自定义认证"></a>1.1自定义认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义认证的实现:</span></span><br><span class="line">	写一个类,继承BaseAuththentication,重写authenticate方法,认证逻辑写在该方法内</span><br><span class="line">    	认证通过:</span><br><span class="line">            返回两个值,其中一个值最终给了Request对象的user</span><br><span class="line">        认证失败:</span><br><span class="line">            抛异常:APIException或者AuthenticationFailed</span><br></pre></td></tr></table></figure>

<h4 id="自定义认证流程"><a href="#自定义认证流程" class="headerlink" title="自定义认证流程"></a>自定义认证流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件编写自己的认证类,并继承继承BaseAuththentication父类,重写authenticate方法,认证逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义认证类</span></span><br><span class="line"><span class="comment"># 3.认证生效范围配置:</span></span><br><span class="line">	全局认证:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部认证:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,认证只生效该视图类</span></span><br><span class="line">        authentication_classes = [MyAuth]</span><br><span class="line">        </span><br><span class="line"><span class="comment"># ps:全局认证局部不认证</span></span><br><span class="line">    <span class="number">1.</span>先在settings.py中配置好全局认证</span><br><span class="line">    <span class="number">2.</span>视图类书写:authentication_classes = [](优先使用局部)</span><br></pre></td></tr></table></figure>

<h4 id="编写models"><a href="#编写models" class="headerlink" title="编写models"></a>编写models</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    username=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    user_type=models.IntegerField(choices=((<span class="number">1</span>,<span class="string">&#x27;超级用户&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;普通用户&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;二笔用户&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserToken</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    user=models.OneToOneField(to=<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line">    token=models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写认证类"><a href="#编写认证类" class="headerlink" title="编写认证类"></a>编写认证类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用下创建任一py文件并编写认证类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> AuthenticationFailed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyAuth</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="comment"># 从请求头中获取当次请求携带的token字符串(登录后会返回随机字符串,未登录则没有随机字符串)</span></span><br><span class="line">            token = request.META.get(<span class="string">&#x27;HTTP_TOKEN&#x27;</span>)</span><br><span class="line">            <span class="comment"># token = request.query_params.get(&#x27;token&#x27;)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;请求头中缺少token参数&#x27;</span>)</span><br><span class="line">            user_token = UserToken.objects.<span class="built_in">filter</span>(token=token).first()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_token:</span><br><span class="line">                <span class="keyword">return</span> user_token.user, token</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;校验失败&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写视图类"><a href="#编写视图类" class="headerlink" title="编写视图类"></a>编写视图类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入需要的py文件并编写视图类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> User, UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">    <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyAuth</span><br><span class="line">    <span class="keyword">import</span> uuid</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">LoginView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">   </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            user = User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                token = uuid.uuid4()</span><br><span class="line">                <span class="comment"># 根据user=user去查询,如果有,使用defaults更新,如果没有,新增一条</span></span><br><span class="line">                UserToken.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;, user=user)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;登陆成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;用户名或密码错误&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="全局认证"><a href="#全局认证" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        <span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部认证"><a href="#局部认证" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line">	<span class="comment"># 中括号内填写认证类名</span></span><br><span class="line">	authentication_classes = [MyAuth]</span><br></pre></td></tr></table></figure>

<h3 id="1-2内置认证"><a href="#1-2内置认证" class="headerlink" title="1.2内置认证"></a>1.2内置认证</h3><h4 id="全局认证-1"><a href="#全局认证-1" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <span class="comment"># session认证</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,   	<span class="comment"># 基本认证</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 认证失败会有两种可能的返回值:</span></span><br><span class="line">	<span class="number">401</span> Unauthorized 未认证</span><br><span class="line">	<span class="number">403</span> Permission Denied 权限被禁止</span><br></pre></td></tr></table></figure>

<h4 id="局部认证-1"><a href="#局部认证-1" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line"></span><br><span class="line">导入内置认证类:</span><br><span class="line">    <span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication, BasicAuthentication</span><br><span class="line"></span><br><span class="line">配置类属性:</span><br><span class="line">    authentication_classes = [SessionAuthentication, BasicAuthentication]</span><br></pre></td></tr></table></figure>

<h2 id="2-权限Permissions"><a href="#2-权限Permissions" class="headerlink" title="2.权限Permissions"></a>2.权限Permissions</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限控制可以限制用户对于视图的访问和对于具体数据对象的访问</span></span><br><span class="line">    -在执行视图的dispatch()方法前，会先进行视图访问权限的判断</span><br><span class="line">	-在通过get_object()获取具体对象时，会进行模型对象访问权限的判断</span><br></pre></td></tr></table></figure>

<h3 id="2-1自定义权限"><a href="#2-1自定义权限" class="headerlink" title="2.1自定义权限"></a>2.1自定义权限</h3><h4 id="自定义权限流程"><a href="#自定义权限流程" class="headerlink" title="自定义权限流程"></a>自定义权限流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件,编写权限类(继承或不继承BasePermission父类),重写has_permission方法,权限逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义权限类</span></span><br><span class="line"><span class="comment"># 3.权限生效范围配置:</span></span><br><span class="line">	全局权限:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写权限类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部权限:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,权限只生效该视图类</span></span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="编写权限类"><a href="#编写权限类" class="headerlink" title="编写权限类"></a>编写权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建任一py文件或写在上述认证类中都可</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">MyPermission</span>(<span class="params">BasePermission</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="keyword">if</span> request.user.user_type == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限"><a href="#全局权限" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限"><a href="#局部权限" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyPermission</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如需自定义权限，需继承rest_framework.permissions.BasePermission父类，并实现以下两个任何一个方法或全部</span></span><br><span class="line">    - `.has_permission(self, request, view)`</span><br><span class="line">      是否可以访问视图,view表示当前视图对象</span><br><span class="line"></span><br><span class="line">    - `.has_object_permission(self, request, view, obj)`</span><br><span class="line">      是否可以访问数据对象,view表示当前视图,obj为数据对象</span><br></pre></td></tr></table></figure>

<h3 id="2-2内置权限"><a href="#2-2内置权限" class="headerlink" title="2.2内置权限"></a>2.2内置权限</h3><h4 id="内置权限类"><a href="#内置权限类" class="headerlink" title="内置权限类"></a>内置权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf提供的内置权限类,一般配套内置认证使用</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny,IsAuthenticated,IsAdminUser,IsAuthenticatedOrReadOnly</span><br><span class="line">    - AllowAny 						<span class="comment"># 允许所有用户</span></span><br><span class="line">    - IsAuthenticated 				<span class="comment"># 仅通过认证的用户</span></span><br><span class="line">    - IsAdminUser 					<span class="comment"># 仅管理员用户</span></span><br><span class="line">    - IsAuthenticatedOrReadOnly 	<span class="comment"># 登陆认证用户可以对数据进行增删改操作，未登陆认证的只能查看数据</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限-1"><a href="#全局权限-1" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 通过认证的用户才有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 若未指明,则采用如下配置:</span></span><br><span class="line">	REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 所有用户都有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限-1"><a href="#局部权限-1" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [IsAuthenticated]</span><br></pre></td></tr></table></figure>

<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建超级用户，登陆到admin，创建普通用户(注意设置职员状态，也就是能登陆)</span></span><br><span class="line"><span class="comment"># 全局配置IsAuthenticated</span></span><br><span class="line"><span class="comment"># setting.py</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"> 	path(<span class="string">&#x27;test/&#x27;</span>, views.TestView.as_view()),</span><br><span class="line">    </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;个人中心&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 登陆到admin后台后，直接访问可以，如果没登陆，不能访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意:如果全局配置了</span></span><br><span class="line">	rest_framework.permissions.IsAdminUser</span><br><span class="line"><span class="comment"># 就只有管理员能访问，其他用户访问不了</span></span><br></pre></td></tr></table></figure>

<h2 id="3-访问频率Throttling"><a href="#3-访问频率Throttling" class="headerlink" title="3.访问频率Throttling"></a>3.访问频率Throttling</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问频率限制用处:</span></span><br><span class="line">    可以对接口访问的频次进行限制，以减轻服务器压力</span><br><span class="line">    一般用于付费购买次数,投票等场景使用</span><br></pre></td></tr></table></figure>

<h3 id="频率限制的使用"><a href="#频率限制的使用" class="headerlink" title="频率限制的使用"></a>频率限制的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制用户的访问次数，根据ip，根据用户id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写个类，继承基类，重写某个方法</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> BaseThrottle,SimpleRateThrottle</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">        scope = <span class="string">&#x27;ip_throttle&#x27;</span>  <span class="comment"># 一定要写</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="comment"># 返回谁，就以谁做限制</span></span><br><span class="line">            <span class="comment"># 按ip限制</span></span><br><span class="line">            <span class="built_in">print</span>(request.META)</span><br><span class="line">            <span class="keyword">return</span> request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在视图类中配置</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在配置文件中配置</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 频率限制的配置信息</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ip_throttle&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>  <span class="comment"># key要跟类中的scop对应，1分钟只能访问3此</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 局部使用</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局使用（在配置文件中）</span></span><br><span class="line">	<span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [<span class="string">&#x27;app01.auth.MyThrottle&#x27;</span>],</span><br></pre></td></tr></table></figure>

<h3 id="3-1自定义频率类"><a href="#3-1自定义频率类" class="headerlink" title="3.1自定义频率类"></a>3.1自定义频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义频率类逻辑:</span></span><br><span class="line">    <span class="number">1.</span>取出访问者ip</span><br><span class="line">    <span class="number">2.</span>判断当前ip不在访问字典里,添加进去,并且直接返回<span class="literal">True</span>,表示第一次访问,在字典里,继续往下走</span><br><span class="line">    <span class="number">3.</span>循环判断当前ip的列表，有值并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间</span><br><span class="line">    <span class="number">4.</span>判断当前列表长度:</span><br><span class="line">        当列表小于<span class="number">3</span>,说明一分钟以内访问不足三次,把当前时间插入到列表第一个位置,返回<span class="literal">True</span>,通过</span><br><span class="line">    	当大于等于<span class="number">3</span>,说明一分钟内访问超过三次,返回<span class="literal">False</span>验证失败</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 自定义频率类MyThrottles</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThrottles</span>():</span></span><br><span class="line">    VISIT_RECORD = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.history = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="comment"># 1.取出访问者ip</span></span><br><span class="line">        <span class="comment"># print(request.META)</span></span><br><span class="line">        ip = request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="comment"># 2.判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问</span></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> self.VISIT_RECORD:</span><br><span class="line">            self.VISIT_RECORD[ip] = [ctime, ]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        self.history = self.VISIT_RECORD.get(ip)</span><br><span class="line">        <span class="comment"># 3.循环判断当前ip的列表,有值并且当前时间减去列表最后一个时间大于60s,pop掉这种数据,这样列表中仅剩60s以内的访问时间</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> ctime - self.history[-<span class="number">1</span>] &gt; <span class="number">60</span>:</span><br><span class="line">            <span class="comment"># 默认取走列表中最后一个属性值</span></span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="comment"># 4.判断,当列表小于3,说明一分钟内访问不足三次,把当前时间插入到列表第一个位置,返回True,顺利通过</span></span><br><span class="line">        <span class="comment"># 5.当大于等于3,说明一分钟内访问超过三次，返回False验证失败</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history) &lt; <span class="number">3</span>:</span><br><span class="line">            self.history.insert(<span class="number">0</span>, ctime)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span> - (ctime - self.history[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h4 id="全局限次"><a href="#全局限次" class="headerlink" title="全局限次"></a>全局限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py文件中配置:</span></span><br><span class="line">	REST_FRAMEWORK = &#123; </span><br><span class="line">        <span class="comment"># 访问频率全局配置,访问限次已经在频率类中写好,不用指定</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>:[<span class="string">&#x27;app01.MyAuthenticate.MyThrottles&#x27;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部限次"><a href="#局部限次" class="headerlink" title="局部限次"></a>局部限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类里添加属性:</span></span><br><span class="line">	导入频率限次类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyThrottles</span><br><span class="line">    添加类属性:</span><br><span class="line">		throttle_classes = [MyThrottles,]</span><br></pre></td></tr></table></figure>

<h3 id="3-2内置频率类"><a href="#3-2内置频率类" class="headerlink" title="3.2内置频率类"></a>3.2内置频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf内置频率类,配套内置认证内置权限使用,频率类又区分为登录和未登录:</span></span><br><span class="line">	REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="comment"># 访问频率全局配置</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,		<span class="comment"># 未登录访问限次</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>		<span class="comment"># 登录访问限次</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;5/m&#x27;</span>,		<span class="comment"># 未登录一分钟访问限次五次</span></span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span>		<span class="comment"># 登录一分钟访问限次十次</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="限制匿名用户每分钟访问3次-未登录"><a href="#限制匿名用户每分钟访问3次-未登录" class="headerlink" title="限制匿名用户每分钟访问3次(未登录)"></a>限制匿名用户每分钟访问3次(未登录)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全局配置:</span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 使用second(秒),minute(分钟),hour(小时)或day(天)来指明周期。</span></span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="限制登陆用户每分钟访问10次"><a href="#限制登陆用户每分钟访问10次" class="headerlink" title="限制登陆用户每分钟访问10次"></a>限制登陆用户每分钟访问10次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.AnonRateThrottle</span></span><br><span class="line">	限制所有匿名未认证用户，使用IP区分用户。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;anon&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.UserRateThrottle</span></span><br><span class="line">	限制认证用户，使用User <span class="built_in">id</span> 来区分。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;user&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ScopedRateThrottle</span></span><br><span class="line">	限制用户对于每个视图的访问频次，使用ip或user <span class="built_in">id</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    <span class="comment"># 视图类:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactListView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        	throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">        	...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactDetailView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UploadView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># setting.py配置</span></span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;rest_framework.throttling.ScopedRateThrottle&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;contacts&#x27;</span>: <span class="string">&#x27;1000/day&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;uploads&#x27;</span>: <span class="string">&#x27;20/day&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/10/Drf%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F%E5%88%86%E9%A1%B5%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/10/Drf%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F%E5%88%86%E9%A1%B5%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">Drf过滤排序分页异常处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-10T18:20:25+08:00">2019-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf过滤排序分页异常处理"><a href="#Drf过滤排序分页异常处理" class="headerlink" title="Drf过滤排序分页异常处理"></a>Drf过滤排序分页异常处理</h1><h2 id="1-过滤Filtering"><a href="#1-过滤Filtering" class="headerlink" title="1.过滤Filtering"></a>1.过滤Filtering</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装过滤第三方模块</span></span><br><span class="line">	pip3 install django-<span class="built_in">filter</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># settings.py中注册应用</span></span><br><span class="line">	INSTALLED_APPS = [</span><br><span class="line">    	<span class="string">&#x27;django_filters&#x27;</span>,  <span class="comment"># 注册应用</span></span><br><span class="line">	]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 无论是全局过滤还是局部过滤,前提是都需要指定过滤字段</span></span><br><span class="line">	视图类中添加类属性:</span><br><span class="line">		filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局过滤</span></span><br><span class="line">	settings.py:</span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">            <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 局部过滤:</span></span><br><span class="line">	导入过滤模块:</span><br><span class="line">        <span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line">    添加类属性:</span><br><span class="line">        filter_backends = [DjangoFilterBackend,]</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ListAPIView</span>):</span></span><br><span class="line">        queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookSerializer</span><br><span class="line">        filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 127.0.0.1:8000/four/students/?sex=1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置g类(既有排序，又有过滤)</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter,SearchFilter</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在视图类中配置，最顶层的类至少是GenericAPIView</span></span><br><span class="line">    filter_backends = [SearchFilter,OrderingFilter,]</span><br><span class="line">    <span class="comment"># 过滤条件，按名字过滤</span></span><br><span class="line">    search_fields=[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="comment"># 按哪个字段排序</span></span><br><span class="line">    ordering_fields=[<span class="string">&#x27;price&#x27;</span>,<span class="string">&#x27;id&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h2 id="2-排序"><a href="#2-排序" class="headerlink" title="2.排序"></a>2.排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局排序</span></span><br><span class="line">	settings.py:</span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">    		<span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: ( </span><br><span class="line">        	<span class="string">&#x27;rest_framework.filters.OrderingFilter&#x27;</span>,)</span><br><span class="line">		&#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 局部排序</span></span><br><span class="line">	导入过滤模块:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line">    添加类属性:</span><br><span class="line">        filter_backends = [OrderingFilter,]</span><br><span class="line">        </span><br><span class="line">eg:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentListView</span>(<span class="params">ListAPIView</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        filter_backends = [OrderingFilter]</span><br><span class="line">        ordering_fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 127.0.0.1:8000/books/?ordering=-age</span></span><br><span class="line">    <span class="comment"># -id 表示针对id字段进行倒序排序</span></span><br><span class="line">    <span class="comment"># id  表示针对id字段进行升序排序</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># 如果需要在过滤后再进行排序,两者结合使用</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line">    <span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line">	<span class="keyword">from</span> app01.models <span class="keyword">import</span> Book</span><br><span class="line">    <span class="keyword">from</span> app01.ManySerializer <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        queryset = Book.objects</span><br><span class="line">        serializer_class = BookSerializer</span><br><span class="line">        <span class="comment"># 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,</span></span><br><span class="line">    	<span class="comment"># 否则过滤功能会失效</span></span><br><span class="line">        filter_backends = [DjangoFilterBackend, OrderingFilter]</span><br><span class="line">        filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-分页功能"><a href="#3-分页功能" class="headerlink" title="3.分页功能"></a>3.分页功能</h2><h3 id="3-1PageNumberPagination-基本分页"><a href="#3-1PageNumberPagination-基本分页" class="headerlink" title="3.1PageNumberPagination 基本分页"></a>3.1PageNumberPagination 基本分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	page_size = api_settings.PAGE_SIZE	<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">	page_query_param = <span class="string">&#x27;page&#x27;</span>			<span class="comment"># 该属性指定分页时的查询依据(xxx/book/?page=1)</span></span><br><span class="line">    page_size_query_param = <span class="literal">None</span>		<span class="comment"># 该属性指定返回条数</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>           		<span class="comment"># 该属性指定每页最多显示条数(优先级大于上一条)</span></span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承PageNumberPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonPageNumberPagination</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">        page_size = <span class="number">2</span>  				 <span class="comment"># 指定每页显示条数</span></span><br><span class="line">        page_query_param = <span class="string">&#x27;page&#x27;</span>  	 <span class="comment"># 查询时用的参数xxx/books/?page=2 查询第二页数据</span></span><br><span class="line">        page_size_query_param=<span class="string">&#x27;size&#x27;</span> <span class="comment"># 传递该参数可指定该页返回数据条数</span></span><br><span class="line">    	max_page_size = <span class="number">10</span>  		 <span class="comment"># 指定每页最多显示10条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonPageNumberPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?page=<span class="number">3</span>			<span class="comment"># 查询第三页数据,显示默认展示条数</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?page=<span class="number">2</span>&amp;size=<span class="number">5</span>	<span class="comment"># 查询第二页,指定显示五条数据</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2LimitOffsetPagination-偏移分页"><a href="#3-2LimitOffsetPagination-偏移分页" class="headerlink" title="3.2LimitOffsetPagination 偏移分页"></a>3.2LimitOffsetPagination 偏移分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> LimitOffsetPagination</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	default_limit = api_settings.PAGE_SIZE	<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">	page_query_param = <span class="string">&#x27;limit&#x27;</span>				<span class="comment"># 该属性指定显示数据条数</span></span><br><span class="line">    offset_query_param = <span class="string">&#x27;offset&#x27;</span>			<span class="comment"># 该属性指定偏移的查询参数(从xx条开始时查询)</span></span><br><span class="line">    max_limit = <span class="literal">None</span>           				<span class="comment"># 该属性指定每页最多显示条数</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承LimitOffsetPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> LimitOffsetPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonLimitOffsetPagination</span>(<span class="params">LimitOffsetPagination</span>):</span></span><br><span class="line">        default_limit = <span class="number">2</span>  				<span class="comment"># 指定每页显示条数</span></span><br><span class="line">        page_query_param = <span class="string">&#x27;limit&#x27;</span>   	<span class="comment"># 指定显示数据条数</span></span><br><span class="line">        offset_query_param = <span class="string">&#x27;offset&#x27;</span>	<span class="comment"># 指定显示数据的开始位置(索引)</span></span><br><span class="line">    	max_page_size = <span class="number">10</span>  		 	<span class="comment"># 每页最多显示10条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonLimitOffsetPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?limit=<span class="number">2</span>			<span class="comment"># 查询两条数据(索引0和1的数据)</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?limit=<span class="number">2</span>&amp;offset=<span class="number">4</span>	<span class="comment"># 查询两条数据,从第四条开始展示第五第六条</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3CursorPagination-游标分页"><a href="#3-3CursorPagination-游标分页" class="headerlink" title="3.3CursorPagination 游标分页"></a>3.3CursorPagination 游标分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> CursorPagination</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	page_size = api_settings.PAGE_SIZE		<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">    cursor_query_param = <span class="string">&#x27;cursor&#x27;</span>   		<span class="comment"># 该属性指定分页时的查询依据(不可指定)</span></span><br><span class="line">    ordering = <span class="string">&#x27;-created&#x27;</span>              		<span class="comment"># 排序,默认按字段-created排序</span></span><br><span class="line">    page_size_query_param = <span class="literal">None</span>			<span class="comment"># 该属性指定显示条数</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>           			<span class="comment"># 该属性指定每页最多显示条数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优缺点:</span></span><br><span class="line">	优点:速度最快，数据量越大,越有优势</span><br><span class="line">	缺点:只能前一页和后一页,不能直接跳到某一页</span><br></pre></td></tr></table></figure>

<h4 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承PageNumberPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> CursorPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonCursorPagination</span>(<span class="params">CursorPagination</span>):</span>  </span><br><span class="line">        page_size = <span class="number">2</span>  						<span class="comment"># 每页显示两条</span></span><br><span class="line">        cursor_query_param = <span class="string">&#x27;cursor&#x27;</span>  		<span class="comment"># 查询条件(只能上一页下一页)</span></span><br><span class="line">        ordering = <span class="string">&#x27;id&#x27;</span>  					<span class="comment"># 排序，按id升序排序</span></span><br><span class="line">        page_size_query_param = <span class="string">&#x27;size&#x27;</span>  	<span class="comment"># 通过这个参数决定每页显示多少条</span></span><br><span class="line">        max_page_size = <span class="number">5</span>  					<span class="comment"># 每页最大显示五条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonCursorPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/book/?cursor=cD0y			<span class="comment"># 查询某页数据,显示默认条数</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?cursor=cD0y&amp;size=<span class="number">5</span>	<span class="comment"># 查询某页(上下页)数据,显示五条</span></span><br></pre></td></tr></table></figure>

<h3 id="分页总结"><a href="#分页总结" class="headerlink" title="分页总结"></a>分页总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PageNumberPagination 基本分页		可以实现查某一页数据和指定显示条数(数据量越大查询效率越低)</span></span><br><span class="line"><span class="comment"># LimitOffsetPagination 偏移分页	可以实现查指定条数据和指定查询数据的起始位置</span></span><br><span class="line"><span class="comment"># CursorPagination 游标分页			可以实现查询当前页数据和指定显示条数,默认不展示数据总数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ps:</span></span><br><span class="line">	当数据量不大时可以使用基本分页,简单方便实现展示xx页xx条数据(每次查询从第一条开始检索)</span><br><span class="line">    偏移分页可以指定显示数据的开始位置(每次查询可以指定开始检索的位置)</span><br><span class="line">	当数据量很大时可以使用游标分页来提升查询效率,但是他不可以指定查询页数,只可以上一页下一页(每次查询保留当前被检索数据位置) </span><br></pre></td></tr></table></figure>

<h3 id="继承APIView实现三种分页-类似"><a href="#继承APIView实现三种分页-类似" class="headerlink" title="继承APIView实现三种分页(类似)"></a>继承APIView实现三种分页(类似)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookViewALL</span>(<span class="params">APIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,*args,**kwargs</span>):</span></span><br><span class="line">        book_list=Books.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 实例化得到一个对象,自定义的基本分页类</span></span><br><span class="line">        pagination=CommonPageNumberPagination()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用该对象paginate_queryset方法,传入需要分页的数据,返回分页好的数据</span></span><br><span class="line">        book_list2=pagination.paginate_queryset(book_list,request,self)</span><br><span class="line">        </span><br><span class="line">		<span class="comment"># 传入分页后的数据并序列化 </span></span><br><span class="line">        ser=BookSerializer(instance=book_list2,many=<span class="literal">True</span>)</span><br><span class="line">        res=&#123;<span class="string">&#x27;pre&#x27;</span>:pagination.get_previous_link(),<span class="string">&#x27;next&#x27;</span>:pagination.get_next_link(),<span class="string">&#x27;count&#x27;</span>:pagination.page.paginator.count,<span class="string">&#x27;data&#x27;</span>:ser.data&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(res)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 另一种返回方式</span></span><br><span class="line">        <span class="comment"># return pagination.get_paginated_response(ser.data)</span></span><br><span class="line">        </span><br><span class="line">   </span><br><span class="line"><span class="comment"># pagination对象属性:</span></span><br><span class="line">	get_previous_link()				<span class="comment"># 上一页</span></span><br><span class="line">    pagination.get_next_link()		<span class="comment"># 下一页</span></span><br><span class="line">    pagination.page.paginator.count	<span class="comment"># 总的数据量</span></span><br></pre></td></tr></table></figure>

<h2 id="4-异常处理"><a href="#4-异常处理" class="headerlink" title="4.异常处理"></a>4.异常处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 全局统一捕获异常，返回固定的格式  &#123;code:<span class="number">999</span>,msg:<span class="string">&#x27;未知错误&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 使用步骤</span><br><span class="line">	-写一个函数</span><br><span class="line">    -在配置文件中配置</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line"><span class="comment">#  写函数</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">common_exception_handler</span>(<span class="params">exc, context</span>):</span></span><br><span class="line">    <span class="comment"># 记录日志</span></span><br><span class="line">    <span class="built_in">print</span>(context[<span class="string">&#x27;request&#x27;</span>].META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>))</span><br><span class="line">    response=exception_handler(exc, context)</span><br><span class="line">    <span class="keyword">if</span> response:  <span class="comment"># 处理了drf的异常</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">999</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;错误&#x27;</span>,<span class="string">&#x27;detail&#x27;</span>:response.data&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 不知道的异常</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">999</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;未知错误&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 配置文件配置</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="string">&#x27;app01.utils.commonexception_handler&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/05/RBAC%E6%9D%83%E9%99%90%E5%85%B3%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/05/RBAC%E6%9D%83%E9%99%90%E5%85%B3%E7%B3%BB/" class="post-title-link" itemprop="url">RBAC权限关系</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-05 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-05T18:20:25+08:00">2019-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="RBAC权限关系"><a href="#RBAC权限关系" class="headerlink" title="RBAC权限关系"></a>RBAC权限关系</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RBAC:Role-Based Access Control --&gt;基于角色的访问控制</span></span><br><span class="line"><span class="comment"># 公司内部系统，crm：客户关系管理，oa系统，自动化运维项目</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RBAC原理：</span></span><br><span class="line">	权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。这就极大地简化了权限的管理。这样管理都是层级相互依赖的，权限赋予给角色，而把角色又赋予用户，这样的权限设计很清楚，管理起来很方便</span><br><span class="line"></span><br><span class="line"><span class="comment"># Django的 Auth组件(app) 采用的认证规则就是RBAC</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何实现rbac，django的auth如何实现?</span></span><br><span class="line">	 -User表：存用户信息</span><br><span class="line">     -Permission表：存权限:发工资，招人</span><br><span class="line">     -Role表: 存角色：市场，销售，运营，开发，运维，测试...</span><br><span class="line">     -用户和角色是多对多，中间表</span><br><span class="line">     -权限和角色是多对多，中间表</span><br><span class="line">     -用户和权限是多对多，中间表</span><br><span class="line">        </span><br><span class="line"> <span class="comment"># django的auth的表</span></span><br><span class="line">    auth_group：组表，角色表</span><br><span class="line">    auth_permission：权限表</span><br><span class="line">    auth_user：用户表</span><br><span class="line">    auth_group_permissions:角色和权限多对多中间表</span><br><span class="line">    auth_user_groups：用户和角色多对多中间表</span><br><span class="line">    auth_user_user_permissions：用户和权限多对多的中间表</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django有个后台管理admin,自带rbac,有的公司基于admin做二次开发(xadmin,simple-ui)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有的公司自己基于前后端分离实现rbac</span></span><br><span class="line">	-https://github.com/liqianglog/django-vue-admin</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 前后端混合的后台前端模板    </span></span><br><span class="line"> 	X-admin:lay-ui+jq实现的纯静态页面(html，css，js)，帮助我们快速开发后台管理系统</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 智慧大屏</span></span><br><span class="line">	https://gitee.com/kevin_chou/dataVIS.git</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/29/Drf%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/29/Drf%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">Drf序列化组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-29 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-29T18:20:25+08:00">2019-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="序列化组件"><a href="#序列化组件" class="headerlink" title="序列化组件"></a>序列化组件</h1><h2 id="1-序列化器-Serializer"><a href="#1-序列化器-Serializer" class="headerlink" title="1.序列化器-Serializer"></a>1.序列化器-Serializer</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化组件的作用：</span></span><br><span class="line">	<span class="number">1.</span>序列化,序列化器(类)会把模型对象(Book对象，Queryset对象)转换成字典,经过response以后变成json格式字符串</span><br><span class="line">	<span class="number">2.</span>反序列化,把客户端发送过来的数据,经过request以后变成字典(request.data),序列化器(类)可以把字典转成模型,再存储入数据库</span><br><span class="line">	<span class="number">3.</span>反序列化,完成数据校验功能</span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化组件的本质：</span></span><br><span class="line">	写一个类，继承一个基类(Serializer),可以完成序列化，反序列化和数据校验</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">序列化过程:</span><br><span class="line">	把queryset转成字典,第一个参数instance是要序列化的对象,如果序列化多条数据，一定要加上many=<span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">反序列化过程</span><br><span class="line">	修改:</span><br><span class="line">    	第一个参数instance传要修改的对象,第二个单数data传被修改的数据(更新要重写update方法)</span><br><span class="line">	新增:</span><br><span class="line">    	第一个参数instance不用传,第二个参数data要传新增的数据(新增要重写create方法)</span><br><span class="line">  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	serializer不是只能为数据库模型类定义,也可以为非数据库模型类的数据定义 serializer是独立于数据库之外的存在</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p><strong>视图层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化器的使用</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> .serizlizer <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment">#查询所有接口</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        book_list=Books.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 序列化过程，把queryset转成字典</span></span><br><span class="line">        <span class="comment"># 第一个参数是要序列化的对象,如果序列化多条数据，一定要加上many=True</span></span><br><span class="line">        ser=BookSerializer(instance=book_list,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span>(ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        ser=BookSerializer(data=request.data) <span class="comment">#新增，不用传instance</span></span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookDetailAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 查询单个</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line"></span><br><span class="line">        book = Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 序列化过程，把Book转成字典</span></span><br><span class="line">        <span class="comment"># 第一个参数是要序列化的对象,序列化单条数据不用加many=True</span></span><br><span class="line">        ser = BookSerializer(instance=book)</span><br><span class="line">        <span class="built_in">print</span>(ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        Books.objects.<span class="built_in">filter</span>(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line"></span><br><span class="line">        book=Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 反序列化，修改</span></span><br><span class="line">        <span class="comment"># instance 传要修改的对象,data 传被修改后的数据</span></span><br><span class="line">        ser=BookSerializer(instance=book,data=request.data)  <span class="comment">#修改</span></span><br><span class="line">        <span class="comment"># 校验数据</span></span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save() <span class="comment"># 报错</span></span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure>

<p><strong>序列化类</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建任一py文件,并写入序列化类</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="comment">#写字段（要序列化，反序列化的字段）</span></span><br><span class="line">    name=serializers.CharField()</span><br><span class="line">    price=serializers.IntegerField()</span><br><span class="line">    publish=serializers.CharField()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 局部钩子函数validate_字段名</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;价格太高&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 全局钩子函数validate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name == publish:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要更新，一定要重写update方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 修改</span></span><br><span class="line">        instance.name=validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.price=validated_data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">        instance.publish=validated_data.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        <span class="comment"># 修改后一定要保存!</span></span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="comment"># 返回</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要新增，一定要重写create方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 保存</span></span><br><span class="line">        book=Books.objects.create(**validated_data)</span><br><span class="line">        <span class="comment"># 一定记得return</span></span><br><span class="line">        <span class="keyword">return</span> book </span><br></pre></td></tr></table></figure>

<p><strong>路由层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># drf继承APIView的路由</span></span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, views.BookAPIView.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;&#x27;</span>, views.BookDetailAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>模型层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=models.IntegerField()</span><br><span class="line">    publish=models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-1自定义序列化器"><a href="#1-1自定义序列化器" class="headerlink" title="1.1自定义序列化器"></a>1.1自定义序列化器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">自定义序列化器流程:</span><br><span class="line">	<span class="number">1.</span>创建任一py文件,写入一个序列化类,继承Serializer(serializers.Serializer)</span><br><span class="line">	<span class="number">2.</span>在该类中写需要序列化或反序列化的字段,字段的属性(max_lenth...)</span><br><span class="line">        常用字段:</span><br><span class="line">            CharField,DecimalField,DateField,IntegerField</span><br><span class="line">        常用字段属性:</span><br><span class="line">            max_length			<span class="comment"># 最大长度</span></span><br><span class="line">            min_lenght			<span class="comment"># 最小长度</span></span><br><span class="line">            allow_blank			<span class="comment"># 是否允许为空</span></span><br><span class="line">            trim_whitespace		<span class="comment"># 是否截断空白字符</span></span><br><span class="line">            max_value			<span class="comment"># 最大值</span></span><br><span class="line">            min_value			<span class="comment"># 最小值</span></span><br><span class="line">        通用参数:</span><br><span class="line">            read_only		<span class="comment"># 表明该字段仅用于序列化输出，默认False</span></span><br><span class="line">            write_only		<span class="comment"># 表明该字段仅用于反序列化输入，默认False</span></span><br><span class="line">            required		<span class="comment"># 表明该字段在反序列化时必须输入，默认True</span></span><br><span class="line">            default			<span class="comment"># 反序列化时使用的默认值</span></span><br><span class="line">            allow_null		<span class="comment"># 表明该字段是否允许传入None，默认False</span></span><br><span class="line">            validators		<span class="comment"># 该字段使用的验证器</span></span><br><span class="line">            error_messages	<span class="comment"># 包含错误编号与错误信息的字典</span></span><br><span class="line">            label			<span class="comment"># 用于HTML展示API页面时，显示的字段名称</span></span><br><span class="line">            help_text		<span class="comment"># 用于HTML展示API页面时，显示的字段帮助提示信息</span></span><br><span class="line">            </span><br><span class="line">    <span class="number">3.</span>视图类中导入该序列化类,传入要修改的对象和数据实例化得到一个该类对象</span><br><span class="line">    	<span class="comment"># 修改,要传instance(被修改对象),要在序列化类中重写update方法</span></span><br><span class="line">    	ser=BookSerializer(instance=book,data=request.data)</span><br><span class="line">        <span class="comment"># 新增,不用传instance,要在序列化类中重写create方法</span></span><br><span class="line">        ser=BookSerializer(data=request.data) </span><br><span class="line">        </span><br><span class="line">    <span class="number">4.</span>数据校验 <span class="keyword">if</span> ser.valid()</span><br><span class="line">    <span class="number">5.</span>校验通过则保存,不通过则自己写错误提示逻辑</span><br><span class="line">    <span class="number">7.</span>如果字段校验规则不够,还可以使用钩子函数(局部钩子,全局钩子)</span><br><span class="line">    	<span class="comment"># 局部钩子函数(validate_字段名)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太高&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全局钩子函数(validate)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">            name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">            publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> name == publish:</span><br><span class="line">                <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> attrs</span><br><span class="line">            </span><br><span class="line">    <span class="number">8.</span>还可以用name=serializer.CharField(validators=[check_name])校验</span><br><span class="line">    	<span class="number">1.</span>写一个函数:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">check_name</span>(<span class="params">data</span>):</span></span><br><span class="line">                <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">                    <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;姓名不能以sb开头&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">        <span class="number">2.</span>配置字段参数:validators=[check_name]</span><br></pre></td></tr></table></figure>

<h3 id="1-2使用序列化器"><a href="#1-2使用序列化器" class="headerlink" title="1.2使用序列化器"></a>1.2使用序列化器</h3><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化器的使用分为两个阶段:</span></span><br><span class="line">	<span class="number">1.</span>在服务器响应时,使用序列化器可以完成对数据的序列化</span><br><span class="line">	<span class="number">2.</span>在客户端请求时,使用序列化器可以完成对数据的反序列化</span><br></pre></td></tr></table></figure>

<h5 id="基本用法-many源码"><a href="#基本用法-many源码" class="headerlink" title="基本用法(many源码)"></a>基本用法(many源码)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    <span class="comment"># 1.先查询出一个书籍对象</span></span><br><span class="line">    book = Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">    <span class="comment"># 2.构造序列化器(序列化过程)</span></span><br><span class="line">    <span class="comment"># 序列化单条数据</span></span><br><span class="line">    book_one_ser = BookSerializer(instance=book)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 序列化多条数据,加参数many=True</span></span><br><span class="line">    <span class="comment"># book_many_ser = BookSerializer(instance=book_list,many=True)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.通过data属性可以获取序列化后的数据(book_one_ser.data)并返回给前端</span></span><br><span class="line">    <span class="keyword">return</span> Response(book_one_ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	上述的book_one_ser和book_many_ser并不是同一个类实例化得到的</span></span><br><span class="line"><span class="string">		print(type(book_one_ser)) --&gt; &lt;class &#x27;app01.ser.BookModelSerializer&#x27;&gt;</span></span><br><span class="line"><span class="string">		print(type(book_many_ser))--&gt; &lt;class &#x27;rest_framework.serializers.ListSerializer&#x27;&gt;</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	对象的生成流程:</span></span><br><span class="line"><span class="string">		1.先调用类的__new__方法,生成空对象</span></span><br><span class="line"><span class="string">		2.类实例化得到对象触发__init__()</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">	***类的__new__方法控制对象的生成***</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	eg:</span></span><br><span class="line"><span class="string">		def __new__(cls,*args,**kwargs):</span></span><br><span class="line"><span class="string">			if kwargs.pop(&#x27;many&#x27;,False)</span></span><br><span class="line"><span class="string">				return cls.many_init(*args,**kwars)</span></span><br><span class="line"><span class="string">			# 没有传many=True走下面,正常的对象实例化</span></span><br><span class="line"><span class="string">			return super().__new__(cls,*args,**kwargs)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.source</span></span><br><span class="line">	<span class="number">1.</span>可以改字段名 xxx=serializer.CharField(source=<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="number">2.</span>可以<span class="string">&#x27;.&#x27;</span>跨表 publish=serializer.CharField(source=<span class="string">&#x27;publish.name&#x27;</span>)</span><br><span class="line">    <span class="number">3.</span>可以执行方法 func=serializer.CharField(source=<span class="string">&#x27;test&#x27;</span>) --&gt; test是Book表模型中的方法</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 2.SerializerMethodField()(多用于关联表中其他表字段返回或重写字段)</span></span><br><span class="line">	前提:它需要有一个配套方法,方法名叫<span class="string">&#x27;get_字段名&#x27;</span>,该方法返回值就是该字段要显示的数据</span><br><span class="line">    eg:其他表字段返回</span><br><span class="line">        authors=serializer.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span>(<span class="params">self,obj</span>):</span></span><br><span class="line">            <span class="comment"># book对象</span></span><br><span class="line">            authors = obj.authors.<span class="built_in">all</span>() <span class="comment"># 取出所有作者</span></span><br><span class="line">            authors_list = []</span><br><span class="line">            <span class="keyword">for</span> author <span class="keyword">in</span> authors:</span><br><span class="line">                authors_list.append(&#123;<span class="string">&#x27;name&#x27;</span>:author.name,<span class="string">&#x27;age&#x27;</span>:author.age&#125;)</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># authors_list=[&#123;name&#x27;:author.name,&#x27;age&#x27;:author.age&#125; for author in authors]</span></span><br><span class="line">            <span class="keyword">return</span> authors_list</span><br><span class="line">        </span><br><span class="line">    eg:重写字段展示</span><br><span class="line">        name = serializers.SerializerMethodField()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">             <span class="keyword">return</span> <span class="string">&#x27;优秀的:&#x27;</span> + obj.name</span><br></pre></td></tr></table></figure>

<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><h5 id="普通数据验证"><a href="#普通数据验证" class="headerlink" title="普通数据验证"></a>普通数据验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反序列化数据验证:</span></span><br><span class="line">    <span class="number">1.</span>使用序列化器进行反序列化时,需要对数据进行验证后,才能获取验证成功的数据保存成模型类对象</span><br><span class="line">    <span class="number">2.</span>在获取反序列化的数据前，必须调用is_valid()方法进行验证，验证成功返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line">    <span class="number">3.</span>验证失败，可以通过序列化器对象的errors属性获取错误信息，返回字典，包含了字段和其他的错误。如果是非字段错误，可以通过修改REST framework配置中的NON_FIELD_ERRORS_KEY来控制错误字典中的键名</span><br><span class="line">    <span class="number">4.</span>验证成功，可以通过序列化器对象的validated_data属性获取数据</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 定义序列化器时,指明每个字段的序列化类型和选项参数,本身就是一种验证行为</span></span><br><span class="line"><span class="comment"># 即字段自己的校验规则</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Ser</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">            name = serializers.CharField(min_length=<span class="number">3</span>,max_lenth=<span class="number">8</span>)</span><br><span class="line">            age = serializers.CharField(min_length=<span class="number">3</span>,max_lenth=<span class="number">8</span>)</span><br><span class="line">			...</span><br><span class="line">            </span><br><span class="line">    通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进而进行验证</span><br><span class="line">    	<span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="comment"># 自己封装的返回对象</span></span><br><span class="line">            back_dic = MyResponse()</span><br><span class="line">            <span class="comment"># 传入需要校验的数据至序列化类并实例化</span></span><br><span class="line">            ser = Ser(data=request.data)</span><br><span class="line">			<span class="comment"># 判断数据校验的结果</span></span><br><span class="line">            <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">                ser.save()</span><br><span class="line">                back_dic.data = ser.data</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                back_dic.code = <span class="number">201</span></span><br><span class="line">                back_dic.msg = <span class="string">&#x27;创建失败&#x27;</span></span><br><span class="line">                back_dic.errors = ser.errors</span><br><span class="line">                </span><br><span class="line">			<span class="comment"># 调用返回对象的get_dic方法返回数据</span></span><br><span class="line">            <span class="keyword">return</span> Response(back_dic.get_dic)</span><br></pre></td></tr></table></figure>

<h5 id="钩子函数验证"><a href="#钩子函数验证" class="headerlink" title="钩子函数验证"></a>钩子函数验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>validate_字段名</span><br><span class="line">    <span class="comment"># 局部钩子函数validate_字段名</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太高&#x27;</span>)</span><br><span class="line">            </span><br><span class="line"><span class="number">2.</span>validate</span><br><span class="line">    <span class="comment"># 全局钩子函数validate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name == publish:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure>

<h5 id="validators验证"><a href="#validators验证" class="headerlink" title="validators验证"></a>validators验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">validators验证:</span><br><span class="line">	eg:</span><br><span class="line">		name=serializer.CharField(validators=[check_name])</span><br><span class="line">	</span><br><span class="line">    	<span class="number">1.</span>写一个函数:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">check_name</span>(<span class="params">data</span>):</span></span><br><span class="line">                <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">                    <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;姓名不能以sb开头&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">                </span><br><span class="line">        <span class="number">2.</span>配置字段参数:validators=[check_name]</span><br></pre></td></tr></table></figure>

<h5 id="反序列化-保存数据"><a href="#反序列化-保存数据" class="headerlink" title="反序列化-保存数据"></a>反序列化-保存数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">反序列化-保存数据(序列化类中书写):</span><br><span class="line">    <span class="comment"># 如果要更新，一定要重写update方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 修改数据</span></span><br><span class="line">        instance.name=validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.price=validated_data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">        instance.publish=validated_data.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        <span class="comment"># 修改后一定要保存!</span></span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="comment"># 返回</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要新增，一定要重写create方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        book=Books.objects.create(**validated_data)</span><br><span class="line">        <span class="comment"># 一定要记得return</span></span><br><span class="line">        <span class="keyword">return</span> book </span><br></pre></td></tr></table></figure>

<h2 id="2-模型类序列化器ModelSerializer"><a href="#2-模型类序列化器ModelSerializer" class="headerlink" title="2.模型类序列化器ModelSerializer"></a>2.模型类序列化器ModelSerializer</h2><p><strong>简介</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">	如果我们想要使用序列化器对应的是Django的模型类，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类</span><br><span class="line">	</span><br><span class="line">	ModelSerializer与常规的Serializer相同，但提供了:</span><br><span class="line">        基于模型类自动生成一系列字段</span><br><span class="line">        包含默认的create()和update()的实现</span><br><span class="line">        基于模型类自动为Serializer生成validators,比如unique_together(联合唯一)</span><br><span class="line">       </span><br><span class="line"><span class="comment"># 数据库字段联合唯一:</span></span><br><span class="line">	字段联合唯一(unique_together):</span><br><span class="line">	eg:</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">            name = models.CharField(<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            age = models.CharField(<span class="string">&#x27;年龄&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            height = models.CharField(<span class="string">&#x27;身高&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            width = models.CharField(<span class="string">&#x27;体重&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">                unique_together = ((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>,<span class="string">&quot;height&quot;</span>),)</span><br><span class="line"></span><br><span class="line">	上述表示该表中每一条数据的name,age,heght字段值联合唯一</span><br></pre></td></tr></table></figure>

<h3 id="2-1ModelSerializer定义"><a href="#2-1ModelSerializer定义" class="headerlink" title="2.1ModelSerializer定义"></a>2.1ModelSerializer定义</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建任一py文件,写入序列化类,并继承ModelSerializer</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student			<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>    	<span class="comment"># 生效所有字段   </span></span><br><span class="line">        depth = <span class="number">3</span>				<span class="comment"># 映射深度(表示跨三张表展示数据),一般不用</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># model: 指明参照哪个模型类(models.py中的类即数据库里的表)</span></span><br><span class="line"><span class="comment"># fields: 指明模型类的哪些字段生成</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2指定生效字段"><a href="#2-2指定生效字段" class="headerlink" title="2.2指定生效字段"></a>2.2指定生效字段</h3><h4 id="1-使用fields来明确字段"><a href="#1-使用fields来明确字段" class="headerlink" title="1.使用fields来明确字段"></a>1.使用fields来明确字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student					<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)    <span class="comment"># 指定生效字段  </span></span><br></pre></td></tr></table></figure>

<h4 id="2-使用exclude排除字段"><a href="#2-使用exclude排除字段" class="headerlink" title="2.使用exclude排除字段"></a>2.使用exclude排除字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意:exclude和fields不可以同时使用</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student				<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        exclude = (<span class="string">&#x27;id&#x27;</span>,)			<span class="comment"># 排除该字段(默认所有字段生效)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-添加额外字段参数"><a href="#3-添加额外字段参数" class="headerlink" title="3.添加额外字段参数"></a>3.添加额外字段参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">read_only和wirte_only:</span><br><span class="line">    <span class="comment"># 序列化的时候该字段生效,反序列化无效</span></span><br><span class="line">    width=serializers.CharField(read_only=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 反序列化时候该字段生效,序列化时候无效</span></span><br><span class="line">    height=serializers.CharField(write_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用extra_kwargs参数为ModelSerializer添加或修改原有的选项参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = Student</span><br><span class="line">    <span class="comment"># fields = &#x27;__all__&#x27;</span></span><br><span class="line">    <span class="comment"># 指定展示字段</span></span><br><span class="line">    fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;width&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 类似于 width = serializers.CharField(write_only=True,&#x27;max_length&#x27;:6)</span></span><br><span class="line">    extra_kwargs = &#123;</span><br><span class="line">        <span class="string">&#x27;width&#x27;</span>: &#123;<span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span>,<span class="string">&#x27;max_lenth&#x27;</span>:<span class="number">6</span>&#125;,   	<span class="comment"># 序列化的时候使用</span></span><br><span class="line">        <span class="string">&#x27;height&#x27;</span>: &#123;<span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>&#125;  				<span class="comment"># 反序列化的时候使用</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> app01.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 局部钩子校验</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">18</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太小啦&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">	<span class="comment"># 全局钩子校验</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        height = attrs.get(<span class="string">&#x27;height&#x27;</span>)</span><br><span class="line">        width = attrs.get(<span class="string">&#x27;width&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> height == width:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;身材不同寻常,不可创建&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 序列化的时候该字段生效,反序列化无效</span></span><br><span class="line">    name=serializers.CharField(read_only=<span class="literal">True</span>)  </span><br><span class="line">    <span class="comment"># 反序列化时候该字段生效,序列化时候无效</span></span><br><span class="line">    age=serializers.CharField(write_only=<span class="literal">True</span>)</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 重写字段</span></span><br><span class="line">	name = serializers.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">         <span class="keyword">return</span> <span class="string">&#x27;优秀的:&#x27;</span> + obj.name</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 扩写字段(name_detail方法已经在models.py中写好,该字段展示此方法返回值)</span></span><br><span class="line">	name_detail=serializers.CharField(source=<span class="string">&#x27;name_detail&#x27;</span>) <span class="comment"># 执行方法</span></span><br><span class="line">    addr=serializers.CharField(source=<span class="string">&#x27;detail.addr&#x27;</span>) <span class="comment"># .跨表拿数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 多用于跨表连表数据的展示</span></span><br><span class="line">    authors=serializer.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span>(<span class="params">self,obj</span>):</span></span><br><span class="line">        <span class="comment"># book对象</span></span><br><span class="line">        authors = obj.authors.<span class="built_in">all</span>() <span class="comment"># 取出所有作者</span></span><br><span class="line">        <span class="comment"># [&#123;&#x27;name&#x27;:author.name,&#x27;age&#x27;:author.age&#125; for author in authors]</span></span><br><span class="line">        <span class="keyword">return</span> authors_list</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 字段校验规则，映射了表模型中的规则,重写字段，改变校验规则</span></span><br><span class="line">	name=serializers.CharField(max_length=<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student</span><br><span class="line">        <span class="comment"># fields = &#x27;__all__&#x27;  # 默认展示所有字段</span></span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;width&#x27;</span>)	<span class="comment"># 指定展示字段</span></span><br><span class="line">        <span class="comment"># 添加或修改字段原有的选项参数</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;width&#x27;</span>: &#123;<span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span>,<span class="string">&#x27;max_lenth&#x27;</span>:<span class="number">6</span>&#125;,   	<span class="comment"># 序列化的时候使用</span></span><br><span class="line">            <span class="string">&#x27;height&#x27;</span>: &#123;<span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>&#125;  				<span class="comment"># 反序列化的时候使用</span></span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="封装Response对象"><a href="#封装Response对象" class="headerlink" title="封装Response对象"></a>封装Response对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.在utils目录下创建任一文件夹</span></span><br><span class="line"><span class="comment"># 2.写入:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">APIResponse</span>(<span class="params">Response</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, code=<span class="number">100</span>, msg=<span class="string">&#x27;成功&#x27;</span>, status=<span class="literal">None</span>, headers=<span class="literal">None</span>, **kwargs</span>):</span></span><br><span class="line">            res_data = &#123;</span><br><span class="line">                <span class="string">&#x27;code&#x27;</span>: code,</span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span>: msg,</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> kwargs:</span><br><span class="line">                res_data.update(kwargs)</span><br><span class="line">            <span class="built_in">super</span>().__init__(data=res_data, status=status, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.视图类中使用:</span></span><br><span class="line">	<span class="keyword">from</span> luffy_api.utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HomeView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> APIResponse() (默认返回&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;成功&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="局部钩子全局钩子源码"><a href="#局部钩子全局钩子源码" class="headerlink" title="局部钩子全局钩子源码"></a>局部钩子全局钩子源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 入口是 ser.is_valid(),是BaseSerializer的方法</span></span><br><span class="line"><span class="comment"># 最核心的代码:</span></span><br><span class="line">	<span class="comment"># 切记不要按住ctrl点run_validation</span></span><br><span class="line">	self._validated_data = self.run_validation(self.initial_data) </span><br><span class="line">    </span><br><span class="line"><span class="comment"># run_validation 调用的是Serializer类的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_validation</span>(<span class="params">self, data=empty</span>):</span></span><br><span class="line">        value = self.to_internal_value(data) <span class="comment"># 局部钩子的代码</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.run_validators(value)</span><br><span class="line">            value = self.validate(value) <span class="comment"># 全局钩子的执行</span></span><br><span class="line">            <span class="keyword">assert</span> value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, <span class="string">&#x27;.validate() should return the validated data&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> (ValidationError, DjangoValidationError) <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(detail=as_serializer_error(exc))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部钩子核心代码</span></span><br><span class="line">    <span class="keyword">for</span> field <span class="keyword">in</span> fields:</span><br><span class="line">        <span class="comment">#反射字段的局部钩子方法</span></span><br><span class="line">        validate_method = <span class="built_in">getattr</span>(self, <span class="string">&#x27;validate_&#x27;</span> + field.field_name, <span class="literal">None</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> validate_method <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            validated_value = validate_method(validated_value) <span class="comment">#执行局部钩子方法</span></span><br><span class="line">    <span class="keyword">except</span> ValidationError <span class="keyword">as</span> exc:</span><br><span class="line">        errors[field.field_name] = exc.detail</span><br><span class="line">    <span class="keyword">except</span> DjangoValidationError <span class="keyword">as</span> exc:</span><br><span class="line">        errors[field.field_name] = get_error_detail(exc)</span><br></pre></td></tr></table></figure>

<h3 id="Django2版本级联更新删除"><a href="#Django2版本级联更新删除" class="headerlink" title="Django2版本级联更新删除"></a>Django2版本级联更新删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">当删除关联表中的数据时，当前表与其关联的表的行为</span><br><span class="line"></span><br><span class="line">　　models.CASCADE</span><br><span class="line">　　删除关联数据，与之关联也删除(级联删除)</span><br><span class="line"></span><br><span class="line">　　models.DO_NOTHING</span><br><span class="line">　　删除关联数据，关联表什么也不做</span><br><span class="line"></span><br><span class="line">　　models.PROTECT</span><br><span class="line">　　删除关联数据，引发错误ProtectedError</span><br><span class="line"></span><br><span class="line">　　models.SET_NULL</span><br><span class="line">　　删除关联数据，与之关联的值设置为null(前提FK字段需要设置为可空)</span><br><span class="line"></span><br><span class="line">　　models.SET_DEFAULT</span><br><span class="line">　　删除关联数据，与之关联的值设置为默认值(前提FK字段需要设置默认值)</span><br><span class="line"></span><br><span class="line">　　models.SET</span><br><span class="line"></span><br><span class="line">　　删除关联数据，</span><br><span class="line">　　a. 与之关联的值设置为指定值，设置：models.SET(值)</span><br><span class="line">　　b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/22/Drf%E8%A7%86%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/22/Drf%E8%A7%86%E5%9B%BE/" class="post-title-link" itemprop="url">Drf视图</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-22 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-22T18:20:25+08:00">2019-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Django REST framwork 提供的视图的主要作用：</span><br><span class="line">    控制序列化器的执行（检验、保存、转换数据）</span><br><span class="line">    控制数据库查询的执行</span><br></pre></td></tr></table></figure>

<h2 id="1-视图继承关系"><a href="#1-视图继承关系" class="headerlink" title="1.视图继承关系"></a>1.视图继承关系</h2><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701162931921.png" alt="image-20210701162931921"></p>
<h2 id="2-视图"><a href="#2-视图" class="headerlink" title="2.视图"></a>2.视图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REST framework 提供了众多的通用视图基类与扩展类，以简化视图的编写</span><br></pre></td></tr></table></figure>

<h3 id="2-1两个视图基类"><a href="#2-1两个视图基类" class="headerlink" title="2.1两个视图基类"></a>2.1两个视图基类</h3><h4 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a>APIView</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rest_framework.views.APIView</span></span><br><span class="line">	APIView是REST framework提供的所有视图的基类，继承自Django的View父类</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIView与View的不同之处在于:</span></span><br><span class="line">	传入到视图方法中的是REST framework的Request对象，而不是Django的HttpRequeset对象</span><br><span class="line">	视图方法可以返回REST framework的Response对象，视图会为响应数据设置(render)符合前端要求的格式</span><br><span class="line">	任何APIException异常都会被捕获到，并且处理成合适的响应信息</span><br><span class="line">	在进行dispatch()分发前,会对请求进行身份认证、权限检查、流量控制</span><br><span class="line">	</span><br><span class="line">支持定义的类属性:</span><br><span class="line">    authentication_classes 		<span class="comment"># 列表或元祖，身份认证类</span></span><br><span class="line">    permissoin_classes 			<span class="comment"># 列表或元祖，权限检查类</span></span><br><span class="line">    throttle_classes			<span class="comment"># 列表或元祖，流量控制类</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在APIView中仍以常规的类视图定义方法来实现get()、post()或者其他请求方式的方法</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">        <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">        <span class="comment"># path(&#x27;students/&#x27;, views.StudentsAPIView.as_view())</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">StudentsAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">                data_list = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">                serializer = StudentModelSerializer(data_list, many=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h4 id="GenericAPIView-通用视图类"><a href="#GenericAPIView-通用视图类" class="headerlink" title="GenericAPIView(通用视图类)"></a>GenericAPIView(通用视图类)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rest_framework.generics.GenericAPIView</span></span><br><span class="line">	它继承自APIVIew,主要增加了操作序列化器和数据库查询的方法,作用是为下面Mixin扩展类的执行提供方法支持 通常在使用时,可搭配一个或多个Mixin扩展类</span><br></pre></td></tr></table></figure>

<h5 id="提供的关于序列化器使用的属性与方法"><a href="#提供的关于序列化器使用的属性与方法" class="headerlink" title="提供的关于序列化器使用的属性与方法"></a>提供的关于序列化器使用的属性与方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性：</span></span><br><span class="line">	serializer_class 指明视图使用的序列化器</span><br><span class="line"><span class="comment"># 方法：</span></span><br><span class="line">	<span class="number">1.</span>get_serializer_class(self)</span><br><span class="line">	当出现一个视图类中调用多个序列化器时,那么可以通过条件判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了</span><br><span class="line">	返回序列化器类,默认返回serializer_class,可以重写</span><br><span class="line">		eg:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">            	<span class="keyword">if</span> self.request.user.is_staff:</span><br><span class="line">                	<span class="keyword">return</span> FullAccountSerializer</span><br><span class="line">            	<span class="keyword">return</span> BasicAccountSerializer</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="number">2.</span>get_serializer(self, args, *kwargs) ---&gt; 拿到序列化类的对象</span><br><span class="line">    返回序列化器对象,主要用来提供给Mixin扩展类使用,如果我们在视图中想要获取序列化器对象,也可以直接调用此方法,三个参数instance,data,many</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意:该方法在提供序列化器对象的时候,会向序列化器对象的context属性补充三个数据:request、format、view，这三个数据对象可以在定义序列化器时使用</span></span><br><span class="line">        request 	<span class="comment"># 当前视图的请求对象</span></span><br><span class="line">        view 		<span class="comment"># 当前请求的类视图对象</span></span><br><span class="line">        <span class="built_in">format</span> 		<span class="comment"># 当前请求期望返回的数据格式</span></span><br></pre></td></tr></table></figure>

<h5 id="提供的关于数据库查询的属性与方法"><a href="#提供的关于数据库查询的属性与方法" class="headerlink" title="提供的关于数据库查询的属性与方法"></a>提供的关于数据库查询的属性与方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性：</span></span><br><span class="line">	queryset 指明使用的数据查询集</span><br><span class="line"><span class="comment"># 方法：</span></span><br><span class="line">	<span class="number">1.</span>get_queryset(self) ---&gt; 获取所有数据</span><br><span class="line">	返回视图使用的查询集,主要用来提供给Mixin扩展类使用,是列表视图与详情视图获取数据的基础,默认返回queryset属性,可重写</span><br><span class="line">    eg:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">            user = self.request.user</span><br><span class="line">            <span class="keyword">return</span> user.accounts.<span class="built_in">all</span>()</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="number">2.</span>get_object(self) ---&gt; 获取单个对象</span><br><span class="line">	返回详情视图所需的模型类数据对象，主要用来提供给Mixin扩展类使用</span><br><span class="line">	在试图中可以调用该方法获取详情信息的模型类对象</span><br><span class="line">	若详情访问的模型类对象不存在，会返回<span class="number">404</span></span><br><span class="line">		eg:</span><br><span class="line">			<span class="comment"># url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookDetailView.as_view()),</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">                queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">                serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">                    <span class="comment"># get_object()方法根据pk参数查找queryset中的数据对象</span></span><br><span class="line">                    book = self.get_object() </span><br><span class="line">                    serializer = self.get_serializer(book)</span><br><span class="line">                    <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h5 id="其他可以设置的属性"><a href="#其他可以设置的属性" class="headerlink" title="其他可以设置的属性"></a>其他可以设置的属性</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pagination_class 		<span class="comment"># 指明分页控制类</span></span><br><span class="line">filter_backends 		<span class="comment"># 指明过滤控制后端</span></span><br><span class="line">lookup_field = <span class="string">&#x27;pk&#x27;</span>		<span class="comment"># 查单条时,无名或有名分组,转换器分出来的参数名叫pk</span></span><br></pre></td></tr></table></figure>

<h5 id="GenericAPIView通用视图类完整代码"><a href="#GenericAPIView通用视图类完整代码" class="headerlink" title="GenericAPIView通用视图类完整代码"></a>GenericAPIView通用视图类完整代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line">    <span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentModelSerializer, StudentModel2Serializer</span><br><span class="line">    <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentsGenericAPIView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        <span class="comment"># 本次视图类中要操作的数据[必填]</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 本次视图类中要调用的默认序列化器[选填]</span></span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取所有学生信息&quot;&quot;&quot;</span></span><br><span class="line">            serializer = self.get_serializer(instance=self.get_queryset(), many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            serializer = self.get_serializer(data=request.data)</span><br><span class="line">            <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">                instance = serializer.save()</span><br><span class="line">                <span class="comment"># serializer = self.get_serializer(instance=instance)</span></span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentGenericAPIView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;重写获取序列化器类的方法&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> self.request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> StudentModel2Serializer</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在使用GenericAPIView视图获取或操作单个数据时,视图方法中的代表主键的参数最好是pk</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取一条数据&quot;&quot;&quot;</span></span><br><span class="line">            serializer = self.get_serializer(instance=self.get_object())</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">            data = request.data</span><br><span class="line">            serializer = self.get_serializer(instance=self.get_object(),data=data)</span><br><span class="line">            <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">                serializer.save()</span><br><span class="line">                <span class="comment"># serializer = self.get_serializer(instance=self.get_object())</span></span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 序列化器类:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            model= Student</span><br><span class="line">            fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModel2Serializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            model= Student</span><br><span class="line">            fields = (<span class="string">&quot;name&quot;</span>,<span class="string">&quot;class_null&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-2五个视图扩展类"><a href="#2-2五个视图扩展类" class="headerlink" title="2.2五个视图扩展类"></a>2.2五个视图扩展类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 试图扩展类的作用：</span></span><br><span class="line">	提供了几种后端视图(对数据资源进行增删改查)处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量</span><br><span class="line">	这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法</span><br></pre></td></tr></table></figure>

<h5 id="1-ListModelMixin-查所有"><a href="#1-ListModelMixin-查所有" class="headerlink" title="1.ListModelMixin(查所有)"></a>1.ListModelMixin(查所有)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表视图扩展类，提供list(request, *args, **kwargs)方法快速实现列表视图，返回200状态码</span></span><br><span class="line"><span class="comment"># 该Mixin的list方法会对数据进行过滤和分页</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ListModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 过滤</span></span><br><span class="line">            queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line">            <span class="comment"># 分页</span></span><br><span class="line">            page = self.paginate_queryset(queryset)</span><br><span class="line">            <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line">            <span class="comment"># 序列化</span></span><br><span class="line">            serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookListView</span>(<span class="params">ListModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br></pre></td></tr></table></figure>

<h5 id="2-CreateModelMixin-创建"><a href="#2-CreateModelMixin-创建" class="headerlink" title="2.CreateModelMixin(创建)"></a>2.CreateModelMixin(创建)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视图扩展类,提供create(request, *args, **kwargs)方法快速实现创建资源的视图,成功返回201状态码</span></span><br><span class="line"><span class="comment"># 如果序列化器对前端发送的数据验证失败，返回400错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CreateModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 获取序列化器</span></span><br><span class="line">            serializer = self.get_serializer(data=request.data)</span><br><span class="line">            <span class="comment"># 验证</span></span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># 保存</span></span><br><span class="line">            self.perform_create(serializer)</span><br><span class="line">            headers = self.get_success_headers(serializer.data)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_success_headers</span>(<span class="params">self, data</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&#x27;Location&#x27;</span>: <span class="built_in">str</span>(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">            <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">                <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> CreateModelMixin</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookListView</span>(<span class="params">CreateModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.create(request)</span><br></pre></td></tr></table></figure>

<h5 id="3-RetrieveModelMixin-查单个"><a href="#3-RetrieveModelMixin-查单个" class="headerlink" title="3.RetrieveModelMixin(查单个)"></a>3.RetrieveModelMixin(查单个)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 详情视图扩展类，提供retrieve(request, *args, **kwargs)方法可以快速实现返回一个存在的数据对象</span></span><br><span class="line"><span class="comment"># 如果存在，返回200， 否则返回404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">RetrieveModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Retrieve a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 获取对象，会检查对象的权限</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        <span class="comment"># 序列化</span></span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">RetrieveModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.retrieve(request)</span><br></pre></td></tr></table></figure>

<h5 id="4-UpdateModelMixin-更新"><a href="#4-UpdateModelMixin-更新" class="headerlink" title="4.UpdateModelMixin(更新)"></a>4.UpdateModelMixin(更新)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新视图扩展类，提供update(request, *args, **kwargs)方法，可以快速实现更新一个存在的数据对象</span></span><br><span class="line"><span class="comment"># 同时也提供partial_update(request, *args, **kwargs)方法，可以实现局部更新</span></span><br><span class="line"><span class="comment"># 成功返回200，序列化器校验数据失败时，返回400错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UpdateModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Update a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            partial = kwargs.pop(<span class="string">&#x27;partial&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">            instance = self.get_object()</span><br><span class="line">            serializer = self.get_serializer(instance,data=request.data,partial=partial)</span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">            self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">getattr</span>(instance, <span class="string">&#x27;_prefetched_objects_cache&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">                <span class="comment"># If &#x27;prefetch_related&#x27; has been applied to a queryset, we need to</span></span><br><span class="line">                <span class="comment"># forcibly invalidate the prefetch cache on the instance.</span></span><br><span class="line">                instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_update</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">partial_update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            kwargs[<span class="string">&#x27;partial&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">UpdateModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.update(request)</span><br></pre></td></tr></table></figure>

<h5 id="5-DestroyModelMixin-删除"><a href="#5-DestroyModelMixin-删除" class="headerlink" title="5.DestroyModelMixin(删除)"></a>5.DestroyModelMixin(删除)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除视图扩展类，提供destroy(request, *args, **kwargs)方法，可以快速实现删除一个存在的数据对象。</span></span><br><span class="line"><span class="comment"># 成功返回204，不存在返回404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">DestroyModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Destroy a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">destroy</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            instance = self.get_object()</span><br><span class="line">            self.perform_destroy(instance)</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">            instance.delete()</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">DestroyModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.destroy(request)</span><br></pre></td></tr></table></figure>

<h4 id="2-3GenericAPIView和视图扩展类实现api接口"><a href="#2-3GenericAPIView和视图扩展类实现api接口" class="headerlink" title="2.3GenericAPIView和视图扩展类实现api接口:"></a>2.3GenericAPIView和视图扩展类实现api接口:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;GenericAPIView结合视图扩展类实现api接口&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin,CreateModelMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Students2GenericAPIView</span>(<span class="params">GenericAPIView,ListModelMixin,CreateModelMixin</span>):</span></span><br><span class="line">    <span class="comment"># 本次视图类中要操作的数据[必填]</span></span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 本次视图类中要调用的默认序列化器[选填]</span></span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取多个学生信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加学生信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2GenericAPIView</span>(<span class="params">GenericAPIView,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span>):</span></span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在使用GenericAPIView视图获取或操作单个数据时,视图方法中的代表主键的参数最好是pk</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request,pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request,pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;删除一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request,pk)</span><br></pre></td></tr></table></figure>

<h4 id="2-4GenericAPIView的视图子类"><a href="#2-4GenericAPIView的视图子类" class="headerlink" title="2.4GenericAPIView的视图子类"></a>2.4GenericAPIView的视图子类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ListAPIView</span><br><span class="line">	提供 get 方法,查所有</span><br><span class="line">	继承自：GenericAPIView、ListModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>CreateAPIView</span><br><span class="line">	提供 post 方法,创建单个</span><br><span class="line">	继承自：GenericAPIView、CreateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>RetrieveAPIView</span><br><span class="line">	提供 get 方法,差单个</span><br><span class="line">	继承自: GenericAPIView、RetrieveModelMixin</span><br><span class="line">	</span><br><span class="line"><span class="number">4.</span>UpdateAPIView</span><br><span class="line">	提供 put 和 patch 方法,更新单个</span><br><span class="line">	继承自：GenericAPIView、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>DestoryAPIView</span><br><span class="line">	提供 delete 方法,删除单个</span><br><span class="line">	继承自：GenericAPIView、DestoryModelMixin</span><br><span class="line">	</span><br><span class="line"><span class="number">6.</span>ListCreateAPIView</span><br><span class="line">	提供 get、post 方法,查所有和创建单个</span><br><span class="line">	继承自：GenericAPIView、ListModelMixin、CreateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>RetrieveUpdateAPIView</span><br><span class="line">	提供 get、put、patch方法,查单个和更新单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>RetrieveDestoryAPIView</span><br><span class="line">	提供 get、delete方法,查单个和删除单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>RetrieveUpdateDestoryAPIView</span><br><span class="line">	提供 get、put、patch、delete方法,查单个,更新单个以及删除单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</span><br></pre></td></tr></table></figure>

<h2 id="3-视图集viewSet"><a href="#3-视图集viewSet" class="headerlink" title="3.视图集viewSet"></a>3.视图集viewSet</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用视图集ViewSet,可以将一系列逻辑相关的动作放到一个类中:</span></span><br><span class="line">    <span class="built_in">list</span>() 		<span class="comment"># 提供一组数据</span></span><br><span class="line">    retrieve() 	<span class="comment"># 提供单个数据</span></span><br><span class="line">    create() 	<span class="comment"># 创建数据</span></span><br><span class="line">    update() 	<span class="comment"># 保存数据</span></span><br><span class="line">    destory() 	<span class="comment"># 删除数据</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ViewSet视图集类不再实现get(),post()等方法,而是实现动作action如 list(),create()等</span></span><br></pre></td></tr></table></figure>

<p><strong>视图集只在使用as_view()方法的时候，才会将action动作与具体请求方式对应上,eg:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoViewSet</span>(<span class="params">viewsets.ViewSet</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = BookInfoSerializer(books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span>(<span class="params">self, request, pk=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            books = BookInfo.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="keyword">except</span> BookInfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_404_NOT_FOUND)</span><br><span class="line">        serializer = BookInfoSerializer(books)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p><strong>路由设置</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, BookInfoViewSet.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>&#125;),</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;&#x27;</span>, BookInfoViewSet.as_view(&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;retrieve&#x27;</span>&#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="3-1常用视图集父类"><a href="#3-1常用视图集父类" class="headerlink" title="3.1常用视图集父类"></a>3.1常用视图集父类</h3><h4 id="1-ViewSetMixin"><a href="#1-ViewSetMixin" class="headerlink" title="1.ViewSetMixin"></a>1.ViewSetMixin</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ViewSetMixin类----》重写了as_view方法---》view跟之前（APIView的as_view）不一样了</span></span><br><span class="line">      <span class="comment"># get   list</span></span><br><span class="line">  <span class="keyword">for</span> method, action <span class="keyword">in</span> actions.items():</span><br><span class="line">        <span class="comment"># 通过反射去当前视图类对象里找list方法</span></span><br><span class="line">        handler = <span class="built_in">getattr</span>(self, action)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 拿到list方法后并添加到视图类对象中(get--&gt;lish)    </span></span><br><span class="line">        <span class="built_in">setattr</span>(self, method, handler)</span><br><span class="line">        <span class="comment"># 视图类中有get方法，实质上它是list方法   </span></span><br><span class="line">  		<span class="comment"># 至此就实现了请求方式和视图类中方法的映射</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 只要继承ViewSetMixin的视图类,路由写法就变成下面所示:</span></span><br><span class="line">	path(<span class="string">&#x27;books/&#x27;</span>, views.BookView.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;post&#x27;</span>:<span class="string">&#x27;create&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>

<h4 id="2-ViewSet"><a href="#2-ViewSet" class="headerlink" title="2.ViewSet"></a>2.ViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">继承自APIView与ViewSetMixin,作用也与APIView基本类似,提供了身份认证、权限校验、流量管理等</span><br><span class="line">ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典(如&#123;‘get’:’<span class="built_in">list</span>’&#125;)的映射处理工作</span><br><span class="line">在ViewSet中,没有提供任何动作action方法,需要我们自己实现action方法</span><br></pre></td></tr></table></figure>

<h4 id="3-GenericViewSet"><a href="#3-GenericViewSet" class="headerlink" title="3.GenericViewSet"></a>3.GenericViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">	使用ViewSet通常并不方便,因为<span class="built_in">list</span>、retrieve、create、update、destory等方法都需要自己编写,而这些方法与前面讲过的Mixin扩展类提供的方法同名,所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写。但是Mixin扩展类依赖于GenericAPIView,所以还需要继承GenericAPIView</span><br><span class="line"></span><br><span class="line">	GenericViewSet就帮助我们完成了这样的继承工作,继承自GenericAPIView与ViewSetMixin,在实现了调用as_view()时传入字典(如&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>&#125;)的映射处理工作的同时,还提供了GenericAPIView提供的基础方法,可以直接搭配Mixin扩展类使用</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line">    <span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin,CreateModelMixin,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Student4ViewSet</span>(<span class="params">GenericViewSet,ListModelMixin,CreateModelMixin,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 路由定义:</span></span><br><span class="line">	urlpatterns = [</span><br><span class="line">        path(<span class="string">&quot;student/&quot;</span>,views.Student4ViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>: <span class="string">&quot;list&quot;</span>, <span class="string">&quot;post&quot;</span>: <span class="string">&quot;create&quot;</span>&#125;)),</span><br><span class="line">        path(<span class="string">&quot;student/&lt;int:pk&gt;&quot;</span>,views.Student4ViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>: <span class="string">&quot;retrieve&quot;</span>,<span class="string">&quot;put&quot;</span>:<span class="string">&quot;update&quot;</span>,<span class="string">&quot;delete&quot;</span>:<span class="string">&quot;destroy&quot;</span>&#125;)),</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h4 id="4-ModelViewSet"><a href="#4-ModelViewSet" class="headerlink" title="4.ModelViewSet"></a>4.ModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自GenericViewSet,同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin(五个接口都实现了)</span><br></pre></td></tr></table></figure>

<h4 id="5-ReadOnlyModelViewSet"><a href="#5-ReadOnlyModelViewSet" class="headerlink" title="5.ReadOnlyModelViewSet"></a>5.ReadOnlyModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自GenericViewSet，同时包括了ListModelMixin、RetrieveModelMixin(只实现了两个查询接口)</span><br></pre></td></tr></table></figure>

<h3 id="3-2视图集中定义附加action动作"><a href="#3-2视图集中定义附加action动作" class="headerlink" title="3.2视图集中定义附加action动作"></a>3.2视图集中定义附加action动作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图集中，除了上述默认的方法动作外，还可以添加自定义动作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet,ReadOnlyModelViewSet</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;学生登录功能&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;登录成功&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由定义:</span></span><br><span class="line">	urlpatterns = [</span><br><span class="line">    	path(<span class="string">&quot;stu/login/&quot;</span>,views.StudentModelViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>:<span class="string">&quot;login&quot;</span>&#125;)),</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h3 id="3-3action属性"><a href="#3-3action属性" class="headerlink" title="3.3action属性"></a>3.3action属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图集中，我们可以通过action对象属性来获取当前请求视图集时的action动作是哪个</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line">    <span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentModelSerializer</span><br><span class="line">    <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_new_5</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取最近添加的5个学生信息&quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># 操作数据库</span></span><br><span class="line">            <span class="built_in">print</span>(self.action) <span class="comment"># 获取本次请求的视图方法名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过路由访问到当前方法中.可以看到本次的action就是请求的方法名</span></span><br></pre></td></tr></table></figure>

<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两个基类:</span></span><br><span class="line">	APIView				<span class="comment"># 继承自View,k</span></span><br><span class="line">	GenericAPIView		<span class="comment"># 继承自APIView,扩写queryset,serializer_class属性及get_queryset,get_serializer等方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有关数据库,序列化器的操作:</span></span><br><span class="line">	queryset			<span class="comment"># 指定表模型所有数据</span></span><br><span class="line">    serializer_class	<span class="comment"># 指定序列化器</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 五个视图扩展类(rest_framework.mixins)</span></span><br><span class="line">	ListModelMixin			<span class="comment"># list方法获取所有</span></span><br><span class="line">    CreateModelMixin		<span class="comment"># create方法创建一条</span></span><br><span class="line">	RetrieveModelMixin		<span class="comment"># retrieve方法获取一条</span></span><br><span class="line">    UpdateModelMixin		<span class="comment"># update方法修改一条</span></span><br><span class="line">	DestroyModelMixin		<span class="comment"># destory方法删除一条</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 九个子类视图(rest_framework.generics)</span></span><br><span class="line">继承单个视图扩展类和GenericAPIView:</span><br><span class="line">	ListAPIView			<span class="comment"># 继承ListModelMixin,GenericAPIView:,get方法获取所有数据</span></span><br><span class="line">    RetrieveAPIView		<span class="comment"># 继承RetrieveModelMixin,GenericAPIView,get方法,获取一条</span></span><br><span class="line">	CreateAPIView	 	<span class="comment"># 继承CreateModelMixin,GenericAPIView,post方法新增一条数据</span></span><br><span class="line">    UpdateAPIView		<span class="comment"># 继承UpdateModelMixin,GenericAPIView,put和patch方法,修改一条数据</span></span><br><span class="line">	DestroyAPIView		<span class="comment"># 继承DestroyModelMixin,GenericAPIView,delete方法,删除一条数据</span></span><br><span class="line"></span><br><span class="line">继承多个视图扩展类和GenericAPIView:</span><br><span class="line">    ListCreateAPIView 		<span class="comment"># 继承ListModelMixin,CreateModelMixin,GenericAPIView,get获取所有,post新增</span></span><br><span class="line">    RetrieveUpdateAPIView 	<span class="comment"># 继承RetrieveModelMixin,UpdateModelMixin,GenericAPIView,get获取一条,put,patch修改</span></span><br><span class="line">	RetrieveDestroyAPIView 	<span class="comment"># 继承RetrieveModelMixin,DestroyModelMixin,GenericAPIView,get获取一条,delete删除</span></span><br><span class="line">	RetrieveUpdateDestroyAPIView  <span class="comment"># 继承RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin,GenericAPIView,有get获取一条,put,patch修改,delete删除</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#视图集</span></span><br><span class="line">    ViewSetMixin		  	<span class="comment"># 重写了as_view(自定义路由功能)</span></span><br><span class="line">    ViewSet 			  	<span class="comment"># 继承ViewSetMixin和APIView(自定义路由,自定义方法动作)</span></span><br><span class="line">	GenericViewSet		  	<span class="comment"># 继承ViewSetMixin和GenericAPIView(自定义路由和GenericAPIView所有扩展功能)</span></span><br><span class="line">	ModelViewSet 		  	<span class="comment"># 继承五大视图扩展类和GenericViewSet(简单配置就能实现五个常用接口)</span></span><br><span class="line">	ReadOnlyModelViewSet  	<span class="comment"># 继承RetrieveModelMixin,ListModelMixin,GenericViewSet(实现了查单个和查所有双接口)</span></span><br></pre></td></tr></table></figure>

<h4 id="Django本地化-国际化-配置"><a href="#Django本地化-国际化-配置" class="headerlink" title="Django本地化(国际化)配置"></a>Django本地化(国际化)配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"><span class="comment"># S 必须大写(windows平台可以小写)</span></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/18/Drf%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/18/Drf%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/" class="post-title-link" itemprop="url">Drf请求响应</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-18 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-18T18:20:25+08:00">2019-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="请求响应"><a href="#请求响应" class="headerlink" title="请求响应"></a>请求响应</h1><h2 id="1-Request"><a href="#1-Request" class="headerlink" title="1.Request"></a>1.Request</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST framework 传入视图的request对象不再是Django默认的HttpRequest对象，而是REST framework提供的扩展了HttpRequest类的Request类的对象</span><br><span class="line">REST framework 提供了Parser解析器，在接收到请求后会自动根据Content-<span class="type">Type</span>指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典[QueryDict]对象保存到Request对象中</span><br><span class="line">Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果</span><br><span class="line">无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据</span><br></pre></td></tr></table></figure>

<h3 id="1-1常用属性"><a href="#1-1常用属性" class="headerlink" title="1.1常用属性"></a>1.1常用属性</h3><h4 id="data"><a href="#data" class="headerlink" title=".data"></a>.data</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.data返回解析之后的请求体数据。类似于Django中标准的request.POST和 request.FILES属性，但提供如下特性：</span><br><span class="line">       <span class="number">1.</span>包含了解析之后的文件和非文件数据</span><br><span class="line">       <span class="number">2.</span>包含了对POST、PUT、PATCH请求方式解析后的数据</span><br><span class="line">       <span class="number">3.</span>利用了REST framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据</span><br></pre></td></tr></table></figure>

<h4 id="query-params"><a href="#query-params" class="headerlink" title=".query_params"></a>.query_params</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.query_params与Django标准的request.GET相同，只是更换了更正确的名称而已</span><br></pre></td></tr></table></figure>

<h3 id="1-2Drf请求全局和局部配置"><a href="#1-2Drf请求全局和局部配置" class="headerlink" title="1.2Drf请求全局和局部配置"></a>1.2Drf请求全局和局部配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求支持三种编码格式，urlencoded，json，formdata</span></span><br><span class="line"><span class="comment"># 如果不配置，默认支持三种</span></span><br><span class="line">   <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,  <span class="comment"># 解析application/json格式</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>, <span class="comment"># 解析application/x-www-form-urlencoded</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span> <span class="comment"># multipart/form-data</span></span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 全局配置,在项目的配置文件中配置</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">            <span class="comment"># &#x27;rest_framework.parsers.JSONParser&#x27;,  </span></span><br><span class="line">            <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,  </span><br><span class="line">            <span class="comment"># &#x27;rest_framework.parsers.MultiPartParser&#x27;  </span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 局部配置</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.parsers <span class="keyword">import</span> JSONParser</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView,CreateAPIView</span>):</span></span><br><span class="line">        parser_classes = [JSONParser,]</span><br></pre></td></tr></table></figure>

<h2 id="2-Response"><a href="#2-Response" class="headerlink" title="2.Response"></a>2.Response</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REST framework提供了一个响应类Response，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染）成符合前端需求的类型</span><br><span class="line">REST framework提供了Renderer 渲染器，用来根据请求头中的Accept（接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行Accept声明，则会采用默认方式处理响应数据，我们可以通过配置来修改默认响应格式  </span><br></pre></td></tr></table></figure>

<h3 id="2-1响应格式配置"><a href="#2-1响应格式配置" class="headerlink" title="2.1响应格式配置"></a>2.1响应格式配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过配置，设置响应格式（浏览器模板样子，纯json）</span></span><br><span class="line">    <span class="number">1.</span>drf的所有配置，都写在下面这个字典中(REST_FRAMEWORK)</span><br><span class="line">    <span class="number">2.</span>drf有个默认配置文件,如果项目的配置文件配置了，优先使用项目的，如果没配置，使用内置的</span><br><span class="line">    <span class="number">3.</span>返回样式的配置，一般我们不配置</span><br><span class="line">    </span><br><span class="line">    全局配置:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">            <span class="comment"># 配置响应格式,默认有俩(json，浏览器的)</span></span><br><span class="line">            <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    局部配置:</span><br><span class="line">        Response响应格式的全局配置（配置文件中）局部配置（只针对某一个视图函数）</span><br><span class="line">            -在视图类上写:</span><br><span class="line">            	renderer_classes = [JSONRenderer]</span><br><span class="line">        </span><br><span class="line">	配置的三个层次(使用优先级)</span><br><span class="line">    	-局部自己</span><br><span class="line">        -项目中</span><br><span class="line">        -drf默认</span><br></pre></td></tr></table></figure>

<h3 id="2-2构造方式"><a href="#2-2构造方式" class="headerlink" title="2.2构造方式"></a>2.2构造方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Response(data,status=None,template_name=None,headers=None, content_type=None)</span></span><br><span class="line">	data不能是复杂结构的数据,如Django的模型类对象</span><br><span class="line">	对于这样的数据使用Serializer序列化器序列化后(转为了Python字典类型)再传递给data参数</span><br><span class="line">		参数说明：</span><br><span class="line">			data 				<span class="comment"># 为响应准备的序列化处理后的数据</span></span><br><span class="line">            status	 			<span class="comment"># 状态码，默认200</span></span><br><span class="line">            template_name		<span class="comment"># 模板名称,在浏览器访问,看到的好看的模板(自定制)</span></span><br><span class="line">            headers				<span class="comment"># 用于存放响应头信息的字典</span></span><br><span class="line">            content_type 		<span class="comment"># 响应码类型</span></span><br><span class="line">            exception=<span class="literal">False</span>     <span class="comment"># 不用管</span></span><br><span class="line">        	(data，status，headers需要掌握)</span><br><span class="line">            </span><br><span class="line">        status有很多,比较完整的使用:</span><br><span class="line">            response=&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;查询成功&#x27;</span>,<span class="string">&#x27;result&#x27;</span>:ser.data&#125;</span><br><span class="line">            <span class="keyword">return</span> Response(response,status=status.HTTP_201_CREATED,headers=header)</span><br></pre></td></tr></table></figure>

<h3 id="2-3常用属性"><a href="#2-3常用属性" class="headerlink" title="2.3常用属性"></a>2.3常用属性</h3><h4 id="data-1"><a href="#data-1" class="headerlink" title=".data"></a>.data</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">传给response对象的序列化c后，但尚未render处理的数据</span><br></pre></td></tr></table></figure>

<h4 id="status-code"><a href="#status-code" class="headerlink" title=".status_code"></a>.status_code</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">状态码的数字</span><br></pre></td></tr></table></figure>

<h4 id="content"><a href="#content" class="headerlink" title=".content"></a>.content</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">经过render处理后的响应数据</span><br></pre></td></tr></table></figure>

<h3 id="2-4状态码"><a href="#2-4状态码" class="headerlink" title="2.4状态码"></a>2.4状态码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了方便设置状态码，REST framewrok在rest_framework.status模块中提供了常用状态码常量</span><br></pre></td></tr></table></figure>

<h4 id="1-信息告知-1xx"><a href="#1-信息告知-1xx" class="headerlink" title="1.信息告知-1xx"></a>1.信息告知-1xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP_100_CONTINUE</span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS</span><br></pre></td></tr></table></figure>

<h4 id="2-成功-2xx"><a href="#2-成功-2xx" class="headerlink" title="2.成功-2xx"></a>2.成功-2xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_200_OK</span><br><span class="line">HTTP_201_CREATED</span><br><span class="line">HTTP_202_ACCEPTED</span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION</span><br><span class="line">HTTP_204_NO_CONTENT</span><br><span class="line">HTTP_205_RESET_CONTENT</span><br><span class="line">HTTP_206_PARTIAL_CONTENT</span><br><span class="line">HTTP_207_MULTI_STATUS</span><br></pre></td></tr></table></figure>

<h4 id="3-重定向-3xx"><a href="#3-重定向-3xx" class="headerlink" title="3.重定向-3xx"></a>3.重定向-3xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_300_MULTIPLE_CHOICES</span><br><span class="line">HTTP_301_MOVED_PERMANENTLY</span><br><span class="line">HTTP_302_FOUND</span><br><span class="line">HTTP_303_SEE_OTHER</span><br><span class="line">HTTP_304_NOT_MODIFIED</span><br><span class="line">HTTP_305_USE_PROXY</span><br><span class="line">HTTP_306_RESERVED</span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT</span><br></pre></td></tr></table></figure>

<h4 id="4-客户端错误-4xx"><a href="#4-客户端错误-4xx" class="headerlink" title="4.客户端错误-4xx"></a>4.客户端错误-4xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">HTTP_400_BAD_REQUEST</span><br><span class="line">HTTP_401_UNAUTHORIZED</span><br><span class="line">HTTP_402_PAYMENT_REQUIRED</span><br><span class="line">HTTP_403_FORBIDDEN</span><br><span class="line">HTTP_404_NOT_FOUND</span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED</span><br><span class="line">HTTP_406_NOT_ACCEPTABLE</span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED</span><br><span class="line">HTTP_408_REQUEST_TIMEOUT</span><br><span class="line">HTTP_409_CONFLICT</span><br><span class="line">HTTP_410_GONE</span><br><span class="line">HTTP_411_LENGTH_REQUIRED</span><br><span class="line">HTTP_412_PRECONDITION_FAILED</span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE</span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG</span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE</span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE</span><br><span class="line">HTTP_417_EXPECTATION_FAILED</span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY</span><br><span class="line">HTTP_423_LOCKED</span><br><span class="line">HTTP_424_FAILED_DEPENDENCY</span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED</span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS</span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE</span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</span><br></pre></td></tr></table></figure>

<h4 id="5-服务器错误-5xx"><a href="#5-服务器错误-5xx" class="headerlink" title="5.服务器错误-5xx"></a>5.服务器错误-5xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_500_INTERNAL_SERVER_ERROR</span><br><span class="line">HTTP_501_NOT_IMPLEMENTED</span><br><span class="line">HTTP_502_BAD_GATEWAY</span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE</span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT</span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED</span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE</span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</span><br></pre></td></tr></table></figure>

<h4 id="图解"><a href="#图解" class="headerlink" title="图解:"></a>图解:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701145923333.png" alt="image-20210701145923333"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701145935790.png" alt="image-20210701145935790"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

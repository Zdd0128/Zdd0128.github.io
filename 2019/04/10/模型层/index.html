<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="模型层1.数据库正反向迁移1234567正向迁移(将django中的类导入到MySQL中变成表)	python manage.py makemigrations    python manage.py migrate反向迁移	inspectdb    应用场景:        展示数据库中表时或要更换数据库磁盘  2.Django测试环境123456789101112django默认情况下是不允许">
<meta property="og:type" content="article">
<meta property="og:title" content="Django之模型层">
<meta property="og:url" content="http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:description" content="模型层1.数据库正反向迁移1234567正向迁移(将django中的类导入到MySQL中变成表)	python manage.py makemigrations    python manage.py migrate反向迁移	inspectdb    应用场景:        展示数据库中表时或要更换数据库磁盘  2.Django测试环境123456789101112django默认情况下是不允许">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-04-10T10:20:25.000Z">
<meta property="article:modified_time" content="2019-04-10T10:20:25.000Z">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/","path":"2019/04/10/模型层/","title":"Django之模型层"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Django之模型层 | 左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E5%B1%82"><span class="nav-number">1.</span> <span class="nav-text">模型层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%AD%A3%E5%8F%8D%E5%90%91%E8%BF%81%E7%A7%BB"><span class="nav-number">1.0.1.</span> <span class="nav-text">1.数据库正反向迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Django%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-number">1.0.2.</span> <span class="nav-text">2.Django测试环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1"><span class="nav-number">1.0.3.</span> <span class="nav-text">3.必知必会十三条</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.4.</span> <span class="nav-text">4.双下划线查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%AD%A3%E5%8F%8D%E5%90%91%E6%A6%82%E5%BF%B5"><span class="nav-number">1.0.5.</span> <span class="nav-text">5.正反向概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%AD%A3%E5%8F%8D%E5%90%91%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.6.</span> <span class="nav-text">6.正反向跨表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E4%B8%80%E5%AF%B9%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-number">1.0.7.</span> <span class="nav-text">7.一对多表关系外键字段的增删改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E5%A2%9E"><span class="nav-number">1.0.7.1.</span> <span class="nav-text">1.外键字段的增</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E5%88%A0"><span class="nav-number">1.0.7.2.</span> <span class="nav-text">2.外键字段的删</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E6%94%B9"><span class="nav-number">1.0.7.3.</span> <span class="nav-text">3.外键字段的改</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%AC%AC%E4%B8%89%E5%BC%A0%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-number">1.0.8.</span> <span class="nav-text">8.多对多第三张表数据的增删改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%89%E5%BC%A0%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E"><span class="nav-number">1.0.8.1.</span> <span class="nav-text">1.第三张表数据的增</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%AC%AC%E4%B8%89%E5%BC%A0%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E6%94%B9"><span class="nav-number">1.0.8.2.</span> <span class="nav-text">2.第三张表数据的改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%AC%AC%E4%B8%89%E5%BC%A0%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%A0"><span class="nav-number">1.0.8.3.</span> <span class="nav-text">3.第三张表数据的删</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E7%AC%AC%E4%B8%89%E5%BC%A0%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9F%A5"><span class="nav-number">1.0.8.4.</span> <span class="nav-text">4.第三张表数据的查</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.9.</span> <span class="nav-text">9.多表查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2-aggregate"><span class="nav-number">1.0.10.</span> <span class="nav-text">10.聚合查询(aggregate)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-annotate"><span class="nav-number">1.0.11.</span> <span class="nav-text">11.分组查询(annotate)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-F%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.12.</span> <span class="nav-text">12.F查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%92%88%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E8%83%BD%E7%9B%B4%E6%8E%A5%E6%8B%BC%E6%8E%A5-%E9%9C%80%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="nav-number">1.0.12.1.</span> <span class="nav-text">针对字符串不能直接拼接 需导入模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-Q%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.13.</span> <span class="nav-text">13.Q查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Q%E6%9F%A5%E8%AF%A2%E8%BF%9B%E9%98%B6%E7%94%A8%E6%B3%95"><span class="nav-number">1.0.13.1.</span> <span class="nav-text">Q查询进阶用法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E4%BA%8B%E5%8A%A1"><span class="nav-number">1.0.14.</span> <span class="nav-text">14.事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%94%9FSQL%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.0.14.1.</span> <span class="nav-text">执行原生SQL语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F"><span class="nav-number">1.0.14.2.</span> <span class="nav-text">数据库三大范式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%AD%97%E6%AE%B5%E5%8F%8A%E5%8F%82%E6%95%B0"><span class="nav-number">1.0.15.</span> <span class="nav-text">15.模型层字段及参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5"><span class="nav-number">1.0.15.1.</span> <span class="nav-text">自定义字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0"><span class="nav-number">1.0.15.2.</span> <span class="nav-text">常见参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-choices%E5%8F%82%E6%95%B0"><span class="nav-number">1.0.16.</span> <span class="nav-text">16.choices参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-%E6%9F%A5%E7%9C%8B%E5%8E%9F%E7%94%9FSQL%E8%AF%AD%E5%8F%A5%E6%96%B9%E6%B3%95"><span class="nav-number">1.0.17.</span> <span class="nav-text">17.查看原生SQL语句方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-ORM%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="nav-number">1.0.18.</span> <span class="nav-text">18.ORM查询优化(数据库查询优化)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9E%8B-MTV%E4%B8%8EMVC"><span class="nav-number">1.0.19.</span> <span class="nav-text">19.框架设计模型(MTV与MVC)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-number">1.0.20.</span> <span class="nav-text">20.多对多表关系三种创建方式</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Django之模型层
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-10T18:20:25+08:00">2019-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="模型层"><a href="#模型层" class="headerlink" title="模型层"></a>模型层</h1><h3 id="1-数据库正反向迁移"><a href="#1-数据库正反向迁移" class="headerlink" title="1.数据库正反向迁移"></a>1.数据库正反向迁移</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">正向迁移(将django中的类导入到MySQL中变成表)</span><br><span class="line">	python manage.py makemigrations</span><br><span class="line">    python manage.py migrate</span><br><span class="line">反向迁移</span><br><span class="line">	inspectdb</span><br><span class="line">    应用场景:</span><br><span class="line">        展示数据库中表时或要更换数据库磁盘</span><br></pre></td></tr></table></figure>

<h3 id="2-Django测试环境"><a href="#2-Django测试环境" class="headerlink" title="2.Django测试环境"></a>2.Django测试环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">django默认情况下是不允许单独使用某个功能部分(models.py)</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>要么自己新建一个py文件</span><br><span class="line"><span class="number">2.</span>要么使用自带的tests文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day47.settings&quot;</span>)</span><br><span class="line">    <span class="comment"># 导入django并配置</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="comment"># 下面就可以书写测试代码了</span></span><br></pre></td></tr></table></figure>

<h3 id="3-必知必会十三条"><a href="#3-必知必会十三条" class="headerlink" title="3.必知必会十三条"></a>3.必知必会十三条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">all</span>()		 			<span class="comment"># 查询所有数据</span></span><br><span class="line"><span class="number">2.</span><span class="built_in">filter</span>()				<span class="comment"># 带有过滤条件的查询</span></span><br><span class="line"><span class="number">3.</span>get()					<span class="comment"># 直接拿数据对象 但是条件不存在直接报错</span></span><br><span class="line"><span class="number">4.</span>first()				<span class="comment"># 拿queryset里面的第一个数据</span></span><br><span class="line"><span class="number">5.</span>last()				<span class="comment"># 拿quertset里面的最后一个数据</span></span><br><span class="line"><span class="number">6.</span>values()				<span class="comment"># 指定获取数据的字段 select name,age from... 列表套字典</span></span><br><span class="line"><span class="number">7.</span>values_list()			<span class="comment"># 指定获取数据的字段 列表套元组</span></span><br><span class="line"><span class="number">8.</span>distinct()			<span class="comment"># 去重 去重一定要是一模一样的数据(主键千万要注意)</span></span><br><span class="line"><span class="number">9.</span>order_by()			<span class="comment"># 排序 默认升序</span></span><br><span class="line">	res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  	<span class="comment"># 默认是升序  </span></span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)   <span class="comment"># 加负号降序</span></span><br><span class="line"><span class="number">10.</span>reverse() 			<span class="comment"># 反转 前提是数据已经排序过</span></span><br><span class="line"><span class="number">11.</span>count() 				<span class="comment"># 计数 统计当前数据的个数</span></span><br><span class="line"><span class="number">12.</span>exclude()			<span class="comment"># 取反 将括号内排除在外</span></span><br><span class="line">	查询<span class="built_in">id</span>不为<span class="number">3</span>的所有图书</span><br><span class="line">		books = models.BookInfo.objects.exclude(<span class="built_in">id</span> = <span class="number">3</span>)  <span class="comment"># 与filter函数作用相反 </span></span><br><span class="line"><span class="number">13.</span>exists()				<span class="comment"># 返回布尔值 数据本身就自带布尔值 基本用不到</span></span><br></pre></td></tr></table></figure>

<h3 id="4-双下划线查询"><a href="#4-双下划线查询" class="headerlink" title="4.双下划线查询"></a>4.双下划线查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__gt 				大于</span></span><br><span class="line"><span class="string">__gte 				大于等于 </span></span><br><span class="line"><span class="string">__lt 				小于</span></span><br><span class="line"><span class="string">__lte 				小于等于</span></span><br><span class="line"><span class="string">__in 				范围查询</span></span><br><span class="line"><span class="string">__date				日期查询</span></span><br><span class="line"><span class="string">__isnull 			是否为空 True表示为null False表示not null</span></span><br><span class="line"><span class="string">__contains 			包含 模糊查询 默认区分大小写</span></span><br><span class="line"><span class="string">__icontains 		包含 模糊查询 不区分大小写</span></span><br><span class="line"><span class="string">__endswith			以..结尾 (__iendswith 不区分大小写)</span></span><br><span class="line"><span class="string">__startswith		以..开头 (__istartswith 不区分大小写)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询价格大于200的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Books.objects.filter(price__gt=200)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Books.objects.filter(price__lt=200)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># res2 = models.Books.objects.filter(price__gte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res2)</span></span><br><span class="line">    <span class="comment"># res3 = models.Books.objects.filter(price__lte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 成员运算</span></span><br><span class="line">    <span class="comment"># res4 = models.Books.objects.filter(price__in=(456.23,111))</span></span><br><span class="line">    <span class="comment"># print(res4)</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 范围查询</span></span><br><span class="line">    <span class="comment"># res5 = models.Books.objects.filter(price__range=(100,456.23))</span></span><br><span class="line">    <span class="comment"># print(res5)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模糊查询</span></span><br><span class="line">    <span class="comment"># 查询书籍名称中含有字母a的书</span></span><br><span class="line">    <span class="comment"># res6 = models.Books.objects.filter(title__contains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res6)  # 区分大小写</span></span><br><span class="line">    <span class="comment"># res7 = models.Books.objects.filter(title__icontains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res7)  # 忽略大小写</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日期相关</span></span><br><span class="line">    <span class="comment"># 查看出版月份是五月的书</span></span><br><span class="line">    <span class="comment"># res8 = models.Books.objects.filter(publish_time__month=5)</span></span><br><span class="line">    <span class="comment"># print(res8)</span></span><br><span class="line">    <span class="comment"># print(res8.query)</span></span><br><span class="line">    <span class="comment"># res9 = models.Books.objects.filter(publish_time__year=2021)</span></span><br><span class="line">    <span class="comment"># print(res9)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-正反向概念"><a href="#5-正反向概念" class="headerlink" title="5.正反向概念"></a>5.正反向概念</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向</span></span><br><span class="line">	外键字段在我这里,我查你就是正向</span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">	外键字段不在我这里,我查你就是反向</span><br><span class="line">    </span><br><span class="line">    book ---&gt; 外键字段在书那儿(正向) ---&gt;publish</span><br><span class="line">    publish ---&gt; 外键字段在书那儿(反向) ---&gt;book</span><br></pre></td></tr></table></figure>

<h3 id="6-正反向跨表查询"><a href="#6-正反向跨表查询" class="headerlink" title="6.正反向跨表查询"></a>6.正反向跨表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">正向查询按字段</span></span><br><span class="line"><span class="string">反向查询按表名小写</span></span><br><span class="line"><span class="string">		_set</span></span><br><span class="line"><span class="string">		...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">基于对象</span></span><br><span class="line"><span class="string">	正向查询:</span></span><br><span class="line"><span class="string">		当查询结果有多个的时候 必须要加.all()</span></span><br><span class="line"><span class="string">		当查询结果只有一个的时候 直接拿到数据对象不需要加.all()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	反向查询:</span></span><br><span class="line"><span class="string">        当查询结果有多个的时候 必须要加_set.all()</span></span><br><span class="line"><span class="string">        当查询结果只有一个的时候 直接拿到数据对象不需要加_set.all()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-一对多表关系外键字段的增删改"><a href="#7-一对多表关系外键字段的增删改" class="headerlink" title="7.一对多表关系外键字段的增删改"></a>7.一对多表关系外键字段的增删改</h3><h4 id="1-外键字段的增"><a href="#1-外键字段的增" class="headerlink" title="1.外键字段的增"></a>1.外键字段的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;一对多表关系外键默认级联更新级联删除&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(create)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.create(name=<span class="string">&#x27;三国演义&#x27;</span>, price=<span class="string">&#x27;999&#x27;</span>, publish_id=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.create(name=<span class="string">&#x27;孟子&#x27;</span>, price=<span class="string">&#x27;989&#x27;</span>, 	publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h4 id="2-外键字段的删"><a href="#2-外键字段的删" class="headerlink" title="2.外键字段的删"></a>2.外键字段的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(delete)</span></span><br><span class="line">    models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).delete()  <span class="comment"># 级联删除</span></span><br></pre></td></tr></table></figure>

<h4 id="3-外键字段的改"><a href="#3-外键字段的改" class="headerlink" title="3.外键字段的改"></a>3.外键字段的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(update)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">6</span>).update(publish_id=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">8</span>).update(publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h3 id="8-多对多第三张表数据的增删改"><a href="#8-多对多第三张表数据的增删改" class="headerlink" title="8.多对多第三张表数据的增删改"></a>8.多对多第三张表数据的增删改</h3><h4 id="1-第三张表数据的增"><a href="#1-第三张表数据的增" class="headerlink" title="1.第三张表数据的增"></a>1.第三张表数据的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第三张表添加数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    向第三张表中添加数据之前要拿到任一张表的某个对象</span></span><br><span class="line"><span class="string">    再通过正反向概念实现第三张表的数据添加</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(add(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(book_obj.authors)  <span class="comment"># 相当于拿到第三张表</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(1, 2, 3)  # 书籍主键为1的书籍绑定主键为1,2,3的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.add(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.add(1,2,3)</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    author_obj.book_set.add(book_obj)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">add给第三张表添加数据:</span></span><br><span class="line"><span class="string">	括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">	已存在的数据不可重复添加 </span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据增加)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-第三张表数据的改"><a href="#2-第三张表数据的改" class="headerlink" title="2.第三张表数据的改"></a>2.第三张表数据的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(set(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.set([2,3,4])  # 括号内必须放一个可迭代对象</span></span><br><span class="line">    author_obj1 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj2 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.<span class="built_in">set</span>([author_obj1, author_obj2])</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.set([1,2])</span></span><br><span class="line">    book_obj1 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    book_obj2 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">set</span>([book_obj1,book_obj2])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">set修改第三张表中的数据:</span></span><br><span class="line"><span class="string">    括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">    括号内必须放一个可迭代对象</span></span><br><span class="line"><span class="string">    set会将第三张表中已存在数据更新为括号内指定数据</span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-第三张表数据的删"><a href="#3-第三张表数据的删" class="headerlink" title="3.第三张表数据的删"></a>3.第三张表数据的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(remove(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.remove(1,2)  # 删除主键为1的书籍所关联的主键为1,2的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.remove(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.remove(<span class="number">1</span>,<span class="number">3</span>)	<span class="comment"># 删除主键为1的作者所关联的主键为1,3的书籍</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj.book_set.remove(book_obj)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">remove删除第三张表中的数据:</span></span><br><span class="line"><span class="string">   括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">   remove会将第三张表中已存在数据删除</span></span><br><span class="line"><span class="string">   (站在任一张表的角度都可以实现对第三张表的数据删除)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-第三张表数据的查"><a href="#4-第三张表数据的查" class="headerlink" title="4.第三张表数据的查"></a>4.第三张表数据的查</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查</span></span><br><span class="line"></span><br><span class="line">	book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    book_obj.authors.first()  <span class="comment"># 查一个,默认第一个</span></span><br><span class="line">    book_obj.authors.<span class="built_in">all</span>()  <span class="comment"># 查所有</span></span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h3 id="9-多表查询"><a href="#9-多表查询" class="headerlink" title="9.多表查询"></a>9.多表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################基于对象的跨表查询#####################</span></span><br><span class="line">    <span class="comment"># 子查询:将一张表的查询结果当做另外一条SQL语句的条件(括号括起来)</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=4).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.publish</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.title)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Author.None</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # &lt;QuerySet [&lt;Author: 作者对象:oscar&gt;, &lt;Author: 作者对象:egon&gt;]&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = author_obj.author_detail</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line">    <span class="comment"># print(res.phone)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.查询东方出版社出版的书籍</span></span><br><span class="line">    <span class="comment"># 先查询出版社对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(title=&#x27;东方出版社&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里 自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># 先查询120数据对象</span></span><br><span class="line">    <span class="comment"># author_detail_obj = models.AuthorDetail.objects.filter(phone=120).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者那里本身没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_detail_obj.author</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="comment"># print(res.age)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">########################基于双下滑线的跨表查询</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.查询北方出版社出版的书籍名称</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(title=&#x27;北方&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># res =models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># res =models.AuthorDetail.objects.filter(phone=120).values(&#x27;author__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    <span class="comment">############进阶操作#############</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(book__pk=4)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;).values(&#x27;addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询书籍主键为3的作者的电话号码</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__book__pk=3).values(&#x27;phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3).values(&#x27;author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="10-聚合查询-aggregate"><a href="#10-聚合查询-aggregate" class="headerlink" title="10.聚合查询(aggregate)"></a>10.聚合查询(aggregate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询</span></span><br><span class="line">关键字:</span><br><span class="line">    aggregate()</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;max min sum count avg&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max,Min,Sum,Avg,Count</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 求书的最高价格</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.aggregate(Max(&#x27;price&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.aggregate(Sum(&#x27;price&#x27;),Avg(&#x27;price&#x27;),Count(&#x27;pk&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br></pre></td></tr></table></figure>

<h3 id="11-分组查询-annotate"><a href="#11-分组查询-annotate" class="headerlink" title="11.分组查询(annotate)"></a>11.分组查询(annotate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组查询</span></span><br><span class="line">关键字:</span><br><span class="line">	annotate()</span><br><span class="line">	annotate前放values那么按其括号内字段分组</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1.统计每一本书的作者个数</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).values(&#x27;title&#x27;, &#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># 2.统计出每个出版社卖的最便宜的书的价格</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.annotate(not_expensive=Min(&#x27;book__price&#x27;)).values(&#x27;title&#x27;,&#x27;not_expensive&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.统计不止一个作者的图书</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).filter(author_num__gt=1).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 4.查询各个作者出的书的总价格</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.annotate(sum_price=Sum(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;sum_price&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;如果你按照表里面某个指定的字段分组&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;publish_time&#x27;).annotate()</span></span><br></pre></td></tr></table></figure>

<h3 id="12-F查询"><a href="#12-F查询" class="headerlink" title="12.F查询"></a>12.F查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">当查询条件的左右两边数据都来自于表中则可以使用F查询</span></span><br><span class="line"><span class="string">F查询还可以统一修改表中的字段数据(数字)</span></span><br><span class="line"><span class="string">	导入语句:</span></span><br><span class="line"><span class="string">        from django.db.models import F,Value</span></span><br><span class="line"><span class="string">        from django.db.models.functions import Concat</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># F查询</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">    <span class="comment"># 1.查询库存数大于卖出数的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(kucun__gt=F(&#x27;maichu&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 2.将所有的书籍价格上涨100块</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.update(price=F(&#x27;price&#x27;) + 100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.将所有的书籍名称加上&quot;爆款&quot;后缀</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># models.Book.objects.update(title=F(&#x27;title&#x27;) + &#x27;爆款&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># from django.db.models.functions import Concat</span></span><br><span class="line">    <span class="comment"># from django.db.models import Value</span></span><br><span class="line">    <span class="comment"># ret3 = models.Book.objects.update(title=Concat(F(&#x27;title&#x27;), Value(&#x27;爆款&#x27;)))</span></span><br></pre></td></tr></table></figure>

<h4 id="针对字符串不能直接拼接-需导入模块"><a href="#针对字符串不能直接拼接-需导入模块" class="headerlink" title="针对字符串不能直接拼接 需导入模块"></a>针对字符串不能直接拼接 需导入模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Concat</span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Value</span><br><span class="line">    </span><br><span class="line">    ret = models.Book.objects.update(title=Concat(F(<span class="string">&#x27;title&#x27;</span>), Value(<span class="string">&#x27;爆款&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="13-Q查询"><a href="#13-Q查询" class="headerlink" title="13.Q查询"></a>13.Q查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.filter默认只支持and连接查询条件如果需要修改则需要使用Q</span></span><br><span class="line"><span class="string">        from django.db.models import Q</span></span><br><span class="line"><span class="string">        filter(Q(),Q())</span></span><br><span class="line"><span class="string">        filter(Q()|Q())</span></span><br><span class="line"><span class="string">        filter(~Q(),~Q())</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">2.查询条件还可以由变量名模式改为字符串形式</span></span><br><span class="line"><span class="string">        q = Q()</span></span><br><span class="line"><span class="string">        q.connector=&#x27;or&#x27;	# 改变查询参数之间关系 默认是and</span></span><br><span class="line"><span class="string">        q.children.append((&#x27;字段名&#x27;,&#x27;需要查询的数据&#x27;))</span></span><br><span class="line"><span class="string">        filter(q)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.查询书名是三国演义爆款或者库存是100的书籍</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;filter()括号内可以写多个参数 逗号隔开 默认只支持and连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(title=&#x27;三国演义爆款&#x27;,kucun=100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;),Q(kucun=100))  # and</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100))  # or</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(~Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100)) # not</span></span><br><span class="line">    <span class="comment"># print(res1.query)</span></span><br></pre></td></tr></table></figure>

<h4 id="Q查询进阶用法"><a href="#Q查询进阶用法" class="headerlink" title="Q查询进阶用法"></a>Q查询进阶用法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;Q进阶用法&#x27;&#x27;&#x27;</span></span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">   <span class="comment"># condition = input(&#x27;请输入你需要按照什么字段查询数据&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># data = input(&#x27;请输入你需要查询的数据名称&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># q = Q()  # 生成一个Q对象</span></span><br><span class="line">   <span class="comment"># q.children.append((condition,data))</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.filter(q)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line">   q = Q()</span><br><span class="line">   q.connector = <span class="string">&#x27;or&#x27;</span>  <span class="comment"># 可以修改连接条件</span></span><br><span class="line">   q.children.append((<span class="string">&#x27;title__contains&#x27;</span>,<span class="string">&#x27;三&#x27;</span>))</span><br><span class="line">   q.children.append((<span class="string">&#x27;price__gt&#x27;</span>,<span class="number">200</span>))  <span class="comment"># 可以添加多个条件 并且也是and关系</span></span><br><span class="line">   res = models.Book.objects.<span class="built_in">filter</span>(q)</span><br><span class="line">   <span class="built_in">print</span>(res)</span><br><span class="line">   <span class="built_in">print</span>(res.query)</span><br></pre></td></tr></table></figure>

<h3 id="14-事务"><a href="#14-事务" class="headerlink" title="14.事务"></a>14.事务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.什么是事务?</span></span><br><span class="line"><span class="string">	事务是数据库操作的最小工作单元,作为逻辑工作单元执行一系列操作,这些操作作为一个整体一起向系统提交,要么都执行,要么都不执行,事务是一组不可分割的操作机集合</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.事务四大特性 	ACID</span></span><br><span class="line"><span class="string">	1.原子性:</span></span><br><span class="line"><span class="string">		事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做</span></span><br><span class="line"><span class="string">	2.一致性:</span></span><br><span class="line"><span class="string">		事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态</span></span><br><span class="line"><span class="string">	3.独立性:</span></span><br><span class="line"><span class="string">		一个事务的执行不能其它事务干扰</span></span><br><span class="line"><span class="string">	4.持久性:</span></span><br><span class="line"><span class="string">		永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MySQL</span></span><br><span class="line"><span class="string">	start transcation</span></span><br><span class="line"><span class="string">	commit</span></span><br><span class="line"><span class="string">	rollback</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="comment"># 创建一条订单数据</span></span><br><span class="line">            models.Order.objects.create(num=<span class="string">&quot;110110111&quot;</span>, product_id=<span class="number">1</span>, count=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 能执行成功</span></span><br><span class="line">     		models.Product.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(kucun=F(<span class="string">&quot;kucun&quot;</span>) - <span class="number">1</span>, maichu=F(<span class="string">&quot;maichu&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<h4 id="执行原生SQL语句"><a href="#执行原生SQL语句" class="headerlink" title="执行原生SQL语句"></a>执行原生SQL语句</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.raw(<span class="string">&#x27;select * from app01_book&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h4 id="数据库三大范式"><a href="#数据库三大范式" class="headerlink" title="数据库三大范式"></a>数据库三大范式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.第一范式(确保每列保持原子性)</span><br><span class="line">	确保每一个字段都必须是不可拆分的原子值</span><br><span class="line">2.第二范式(确保表中的每列都和主键相关)</span><br><span class="line">	一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中</span><br><span class="line">3.第三范式(确保每列都和主键列直接相关,而不是间接相关)</span><br><span class="line">	每一列数据都和主键直接相关，而不能间接相关</span><br></pre></td></tr></table></figure>

<h3 id="15-模型层字段及参数"><a href="#15-模型层字段及参数" class="headerlink" title="15.模型层字段及参数"></a>15.模型层字段及参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">models.AutoField(primary_key=<span class="literal">True</span>)		<span class="comment"># 主键字段</span></span><br><span class="line">models.CharField(max_length=<span class="number">32</span>)			<span class="comment"># varchar(32)</span></span><br><span class="line">models.IntergeField()					<span class="comment"># 整型</span></span><br><span class="line">models.DateField()						<span class="comment"># 年月日</span></span><br><span class="line">models.DateTimeField()					<span class="comment"># 年月日时分秒</span></span><br><span class="line">	auto_now								<span class="comment"># 记录每次修改时间</span></span><br><span class="line">    auto_now_add							<span class="comment"># 记录第一次修改时间</span></span><br><span class="line">models.DecimalField()					<span class="comment"># 浮点型</span></span><br><span class="line">	max_digits								<span class="comment"># 总位数</span></span><br><span class="line">    decimal_places							<span class="comment"># 小数位</span></span><br><span class="line">models.BooleanField()					<span class="comment"># 布尔值类型</span></span><br><span class="line">	给这个字段传布尔值会自动转换成数字<span class="number">0</span>或<span class="number">1</span></span><br><span class="line">    一般用在状态二选一</span><br><span class="line">TextField()								<span class="comment"># 存储大段文本(bbs项目会使用)</span></span><br><span class="line">EmailField()							<span class="comment"># 存储邮箱格式数据</span></span><br><span class="line">FileField()								<span class="comment"># 存储数据路径(bbs项目会使用)</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义字段"><a href="#自定义字段" class="headerlink" title="自定义字段"></a>自定义字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;自定义字段&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCharField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,max_length,*args,**kwargs</span>):</span></span><br><span class="line">        self.max_length = max_length</span><br><span class="line">        <span class="built_in">super</span>().__init__(max_length=max_length,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_type</span>(<span class="params">self, connection</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;char(%s)&#x27;</span>%self.max_length</span><br></pre></td></tr></table></figure>

<h4 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">max_length			<span class="comment"># 指定长度</span></span><br><span class="line">varbose_name		<span class="comment"># 字段解释</span></span><br><span class="line">default				<span class="comment"># 字段默认值</span></span><br><span class="line">null				<span class="comment"># 字段可以为空</span></span><br><span class="line">auto_now			<span class="comment"># date字段参数 记录每次修改时间</span></span><br><span class="line">auto_now_add		<span class="comment"># date字段参数 记录第一次修改时间</span></span><br><span class="line">to					<span class="comment"># 指定关联哪张表的主键</span></span><br><span class="line">unique				<span class="comment"># 唯一约束</span></span><br><span class="line">db_index			<span class="comment"># 索引</span></span><br><span class="line">choices				<span class="comment"># 存对应关系(一般元组套元组)</span></span><br></pre></td></tr></table></figure>

<h3 id="16-choices参数"><a href="#16-choices参数" class="headerlink" title="16.choices参数"></a>16.choices参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># choices参数</span></span><br><span class="line">创建用户表</span><br><span class="line">	性别</span><br><span class="line">    	两到三种状态</span><br><span class="line">    学历</span><br><span class="line">    	也是有限个</span><br><span class="line">    在职状态</span><br><span class="line">    	也是有限个</span><br><span class="line">    婚姻</span><br><span class="line">    	也是有限个</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;针对某个字段可以列举完全的情况 一般都是使用choices参数&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    host = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>,<span class="string">&#x27;在线&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>,<span class="string">&#x27;待上线&#x27;</span>),</span><br><span class="line">        (<span class="number">3</span>,<span class="string">&#x27;宕机&#x27;</span>),</span><br><span class="line">        (<span class="number">4</span>,<span class="string">&#x27;待上架&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    status = models.IntegerField(choices=status_choices)</span><br><span class="line"></span><br><span class="line">    desc_choices = (</span><br><span class="line">        (<span class="string">&#x27;哈哈&#x27;</span>,<span class="string">&#x27;哈哈哈哈哈哈&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;呵呵&#x27;</span>,<span class="string">&#x27;呵呵呵呵呵呵&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘿嘿&#x27;</span>,<span class="string">&#x27;嘿嘿嘿嘿嘿嘿&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘻嘻&#x27;</span>,<span class="string">&#x27;嘻嘻嘻嘻嘻嘻&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">32</span>,choices=desc_choices)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">*****获取对应关系*****</span><br><span class="line">.get_字段名_display()</span><br></pre></td></tr></table></figure>

<h3 id="17-查看原生SQL语句方法"><a href="#17-查看原生SQL语句方法" class="headerlink" title="17.查看原生SQL语句方法"></a>17.查看原生SQL语句方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>测试环境</span><br><span class="line">	自己拷贝代码</span><br><span class="line"><span class="number">2.</span>pycharm自带的测试环境</span><br><span class="line">    python console</span><br><span class="line"><span class="number">3.</span>配置文件查看所有orm内部SQL语句</span><br><span class="line">    <span class="comment"># 直接拷贝到配置文件中即可</span></span><br><span class="line">        LOGGING = &#123;</span><br><span class="line">        <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            	&#125;,</span><br><span class="line">        	&#125;</span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-ORM查询优化-数据库查询优化"><a href="#18-ORM查询优化-数据库查询优化" class="headerlink" title="18.ORM查询优化(数据库查询优化)"></a>18.ORM查询优化(数据库查询优化)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">惰性查询</span><br><span class="line">	用不到的数据即使写了orm语句也不会执行</span><br><span class="line">        <span class="number">1.</span>only与defer</span><br><span class="line">        <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>only与defer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;title&#x27;)  # 列表套字典</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.only(&#x27;title&#x27;)  # 列表套对象</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.price)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    only括号内写什么字段</span></span><br><span class="line"><span class="string">        生成的对象就含有对应的属性 在查找该属性的时候不再走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则每次都会走数据库查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.defer(&#x27;title&#x27;)	# 列表套对象</span></span><br><span class="line">    <span class="comment"># # print(res1)  </span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    defer与only刚好相反</span></span><br><span class="line"><span class="string">        生成的对象就不含有对应的属性 在查找该属性的时候需要每次走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则不需要走数据库查询</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># print(res.publish.title)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>select_related与prefetch_related</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.select_related(&#x27;publish&#x27;)</span></span><br><span class="line">    <span class="comment"># for i in res:</span></span><br><span class="line">    <span class="comment">#     print(i.publish.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select_related相当于连表操作</span></span><br><span class="line"><span class="string">        先将models后面的表和括号内外键字段关联的表连接起来</span></span><br><span class="line"><span class="string">        之后一次性把所有的数据封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    res = models.Book.objects.prefetch_related(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(i.publish.title)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    prefetch_related相当于子查询</span></span><br><span class="line"><span class="string">        先查询models后面的表的所有的数据</span></span><br><span class="line"><span class="string">        然后将括号内外键关联的表的数据全部查询出来</span></span><br><span class="line"><span class="string">        之后整合到一起封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">总结:</span><br><span class="line">    <span class="number">1.</span>only与defer</span><br><span class="line">        only:查询括号内的字段不需要走数据库 查询括号内以外的字段每次都要走数据库</span><br><span class="line">        defer:查询括号内字段要走数据库 查询括号内以外字段时不需要走数据库</span><br><span class="line">    <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line">    	select_related:相当于链表操作,先将models后的表与括号内指定外键字段关联的表拼接,再把所有数据封装到数据对象中</span><br><span class="line">        prefertch_related:相当于子查询,先将models后的表所有数据查询出来,再将括号内指定外键字段关联的表所有数据查询出来,再整合到一起封装到数据对象中</span><br></pre></td></tr></table></figure>

<h3 id="19-框架设计模型-MTV与MVC"><a href="#19-框架设计模型-MTV与MVC" class="headerlink" title="19.框架设计模型(MTV与MVC)"></a>19.框架设计模型(MTV与MVC)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MTV</span><br><span class="line">	M:models模型层</span><br><span class="line">    T:templates模板层</span><br><span class="line">	V:views视图层</span><br><span class="line">MVC</span><br><span class="line">	M:models模型层</span><br><span class="line">    V:views视图层</span><br><span class="line">    C:controller控制层</span><br><span class="line">        </span><br><span class="line">django框架自称是MTV 其实本质也是MVC</span><br></pre></td></tr></table></figure>

<h3 id="20-多对多表关系三种创建方式"><a href="#20-多对多表关系三种创建方式" class="headerlink" title="20.多对多表关系三种创建方式"></a>20.多对多表关系三种创建方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">第一种(全自动):  </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     <span class="string">&#x27;&#x27;&#x27;第三张表的扩展性极差 eg:无法添加额外的字段&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第二种(纯手动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        book_id = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">        author_id = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">        desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;第三张表可以自定义 但是orm查询不太方便&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第三种(半自动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>,</span><br><span class="line">                                     through=<span class="string">&#x27;Books2Author&#x27;</span>,</span><br><span class="line">                                     through_fields=(<span class="string">&#x27;book&#x27;</span>,<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">                                     )</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	<span class="comment"># books = models.ManyToManyField(to=&#x27;Books&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through=&#x27;Books2Author&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through_fields=(&#x27;author&#x27;,&#x27;book&#x27;)</span></span><br><span class="line">    	<span class="comment">#                                )</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	book = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">    	author = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">    	desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;扩展性高 无法使用add\set\remove\clear 其他操作不影响&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">through_fields字段先后顺序</span></span><br><span class="line"><span class="string">	判断本质:</span></span><br><span class="line"><span class="string">		通过第三张表查询对应的的表 需要用到哪个字段就把哪个字段放前面</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/03/15/%E6%A8%A1%E6%9D%BF%E5%B1%82/" rel="prev" title="Django之模板层">
                  <i class="fa fa-chevron-left"></i> Django之模板层
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/04/12/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1/" rel="next" title="模型层之必知必会十三条">
                  模型层之必知必会十三条 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/" class="post-title-link" itemprop="url">Drf过认证权限频率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-15 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-15T18:20:25+08:00">2019-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-认证Authentication"><a href="#1-认证Authentication" class="headerlink" title="1.认证Authentication"></a>1.认证Authentication</h2><h3 id="1-1自定义认证"><a href="#1-1自定义认证" class="headerlink" title="1.1自定义认证"></a>1.1自定义认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义认证的实现:</span></span><br><span class="line">	写一个类,继承BaseAuththentication,重写authenticate方法,认证逻辑写在该方法内</span><br><span class="line">    	认证通过:</span><br><span class="line">            返回两个值,其中一个值最终给了Request对象的user</span><br><span class="line">        认证失败:</span><br><span class="line">            抛异常:APIException或者AuthenticationFailed</span><br></pre></td></tr></table></figure>

<h4 id="自定义认证流程"><a href="#自定义认证流程" class="headerlink" title="自定义认证流程"></a>自定义认证流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件编写自己的认证类,并继承继承BaseAuththentication父类,重写authenticate方法,认证逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义认证类</span></span><br><span class="line"><span class="comment"># 3.认证生效范围配置:</span></span><br><span class="line">	全局认证:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部认证:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,认证只生效该视图类</span></span><br><span class="line">        authentication_classes = [MyAuth]</span><br><span class="line">        </span><br><span class="line"><span class="comment"># ps:全局认证局部不认证</span></span><br><span class="line">    <span class="number">1.</span>先在settings.py中配置好全局认证</span><br><span class="line">    <span class="number">2.</span>视图类书写:authentication_classes = [](优先使用局部)</span><br></pre></td></tr></table></figure>

<h4 id="编写models"><a href="#编写models" class="headerlink" title="编写models"></a>编写models</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    username=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    user_type=models.IntegerField(choices=((<span class="number">1</span>,<span class="string">&#x27;超级用户&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;普通用户&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;二笔用户&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserToken</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    user=models.OneToOneField(to=<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line">    token=models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写认证类"><a href="#编写认证类" class="headerlink" title="编写认证类"></a>编写认证类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用下创建任一py文件并编写认证类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> AuthenticationFailed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyAuth</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="comment"># 从请求头中获取当次请求携带的token字符串(登录后会返回随机字符串,未登录则没有随机字符串)</span></span><br><span class="line">            token = request.META.get(<span class="string">&#x27;HTTP_TOKEN&#x27;</span>)</span><br><span class="line">            <span class="comment"># token = request.query_params.get(&#x27;token&#x27;)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;请求头中缺少token参数&#x27;</span>)</span><br><span class="line">            user_token = UserToken.objects.<span class="built_in">filter</span>(token=token).first()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_token:</span><br><span class="line">                <span class="keyword">return</span> user_token.user, token</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;校验失败&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写视图类"><a href="#编写视图类" class="headerlink" title="编写视图类"></a>编写视图类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入需要的py文件并编写视图类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> User, UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">    <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyAuth</span><br><span class="line">    <span class="keyword">import</span> uuid</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">LoginView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">   </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            user = User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                token = uuid.uuid4()</span><br><span class="line">                <span class="comment"># 根据user=user去查询,如果有,使用defaults更新,如果没有,新增一条</span></span><br><span class="line">                UserToken.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;, user=user)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;登陆成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;用户名或密码错误&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="全局认证"><a href="#全局认证" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        <span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部认证"><a href="#局部认证" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line">	<span class="comment"># 中括号内填写认证类名</span></span><br><span class="line">	authentication_classes = [MyAuth]</span><br></pre></td></tr></table></figure>

<h3 id="1-2内置认证"><a href="#1-2内置认证" class="headerlink" title="1.2内置认证"></a>1.2内置认证</h3><h4 id="全局认证-1"><a href="#全局认证-1" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <span class="comment"># session认证</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,   	<span class="comment"># 基本认证</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 认证失败会有两种可能的返回值:</span></span><br><span class="line">	<span class="number">401</span> Unauthorized 未认证</span><br><span class="line">	<span class="number">403</span> Permission Denied 权限被禁止</span><br></pre></td></tr></table></figure>

<h4 id="局部认证-1"><a href="#局部认证-1" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line"></span><br><span class="line">导入内置认证类:</span><br><span class="line">    <span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication, BasicAuthentication</span><br><span class="line"></span><br><span class="line">配置类属性:</span><br><span class="line">    authentication_classes = [SessionAuthentication, BasicAuthentication]</span><br></pre></td></tr></table></figure>

<h2 id="2-权限Permissions"><a href="#2-权限Permissions" class="headerlink" title="2.权限Permissions"></a>2.权限Permissions</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限控制可以限制用户对于视图的访问和对于具体数据对象的访问</span></span><br><span class="line">    -在执行视图的dispatch()方法前，会先进行视图访问权限的判断</span><br><span class="line">	-在通过get_object()获取具体对象时，会进行模型对象访问权限的判断</span><br></pre></td></tr></table></figure>

<h3 id="2-1自定义权限"><a href="#2-1自定义权限" class="headerlink" title="2.1自定义权限"></a>2.1自定义权限</h3><h4 id="自定义权限流程"><a href="#自定义权限流程" class="headerlink" title="自定义权限流程"></a>自定义权限流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件,编写权限类(继承或不继承BasePermission父类),重写has_permission方法,权限逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义权限类</span></span><br><span class="line"><span class="comment"># 3.权限生效范围配置:</span></span><br><span class="line">	全局权限:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写权限类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部权限:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,权限只生效该视图类</span></span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="编写权限类"><a href="#编写权限类" class="headerlink" title="编写权限类"></a>编写权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建任一py文件或写在上述认证类中都可</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">MyPermission</span>(<span class="params">BasePermission</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="keyword">if</span> request.user.user_type == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限"><a href="#全局权限" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限"><a href="#局部权限" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyPermission</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如需自定义权限，需继承rest_framework.permissions.BasePermission父类，并实现以下两个任何一个方法或全部</span></span><br><span class="line">    - `.has_permission(self, request, view)`</span><br><span class="line">      是否可以访问视图,view表示当前视图对象</span><br><span class="line"></span><br><span class="line">    - `.has_object_permission(self, request, view, obj)`</span><br><span class="line">      是否可以访问数据对象,view表示当前视图,obj为数据对象</span><br></pre></td></tr></table></figure>

<h3 id="2-2内置权限"><a href="#2-2内置权限" class="headerlink" title="2.2内置权限"></a>2.2内置权限</h3><h4 id="内置权限类"><a href="#内置权限类" class="headerlink" title="内置权限类"></a>内置权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf提供的内置权限类,一般配套内置认证使用</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny,IsAuthenticated,IsAdminUser,IsAuthenticatedOrReadOnly</span><br><span class="line">    - AllowAny 						<span class="comment"># 允许所有用户</span></span><br><span class="line">    - IsAuthenticated 				<span class="comment"># 仅通过认证的用户</span></span><br><span class="line">    - IsAdminUser 					<span class="comment"># 仅管理员用户</span></span><br><span class="line">    - IsAuthenticatedOrReadOnly 	<span class="comment"># 登陆认证用户可以对数据进行增删改操作，未登陆认证的只能查看数据</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限-1"><a href="#全局权限-1" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 通过认证的用户才有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 若未指明,则采用如下配置:</span></span><br><span class="line">	REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 所有用户都有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限-1"><a href="#局部权限-1" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [IsAuthenticated]</span><br></pre></td></tr></table></figure>

<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建超级用户，登陆到admin，创建普通用户(注意设置职员状态，也就是能登陆)</span></span><br><span class="line"><span class="comment"># 全局配置IsAuthenticated</span></span><br><span class="line"><span class="comment"># setting.py</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"> 	path(<span class="string">&#x27;test/&#x27;</span>, views.TestView.as_view()),</span><br><span class="line">    </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;个人中心&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 登陆到admin后台后，直接访问可以，如果没登陆，不能访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意:如果全局配置了</span></span><br><span class="line">	rest_framework.permissions.IsAdminUser</span><br><span class="line"><span class="comment"># 就只有管理员能访问，其他用户访问不了</span></span><br></pre></td></tr></table></figure>

<h2 id="3-访问频率Throttling"><a href="#3-访问频率Throttling" class="headerlink" title="3.访问频率Throttling"></a>3.访问频率Throttling</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问频率限制用处:</span></span><br><span class="line">    可以对接口访问的频次进行限制，以减轻服务器压力</span><br><span class="line">    一般用于付费购买次数,投票等场景使用</span><br></pre></td></tr></table></figure>

<h3 id="频率限制的使用"><a href="#频率限制的使用" class="headerlink" title="频率限制的使用"></a>频率限制的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制用户的访问次数，根据ip，根据用户id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写个类，继承基类，重写某个方法</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> BaseThrottle,SimpleRateThrottle</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">        scope = <span class="string">&#x27;ip_throttle&#x27;</span>  <span class="comment"># 一定要写</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="comment"># 返回谁，就以谁做限制</span></span><br><span class="line">            <span class="comment"># 按ip限制</span></span><br><span class="line">            <span class="built_in">print</span>(request.META)</span><br><span class="line">            <span class="keyword">return</span> request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在视图类中配置</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在配置文件中配置</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 频率限制的配置信息</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ip_throttle&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>  <span class="comment"># key要跟类中的scop对应，1分钟只能访问3此</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 局部使用</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局使用（在配置文件中）</span></span><br><span class="line">	<span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [<span class="string">&#x27;app01.auth.MyThrottle&#x27;</span>],</span><br></pre></td></tr></table></figure>

<h3 id="3-1自定义频率类"><a href="#3-1自定义频率类" class="headerlink" title="3.1自定义频率类"></a>3.1自定义频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义频率类逻辑:</span></span><br><span class="line">    <span class="number">1.</span>取出访问者ip</span><br><span class="line">    <span class="number">2.</span>判断当前ip不在访问字典里,添加进去,并且直接返回<span class="literal">True</span>,表示第一次访问,在字典里,继续往下走</span><br><span class="line">    <span class="number">3.</span>循环判断当前ip的列表，有值并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间</span><br><span class="line">    <span class="number">4.</span>判断当前列表长度:</span><br><span class="line">        当列表小于<span class="number">3</span>,说明一分钟以内访问不足三次,把当前时间插入到列表第一个位置,返回<span class="literal">True</span>,通过</span><br><span class="line">    	当大于等于<span class="number">3</span>,说明一分钟内访问超过三次,返回<span class="literal">False</span>验证失败</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 自定义频率类MyThrottles</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThrottles</span>():</span></span><br><span class="line">    VISIT_RECORD = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.history = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="comment"># 1.取出访问者ip</span></span><br><span class="line">        <span class="comment"># print(request.META)</span></span><br><span class="line">        ip = request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="comment"># 2.判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问</span></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> self.VISIT_RECORD:</span><br><span class="line">            self.VISIT_RECORD[ip] = [ctime, ]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        self.history = self.VISIT_RECORD.get(ip)</span><br><span class="line">        <span class="comment"># 3.循环判断当前ip的列表,有值并且当前时间减去列表最后一个时间大于60s,pop掉这种数据,这样列表中仅剩60s以内的访问时间</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> ctime - self.history[-<span class="number">1</span>] &gt; <span class="number">60</span>:</span><br><span class="line">            <span class="comment"># 默认取走列表中最后一个属性值</span></span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="comment"># 4.判断,当列表小于3,说明一分钟内访问不足三次,把当前时间插入到列表第一个位置,返回True,顺利通过</span></span><br><span class="line">        <span class="comment"># 5.当大于等于3,说明一分钟内访问超过三次，返回False验证失败</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history) &lt; <span class="number">3</span>:</span><br><span class="line">            self.history.insert(<span class="number">0</span>, ctime)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span> - (ctime - self.history[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h4 id="全局限次"><a href="#全局限次" class="headerlink" title="全局限次"></a>全局限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py文件中配置:</span></span><br><span class="line">	REST_FRAMEWORK = &#123; </span><br><span class="line">        <span class="comment"># 访问频率全局配置,访问限次已经在频率类中写好,不用指定</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>:[<span class="string">&#x27;app01.MyAuthenticate.MyThrottles&#x27;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部限次"><a href="#局部限次" class="headerlink" title="局部限次"></a>局部限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类里添加属性:</span></span><br><span class="line">	导入频率限次类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyThrottles</span><br><span class="line">    添加类属性:</span><br><span class="line">		throttle_classes = [MyThrottles,]</span><br></pre></td></tr></table></figure>

<h3 id="3-2内置频率类"><a href="#3-2内置频率类" class="headerlink" title="3.2内置频率类"></a>3.2内置频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf内置频率类,配套内置认证内置权限使用,频率类又区分为登录和未登录:</span></span><br><span class="line">	REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="comment"># 访问频率全局配置</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,		<span class="comment"># 未登录访问限次</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>		<span class="comment"># 登录访问限次</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;5/m&#x27;</span>,		<span class="comment"># 未登录一分钟访问限次五次</span></span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span>		<span class="comment"># 登录一分钟访问限次十次</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="限制匿名用户每分钟访问3次-未登录"><a href="#限制匿名用户每分钟访问3次-未登录" class="headerlink" title="限制匿名用户每分钟访问3次(未登录)"></a>限制匿名用户每分钟访问3次(未登录)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全局配置:</span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 使用second(秒),minute(分钟),hour(小时)或day(天)来指明周期。</span></span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="限制登陆用户每分钟访问10次"><a href="#限制登陆用户每分钟访问10次" class="headerlink" title="限制登陆用户每分钟访问10次"></a>限制登陆用户每分钟访问10次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.AnonRateThrottle</span></span><br><span class="line">	限制所有匿名未认证用户，使用IP区分用户。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;anon&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.UserRateThrottle</span></span><br><span class="line">	限制认证用户，使用User <span class="built_in">id</span> 来区分。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;user&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ScopedRateThrottle</span></span><br><span class="line">	限制用户对于每个视图的访问频次，使用ip或user <span class="built_in">id</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    <span class="comment"># 视图类:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactListView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        	throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">        	...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactDetailView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UploadView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># setting.py配置</span></span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;rest_framework.throttling.ScopedRateThrottle&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;contacts&#x27;</span>: <span class="string">&#x27;1000/day&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;uploads&#x27;</span>: <span class="string">&#x27;20/day&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/10/Drf%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F%E5%88%86%E9%A1%B5%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/10/Drf%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F%E5%88%86%E9%A1%B5%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">Drf过滤排序分页异常处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-10T18:20:25+08:00">2019-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf过滤排序分页异常处理"><a href="#Drf过滤排序分页异常处理" class="headerlink" title="Drf过滤排序分页异常处理"></a>Drf过滤排序分页异常处理</h1><h2 id="1-过滤Filtering"><a href="#1-过滤Filtering" class="headerlink" title="1.过滤Filtering"></a>1.过滤Filtering</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装过滤第三方模块</span></span><br><span class="line">	pip3 install django-<span class="built_in">filter</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># settings.py中注册应用</span></span><br><span class="line">	INSTALLED_APPS = [</span><br><span class="line">    	<span class="string">&#x27;django_filters&#x27;</span>,  <span class="comment"># 注册应用</span></span><br><span class="line">	]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 无论是全局过滤还是局部过滤,前提是都需要指定过滤字段</span></span><br><span class="line">	视图类中添加类属性:</span><br><span class="line">		filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局过滤</span></span><br><span class="line">	settings.py:</span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">            <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 局部过滤:</span></span><br><span class="line">	导入过滤模块:</span><br><span class="line">        <span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line">    添加类属性:</span><br><span class="line">        filter_backends = [DjangoFilterBackend,]</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ListAPIView</span>):</span></span><br><span class="line">        queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookSerializer</span><br><span class="line">        filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 127.0.0.1:8000/four/students/?sex=1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内置g类(既有排序，又有过滤)</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter,SearchFilter</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在视图类中配置，最顶层的类至少是GenericAPIView</span></span><br><span class="line">    filter_backends = [SearchFilter,OrderingFilter,]</span><br><span class="line">    <span class="comment"># 过滤条件，按名字过滤</span></span><br><span class="line">    search_fields=[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="comment"># 按哪个字段排序</span></span><br><span class="line">    ordering_fields=[<span class="string">&#x27;price&#x27;</span>,<span class="string">&#x27;id&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h2 id="2-排序"><a href="#2-排序" class="headerlink" title="2.排序"></a>2.排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局排序</span></span><br><span class="line">	settings.py:</span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">    		<span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: ( </span><br><span class="line">        	<span class="string">&#x27;rest_framework.filters.OrderingFilter&#x27;</span>,)</span><br><span class="line">		&#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 局部排序</span></span><br><span class="line">	导入过滤模块:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line">    添加类属性:</span><br><span class="line">        filter_backends = [OrderingFilter,]</span><br><span class="line">        </span><br><span class="line">eg:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentListView</span>(<span class="params">ListAPIView</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        filter_backends = [OrderingFilter]</span><br><span class="line">        ordering_fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 127.0.0.1:8000/books/?ordering=-age</span></span><br><span class="line">    <span class="comment"># -id 表示针对id字段进行倒序排序</span></span><br><span class="line">    <span class="comment"># id  表示针对id字段进行升序排序</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># 如果需要在过滤后再进行排序,两者结合使用</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line">    <span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line">	<span class="keyword">from</span> app01.models <span class="keyword">import</span> Book</span><br><span class="line">    <span class="keyword">from</span> app01.ManySerializer <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        queryset = Book.objects</span><br><span class="line">        serializer_class = BookSerializer</span><br><span class="line">        <span class="comment"># 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,</span></span><br><span class="line">    	<span class="comment"># 否则过滤功能会失效</span></span><br><span class="line">        filter_backends = [DjangoFilterBackend, OrderingFilter]</span><br><span class="line">        filter_fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-分页功能"><a href="#3-分页功能" class="headerlink" title="3.分页功能"></a>3.分页功能</h2><h3 id="3-1PageNumberPagination-基本分页"><a href="#3-1PageNumberPagination-基本分页" class="headerlink" title="3.1PageNumberPagination 基本分页"></a>3.1PageNumberPagination 基本分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	page_size = api_settings.PAGE_SIZE	<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">	page_query_param = <span class="string">&#x27;page&#x27;</span>			<span class="comment"># 该属性指定分页时的查询依据(xxx/book/?page=1)</span></span><br><span class="line">    page_size_query_param = <span class="literal">None</span>		<span class="comment"># 该属性指定返回条数</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>           		<span class="comment"># 该属性指定每页最多显示条数(优先级大于上一条)</span></span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承PageNumberPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonPageNumberPagination</span>(<span class="params">PageNumberPagination</span>):</span></span><br><span class="line">        page_size = <span class="number">2</span>  				 <span class="comment"># 指定每页显示条数</span></span><br><span class="line">        page_query_param = <span class="string">&#x27;page&#x27;</span>  	 <span class="comment"># 查询时用的参数xxx/books/?page=2 查询第二页数据</span></span><br><span class="line">        page_size_query_param=<span class="string">&#x27;size&#x27;</span> <span class="comment"># 传递该参数可指定该页返回数据条数</span></span><br><span class="line">    	max_page_size = <span class="number">10</span>  		 <span class="comment"># 指定每页最多显示10条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonPageNumberPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?page=<span class="number">3</span>			<span class="comment"># 查询第三页数据,显示默认展示条数</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?page=<span class="number">2</span>&amp;size=<span class="number">5</span>	<span class="comment"># 查询第二页,指定显示五条数据</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2LimitOffsetPagination-偏移分页"><a href="#3-2LimitOffsetPagination-偏移分页" class="headerlink" title="3.2LimitOffsetPagination 偏移分页"></a>3.2LimitOffsetPagination 偏移分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> LimitOffsetPagination</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	default_limit = api_settings.PAGE_SIZE	<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">	page_query_param = <span class="string">&#x27;limit&#x27;</span>				<span class="comment"># 该属性指定显示数据条数</span></span><br><span class="line">    offset_query_param = <span class="string">&#x27;offset&#x27;</span>			<span class="comment"># 该属性指定偏移的查询参数(从xx条开始时查询)</span></span><br><span class="line">    max_limit = <span class="literal">None</span>           				<span class="comment"># 该属性指定每页最多显示条数</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承LimitOffsetPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> LimitOffsetPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonLimitOffsetPagination</span>(<span class="params">LimitOffsetPagination</span>):</span></span><br><span class="line">        default_limit = <span class="number">2</span>  				<span class="comment"># 指定每页显示条数</span></span><br><span class="line">        page_query_param = <span class="string">&#x27;limit&#x27;</span>   	<span class="comment"># 指定显示数据条数</span></span><br><span class="line">        offset_query_param = <span class="string">&#x27;offset&#x27;</span>	<span class="comment"># 指定显示数据的开始位置(索引)</span></span><br><span class="line">    	max_page_size = <span class="number">10</span>  		 	<span class="comment"># 每页最多显示10条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonLimitOffsetPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?limit=<span class="number">2</span>			<span class="comment"># 查询两条数据(索引0和1的数据)</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?limit=<span class="number">2</span>&amp;offset=<span class="number">4</span>	<span class="comment"># 查询两条数据,从第四条开始展示第五第六条</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3CursorPagination-游标分页"><a href="#3-3CursorPagination-游标分页" class="headerlink" title="3.3CursorPagination 游标分页"></a>3.3CursorPagination 游标分页</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> CursorPagination</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要类属性</span></span><br><span class="line">	page_size = api_settings.PAGE_SIZE		<span class="comment"># 该属性获取全局默认显示条数</span></span><br><span class="line">    cursor_query_param = <span class="string">&#x27;cursor&#x27;</span>   		<span class="comment"># 该属性指定分页时的查询依据(不可指定)</span></span><br><span class="line">    ordering = <span class="string">&#x27;-created&#x27;</span>              		<span class="comment"># 排序,默认按字段-created排序</span></span><br><span class="line">    page_size_query_param = <span class="literal">None</span>			<span class="comment"># 该属性指定显示条数</span></span><br><span class="line">    max_page_size = <span class="literal">None</span>           			<span class="comment"># 该属性指定每页最多显示条数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优缺点:</span></span><br><span class="line">	优点:速度最快，数据量越大,越有优势</span><br><span class="line">	缺点:只能前一页和后一页,不能直接跳到某一页</span><br></pre></td></tr></table></figure>

<h4 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.写一个分页类,并继承PageNumberPagination父类,重写上述4个类属性</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> CursorPagination</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CommonCursorPagination</span>(<span class="params">CursorPagination</span>):</span>  </span><br><span class="line">        page_size = <span class="number">2</span>  						<span class="comment"># 每页显示两条</span></span><br><span class="line">        cursor_query_param = <span class="string">&#x27;cursor&#x27;</span>  		<span class="comment"># 查询条件(只能上一页下一页)</span></span><br><span class="line">        ordering = <span class="string">&#x27;id&#x27;</span>  					<span class="comment"># 排序，按id升序排序</span></span><br><span class="line">        page_size_query_param = <span class="string">&#x27;size&#x27;</span>  	<span class="comment"># 通过这个参数决定每页显示多少条</span></span><br><span class="line">        max_page_size = <span class="number">5</span>  					<span class="comment"># 每页最大显示五条</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.视图类中配置自定义分页类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">    <span class="comment"># class BookView(GenericViewSet,ListModelMixin):</span></span><br><span class="line">        <span class="comment"># 配置分页类，继承GenericAPIView及子类，才能使用</span></span><br><span class="line">        pagination_class = CommonCursorPagination</span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/book/?cursor=cD0y			<span class="comment"># 查询某页数据,显示默认条数</span></span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/books/?cursor=cD0y&amp;size=<span class="number">5</span>	<span class="comment"># 查询某页(上下页)数据,显示五条</span></span><br></pre></td></tr></table></figure>

<h3 id="分页总结"><a href="#分页总结" class="headerlink" title="分页总结"></a>分页总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PageNumberPagination 基本分页		可以实现查某一页数据和指定显示条数(数据量越大查询效率越低)</span></span><br><span class="line"><span class="comment"># LimitOffsetPagination 偏移分页	可以实现查指定条数据和指定查询数据的起始位置</span></span><br><span class="line"><span class="comment"># CursorPagination 游标分页			可以实现查询当前页数据和指定显示条数,默认不展示数据总数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ps:</span></span><br><span class="line">	当数据量不大时可以使用基本分页,简单方便实现展示xx页xx条数据(每次查询从第一条开始检索)</span><br><span class="line">    偏移分页可以指定显示数据的开始位置(每次查询可以指定开始检索的位置)</span><br><span class="line">	当数据量很大时可以使用游标分页来提升查询效率,但是他不可以指定查询页数,只可以上一页下一页(每次查询保留当前被检索数据位置) </span><br></pre></td></tr></table></figure>

<h3 id="继承APIView实现三种分页-类似"><a href="#继承APIView实现三种分页-类似" class="headerlink" title="继承APIView实现三种分页(类似)"></a>继承APIView实现三种分页(类似)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookViewALL</span>(<span class="params">APIView</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,*args,**kwargs</span>):</span></span><br><span class="line">        book_list=Books.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 实例化得到一个对象,自定义的基本分页类</span></span><br><span class="line">        pagination=CommonPageNumberPagination()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用该对象paginate_queryset方法,传入需要分页的数据,返回分页好的数据</span></span><br><span class="line">        book_list2=pagination.paginate_queryset(book_list,request,self)</span><br><span class="line">        </span><br><span class="line">		<span class="comment"># 传入分页后的数据并序列化 </span></span><br><span class="line">        ser=BookSerializer(instance=book_list2,many=<span class="literal">True</span>)</span><br><span class="line">        res=&#123;<span class="string">&#x27;pre&#x27;</span>:pagination.get_previous_link(),<span class="string">&#x27;next&#x27;</span>:pagination.get_next_link(),<span class="string">&#x27;count&#x27;</span>:pagination.page.paginator.count,<span class="string">&#x27;data&#x27;</span>:ser.data&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(res)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 另一种返回方式</span></span><br><span class="line">        <span class="comment"># return pagination.get_paginated_response(ser.data)</span></span><br><span class="line">        </span><br><span class="line">   </span><br><span class="line"><span class="comment"># pagination对象属性:</span></span><br><span class="line">	get_previous_link()				<span class="comment"># 上一页</span></span><br><span class="line">    pagination.get_next_link()		<span class="comment"># 下一页</span></span><br><span class="line">    pagination.page.paginator.count	<span class="comment"># 总的数据量</span></span><br></pre></td></tr></table></figure>

<h2 id="4-异常处理"><a href="#4-异常处理" class="headerlink" title="4.异常处理"></a>4.异常处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 全局统一捕获异常，返回固定的格式  &#123;code:<span class="number">999</span>,msg:<span class="string">&#x27;未知错误&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 使用步骤</span><br><span class="line">	-写一个函数</span><br><span class="line">    -在配置文件中配置</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line"><span class="comment">#  写函数</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">common_exception_handler</span>(<span class="params">exc, context</span>):</span></span><br><span class="line">    <span class="comment"># 记录日志</span></span><br><span class="line">    <span class="built_in">print</span>(context[<span class="string">&#x27;request&#x27;</span>].META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>))</span><br><span class="line">    response=exception_handler(exc, context)</span><br><span class="line">    <span class="keyword">if</span> response:  <span class="comment"># 处理了drf的异常</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">999</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;错误&#x27;</span>,<span class="string">&#x27;detail&#x27;</span>:response.data&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 不知道的异常</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">999</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;未知错误&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> Response(data)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 配置文件配置</span></span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="string">&#x27;app01.utils.commonexception_handler&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/05/RBAC%E6%9D%83%E9%99%90%E5%85%B3%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/05/RBAC%E6%9D%83%E9%99%90%E5%85%B3%E7%B3%BB/" class="post-title-link" itemprop="url">RBAC权限关系</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-05 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-05T18:20:25+08:00">2019-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="RBAC权限关系"><a href="#RBAC权限关系" class="headerlink" title="RBAC权限关系"></a>RBAC权限关系</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RBAC:Role-Based Access Control --&gt;基于角色的访问控制</span></span><br><span class="line"><span class="comment"># 公司内部系统，crm：客户关系管理，oa系统，自动化运维项目</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RBAC原理：</span></span><br><span class="line">	权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。这就极大地简化了权限的管理。这样管理都是层级相互依赖的，权限赋予给角色，而把角色又赋予用户，这样的权限设计很清楚，管理起来很方便</span><br><span class="line"></span><br><span class="line"><span class="comment"># Django的 Auth组件(app) 采用的认证规则就是RBAC</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何实现rbac，django的auth如何实现?</span></span><br><span class="line">	 -User表：存用户信息</span><br><span class="line">     -Permission表：存权限:发工资，招人</span><br><span class="line">     -Role表: 存角色：市场，销售，运营，开发，运维，测试...</span><br><span class="line">     -用户和角色是多对多，中间表</span><br><span class="line">     -权限和角色是多对多，中间表</span><br><span class="line">     -用户和权限是多对多，中间表</span><br><span class="line">        </span><br><span class="line"> <span class="comment"># django的auth的表</span></span><br><span class="line">    auth_group：组表，角色表</span><br><span class="line">    auth_permission：权限表</span><br><span class="line">    auth_user：用户表</span><br><span class="line">    auth_group_permissions:角色和权限多对多中间表</span><br><span class="line">    auth_user_groups：用户和角色多对多中间表</span><br><span class="line">    auth_user_user_permissions：用户和权限多对多的中间表</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django有个后台管理admin,自带rbac,有的公司基于admin做二次开发(xadmin,simple-ui)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有的公司自己基于前后端分离实现rbac</span></span><br><span class="line">	-https://github.com/liqianglog/django-vue-admin</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 前后端混合的后台前端模板    </span></span><br><span class="line"> 	X-admin:lay-ui+jq实现的纯静态页面(html，css，js)，帮助我们快速开发后台管理系统</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 智慧大屏</span></span><br><span class="line">	https://gitee.com/kevin_chou/dataVIS.git</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/29/Drf%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/29/Drf%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">Drf序列化组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-29 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-29T18:20:25+08:00">2019-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="序列化组件"><a href="#序列化组件" class="headerlink" title="序列化组件"></a>序列化组件</h1><h2 id="1-序列化器-Serializer"><a href="#1-序列化器-Serializer" class="headerlink" title="1.序列化器-Serializer"></a>1.序列化器-Serializer</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化组件的作用：</span></span><br><span class="line">	<span class="number">1.</span>序列化,序列化器(类)会把模型对象(Book对象，Queryset对象)转换成字典,经过response以后变成json格式字符串</span><br><span class="line">	<span class="number">2.</span>反序列化,把客户端发送过来的数据,经过request以后变成字典(request.data),序列化器(类)可以把字典转成模型,再存储入数据库</span><br><span class="line">	<span class="number">3.</span>反序列化,完成数据校验功能</span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化组件的本质：</span></span><br><span class="line">	写一个类，继承一个基类(Serializer),可以完成序列化，反序列化和数据校验</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">序列化过程:</span><br><span class="line">	把queryset转成字典,第一个参数instance是要序列化的对象,如果序列化多条数据，一定要加上many=<span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">反序列化过程</span><br><span class="line">	修改:</span><br><span class="line">    	第一个参数instance传要修改的对象,第二个单数data传被修改的数据(更新要重写update方法)</span><br><span class="line">	新增:</span><br><span class="line">    	第一个参数instance不用传,第二个参数data要传新增的数据(新增要重写create方法)</span><br><span class="line">  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	serializer不是只能为数据库模型类定义,也可以为非数据库模型类的数据定义 serializer是独立于数据库之外的存在</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p><strong>视图层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化器的使用</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> .serizlizer <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment">#查询所有接口</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        book_list=Books.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 序列化过程，把queryset转成字典</span></span><br><span class="line">        <span class="comment"># 第一个参数是要序列化的对象,如果序列化多条数据，一定要加上many=True</span></span><br><span class="line">        ser=BookSerializer(instance=book_list,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span>(ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        ser=BookSerializer(data=request.data) <span class="comment">#新增，不用传instance</span></span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookDetailAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="comment"># 查询单个</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line"></span><br><span class="line">        book = Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 序列化过程，把Book转成字典</span></span><br><span class="line">        <span class="comment"># 第一个参数是要序列化的对象,序列化单条数据不用加many=True</span></span><br><span class="line">        ser = BookSerializer(instance=book)</span><br><span class="line">        <span class="built_in">print</span>(ser.data)</span><br><span class="line">        <span class="keyword">return</span> Response(ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        Books.objects.<span class="built_in">filter</span>(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line"></span><br><span class="line">        book=Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">        <span class="comment"># 反序列化，修改</span></span><br><span class="line">        <span class="comment"># instance 传要修改的对象,data 传被修改后的数据</span></span><br><span class="line">        ser=BookSerializer(instance=book,data=request.data)  <span class="comment">#修改</span></span><br><span class="line">        <span class="comment"># 校验数据</span></span><br><span class="line">        <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">            ser.save() <span class="comment"># 报错</span></span><br><span class="line">            <span class="keyword">return</span> Response(ser.data)</span><br></pre></td></tr></table></figure>

<p><strong>序列化类</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建任一py文件,并写入序列化类</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">    <span class="comment">#写字段（要序列化，反序列化的字段）</span></span><br><span class="line">    name=serializers.CharField()</span><br><span class="line">    price=serializers.IntegerField()</span><br><span class="line">    publish=serializers.CharField()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 局部钩子函数validate_字段名</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;价格太高&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 全局钩子函数validate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name == publish:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要更新，一定要重写update方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 修改</span></span><br><span class="line">        instance.name=validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.price=validated_data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">        instance.publish=validated_data.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        <span class="comment"># 修改后一定要保存!</span></span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="comment"># 返回</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要新增，一定要重写create方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 保存</span></span><br><span class="line">        book=Books.objects.create(**validated_data)</span><br><span class="line">        <span class="comment"># 一定记得return</span></span><br><span class="line">        <span class="keyword">return</span> book </span><br></pre></td></tr></table></figure>

<p><strong>路由层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># drf继承APIView的路由</span></span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, views.BookAPIView.as_view()),</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;&#x27;</span>, views.BookDetailAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>模型层</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=models.IntegerField()</span><br><span class="line">    publish=models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-1自定义序列化器"><a href="#1-1自定义序列化器" class="headerlink" title="1.1自定义序列化器"></a>1.1自定义序列化器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">自定义序列化器流程:</span><br><span class="line">	<span class="number">1.</span>创建任一py文件,写入一个序列化类,继承Serializer(serializers.Serializer)</span><br><span class="line">	<span class="number">2.</span>在该类中写需要序列化或反序列化的字段,字段的属性(max_lenth...)</span><br><span class="line">        常用字段:</span><br><span class="line">            CharField,DecimalField,DateField,IntegerField</span><br><span class="line">        常用字段属性:</span><br><span class="line">            max_length			<span class="comment"># 最大长度</span></span><br><span class="line">            min_lenght			<span class="comment"># 最小长度</span></span><br><span class="line">            allow_blank			<span class="comment"># 是否允许为空</span></span><br><span class="line">            trim_whitespace		<span class="comment"># 是否截断空白字符</span></span><br><span class="line">            max_value			<span class="comment"># 最大值</span></span><br><span class="line">            min_value			<span class="comment"># 最小值</span></span><br><span class="line">        通用参数:</span><br><span class="line">            read_only		<span class="comment"># 表明该字段仅用于序列化输出，默认False</span></span><br><span class="line">            write_only		<span class="comment"># 表明该字段仅用于反序列化输入，默认False</span></span><br><span class="line">            required		<span class="comment"># 表明该字段在反序列化时必须输入，默认True</span></span><br><span class="line">            default			<span class="comment"># 反序列化时使用的默认值</span></span><br><span class="line">            allow_null		<span class="comment"># 表明该字段是否允许传入None，默认False</span></span><br><span class="line">            validators		<span class="comment"># 该字段使用的验证器</span></span><br><span class="line">            error_messages	<span class="comment"># 包含错误编号与错误信息的字典</span></span><br><span class="line">            label			<span class="comment"># 用于HTML展示API页面时，显示的字段名称</span></span><br><span class="line">            help_text		<span class="comment"># 用于HTML展示API页面时，显示的字段帮助提示信息</span></span><br><span class="line">            </span><br><span class="line">    <span class="number">3.</span>视图类中导入该序列化类,传入要修改的对象和数据实例化得到一个该类对象</span><br><span class="line">    	<span class="comment"># 修改,要传instance(被修改对象),要在序列化类中重写update方法</span></span><br><span class="line">    	ser=BookSerializer(instance=book,data=request.data)</span><br><span class="line">        <span class="comment"># 新增,不用传instance,要在序列化类中重写create方法</span></span><br><span class="line">        ser=BookSerializer(data=request.data) </span><br><span class="line">        </span><br><span class="line">    <span class="number">4.</span>数据校验 <span class="keyword">if</span> ser.valid()</span><br><span class="line">    <span class="number">5.</span>校验通过则保存,不通过则自己写错误提示逻辑</span><br><span class="line">    <span class="number">7.</span>如果字段校验规则不够,还可以使用钩子函数(局部钩子,全局钩子)</span><br><span class="line">    	<span class="comment"># 局部钩子函数(validate_字段名)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太高&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 全局钩子函数(validate)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">            name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">            publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> name == publish:</span><br><span class="line">                <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> attrs</span><br><span class="line">            </span><br><span class="line">    <span class="number">8.</span>还可以用name=serializer.CharField(validators=[check_name])校验</span><br><span class="line">    	<span class="number">1.</span>写一个函数:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">check_name</span>(<span class="params">data</span>):</span></span><br><span class="line">                <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">                    <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;姓名不能以sb开头&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">        <span class="number">2.</span>配置字段参数:validators=[check_name]</span><br></pre></td></tr></table></figure>

<h3 id="1-2使用序列化器"><a href="#1-2使用序列化器" class="headerlink" title="1.2使用序列化器"></a>1.2使用序列化器</h3><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化器的使用分为两个阶段:</span></span><br><span class="line">	<span class="number">1.</span>在服务器响应时,使用序列化器可以完成对数据的序列化</span><br><span class="line">	<span class="number">2.</span>在客户端请求时,使用序列化器可以完成对数据的反序列化</span><br></pre></td></tr></table></figure>

<h5 id="基本用法-many源码"><a href="#基本用法-many源码" class="headerlink" title="基本用法(many源码)"></a>基本用法(many源码)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">    <span class="comment"># 1.先查询出一个书籍对象</span></span><br><span class="line">    book = Books.objects.<span class="built_in">filter</span>(pk=pk).first()</span><br><span class="line">    <span class="comment"># 2.构造序列化器(序列化过程)</span></span><br><span class="line">    <span class="comment"># 序列化单条数据</span></span><br><span class="line">    book_one_ser = BookSerializer(instance=book)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 序列化多条数据,加参数many=True</span></span><br><span class="line">    <span class="comment"># book_many_ser = BookSerializer(instance=book_list,many=True)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.通过data属性可以获取序列化后的数据(book_one_ser.data)并返回给前端</span></span><br><span class="line">    <span class="keyword">return</span> Response(book_one_ser.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	上述的book_one_ser和book_many_ser并不是同一个类实例化得到的</span></span><br><span class="line"><span class="string">		print(type(book_one_ser)) --&gt; &lt;class &#x27;app01.ser.BookModelSerializer&#x27;&gt;</span></span><br><span class="line"><span class="string">		print(type(book_many_ser))--&gt; &lt;class &#x27;rest_framework.serializers.ListSerializer&#x27;&gt;</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	对象的生成流程:</span></span><br><span class="line"><span class="string">		1.先调用类的__new__方法,生成空对象</span></span><br><span class="line"><span class="string">		2.类实例化得到对象触发__init__()</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">	***类的__new__方法控制对象的生成***</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	eg:</span></span><br><span class="line"><span class="string">		def __new__(cls,*args,**kwargs):</span></span><br><span class="line"><span class="string">			if kwargs.pop(&#x27;many&#x27;,False)</span></span><br><span class="line"><span class="string">				return cls.many_init(*args,**kwars)</span></span><br><span class="line"><span class="string">			# 没有传many=True走下面,正常的对象实例化</span></span><br><span class="line"><span class="string">			return super().__new__(cls,*args,**kwargs)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.source</span></span><br><span class="line">	<span class="number">1.</span>可以改字段名 xxx=serializer.CharField(source=<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="number">2.</span>可以<span class="string">&#x27;.&#x27;</span>跨表 publish=serializer.CharField(source=<span class="string">&#x27;publish.name&#x27;</span>)</span><br><span class="line">    <span class="number">3.</span>可以执行方法 func=serializer.CharField(source=<span class="string">&#x27;test&#x27;</span>) --&gt; test是Book表模型中的方法</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 2.SerializerMethodField()(多用于关联表中其他表字段返回或重写字段)</span></span><br><span class="line">	前提:它需要有一个配套方法,方法名叫<span class="string">&#x27;get_字段名&#x27;</span>,该方法返回值就是该字段要显示的数据</span><br><span class="line">    eg:其他表字段返回</span><br><span class="line">        authors=serializer.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span>(<span class="params">self,obj</span>):</span></span><br><span class="line">            <span class="comment"># book对象</span></span><br><span class="line">            authors = obj.authors.<span class="built_in">all</span>() <span class="comment"># 取出所有作者</span></span><br><span class="line">            authors_list = []</span><br><span class="line">            <span class="keyword">for</span> author <span class="keyword">in</span> authors:</span><br><span class="line">                authors_list.append(&#123;<span class="string">&#x27;name&#x27;</span>:author.name,<span class="string">&#x27;age&#x27;</span>:author.age&#125;)</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># authors_list=[&#123;name&#x27;:author.name,&#x27;age&#x27;:author.age&#125; for author in authors]</span></span><br><span class="line">            <span class="keyword">return</span> authors_list</span><br><span class="line">        </span><br><span class="line">    eg:重写字段展示</span><br><span class="line">        name = serializers.SerializerMethodField()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">             <span class="keyword">return</span> <span class="string">&#x27;优秀的:&#x27;</span> + obj.name</span><br></pre></td></tr></table></figure>

<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><h5 id="普通数据验证"><a href="#普通数据验证" class="headerlink" title="普通数据验证"></a>普通数据验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反序列化数据验证:</span></span><br><span class="line">    <span class="number">1.</span>使用序列化器进行反序列化时,需要对数据进行验证后,才能获取验证成功的数据保存成模型类对象</span><br><span class="line">    <span class="number">2.</span>在获取反序列化的数据前，必须调用is_valid()方法进行验证，验证成功返回<span class="literal">True</span>，否则返回<span class="literal">False</span></span><br><span class="line">    <span class="number">3.</span>验证失败，可以通过序列化器对象的errors属性获取错误信息，返回字典，包含了字段和其他的错误。如果是非字段错误，可以通过修改REST framework配置中的NON_FIELD_ERRORS_KEY来控制错误字典中的键名</span><br><span class="line">    <span class="number">4.</span>验证成功，可以通过序列化器对象的validated_data属性获取数据</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 定义序列化器时,指明每个字段的序列化类型和选项参数,本身就是一种验证行为</span></span><br><span class="line"><span class="comment"># 即字段自己的校验规则</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Ser</span>(<span class="params">serializers.Serializer</span>):</span></span><br><span class="line">            name = serializers.CharField(min_length=<span class="number">3</span>,max_lenth=<span class="number">8</span>)</span><br><span class="line">            age = serializers.CharField(min_length=<span class="number">3</span>,max_lenth=<span class="number">8</span>)</span><br><span class="line">			...</span><br><span class="line">            </span><br><span class="line">    通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进而进行验证</span><br><span class="line">    	<span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="comment"># 自己封装的返回对象</span></span><br><span class="line">            back_dic = MyResponse()</span><br><span class="line">            <span class="comment"># 传入需要校验的数据至序列化类并实例化</span></span><br><span class="line">            ser = Ser(data=request.data)</span><br><span class="line">			<span class="comment"># 判断数据校验的结果</span></span><br><span class="line">            <span class="keyword">if</span> ser.is_valid():</span><br><span class="line">                ser.save()</span><br><span class="line">                back_dic.data = ser.data</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                back_dic.code = <span class="number">201</span></span><br><span class="line">                back_dic.msg = <span class="string">&#x27;创建失败&#x27;</span></span><br><span class="line">                back_dic.errors = ser.errors</span><br><span class="line">                </span><br><span class="line">			<span class="comment"># 调用返回对象的get_dic方法返回数据</span></span><br><span class="line">            <span class="keyword">return</span> Response(back_dic.get_dic)</span><br></pre></td></tr></table></figure>

<h5 id="钩子函数验证"><a href="#钩子函数验证" class="headerlink" title="钩子函数验证"></a>钩子函数验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>validate_字段名</span><br><span class="line">    <span class="comment"># 局部钩子函数validate_字段名</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">88</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太高&#x27;</span>)</span><br><span class="line">            </span><br><span class="line"><span class="number">2.</span>validate</span><br><span class="line">    <span class="comment"># 全局钩子函数validate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        name = attrs.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        publish = attrs.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name == publish:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;书名和出版社名冲突&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure>

<h5 id="validators验证"><a href="#validators验证" class="headerlink" title="validators验证"></a>validators验证</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">validators验证:</span><br><span class="line">	eg:</span><br><span class="line">		name=serializer.CharField(validators=[check_name])</span><br><span class="line">	</span><br><span class="line">    	<span class="number">1.</span>写一个函数:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">check_name</span>(<span class="params">data</span>):</span></span><br><span class="line">                <span class="keyword">if</span> data.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">                    <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;姓名不能以sb开头&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> data</span><br><span class="line">                </span><br><span class="line">        <span class="number">2.</span>配置字段参数:validators=[check_name]</span><br></pre></td></tr></table></figure>

<h5 id="反序列化-保存数据"><a href="#反序列化-保存数据" class="headerlink" title="反序列化-保存数据"></a>反序列化-保存数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">反序列化-保存数据(序列化类中书写):</span><br><span class="line">    <span class="comment"># 如果要更新，一定要重写update方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 修改数据</span></span><br><span class="line">        instance.name=validated_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        instance.price=validated_data.get(<span class="string">&#x27;price&#x27;</span>)</span><br><span class="line">        instance.publish=validated_data.get(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">        <span class="comment"># 修改后一定要保存!</span></span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="comment"># 返回</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果要新增，一定要重写create方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        book=Books.objects.create(**validated_data)</span><br><span class="line">        <span class="comment"># 一定要记得return</span></span><br><span class="line">        <span class="keyword">return</span> book </span><br></pre></td></tr></table></figure>

<h2 id="2-模型类序列化器ModelSerializer"><a href="#2-模型类序列化器ModelSerializer" class="headerlink" title="2.模型类序列化器ModelSerializer"></a>2.模型类序列化器ModelSerializer</h2><p><strong>简介</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">	如果我们想要使用序列化器对应的是Django的模型类，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类</span><br><span class="line">	</span><br><span class="line">	ModelSerializer与常规的Serializer相同，但提供了:</span><br><span class="line">        基于模型类自动生成一系列字段</span><br><span class="line">        包含默认的create()和update()的实现</span><br><span class="line">        基于模型类自动为Serializer生成validators,比如unique_together(联合唯一)</span><br><span class="line">       </span><br><span class="line"><span class="comment"># 数据库字段联合唯一:</span></span><br><span class="line">	字段联合唯一(unique_together):</span><br><span class="line">	eg:</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">            name = models.CharField(<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            age = models.CharField(<span class="string">&#x27;年龄&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            height = models.CharField(<span class="string">&#x27;身高&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            width = models.CharField(<span class="string">&#x27;体重&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">                unique_together = ((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>,<span class="string">&quot;height&quot;</span>),)</span><br><span class="line"></span><br><span class="line">	上述表示该表中每一条数据的name,age,heght字段值联合唯一</span><br></pre></td></tr></table></figure>

<h3 id="2-1ModelSerializer定义"><a href="#2-1ModelSerializer定义" class="headerlink" title="2.1ModelSerializer定义"></a>2.1ModelSerializer定义</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建任一py文件,写入序列化类,并继承ModelSerializer</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student			<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>    	<span class="comment"># 生效所有字段   </span></span><br><span class="line">        depth = <span class="number">3</span>				<span class="comment"># 映射深度(表示跨三张表展示数据),一般不用</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># model: 指明参照哪个模型类(models.py中的类即数据库里的表)</span></span><br><span class="line"><span class="comment"># fields: 指明模型类的哪些字段生成</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2指定生效字段"><a href="#2-2指定生效字段" class="headerlink" title="2.2指定生效字段"></a>2.2指定生效字段</h3><h4 id="1-使用fields来明确字段"><a href="#1-使用fields来明确字段" class="headerlink" title="1.使用fields来明确字段"></a>1.使用fields来明确字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student					<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)    <span class="comment"># 指定生效字段  </span></span><br></pre></td></tr></table></figure>

<h4 id="2-使用exclude排除字段"><a href="#2-使用exclude排除字段" class="headerlink" title="2.使用exclude排除字段"></a>2.使用exclude排除字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意:exclude和fields不可以同时使用</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student				<span class="comment"># 对应models.py中的模型类</span></span><br><span class="line">        exclude = (<span class="string">&#x27;id&#x27;</span>,)			<span class="comment"># 排除该字段(默认所有字段生效)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-添加额外字段参数"><a href="#3-添加额外字段参数" class="headerlink" title="3.添加额外字段参数"></a>3.添加额外字段参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">read_only和wirte_only:</span><br><span class="line">    <span class="comment"># 序列化的时候该字段生效,反序列化无效</span></span><br><span class="line">    width=serializers.CharField(read_only=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 反序列化时候该字段生效,序列化时候无效</span></span><br><span class="line">    height=serializers.CharField(write_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用extra_kwargs参数为ModelSerializer添加或修改原有的选项参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = Student</span><br><span class="line">    <span class="comment"># fields = &#x27;__all__&#x27;</span></span><br><span class="line">    <span class="comment"># 指定展示字段</span></span><br><span class="line">    fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;width&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 类似于 width = serializers.CharField(write_only=True,&#x27;max_length&#x27;:6)</span></span><br><span class="line">    extra_kwargs = &#123;</span><br><span class="line">        <span class="string">&#x27;width&#x27;</span>: &#123;<span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span>,<span class="string">&#x27;max_lenth&#x27;</span>:<span class="number">6</span>&#125;,   	<span class="comment"># 序列化的时候使用</span></span><br><span class="line">        <span class="string">&#x27;height&#x27;</span>: &#123;<span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>&#125;  				<span class="comment"># 反序列化的时候使用</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> app01.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 局部钩子校验</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_age</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(data) &gt; <span class="number">18</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;年龄太小啦&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">	<span class="comment"># 全局钩子校验</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        height = attrs.get(<span class="string">&#x27;height&#x27;</span>)</span><br><span class="line">        width = attrs.get(<span class="string">&#x27;width&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> height == width:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;身材不同寻常,不可创建&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> attrs</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 序列化的时候该字段生效,反序列化无效</span></span><br><span class="line">    name=serializers.CharField(read_only=<span class="literal">True</span>)  </span><br><span class="line">    <span class="comment"># 反序列化时候该字段生效,序列化时候无效</span></span><br><span class="line">    age=serializers.CharField(write_only=<span class="literal">True</span>)</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 重写字段</span></span><br><span class="line">	name = serializers.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">         <span class="keyword">return</span> <span class="string">&#x27;优秀的:&#x27;</span> + obj.name</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 扩写字段(name_detail方法已经在models.py中写好,该字段展示此方法返回值)</span></span><br><span class="line">	name_detail=serializers.CharField(source=<span class="string">&#x27;name_detail&#x27;</span>) <span class="comment"># 执行方法</span></span><br><span class="line">    addr=serializers.CharField(source=<span class="string">&#x27;detail.addr&#x27;</span>) <span class="comment"># .跨表拿数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 多用于跨表连表数据的展示</span></span><br><span class="line">    authors=serializer.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span>(<span class="params">self,obj</span>):</span></span><br><span class="line">        <span class="comment"># book对象</span></span><br><span class="line">        authors = obj.authors.<span class="built_in">all</span>() <span class="comment"># 取出所有作者</span></span><br><span class="line">        <span class="comment"># [&#123;&#x27;name&#x27;:author.name,&#x27;age&#x27;:author.age&#125; for author in authors]</span></span><br><span class="line">        <span class="keyword">return</span> authors_list</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 字段校验规则，映射了表模型中的规则,重写字段，改变校验规则</span></span><br><span class="line">	name=serializers.CharField(max_length=<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student</span><br><span class="line">        <span class="comment"># fields = &#x27;__all__&#x27;  # 默认展示所有字段</span></span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;width&#x27;</span>)	<span class="comment"># 指定展示字段</span></span><br><span class="line">        <span class="comment"># 添加或修改字段原有的选项参数</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;width&#x27;</span>: &#123;<span class="string">&#x27;read_only&#x27;</span>: <span class="literal">True</span>,<span class="string">&#x27;max_lenth&#x27;</span>:<span class="number">6</span>&#125;,   	<span class="comment"># 序列化的时候使用</span></span><br><span class="line">            <span class="string">&#x27;height&#x27;</span>: &#123;<span class="string">&#x27;write_only&#x27;</span>: <span class="literal">True</span>&#125;  				<span class="comment"># 反序列化的时候使用</span></span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="封装Response对象"><a href="#封装Response对象" class="headerlink" title="封装Response对象"></a>封装Response对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.在utils目录下创建任一文件夹</span></span><br><span class="line"><span class="comment"># 2.写入:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">APIResponse</span>(<span class="params">Response</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, code=<span class="number">100</span>, msg=<span class="string">&#x27;成功&#x27;</span>, status=<span class="literal">None</span>, headers=<span class="literal">None</span>, **kwargs</span>):</span></span><br><span class="line">            res_data = &#123;</span><br><span class="line">                <span class="string">&#x27;code&#x27;</span>: code,</span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span>: msg,</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> kwargs:</span><br><span class="line">                res_data.update(kwargs)</span><br><span class="line">            <span class="built_in">super</span>().__init__(data=res_data, status=status, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.视图类中使用:</span></span><br><span class="line">	<span class="keyword">from</span> luffy_api.utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HomeView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> APIResponse() (默认返回&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;成功&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="局部钩子全局钩子源码"><a href="#局部钩子全局钩子源码" class="headerlink" title="局部钩子全局钩子源码"></a>局部钩子全局钩子源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 入口是 ser.is_valid(),是BaseSerializer的方法</span></span><br><span class="line"><span class="comment"># 最核心的代码:</span></span><br><span class="line">	<span class="comment"># 切记不要按住ctrl点run_validation</span></span><br><span class="line">	self._validated_data = self.run_validation(self.initial_data) </span><br><span class="line">    </span><br><span class="line"><span class="comment"># run_validation 调用的是Serializer类的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_validation</span>(<span class="params">self, data=empty</span>):</span></span><br><span class="line">        value = self.to_internal_value(data) <span class="comment"># 局部钩子的代码</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.run_validators(value)</span><br><span class="line">            value = self.validate(value) <span class="comment"># 全局钩子的执行</span></span><br><span class="line">            <span class="keyword">assert</span> value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, <span class="string">&#x27;.validate() should return the validated data&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> (ValidationError, DjangoValidationError) <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(detail=as_serializer_error(exc))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部钩子核心代码</span></span><br><span class="line">    <span class="keyword">for</span> field <span class="keyword">in</span> fields:</span><br><span class="line">        <span class="comment">#反射字段的局部钩子方法</span></span><br><span class="line">        validate_method = <span class="built_in">getattr</span>(self, <span class="string">&#x27;validate_&#x27;</span> + field.field_name, <span class="literal">None</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> validate_method <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            validated_value = validate_method(validated_value) <span class="comment">#执行局部钩子方法</span></span><br><span class="line">    <span class="keyword">except</span> ValidationError <span class="keyword">as</span> exc:</span><br><span class="line">        errors[field.field_name] = exc.detail</span><br><span class="line">    <span class="keyword">except</span> DjangoValidationError <span class="keyword">as</span> exc:</span><br><span class="line">        errors[field.field_name] = get_error_detail(exc)</span><br></pre></td></tr></table></figure>

<h3 id="Django2版本级联更新删除"><a href="#Django2版本级联更新删除" class="headerlink" title="Django2版本级联更新删除"></a>Django2版本级联更新删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">当删除关联表中的数据时，当前表与其关联的表的行为</span><br><span class="line"></span><br><span class="line">　　models.CASCADE</span><br><span class="line">　　删除关联数据，与之关联也删除(级联删除)</span><br><span class="line"></span><br><span class="line">　　models.DO_NOTHING</span><br><span class="line">　　删除关联数据，关联表什么也不做</span><br><span class="line"></span><br><span class="line">　　models.PROTECT</span><br><span class="line">　　删除关联数据，引发错误ProtectedError</span><br><span class="line"></span><br><span class="line">　　models.SET_NULL</span><br><span class="line">　　删除关联数据，与之关联的值设置为null(前提FK字段需要设置为可空)</span><br><span class="line"></span><br><span class="line">　　models.SET_DEFAULT</span><br><span class="line">　　删除关联数据，与之关联的值设置为默认值(前提FK字段需要设置默认值)</span><br><span class="line"></span><br><span class="line">　　models.SET</span><br><span class="line"></span><br><span class="line">　　删除关联数据，</span><br><span class="line">　　a. 与之关联的值设置为指定值，设置：models.SET(值)</span><br><span class="line">　　b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/22/Drf%E8%A7%86%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/22/Drf%E8%A7%86%E5%9B%BE/" class="post-title-link" itemprop="url">Drf视图</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-22 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-22T18:20:25+08:00">2019-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Django REST framwork 提供的视图的主要作用：</span><br><span class="line">    控制序列化器的执行（检验、保存、转换数据）</span><br><span class="line">    控制数据库查询的执行</span><br></pre></td></tr></table></figure>

<h2 id="1-视图继承关系"><a href="#1-视图继承关系" class="headerlink" title="1.视图继承关系"></a>1.视图继承关系</h2><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701162931921.png" alt="image-20210701162931921"></p>
<h2 id="2-视图"><a href="#2-视图" class="headerlink" title="2.视图"></a>2.视图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REST framework 提供了众多的通用视图基类与扩展类，以简化视图的编写</span><br></pre></td></tr></table></figure>

<h3 id="2-1两个视图基类"><a href="#2-1两个视图基类" class="headerlink" title="2.1两个视图基类"></a>2.1两个视图基类</h3><h4 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a>APIView</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rest_framework.views.APIView</span></span><br><span class="line">	APIView是REST framework提供的所有视图的基类，继承自Django的View父类</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIView与View的不同之处在于:</span></span><br><span class="line">	传入到视图方法中的是REST framework的Request对象，而不是Django的HttpRequeset对象</span><br><span class="line">	视图方法可以返回REST framework的Response对象，视图会为响应数据设置(render)符合前端要求的格式</span><br><span class="line">	任何APIException异常都会被捕获到，并且处理成合适的响应信息</span><br><span class="line">	在进行dispatch()分发前,会对请求进行身份认证、权限检查、流量控制</span><br><span class="line">	</span><br><span class="line">支持定义的类属性:</span><br><span class="line">    authentication_classes 		<span class="comment"># 列表或元祖，身份认证类</span></span><br><span class="line">    permissoin_classes 			<span class="comment"># 列表或元祖，权限检查类</span></span><br><span class="line">    throttle_classes			<span class="comment"># 列表或元祖，流量控制类</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在APIView中仍以常规的类视图定义方法来实现get()、post()或者其他请求方式的方法</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">        <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">        <span class="comment"># path(&#x27;students/&#x27;, views.StudentsAPIView.as_view())</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">StudentsAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">                data_list = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">                serializer = StudentModelSerializer(data_list, many=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h4 id="GenericAPIView-通用视图类"><a href="#GenericAPIView-通用视图类" class="headerlink" title="GenericAPIView(通用视图类)"></a>GenericAPIView(通用视图类)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rest_framework.generics.GenericAPIView</span></span><br><span class="line">	它继承自APIVIew,主要增加了操作序列化器和数据库查询的方法,作用是为下面Mixin扩展类的执行提供方法支持 通常在使用时,可搭配一个或多个Mixin扩展类</span><br></pre></td></tr></table></figure>

<h5 id="提供的关于序列化器使用的属性与方法"><a href="#提供的关于序列化器使用的属性与方法" class="headerlink" title="提供的关于序列化器使用的属性与方法"></a>提供的关于序列化器使用的属性与方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性：</span></span><br><span class="line">	serializer_class 指明视图使用的序列化器</span><br><span class="line"><span class="comment"># 方法：</span></span><br><span class="line">	<span class="number">1.</span>get_serializer_class(self)</span><br><span class="line">	当出现一个视图类中调用多个序列化器时,那么可以通过条件判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了</span><br><span class="line">	返回序列化器类,默认返回serializer_class,可以重写</span><br><span class="line">		eg:</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">            	<span class="keyword">if</span> self.request.user.is_staff:</span><br><span class="line">                	<span class="keyword">return</span> FullAccountSerializer</span><br><span class="line">            	<span class="keyword">return</span> BasicAccountSerializer</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="number">2.</span>get_serializer(self, args, *kwargs) ---&gt; 拿到序列化类的对象</span><br><span class="line">    返回序列化器对象,主要用来提供给Mixin扩展类使用,如果我们在视图中想要获取序列化器对象,也可以直接调用此方法,三个参数instance,data,many</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意:该方法在提供序列化器对象的时候,会向序列化器对象的context属性补充三个数据:request、format、view，这三个数据对象可以在定义序列化器时使用</span></span><br><span class="line">        request 	<span class="comment"># 当前视图的请求对象</span></span><br><span class="line">        view 		<span class="comment"># 当前请求的类视图对象</span></span><br><span class="line">        <span class="built_in">format</span> 		<span class="comment"># 当前请求期望返回的数据格式</span></span><br></pre></td></tr></table></figure>

<h5 id="提供的关于数据库查询的属性与方法"><a href="#提供的关于数据库查询的属性与方法" class="headerlink" title="提供的关于数据库查询的属性与方法"></a>提供的关于数据库查询的属性与方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性：</span></span><br><span class="line">	queryset 指明使用的数据查询集</span><br><span class="line"><span class="comment"># 方法：</span></span><br><span class="line">	<span class="number">1.</span>get_queryset(self) ---&gt; 获取所有数据</span><br><span class="line">	返回视图使用的查询集,主要用来提供给Mixin扩展类使用,是列表视图与详情视图获取数据的基础,默认返回queryset属性,可重写</span><br><span class="line">    eg:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">            user = self.request.user</span><br><span class="line">            <span class="keyword">return</span> user.accounts.<span class="built_in">all</span>()</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="number">2.</span>get_object(self) ---&gt; 获取单个对象</span><br><span class="line">	返回详情视图所需的模型类数据对象，主要用来提供给Mixin扩展类使用</span><br><span class="line">	在试图中可以调用该方法获取详情信息的模型类对象</span><br><span class="line">	若详情访问的模型类对象不存在，会返回<span class="number">404</span></span><br><span class="line">		eg:</span><br><span class="line">			<span class="comment"># url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookDetailView.as_view()),</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">                queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">                serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">                    <span class="comment"># get_object()方法根据pk参数查找queryset中的数据对象</span></span><br><span class="line">                    book = self.get_object() </span><br><span class="line">                    serializer = self.get_serializer(book)</span><br><span class="line">                    <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h5 id="其他可以设置的属性"><a href="#其他可以设置的属性" class="headerlink" title="其他可以设置的属性"></a>其他可以设置的属性</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pagination_class 		<span class="comment"># 指明分页控制类</span></span><br><span class="line">filter_backends 		<span class="comment"># 指明过滤控制后端</span></span><br><span class="line">lookup_field = <span class="string">&#x27;pk&#x27;</span>		<span class="comment"># 查单条时,无名或有名分组,转换器分出来的参数名叫pk</span></span><br></pre></td></tr></table></figure>

<h5 id="GenericAPIView通用视图类完整代码"><a href="#GenericAPIView通用视图类完整代码" class="headerlink" title="GenericAPIView通用视图类完整代码"></a>GenericAPIView通用视图类完整代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line">    <span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentModelSerializer, StudentModel2Serializer</span><br><span class="line">    <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentsGenericAPIView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        <span class="comment"># 本次视图类中要操作的数据[必填]</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 本次视图类中要调用的默认序列化器[选填]</span></span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取所有学生信息&quot;&quot;&quot;</span></span><br><span class="line">            serializer = self.get_serializer(instance=self.get_queryset(), many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            serializer = self.get_serializer(data=request.data)</span><br><span class="line">            <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">                instance = serializer.save()</span><br><span class="line">                <span class="comment"># serializer = self.get_serializer(instance=instance)</span></span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentGenericAPIView</span>(<span class="params">GenericAPIView</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;重写获取序列化器类的方法&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> self.request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> StudentModel2Serializer</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在使用GenericAPIView视图获取或操作单个数据时,视图方法中的代表主键的参数最好是pk</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取一条数据&quot;&quot;&quot;</span></span><br><span class="line">            serializer = self.get_serializer(instance=self.get_object())</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">            data = request.data</span><br><span class="line">            serializer = self.get_serializer(instance=self.get_object(),data=data)</span><br><span class="line">            <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">                serializer.save()</span><br><span class="line">                <span class="comment"># serializer = self.get_serializer(instance=self.get_object())</span></span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 序列化器类:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            model= Student</span><br><span class="line">            fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModel2Serializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            model= Student</span><br><span class="line">            fields = (<span class="string">&quot;name&quot;</span>,<span class="string">&quot;class_null&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-2五个视图扩展类"><a href="#2-2五个视图扩展类" class="headerlink" title="2.2五个视图扩展类"></a>2.2五个视图扩展类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 试图扩展类的作用：</span></span><br><span class="line">	提供了几种后端视图(对数据资源进行增删改查)处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量</span><br><span class="line">	这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法</span><br></pre></td></tr></table></figure>

<h5 id="1-ListModelMixin-查所有"><a href="#1-ListModelMixin-查所有" class="headerlink" title="1.ListModelMixin(查所有)"></a>1.ListModelMixin(查所有)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表视图扩展类，提供list(request, *args, **kwargs)方法快速实现列表视图，返回200状态码</span></span><br><span class="line"><span class="comment"># 该Mixin的list方法会对数据进行过滤和分页</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ListModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 过滤</span></span><br><span class="line">            queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line">            <span class="comment"># 分页</span></span><br><span class="line">            page = self.paginate_queryset(queryset)</span><br><span class="line">            <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line">            <span class="comment"># 序列化</span></span><br><span class="line">            serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookListView</span>(<span class="params">ListModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br></pre></td></tr></table></figure>

<h5 id="2-CreateModelMixin-创建"><a href="#2-CreateModelMixin-创建" class="headerlink" title="2.CreateModelMixin(创建)"></a>2.CreateModelMixin(创建)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视图扩展类,提供create(request, *args, **kwargs)方法快速实现创建资源的视图,成功返回201状态码</span></span><br><span class="line"><span class="comment"># 如果序列化器对前端发送的数据验证失败，返回400错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">CreateModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 获取序列化器</span></span><br><span class="line">            serializer = self.get_serializer(data=request.data)</span><br><span class="line">            <span class="comment"># 验证</span></span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># 保存</span></span><br><span class="line">            self.perform_create(serializer)</span><br><span class="line">            headers = self.get_success_headers(serializer.data)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_success_headers</span>(<span class="params">self, data</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&#x27;Location&#x27;</span>: <span class="built_in">str</span>(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">            <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">                <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> CreateModelMixin</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookListView</span>(<span class="params">CreateModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.create(request)</span><br></pre></td></tr></table></figure>

<h5 id="3-RetrieveModelMixin-查单个"><a href="#3-RetrieveModelMixin-查单个" class="headerlink" title="3.RetrieveModelMixin(查单个)"></a>3.RetrieveModelMixin(查单个)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 详情视图扩展类，提供retrieve(request, *args, **kwargs)方法可以快速实现返回一个存在的数据对象</span></span><br><span class="line"><span class="comment"># 如果存在，返回200， 否则返回404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">RetrieveModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Retrieve a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 获取对象，会检查对象的权限</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        <span class="comment"># 序列化</span></span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">RetrieveModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.retrieve(request)</span><br></pre></td></tr></table></figure>

<h5 id="4-UpdateModelMixin-更新"><a href="#4-UpdateModelMixin-更新" class="headerlink" title="4.UpdateModelMixin(更新)"></a>4.UpdateModelMixin(更新)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新视图扩展类，提供update(request, *args, **kwargs)方法，可以快速实现更新一个存在的数据对象</span></span><br><span class="line"><span class="comment"># 同时也提供partial_update(request, *args, **kwargs)方法，可以实现局部更新</span></span><br><span class="line"><span class="comment"># 成功返回200，序列化器校验数据失败时，返回400错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">UpdateModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Update a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            partial = kwargs.pop(<span class="string">&#x27;partial&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">            instance = self.get_object()</span><br><span class="line">            serializer = self.get_serializer(instance,data=request.data,partial=partial)</span><br><span class="line">            serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">            self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">getattr</span>(instance, <span class="string">&#x27;_prefetched_objects_cache&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">                <span class="comment"># If &#x27;prefetch_related&#x27; has been applied to a queryset, we need to</span></span><br><span class="line">                <span class="comment"># forcibly invalidate the prefetch cache on the instance.</span></span><br><span class="line">                instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_update</span>(<span class="params">self, serializer</span>):</span></span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">partial_update</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            kwargs[<span class="string">&#x27;partial&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">UpdateModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.update(request)</span><br></pre></td></tr></table></figure>

<h5 id="5-DestroyModelMixin-删除"><a href="#5-DestroyModelMixin-删除" class="headerlink" title="5.DestroyModelMixin(删除)"></a>5.DestroyModelMixin(删除)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除视图扩展类，提供destroy(request, *args, **kwargs)方法，可以快速实现删除一个存在的数据对象。</span></span><br><span class="line"><span class="comment"># 成功返回204，不存在返回404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">DestroyModelMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Destroy a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">destroy</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            instance = self.get_object()</span><br><span class="line">            self.perform_destroy(instance)</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">            instance.delete()</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span>(<span class="params">DestroyModelMixin, GenericAPIView</span>):</span></span><br><span class="line">        queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.destroy(request)</span><br></pre></td></tr></table></figure>

<h4 id="2-3GenericAPIView和视图扩展类实现api接口"><a href="#2-3GenericAPIView和视图扩展类实现api接口" class="headerlink" title="2.3GenericAPIView和视图扩展类实现api接口:"></a>2.3GenericAPIView和视图扩展类实现api接口:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;GenericAPIView结合视图扩展类实现api接口&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin,CreateModelMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Students2GenericAPIView</span>(<span class="params">GenericAPIView,ListModelMixin,CreateModelMixin</span>):</span></span><br><span class="line">    <span class="comment"># 本次视图类中要操作的数据[必填]</span></span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 本次视图类中要调用的默认序列化器[选填]</span></span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取多个学生信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加学生信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2GenericAPIView</span>(<span class="params">GenericAPIView,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span>):</span></span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在使用GenericAPIView视图获取或操作单个数据时,视图方法中的代表主键的参数最好是pk</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request,pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request,pk)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self,request,pk</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;删除一条数据&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request,pk)</span><br></pre></td></tr></table></figure>

<h4 id="2-4GenericAPIView的视图子类"><a href="#2-4GenericAPIView的视图子类" class="headerlink" title="2.4GenericAPIView的视图子类"></a>2.4GenericAPIView的视图子类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ListAPIView</span><br><span class="line">	提供 get 方法,查所有</span><br><span class="line">	继承自：GenericAPIView、ListModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>CreateAPIView</span><br><span class="line">	提供 post 方法,创建单个</span><br><span class="line">	继承自：GenericAPIView、CreateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>RetrieveAPIView</span><br><span class="line">	提供 get 方法,差单个</span><br><span class="line">	继承自: GenericAPIView、RetrieveModelMixin</span><br><span class="line">	</span><br><span class="line"><span class="number">4.</span>UpdateAPIView</span><br><span class="line">	提供 put 和 patch 方法,更新单个</span><br><span class="line">	继承自：GenericAPIView、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>DestoryAPIView</span><br><span class="line">	提供 delete 方法,删除单个</span><br><span class="line">	继承自：GenericAPIView、DestoryModelMixin</span><br><span class="line">	</span><br><span class="line"><span class="number">6.</span>ListCreateAPIView</span><br><span class="line">	提供 get、post 方法,查所有和创建单个</span><br><span class="line">	继承自：GenericAPIView、ListModelMixin、CreateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>RetrieveUpdateAPIView</span><br><span class="line">	提供 get、put、patch方法,查单个和更新单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>RetrieveDestoryAPIView</span><br><span class="line">	提供 get、delete方法,查单个和删除单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>RetrieveUpdateDestoryAPIView</span><br><span class="line">	提供 get、put、patch、delete方法,查单个,更新单个以及删除单个</span><br><span class="line">	继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</span><br></pre></td></tr></table></figure>

<h2 id="3-视图集viewSet"><a href="#3-视图集viewSet" class="headerlink" title="3.视图集viewSet"></a>3.视图集viewSet</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用视图集ViewSet,可以将一系列逻辑相关的动作放到一个类中:</span></span><br><span class="line">    <span class="built_in">list</span>() 		<span class="comment"># 提供一组数据</span></span><br><span class="line">    retrieve() 	<span class="comment"># 提供单个数据</span></span><br><span class="line">    create() 	<span class="comment"># 创建数据</span></span><br><span class="line">    update() 	<span class="comment"># 保存数据</span></span><br><span class="line">    destory() 	<span class="comment"># 删除数据</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ViewSet视图集类不再实现get(),post()等方法,而是实现动作action如 list(),create()等</span></span><br></pre></td></tr></table></figure>

<p><strong>视图集只在使用as_view()方法的时候，才会将action动作与具体请求方式对应上,eg:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoViewSet</span>(<span class="params">viewsets.ViewSet</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        books = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer = BookInfoSerializer(books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span>(<span class="params">self, request, pk=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            books = BookInfo.objects.get(<span class="built_in">id</span>=pk)</span><br><span class="line">        <span class="keyword">except</span> BookInfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_404_NOT_FOUND)</span><br><span class="line">        serializer = BookInfoSerializer(books)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p><strong>路由设置</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, BookInfoViewSet.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>&#125;),</span><br><span class="line">    path(<span class="string">&#x27;books/&lt;int:pk&gt;&#x27;</span>, BookInfoViewSet.as_view(&#123;<span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;retrieve&#x27;</span>&#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="3-1常用视图集父类"><a href="#3-1常用视图集父类" class="headerlink" title="3.1常用视图集父类"></a>3.1常用视图集父类</h3><h4 id="1-ViewSetMixin"><a href="#1-ViewSetMixin" class="headerlink" title="1.ViewSetMixin"></a>1.ViewSetMixin</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ViewSetMixin类----》重写了as_view方法---》view跟之前（APIView的as_view）不一样了</span></span><br><span class="line">      <span class="comment"># get   list</span></span><br><span class="line">  <span class="keyword">for</span> method, action <span class="keyword">in</span> actions.items():</span><br><span class="line">        <span class="comment"># 通过反射去当前视图类对象里找list方法</span></span><br><span class="line">        handler = <span class="built_in">getattr</span>(self, action)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 拿到list方法后并添加到视图类对象中(get--&gt;lish)    </span></span><br><span class="line">        <span class="built_in">setattr</span>(self, method, handler)</span><br><span class="line">        <span class="comment"># 视图类中有get方法，实质上它是list方法   </span></span><br><span class="line">  		<span class="comment"># 至此就实现了请求方式和视图类中方法的映射</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 只要继承ViewSetMixin的视图类,路由写法就变成下面所示:</span></span><br><span class="line">	path(<span class="string">&#x27;books/&#x27;</span>, views.BookView.as_view(&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;post&#x27;</span>:<span class="string">&#x27;create&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>

<h4 id="2-ViewSet"><a href="#2-ViewSet" class="headerlink" title="2.ViewSet"></a>2.ViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">继承自APIView与ViewSetMixin,作用也与APIView基本类似,提供了身份认证、权限校验、流量管理等</span><br><span class="line">ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典(如&#123;‘get’:’<span class="built_in">list</span>’&#125;)的映射处理工作</span><br><span class="line">在ViewSet中,没有提供任何动作action方法,需要我们自己实现action方法</span><br></pre></td></tr></table></figure>

<h4 id="3-GenericViewSet"><a href="#3-GenericViewSet" class="headerlink" title="3.GenericViewSet"></a>3.GenericViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">	使用ViewSet通常并不方便,因为<span class="built_in">list</span>、retrieve、create、update、destory等方法都需要自己编写,而这些方法与前面讲过的Mixin扩展类提供的方法同名,所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写。但是Mixin扩展类依赖于GenericAPIView,所以还需要继承GenericAPIView</span><br><span class="line"></span><br><span class="line">	GenericViewSet就帮助我们完成了这样的继承工作,继承自GenericAPIView与ViewSetMixin,在实现了调用as_view()时传入字典(如&#123;<span class="string">&#x27;get&#x27;</span>:<span class="string">&#x27;list&#x27;</span>&#125;)的映射处理工作的同时,还提供了GenericAPIView提供的基础方法,可以直接搭配Mixin扩展类使用</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line">    <span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin,CreateModelMixin,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Student4ViewSet</span>(<span class="params">GenericViewSet,ListModelMixin,CreateModelMixin,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 路由定义:</span></span><br><span class="line">	urlpatterns = [</span><br><span class="line">        path(<span class="string">&quot;student/&quot;</span>,views.Student4ViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>: <span class="string">&quot;list&quot;</span>, <span class="string">&quot;post&quot;</span>: <span class="string">&quot;create&quot;</span>&#125;)),</span><br><span class="line">        path(<span class="string">&quot;student/&lt;int:pk&gt;&quot;</span>,views.Student4ViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>: <span class="string">&quot;retrieve&quot;</span>,<span class="string">&quot;put&quot;</span>:<span class="string">&quot;update&quot;</span>,<span class="string">&quot;delete&quot;</span>:<span class="string">&quot;destroy&quot;</span>&#125;)),</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h4 id="4-ModelViewSet"><a href="#4-ModelViewSet" class="headerlink" title="4.ModelViewSet"></a>4.ModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自GenericViewSet,同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin(五个接口都实现了)</span><br></pre></td></tr></table></figure>

<h4 id="5-ReadOnlyModelViewSet"><a href="#5-ReadOnlyModelViewSet" class="headerlink" title="5.ReadOnlyModelViewSet"></a>5.ReadOnlyModelViewSet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自GenericViewSet，同时包括了ListModelMixin、RetrieveModelMixin(只实现了两个查询接口)</span><br></pre></td></tr></table></figure>

<h3 id="3-2视图集中定义附加action动作"><a href="#3-2视图集中定义附加action动作" class="headerlink" title="3.2视图集中定义附加action动作"></a>3.2视图集中定义附加action动作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图集中，除了上述默认的方法动作外，还可以添加自定义动作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet,ReadOnlyModelViewSet</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;学生登录功能&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;登录成功&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由定义:</span></span><br><span class="line">	urlpatterns = [</span><br><span class="line">    	path(<span class="string">&quot;stu/login/&quot;</span>,views.StudentModelViewSet.as_view(&#123;<span class="string">&quot;get&quot;</span>:<span class="string">&quot;login&quot;</span>&#125;)),</span><br><span class="line">	]</span><br></pre></td></tr></table></figure>

<h3 id="3-3action属性"><a href="#3-3action属性" class="headerlink" title="3.3action属性"></a>3.3action属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图集中，我们可以通过action对象属性来获取当前请求视图集时的action动作是哪个</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line">    <span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentModelSerializer</span><br><span class="line">    <span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_new_5</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;获取最近添加的5个学生信息&quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># 操作数据库</span></span><br><span class="line">            <span class="built_in">print</span>(self.action) <span class="comment"># 获取本次请求的视图方法名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过路由访问到当前方法中.可以看到本次的action就是请求的方法名</span></span><br></pre></td></tr></table></figure>

<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两个基类:</span></span><br><span class="line">	APIView				<span class="comment"># 继承自View,k</span></span><br><span class="line">	GenericAPIView		<span class="comment"># 继承自APIView,扩写queryset,serializer_class属性及get_queryset,get_serializer等方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有关数据库,序列化器的操作:</span></span><br><span class="line">	queryset			<span class="comment"># 指定表模型所有数据</span></span><br><span class="line">    serializer_class	<span class="comment"># 指定序列化器</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 五个视图扩展类(rest_framework.mixins)</span></span><br><span class="line">	ListModelMixin			<span class="comment"># list方法获取所有</span></span><br><span class="line">    CreateModelMixin		<span class="comment"># create方法创建一条</span></span><br><span class="line">	RetrieveModelMixin		<span class="comment"># retrieve方法获取一条</span></span><br><span class="line">    UpdateModelMixin		<span class="comment"># update方法修改一条</span></span><br><span class="line">	DestroyModelMixin		<span class="comment"># destory方法删除一条</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 九个子类视图(rest_framework.generics)</span></span><br><span class="line">继承单个视图扩展类和GenericAPIView:</span><br><span class="line">	ListAPIView			<span class="comment"># 继承ListModelMixin,GenericAPIView:,get方法获取所有数据</span></span><br><span class="line">    RetrieveAPIView		<span class="comment"># 继承RetrieveModelMixin,GenericAPIView,get方法,获取一条</span></span><br><span class="line">	CreateAPIView	 	<span class="comment"># 继承CreateModelMixin,GenericAPIView,post方法新增一条数据</span></span><br><span class="line">    UpdateAPIView		<span class="comment"># 继承UpdateModelMixin,GenericAPIView,put和patch方法,修改一条数据</span></span><br><span class="line">	DestroyAPIView		<span class="comment"># 继承DestroyModelMixin,GenericAPIView,delete方法,删除一条数据</span></span><br><span class="line"></span><br><span class="line">继承多个视图扩展类和GenericAPIView:</span><br><span class="line">    ListCreateAPIView 		<span class="comment"># 继承ListModelMixin,CreateModelMixin,GenericAPIView,get获取所有,post新增</span></span><br><span class="line">    RetrieveUpdateAPIView 	<span class="comment"># 继承RetrieveModelMixin,UpdateModelMixin,GenericAPIView,get获取一条,put,patch修改</span></span><br><span class="line">	RetrieveDestroyAPIView 	<span class="comment"># 继承RetrieveModelMixin,DestroyModelMixin,GenericAPIView,get获取一条,delete删除</span></span><br><span class="line">	RetrieveUpdateDestroyAPIView  <span class="comment"># 继承RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin,GenericAPIView,有get获取一条,put,patch修改,delete删除</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#视图集</span></span><br><span class="line">    ViewSetMixin		  	<span class="comment"># 重写了as_view(自定义路由功能)</span></span><br><span class="line">    ViewSet 			  	<span class="comment"># 继承ViewSetMixin和APIView(自定义路由,自定义方法动作)</span></span><br><span class="line">	GenericViewSet		  	<span class="comment"># 继承ViewSetMixin和GenericAPIView(自定义路由和GenericAPIView所有扩展功能)</span></span><br><span class="line">	ModelViewSet 		  	<span class="comment"># 继承五大视图扩展类和GenericViewSet(简单配置就能实现五个常用接口)</span></span><br><span class="line">	ReadOnlyModelViewSet  	<span class="comment"># 继承RetrieveModelMixin,ListModelMixin,GenericViewSet(实现了查单个和查所有双接口)</span></span><br></pre></td></tr></table></figure>

<h4 id="Django本地化-国际化-配置"><a href="#Django本地化-国际化-配置" class="headerlink" title="Django本地化(国际化)配置"></a>Django本地化(国际化)配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"><span class="comment"># S 必须大写(windows平台可以小写)</span></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/18/Drf%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/18/Drf%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/" class="post-title-link" itemprop="url">Drf请求响应</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-18 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-18T18:20:25+08:00">2019-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="请求响应"><a href="#请求响应" class="headerlink" title="请求响应"></a>请求响应</h1><h2 id="1-Request"><a href="#1-Request" class="headerlink" title="1.Request"></a>1.Request</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST framework 传入视图的request对象不再是Django默认的HttpRequest对象，而是REST framework提供的扩展了HttpRequest类的Request类的对象</span><br><span class="line">REST framework 提供了Parser解析器，在接收到请求后会自动根据Content-<span class="type">Type</span>指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典[QueryDict]对象保存到Request对象中</span><br><span class="line">Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果</span><br><span class="line">无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据</span><br></pre></td></tr></table></figure>

<h3 id="1-1常用属性"><a href="#1-1常用属性" class="headerlink" title="1.1常用属性"></a>1.1常用属性</h3><h4 id="data"><a href="#data" class="headerlink" title=".data"></a>.data</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.data返回解析之后的请求体数据。类似于Django中标准的request.POST和 request.FILES属性，但提供如下特性：</span><br><span class="line">       <span class="number">1.</span>包含了解析之后的文件和非文件数据</span><br><span class="line">       <span class="number">2.</span>包含了对POST、PUT、PATCH请求方式解析后的数据</span><br><span class="line">       <span class="number">3.</span>利用了REST framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据</span><br></pre></td></tr></table></figure>

<h4 id="query-params"><a href="#query-params" class="headerlink" title=".query_params"></a>.query_params</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.query_params与Django标准的request.GET相同，只是更换了更正确的名称而已</span><br></pre></td></tr></table></figure>

<h3 id="1-2Drf请求全局和局部配置"><a href="#1-2Drf请求全局和局部配置" class="headerlink" title="1.2Drf请求全局和局部配置"></a>1.2Drf请求全局和局部配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求支持三种编码格式，urlencoded，json，formdata</span></span><br><span class="line"><span class="comment"># 如果不配置，默认支持三种</span></span><br><span class="line">   <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,  <span class="comment"># 解析application/json格式</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>, <span class="comment"># 解析application/x-www-form-urlencoded</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span> <span class="comment"># multipart/form-data</span></span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 全局配置,在项目的配置文件中配置</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: [</span><br><span class="line">            <span class="comment"># &#x27;rest_framework.parsers.JSONParser&#x27;,  </span></span><br><span class="line">            <span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,  </span><br><span class="line">            <span class="comment"># &#x27;rest_framework.parsers.MultiPartParser&#x27;  </span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 局部配置</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.parsers <span class="keyword">import</span> JSONParser</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView,CreateAPIView</span>):</span></span><br><span class="line">        parser_classes = [JSONParser,]</span><br></pre></td></tr></table></figure>

<h2 id="2-Response"><a href="#2-Response" class="headerlink" title="2.Response"></a>2.Response</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REST framework提供了一个响应类Response，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染）成符合前端需求的类型</span><br><span class="line">REST framework提供了Renderer 渲染器，用来根据请求头中的Accept（接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行Accept声明，则会采用默认方式处理响应数据，我们可以通过配置来修改默认响应格式  </span><br></pre></td></tr></table></figure>

<h3 id="2-1响应格式配置"><a href="#2-1响应格式配置" class="headerlink" title="2.1响应格式配置"></a>2.1响应格式配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过配置，设置响应格式（浏览器模板样子，纯json）</span></span><br><span class="line">    <span class="number">1.</span>drf的所有配置，都写在下面这个字典中(REST_FRAMEWORK)</span><br><span class="line">    <span class="number">2.</span>drf有个默认配置文件,如果项目的配置文件配置了，优先使用项目的，如果没配置，使用内置的</span><br><span class="line">    <span class="number">3.</span>返回样式的配置，一般我们不配置</span><br><span class="line">    </span><br><span class="line">    全局配置:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">            <span class="comment"># 配置响应格式,默认有俩(json，浏览器的)</span></span><br><span class="line">            <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    局部配置:</span><br><span class="line">        Response响应格式的全局配置（配置文件中）局部配置（只针对某一个视图函数）</span><br><span class="line">            -在视图类上写:</span><br><span class="line">            	renderer_classes = [JSONRenderer]</span><br><span class="line">        </span><br><span class="line">	配置的三个层次(使用优先级)</span><br><span class="line">    	-局部自己</span><br><span class="line">        -项目中</span><br><span class="line">        -drf默认</span><br></pre></td></tr></table></figure>

<h3 id="2-2构造方式"><a href="#2-2构造方式" class="headerlink" title="2.2构造方式"></a>2.2构造方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Response(data,status=None,template_name=None,headers=None, content_type=None)</span></span><br><span class="line">	data不能是复杂结构的数据,如Django的模型类对象</span><br><span class="line">	对于这样的数据使用Serializer序列化器序列化后(转为了Python字典类型)再传递给data参数</span><br><span class="line">		参数说明：</span><br><span class="line">			data 				<span class="comment"># 为响应准备的序列化处理后的数据</span></span><br><span class="line">            status	 			<span class="comment"># 状态码，默认200</span></span><br><span class="line">            template_name		<span class="comment"># 模板名称,在浏览器访问,看到的好看的模板(自定制)</span></span><br><span class="line">            headers				<span class="comment"># 用于存放响应头信息的字典</span></span><br><span class="line">            content_type 		<span class="comment"># 响应码类型</span></span><br><span class="line">            exception=<span class="literal">False</span>     <span class="comment"># 不用管</span></span><br><span class="line">        	(data，status，headers需要掌握)</span><br><span class="line">            </span><br><span class="line">        status有很多,比较完整的使用:</span><br><span class="line">            response=&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;查询成功&#x27;</span>,<span class="string">&#x27;result&#x27;</span>:ser.data&#125;</span><br><span class="line">            <span class="keyword">return</span> Response(response,status=status.HTTP_201_CREATED,headers=header)</span><br></pre></td></tr></table></figure>

<h3 id="2-3常用属性"><a href="#2-3常用属性" class="headerlink" title="2.3常用属性"></a>2.3常用属性</h3><h4 id="data-1"><a href="#data-1" class="headerlink" title=".data"></a>.data</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">传给response对象的序列化c后，但尚未render处理的数据</span><br></pre></td></tr></table></figure>

<h4 id="status-code"><a href="#status-code" class="headerlink" title=".status_code"></a>.status_code</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">状态码的数字</span><br></pre></td></tr></table></figure>

<h4 id="content"><a href="#content" class="headerlink" title=".content"></a>.content</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">经过render处理后的响应数据</span><br></pre></td></tr></table></figure>

<h3 id="2-4状态码"><a href="#2-4状态码" class="headerlink" title="2.4状态码"></a>2.4状态码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了方便设置状态码，REST framewrok在rest_framework.status模块中提供了常用状态码常量</span><br></pre></td></tr></table></figure>

<h4 id="1-信息告知-1xx"><a href="#1-信息告知-1xx" class="headerlink" title="1.信息告知-1xx"></a>1.信息告知-1xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP_100_CONTINUE</span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS</span><br></pre></td></tr></table></figure>

<h4 id="2-成功-2xx"><a href="#2-成功-2xx" class="headerlink" title="2.成功-2xx"></a>2.成功-2xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_200_OK</span><br><span class="line">HTTP_201_CREATED</span><br><span class="line">HTTP_202_ACCEPTED</span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION</span><br><span class="line">HTTP_204_NO_CONTENT</span><br><span class="line">HTTP_205_RESET_CONTENT</span><br><span class="line">HTTP_206_PARTIAL_CONTENT</span><br><span class="line">HTTP_207_MULTI_STATUS</span><br></pre></td></tr></table></figure>

<h4 id="3-重定向-3xx"><a href="#3-重定向-3xx" class="headerlink" title="3.重定向-3xx"></a>3.重定向-3xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_300_MULTIPLE_CHOICES</span><br><span class="line">HTTP_301_MOVED_PERMANENTLY</span><br><span class="line">HTTP_302_FOUND</span><br><span class="line">HTTP_303_SEE_OTHER</span><br><span class="line">HTTP_304_NOT_MODIFIED</span><br><span class="line">HTTP_305_USE_PROXY</span><br><span class="line">HTTP_306_RESERVED</span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT</span><br></pre></td></tr></table></figure>

<h4 id="4-客户端错误-4xx"><a href="#4-客户端错误-4xx" class="headerlink" title="4.客户端错误-4xx"></a>4.客户端错误-4xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">HTTP_400_BAD_REQUEST</span><br><span class="line">HTTP_401_UNAUTHORIZED</span><br><span class="line">HTTP_402_PAYMENT_REQUIRED</span><br><span class="line">HTTP_403_FORBIDDEN</span><br><span class="line">HTTP_404_NOT_FOUND</span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED</span><br><span class="line">HTTP_406_NOT_ACCEPTABLE</span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED</span><br><span class="line">HTTP_408_REQUEST_TIMEOUT</span><br><span class="line">HTTP_409_CONFLICT</span><br><span class="line">HTTP_410_GONE</span><br><span class="line">HTTP_411_LENGTH_REQUIRED</span><br><span class="line">HTTP_412_PRECONDITION_FAILED</span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE</span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG</span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE</span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE</span><br><span class="line">HTTP_417_EXPECTATION_FAILED</span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY</span><br><span class="line">HTTP_423_LOCKED</span><br><span class="line">HTTP_424_FAILED_DEPENDENCY</span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED</span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS</span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE</span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</span><br></pre></td></tr></table></figure>

<h4 id="5-服务器错误-5xx"><a href="#5-服务器错误-5xx" class="headerlink" title="5.服务器错误-5xx"></a>5.服务器错误-5xx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP_500_INTERNAL_SERVER_ERROR</span><br><span class="line">HTTP_501_NOT_IMPLEMENTED</span><br><span class="line">HTTP_502_BAD_GATEWAY</span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE</span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT</span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED</span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE</span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</span><br></pre></td></tr></table></figure>

<h4 id="图解"><a href="#图解" class="headerlink" title="图解:"></a>图解:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701145923333.png" alt="image-20210701145923333"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210701145935790.png" alt="image-20210701145935790"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/14/Drf%E8%B7%AF%E7%94%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/14/Drf%E8%B7%AF%E7%94%B1/" class="post-title-link" itemprop="url">Drf路由</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-14 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-14T18:20:25+08:00">2019-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf路由"><a href="#Drf路由" class="headerlink" title="Drf路由"></a>Drf路由</h1><h2 id="1-路由Routers"><a href="#1-路由Routers" class="headerlink" title="1.路由Routers"></a>1.路由Routers</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息</span><br><span class="line"></span><br><span class="line"><span class="comment"># REST framework提供了两个router:</span></span><br><span class="line">    <span class="number">1.</span>SimpleRouter		<span class="comment"># 自动生成两个路由</span></span><br><span class="line">    	eg:</span><br><span class="line">            ^books/$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">			^books/(?P&lt;pk&gt;[^/.]+)/$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">    <span class="number">2.</span>DefaultRouter		<span class="comment"># 自动生成六个路由</span></span><br><span class="line">    	eg:</span><br><span class="line">            ^books/$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">            ^books\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">            ^books/(?P&lt;pk&gt;[^/.]+)/$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            ^books/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            ^$ [name=<span class="string">&#x27;api-root&#x27;</span>]</span><br><span class="line">            ^\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;api-root&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">   	<span class="comment"># DefaultRouter与SimpleRouter的区别:</span></span><br><span class="line">    	DefaultRouter会多附带一个默认的API根视图，返回一个包含所有列表视图的超链接响应数据</span><br></pre></td></tr></table></figure>

<h2 id="2-使用方法"><a href="#2-使用方法" class="headerlink" title="2.使用方法"></a>2.使用方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用前提:视图类必须是继承ViewSetMixin的子类，才能自动生成路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建router对象,并注册视图集</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"></span><br><span class="line">        router = routers.SimpleRouter()</span><br><span class="line">        router.register(<span class="string">&#x27;router_stu&#x27;</span>,StudentView, base_name=<span class="string">&#x27;student&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">	<span class="comment"># register(prefix, viewset, base_name)参数详解:</span></span><br><span class="line">    	prefix 			<span class="comment"># 该视图集的路由前缀</span></span><br><span class="line">        viewset 		<span class="comment"># 视图集</span></span><br><span class="line">        base_name 		<span class="comment"># 路由别名</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># 2.添加路由数据的两种方式:</span></span><br><span class="line">	方式一:</span><br><span class="line">        urlpatterns+=router.urls </span><br><span class="line">    方式二:</span><br><span class="line">        urlpatterns = [</span><br><span class="line">    		path(<span class="string">&#x27;api/&#x27;</span>, include(router.urls))</span><br><span class="line">		]	</span><br></pre></td></tr></table></figure>

<h3 id="自动生成路由代码演示"><a href="#自动生成路由代码演示" class="headerlink" title="自动生成路由代码演示"></a>自动生成路由代码演示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类代码:</span></span><br><span class="line">	<span class="comment"># 必须是继承ModelViewSet的视图类才能自动生成路由</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        <span class="comment"># 这种方法不会自动生成，需要用action配置</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;学生登录功能&quot;&quot;&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(self.action)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;登录成功&quot;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由代码:</span></span><br><span class="line">	<span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line">    <span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">    urlpatterns = [</span><br><span class="line">        path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用drf提供路由类router给视图集生成路由列表&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 实例化路由类</span></span><br><span class="line">    <span class="comment"># Drf一共提供了两个路由类给我们使用,他们用法一致,功能几乎一样</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter,SimpleRouter</span><br><span class="line">    router = DefaultRouter() 或 router = SimpleRouter()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注册视图集</span></span><br><span class="line">    router.register(<span class="string">&quot;router_stu&quot;</span>,views.StudentModelViewSet)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把生成的路由列表追加到urlpatterns</span></span><br><span class="line">    urlpatterns += router.urls</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    上述代码就自动生成路由地址[增/删/改/查一条/查多条的功能],但不会自动生成我们在视图集自定义方法的路由</span><br><span class="line">    所以我们如果也要给自定义方法生成路由,则需要进行action动作的声明</span><br></pre></td></tr></table></figure>

<h2 id="3-视图集附加action声明"><a href="#3-视图集附加action声明" class="headerlink" title="3.视图集附加action声明"></a>3.视图集附加action声明</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	视图集中，如果想要让Router自动帮我们为自定义的方法生成路由信息，需使用action装饰器,用action装饰器装饰的方法名会作为action动作名,与<span class="built_in">list</span>、retrieve等同</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入装饰器:</span></span><br><span class="line">    rest_framework.decorators.action</span><br><span class="line">    </span><br><span class="line"><span class="comment"># action装饰器可以接收两个参数:</span></span><br><span class="line">    methods: 声明该action对应的请求方式，列表传递</span><br><span class="line">    detail:  声明该action的路径是否与单一资源对应(Tr)</span><br><span class="line">        eg:</span><br><span class="line">            detail=<span class="literal">True</span>   生成的路由是:xxx/&lt;pk&gt;/action方法名/</span><br><span class="line">            detail=<span class="literal">False</span>  生成的路由是:xxx/action方法名/    </span><br></pre></td></tr></table></figure>

<h3 id="action装饰器生成路由代码演示"><a href="#action装饰器生成路由代码演示" class="headerlink" title="action装饰器生成路由代码演示"></a>action装饰器生成路由代码演示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类代码:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="comment"># methods 		设置当前方法允许哪些http请求访问当前视图方法</span></span><br><span class="line">        <span class="comment"># detail 		设置当前视图方法是否是操作一个数据</span></span><br><span class="line">        <span class="comment"># detail=False   表示路径名格式应该为 router_stu/login/</span></span><br><span class="line"><span class="meta">        @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登陆成功&#x27;</span>&#125;)</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># detail=True   表示路径名格式应该为 router_stu/&#123;pk&#125;/get_new_5/</span></span><br><span class="line"><span class="meta">        @action(<span class="params">methods=[<span class="string">&#x27;put&#x27;</span>], detail=<span class="literal">True</span></span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_new_5</span>(<span class="params">self, request,pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;获取5条数据成功&#x27;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 被action装饰的自定义方法会自动生成如下路由:</span></span><br><span class="line">	^router_stu/&#123;pk&#125;/login/$   name: router_stu-login</span><br><span class="line">    ^router_stu/get_new_5/$    name: router_stu-get_new_5 </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/12/Drf%E5%85%A5%E9%97%A8%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/12/Drf%E5%85%A5%E9%97%A8%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">Drf入门规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-12T18:20:25+08:00">2019-05-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf-Djano高级"><a href="#Drf-Djano高级" class="headerlink" title="Drf(Djano高级)"></a>Drf(Djano高级)</h1><h2 id="1-Web开发模式"><a href="#1-Web开发模式" class="headerlink" title="1.Web开发模式"></a>1.Web开发模式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 前后端混合开发</span><br><span class="line">	-模板渲染在后端完成</span><br><span class="line">    var name=<span class="string">&quot;&#123;&#123;dic&#125;&#125;&quot;</span></span><br><span class="line"><span class="number">2</span> 前后端分离（主流）</span><br><span class="line">	-后端只负责写接口，前端来调用，通信使用json格式</span><br><span class="line">    -多端（web，app）都可以使用同一个接口 </span><br></pre></td></tr></table></figure>

<h4 id="前后端不分离"><a href="#前后端不分离" class="headerlink" title="前后端不分离:"></a>前后端不分离:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628182533637.png" alt="image-20210628182533637"></p>
<h4 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离:"></a>前后端分离:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628182613156.png" alt="image-20210628182613156"></p>
<h2 id="2-API接口"><a href="#2-API接口" class="headerlink" title="2.API接口"></a>2.API接口</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是API接口(应用程序接口)?</span><br><span class="line">    通过网络，规定了前后台信息交互规则的url链接，也就是前后台信息交互的媒介</span><br><span class="line">	为了在团队内部形成共识、防止个人习惯差异引起的混乱，我们需要找到一种大家都觉得很好的接口实现规范，而且这种规范能够让后端写的接口，用途一目了然，减少双方之间的合作成本(详细可以查看微博开放平台:https://<span class="built_in">open</span>.weibo.com/wiki/<span class="number">2</span>/users/show)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>API功能</span><br><span class="line">	<span class="number">1.</span>API确认所有操作都是合法的</span><br><span class="line">	<span class="number">2.</span>在发生错误时，API会根据错误报告机制发出指示</span><br><span class="line">	<span class="number">3.</span>API内置授权和访问控制，确保只有授权人员才能访问特殊数据</span><br><span class="line">	<span class="number">4.</span>可以充当防火墙，防止资源被滥用，允许合法的请求</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>常见API接口形式</span><br><span class="line">	<span class="number">1.</span>HTTP类型接口</span><br><span class="line">		基于HTTP协议提供的API,这类API常常以“网址”形式提供的,像现在主流的RESTful就属于这类接口</span><br><span class="line">        </span><br><span class="line">	<span class="number">2.</span>RPC接口</span><br><span class="line">		RPC它是指远程过程调用，将一部分代码逻辑放在远程服务器上部署，然后在需要的地方调用即可(调用远程方法就像调用本地方法一样),本质上是Client/Server模式，而且支持多种协议和数据传输方式</span><br><span class="line">        </span><br><span class="line">	<span class="number">3.</span>Web Service 接口</span><br><span class="line">		Web Service并不具象地指某种API，我们将以WEB形式提供的服务都称之为Web Service，像RESTful也属于Web Service。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="number">4.</span>API接口四大特点:</span><br><span class="line">    <span class="number">1.</span>url：长得像返回数据的url链接</span><br><span class="line">    <span class="number">2.</span>请求方式：get、post、put、patch、delete</span><br><span class="line">    <span class="number">3.</span>请求参数：json或xml格式的&#123;key:value&#125;类型数据</span><br><span class="line">    <span class="number">4.</span>响应结果：json或xml格式的数据</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="number">5.</span>接口约束子类行为</span><br><span class="line">	-人为</span><br><span class="line">    -abc模块</span><br><span class="line">    -父类抛异常</span><br></pre></td></tr></table></figure>

<h3 id="接口测试工具"><a href="#接口测试工具" class="headerlink" title="接口测试工具"></a>接口测试工具</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接口测试工具:</span></span><br><span class="line">	<span class="number">1.</span>接口测试工具有很多 --&gt; postman,浏览器插件，接口压力测试工具Jmeter</span><br><span class="line">    <span class="number">2.</span>本质就是模拟发送http请求</span><br><span class="line">    <span class="number">3.</span>安装postman ---&gt; 双击即可</span><br><span class="line">    <span class="number">4.</span>前后端交互的编码方式</span><br><span class="line">    	-urlencoded		<span class="comment"># 普通数据</span></span><br><span class="line">        -form-data		<span class="comment"># 普通数据和文件数据</span></span><br><span class="line">        -json			<span class="comment"># json格式数据</span></span><br><span class="line">    <span class="number">5.</span>详见http://www.liuqingzheng.top/python/Django-rest-framework%E6%A1%<span class="number">86</span>%E6%9E%B6/<span class="number">1</span>-drf-drf%E5%<span class="number">85</span>%A5%E9%<span class="number">97</span>%A8%E8%A7%<span class="number">84</span>%E8%8C%<span class="number">83</span>/</span><br></pre></td></tr></table></figure>

<p><strong>工作面板:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184627445.png" alt="image-20210628184627445"></p>
<p><strong>简易get请求:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184657295.png" alt="image-20210628184657295"></p>
<p><strong>简易的post请求:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184729439.png" alt="image-20210628184729439"></p>
<p><strong>案例:请求百度地图接口</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184809594.png" alt="image-20210628184809594"></p>
<h2 id="3-RESTful规范"><a href="#3-RESTful规范" class="headerlink" title="3.RESTful规范"></a>3.RESTful规范</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是RESTful?</span><br><span class="line">	RESTful是一种定义Web API接口的设计风格，尤其适用于前后端分离的应用模式中,大部分的接口，都会按照这个规范去写(Web API接口的设计风格)最早出现在<span class="number">2000</span>年Roy Fielding的博士论文中</span><br><span class="line">	</span><br><span class="line"><span class="number">2.</span>RESTful十条:</span><br><span class="line">	<span class="number">1.</span>url链接一般都采用https协议进行传输(提高数据交互过程中的安全性)</span><br><span class="line">    </span><br><span class="line">	<span class="number">2.</span>url中带关键字api(代表该请求url链接是完成前后台数据交互的)</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com</span><br><span class="line">            https://www.baidu.com/api</span><br><span class="line">                </span><br><span class="line">	<span class="number">3.</span>url中带版本信息</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/v1</span><br><span class="line">            https://api.baidu.com/v2</span><br><span class="line">                </span><br><span class="line">    <span class="number">4.</span>数据即资源，均使用名词表示(可复数)</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/users</span><br><span class="line">            https://api.baidu.com/books</span><br><span class="line">            https://api.baidu.com/book</span><br><span class="line">                </span><br><span class="line">    <span class="number">5</span> 资源操作由请求方式决定</span><br><span class="line">        -查询操作----get(查单条,查所有)</span><br><span class="line">        -新增操作----post</span><br><span class="line">        -修改操作----put(整体修改),patch(局部修改)</span><br><span class="line">        -删除操作----delete</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/books 	- get请求：获取所有书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- get请求：获取主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books 	- post请求：新增一本书书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span>	- put请求：整体修改主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- patch请求：局部修改主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- delete请求：删除主键为<span class="number">1</span>的书</span><br><span class="line">                </span><br><span class="line">     <span class="number">6</span> 请求url中带搜索筛选条件(通过在url上传参的形式传递搜索条件)</span><br><span class="line">    	https://api.example.com/v1/zoos?limit=<span class="number">10</span>：			<span class="comment"># 指定返回记录的数量</span></span><br><span class="line">        https://api.example.com/v1/zoos?offset=<span class="number">10</span>：			<span class="comment"># 指定返回记录的开始位置</span></span><br><span class="line">        https://api.example.com/v1/zoos?animal_type_id=<span class="number">1</span>：	<span class="comment"># 指定筛选条件</span></span><br><span class="line">            </span><br><span class="line">   	 <span class="number">7.</span>响应中要带状态码（自己定义，http响应状态码）</span><br><span class="line">        &#123;</span><br><span class="line">        	status:<span class="number">200</span></span><br><span class="line">        &#125;</span><br><span class="line">        eg:(常见状态码)</span><br><span class="line">            <span class="number">200</span>：常规请求</span><br><span class="line">			<span class="number">201</span>：创建成功</span><br><span class="line">            <span class="number">301</span>：永久重定向</span><br><span class="line">            <span class="number">302</span>：暂时重定向</span><br><span class="line">            <span class="number">403</span>：请求无权限</span><br><span class="line">            <span class="number">404</span>：请求路径或资源不存在</span><br><span class="line">            <span class="number">405</span>：请求方法不存在</span><br><span class="line">            <span class="number">500</span>：服务器异常</span><br><span class="line"> </span><br><span class="line">      <span class="number">8.</span>响应返回错误或提示信息</span><br><span class="line">         &#123;</span><br><span class="line">             status:<span class="number">200</span></span><br><span class="line">             msg: <span class="string">&quot;无权限操作&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">        </span><br><span class="line">      <span class="number">9.</span>返回结果，遵循如下规范(大概率都没有遵循)</span><br><span class="line">        GET /collection				<span class="comment"># 返回资源对象的列表（数组）</span></span><br><span class="line">        GET /collection/resource	<span class="comment"># 返回单个资源对象</span></span><br><span class="line">        POST /collection			<span class="comment"># 返回新生成的资源对象</span></span><br><span class="line">        PUT /collection/resource	<span class="comment"># 返回完整的资源对象</span></span><br><span class="line">        PATCH /collection/resource	<span class="comment"># 返回完整的资源对象</span></span><br><span class="line">        DELETE /collection/resource	<span class="comment"># 返回一个空文档</span></span><br><span class="line">      </span><br><span class="line">      <span class="number">10.</span>返回数据中带链接地址</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">        <span class="string">&quot;results&quot;</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>:<span class="string">&quot;肯德基(罗餐厅)&quot;</span>,</span><br><span class="line">                <span class="string">&quot;img&quot;</span>: <span class="string">&quot;https://image.baidu.com/kfc/001.png&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        	]</span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-序列化"><a href="#4-序列化" class="headerlink" title="4.序列化"></a>4.序列化</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 什么是序列化和反序列化?</span></span><br><span class="line">	序列化：把我们识别的数据转换成指定的格式提供给别人</span><br><span class="line">	反序列化：把别人提供的数据转换/还原成我们需要的格式</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    前端js提供过来的json数据,对于python而言就是字符串，我们需要进行反序列化换成模型类对象，这样我们才能把数据保存到数据库中</span><br></pre></td></tr></table></figure>

<h2 id="5-Drf简介及安装"><a href="#5-Drf简介及安装" class="headerlink" title="5.Drf简介及安装"></a>5.Drf简介及安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf简介:</span></span><br><span class="line">	Django Rest_Framework:是django的一个app，可以借助它快速在django框架开发出符合restful规范的接口</span><br><span class="line"><span class="comment"># Drf提供了：</span></span><br><span class="line">	REST framework还提供了认证、权限、限流、过滤、分页、接口文档等功能支持</span><br><span class="line"><span class="comment"># Drf官方文档：</span></span><br><span class="line">	https://www.django-rest-framework.org/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># python django的版本支持情况</span></span><br><span class="line">    Python（<span class="number">3.5</span>、<span class="number">3.6</span>、<span class="number">3.7</span>、<span class="number">3.8</span>、<span class="number">3.9</span>）</span><br><span class="line">    Django (<span class="number">2.2</span>, <span class="number">3.0</span>, <span class="number">3.1</span>)   <span class="number">2.</span>x用的多，<span class="number">1.</span>x老项目</span><br><span class="line"></span><br><span class="line"><span class="comment"># django版本区别：1版本跟2b没有大的区别</span></span><br><span class="line">	<span class="number">1</span>版本支持路由正则匹配,<span class="number">2</span>版本的路由写什么就是什么,精准匹配,<span class="number">5</span>个转换器(<span class="built_in">int</span>，<span class="built_in">str</span>，slug，path，uuid)</span><br><span class="line">    <span class="number">1</span>版本默认级联更新级联删除,<span class="number">2</span>版本需要自己指定级联删除动作</span><br><span class="line">      </span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">	pip3 install djangorestframework</span><br><span class="line">    <span class="comment"># 注意：跟django版本对应好，django 2.2.2 ---&gt; drf最新</span></span><br></pre></td></tr></table></figure>

<h2 id="6-基于Drf快速实现五个接口"><a href="#6-基于Drf快速实现五个接口" class="headerlink" title="6.基于Drf快速实现五个接口"></a>6.基于Drf快速实现五个接口</h2><h3 id="6-1路由层"><a href="#6-1路由层" class="headerlink" title="6.1路由层"></a>6.1路由层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = SimpleRouter()</span><br><span class="line">router.register(<span class="string">&#x27;book&#x27;</span>, views.BookView)</span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment">#    path(&#x27;admin/&#x27;, admin.site.urls),</span></span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<h3 id="6-2视图层"><a href="#6-2视图层" class="headerlink" title="6.2视图层"></a>6.2视图层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .serizlizer <span class="keyword">import</span> BookSerializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Books.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>

<h3 id="6-3模型层"><a href="#6-3模型层" class="headerlink" title="6.3模型层"></a>6.3模型层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=models.IntegerField()</span><br><span class="line">    publish=models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-4序列化类"><a href="#6-4序列化类" class="headerlink" title="6.4序列化类"></a>6.4序列化类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=Books</span><br><span class="line">        fields=<span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-Cbv源码分析"><a href="#7-Cbv源码分析" class="headerlink" title="7.Cbv源码分析"></a>7.Cbv源码分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>views.Book.as_view()执行完的结果一定是个函数内存地址</span><br><span class="line"><span class="number">2.</span>as_view是View类的类方法，类来调用</span><br><span class="line"><span class="number">3.</span>as_view中view这个闭包函数的源码是</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 核心代码</span></span><br><span class="line">        <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line"><span class="number">4.</span>执行了View类的dispatch</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 如果是get请求</span></span><br><span class="line">        <span class="comment"># request.method.lower() 是get字符串，下面条件符合</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            <span class="comment"># 通过反射拿到我们写的Book视图类的中的get方法</span></span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">        <span class="comment"># get(request, *args, **kwargs)----&gt;执行Book视图类中的get方法,再同FBV</span></span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line"><span class="number">5.</span>扩展，如果我在Book视图类中重写dispatch方法</span><br><span class="line">	-可以实现，在get，post方法执行之前或者之后执行代码，完成类似装饰器的效果</span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 加代码</span></span><br><span class="line">            response=<span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">            <span class="comment"># 加代码</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="8-DRF基本使用及执行流程分析"><a href="#8-DRF基本使用及执行流程分析" class="headerlink" title="8.DRF基本使用及执行流程分析"></a>8.DRF基本使用及执行流程分析</h2><h3 id="8-1继承APIView使用"><a href="#8-1继承APIView使用" class="headerlink" title="8.1继承APIView使用"></a>8.1继承APIView使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 这个request是什么？新的，drf的Reqeust对象,用起来，跟老request对象一样</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(request))  		  <span class="comment"># rest_framework.request.Request</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(request._request)) <span class="comment"># django.core.handlers.wsgi.WSGIRequest</span></span><br><span class="line">        <span class="built_in">print</span>(request.GET)  <span class="comment"># 神奇</span></span><br><span class="line">        <span class="built_in">print</span>(request._request.GET)  <span class="comment"># 应该这么用</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;get请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 以后再取值，都从request.data中取(三种编码格式数据都可以取到)</span></span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="built_in">print</span>(request.POST)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;post请求&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-2APIView执行流程"><a href="#8-2APIView执行流程" class="headerlink" title="8.2APIView执行流程"></a>8.2APIView执行流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIView继承了django的View</span></span><br><span class="line"><span class="number">1.</span>APIView中重写了as_view</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>):</span></span><br><span class="line">        <span class="comment"># 调用父类的as_view</span></span><br><span class="line">        view = <span class="built_in">super</span>().as_view(**initkwargs)</span><br><span class="line">        <span class="comment"># 只要继承APIView以后所有的视图都没有csrf保护了 不管是否注释掉中间件 </span></span><br><span class="line">        <span class="keyword">return</span> csrf_exempt(view)</span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>请求来了-&gt;路由匹配上-&gt;view(request)-&gt;调用self.dispatch-&gt;apiview中重写了diapatch</span><br><span class="line">执行self.dispatch()----&gt;APIView的dispatch</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">		<span class="comment"># 重新包装了一个新的request对象，基于原来的request对象包装的</span></span><br><span class="line">        <span class="comment"># 这个request对象是新的request对象，是drf提供的Request类的对象</span></span><br><span class="line">        <span class="comment"># 新的request包含原来老的request(django的request)</span></span><br><span class="line">        <span class="comment"># self._request = request</span></span><br><span class="line">        request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        <span class="comment">#print(request._request)  老的request对象</span></span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">        	<span class="comment"># 认证，权限，频率...</span></span><br><span class="line">            self.initial(request, *args, **kwargs)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">                handler = <span class="built_in">getattr</span>(self, request.method.lower(),</span><br><span class="line">                                  self.http_method_not_allowed)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handler = self.http_method_not_allowed</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 视图类中get方法的执行</span></span><br><span class="line">            response = handler(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="comment"># 如果在视图类中有错误，会被捕获（全局异常处理）</span></span><br><span class="line">            response = self.handle_exception(exc)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 把response包装了一下，返回</span></span><br><span class="line">        self.response = self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self.response</span><br><span class="line">	   </span><br><span class="line"><span class="number">3.</span>在视图类中使用的request对象是新的request对象，老的是request._request</span><br><span class="line">	-新的request.GET拿到的还是老的GET，原理如下(Request类重写了__getattr__)</span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, attr</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 通过反射 获取原生的request对象,取其属性或方法</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">getattr</span>(self._request, attr)</span><br><span class="line">            <span class="keyword">except</span> AttributeError:</span><br><span class="line">                <span class="keyword">return</span> self.__getattribute__(attr)</span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">魔法方法：</span></span><br><span class="line"><span class="string">	类中__名字__的方法，就叫魔法方法,学过的__init__(类实例化执行),__str__(打印对象执行)</span></span><br><span class="line"><span class="string">    不需要主动调用,某种特定条件就会触发它的执行</span></span><br><span class="line"><span class="string">    __getattr__：对象.属性，会触发它的执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line"><span class="number">4.</span>结论:以后继承了APIView后，request对象成了新的，但是跟原来一样用</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>新的request对象中有一个属性data</span><br><span class="line">	<span class="comment"># request.data感觉是一个数据属性,其实是一个方法,被@property修饰</span></span><br><span class="line">	-data是post请求携带的数据(三种编码格式)----&gt;字典</span><br><span class="line">    -无论是什么编码格式，只要是post提交的数据，都在request.data中</span><br><span class="line">	-以后再取值，都从request.data中取</span><br></pre></td></tr></table></figure>

<h3 id="8-3APIView和Request对象分析"><a href="#8-3APIView和Request对象分析" class="headerlink" title="8.3APIView和Request对象分析"></a>8.3APIView和Request对象分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 以后如果使用了drf，继承APIView(drf提供了很多view，他们都是继承自APIView)执行流程如下</span><br><span class="line">	-包装出了一个新的request，在视图函数中使用时，跟原来没有区别</span><br><span class="line">    -注意：</span><br><span class="line">    取post提交的数据，不要从request.POST中取了，要从request.data中取</span><br><span class="line">    取get提交的数据，尽量不从request.GET中取了，要从request.query_params中取</span><br><span class="line">    eg:</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">query_params</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self._request.GET</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> Request类(drf的)中需要掌握的</span><br><span class="line">	-request.data  			<span class="comment"># 方法包装成了数据属性</span></span><br><span class="line">    -request.query_params 	<span class="comment"># 就是request._request.GET</span></span><br><span class="line">    -request.FIELS        	<span class="comment"># 上传的文件</span></span><br><span class="line">    -用起来跟原来一样</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> APIView类</span><br><span class="line">	-包装新的request</span><br><span class="line">    -执行了认证，权限，频率....</span><br><span class="line">    -处理了全局异常</span><br><span class="line">    -包装了response对象</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/04/Ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/04/Ajax/" class="post-title-link" itemprop="url">Ajax</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-04 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-04T18:20:25+08:00">2019-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h3 id="1-Ajax简介"><a href="#1-Ajax简介" class="headerlink" title="1.Ajax简介"></a>1.Ajax简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">异步提交 局部刷新</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">同步:提交任务之后原地等待任务结果期间不做任何事</span></span><br><span class="line"><span class="string">异步:提交任务之后不原地等待任务结果 等任务产生结果通过异步回调机制</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">前戏页面</span><br><span class="line">	博客园注册页面</span><br><span class="line">    github注册页面</span><br><span class="line"> </span><br><span class="line">能够发送网络请求的方法</span><br><span class="line">	a				get请求</span><br><span class="line">    form表单		   get请求、post请求</span><br><span class="line">    ajax            get请求、post请求</span><br><span class="line"> </span><br><span class="line">ajax不是一门独立的语言 而是一个功能 类似于装饰器</span><br><span class="line">	能够实现ajax功能的书写方式有很多 </span><br><span class="line">    	eg:原生js代码 jQuery封装代码 组件框架代码...</span><br><span class="line">    我们这里学习jQuery版本</span><br><span class="line"> </span><br><span class="line">ajax前戏</span><br><span class="line">	需求:保证页面不刷新的情况下完成数字的和</span><br></pre></td></tr></table></figure>

<h3 id="2-基本语法"><a href="#2-基本语法" class="headerlink" title="2.基本语法"></a>2.基本语法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">基本参数:</span></span><br><span class="line"><span class="string">	url:		提交地址   同form表单action参数</span></span><br><span class="line"><span class="string">	type:		请求方式   同form表单method参数</span></span><br><span class="line"><span class="string">	data:		数据体     需要发送的数据</span></span><br><span class="line"><span class="string">	success:	回调函数   后端返回结果自动执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">ajax发送给后端</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">            url:<span class="string">&#x27;&#x27;</span>,                       // 控制提交地址 规律与form标签的action参数一致</span><br><span class="line">            <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,                  // 控制请求方式</span><br><span class="line">            data:&#123;<span class="string">&#x27;i1&#x27;</span>:i1Val,<span class="string">&#x27;i2&#x27;</span>:i2Val&#125;, // 发送的数据 一般是字典形式</span><br><span class="line">            success:function (args) &#123;</span><br><span class="line">                    // 异步回调函数</span><br><span class="line">                    &#123;<span class="comment">#alert(args)#&#125;</span></span><br><span class="line">                    // 查看<span class="built_in">input</span>框并且写入数据</span><br><span class="line">                    $(<span class="string">&#x27;#i3&#x27;</span>).val(args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-前后端传输数据的编码格式-contenType"><a href="#3-前后端传输数据的编码格式-contenType" class="headerlink" title="3.前后端传输数据的编码格式(contenType)"></a>3.前后端传输数据的编码格式(contenType)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">contenType</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">前后端数据传输格式主要有三种</span></span><br><span class="line"><span class="string">    application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">	multipart/form-data</span></span><br><span class="line"><span class="string">    application/json</span></span><br><span class="line"><span class="string">朝后端发送数据的时候针对不同的方式后端有不同的处理措施</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># form表单</span></span><br><span class="line">默认数据编码格式是urlencoded</span><br><span class="line">数据格式:username=jason&amp;password=<span class="number">234</span></span><br><span class="line">    <span class="number">1.</span>针对urlencoded格式:</span><br><span class="line">        django后端针对符合urlencoded格式的数据会自动解析并封装到request.POST中</span><br><span class="line">    <span class="number">2.</span>针对form-data格式:</span><br><span class="line">        django后端针对form-data格式的数据文件自动封装到request.FILES中 普通的符合urlencoded还是封装到request.POST中</span><br><span class="line">    <span class="number">3.</span>针对json格式</span><br><span class="line">    	form表单发送不了json格式数据</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"><span class="comment"># ajax</span></span><br><span class="line">默认数据编码格式是urlencoded</span><br><span class="line">数据格式:username=jason&amp;password=<span class="number">234</span></span><br><span class="line">    <span class="number">1.</span>针对urlencoded格式:</span><br><span class="line">        django后端针对符合urlencoded格式的数据会自动解析封装到request.POST中 同form表单</span><br><span class="line">	<span class="number">2.</span>针对form-data:</span><br><span class="line">        django后端能够直接识别到formdata对象并将内部的普通键值自动解析封装到request.POST中 文件数据自动解析并封装到request.FILEs中</span><br><span class="line">    <span class="number">3.</span>针对json格式:</span><br><span class="line">        django后端不会帮你处理json格式数据需要你自己去request.body获取并处理    </span><br></pre></td></tr></table></figure>

<h4 id="dataType参数"><a href="#dataType参数" class="headerlink" title="dataType参数"></a>dataType参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataType</span><br><span class="line">	django后端如果使用JsonResponse给回调函数返回json格式字符串 回调函数会自动反序列化成js中的自定义对象</span><br><span class="line">    django后端不使用JsonResponse而是自己通过json模块序列化的数据 回调函数接收到之后不会自动反序列化</span><br></pre></td></tr></table></figure>

<h3 id="4-Ajax发送文件格式数据"><a href="#4-Ajax发送文件格式数据" class="headerlink" title="4.Ajax发送文件格式数据"></a>4.Ajax发送文件格式数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Ajax发送文件:</span></span><br><span class="line"><span class="string">    1.利用FormData内置对象先生成一个对象</span></span><br><span class="line"><span class="string">    2.向生成的对象里添加想要发送的普通数据或文件数据</span></span><br><span class="line"><span class="string">    3.将生成的对象放在data后面发送给后端</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	ajax发送文件格式数据必须要指定的两个参数</span></span><br><span class="line"><span class="string">		1.contentType:false		声明不使用任何编码 django后端自动识别formDataObj对象</span></span><br><span class="line"><span class="string">		2.processData:false		向浏览器声明不处理formDataObj对象 直接发送</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ajax发送文件数据</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&#x27;#d1&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function () &#123;</span><br><span class="line">                // <span class="number">1.</span>先生成一个内置对象</span><br><span class="line">                let formDataObj = new FormData();</span><br><span class="line">                // <span class="number">2.</span>添加符合urlencoded格式的普通键值对数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>);</span><br><span class="line">                // <span class="number">3.</span>添加文件数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#myfile&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">                // <span class="number">4.</span>ajax发送给后端</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&#x27;&#x27;</span>,  			// 提交地址 规律同form标签的action参数</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,  		// 请求方式</span><br><span class="line">                    data:formDataObj,  	// 发送的数据</span><br><span class="line">                    // Ajax发送文件必须额外指定两个参数</span><br><span class="line">                    contentType:false,  // 不采用任何编码 后端能直接识别formdata对象</span><br><span class="line">                    processData:false,  // 不处理formdata对象 直接发送即可</span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                        ...</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;); </span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">总结:</span><br><span class="line">	<span class="number">1.</span>需要利用内置对象FormData</span><br><span class="line">    	生成一个对象:</span><br><span class="line">        	let formDataObj = new FormData();</span><br><span class="line">        添加普通的键值对</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;username&#x27;</span>,$(<span class="string">&#x27;#d1&#x27;</span>).val());</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;password&#x27;</span>,$(<span class="string">&#x27;#d2&#x27;</span>).val());</span><br><span class="line">        添加文件对象</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#d3&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>])</span><br><span class="line">	<span class="number">2.</span>需要指定两个关键性的参数</span><br><span class="line">        contentType :false   // 不需使用任何编码django后端能够自动识别formdata对象</span><br><span class="line">        processData:false	 // 告诉你的浏览器不要对你的数据进行任何处理</span><br><span class="line">	<span class="number">3.</span> django后端能直接识别到formdata对象并且能够将内部的普通键值自动解析封装到request.POST中 文件数据自动解析并封装到request.FILEs中</span><br></pre></td></tr></table></figure>

<h3 id="5-Ajax发送Json格式数据"><a href="#5-Ajax发送Json格式数据" class="headerlink" title="5.Ajax发送Json格式数据"></a>5.Ajax发送Json格式数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">前后端传输数据的时候一定要确保编码格式跟数据真正的格式是一致的</span></span><br><span class="line"><span class="string">不要骗人家!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;username&quot;:&quot;jason&quot;, &quot;age&quot;:25&#125;</span></span><br><span class="line"><span class="string">	在request.POST里面肯定找不到</span></span><br><span class="line"><span class="string">	django针对json格式的数据不会做任何的处理</span></span><br><span class="line"><span class="string">	需自己去request.body获取并处理</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">request对象方法补充</span></span><br><span class="line"><span class="string">	request.is_ajax()</span></span><br><span class="line"><span class="string">	判断当前请求是否是ajax请求 返回布尔值</span></span><br><span class="line"><span class="string">	is_开头基本上返回结果都是布尔值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>	</span><br><span class="line"></span><br><span class="line">前端:</span><br><span class="line">    </span><br><span class="line">ajax发送json格式数据</span><br><span class="line">	django后端不做任何处理 直接以二进制形式存放在request.body中</span><br><span class="line">	data</span><br><span class="line">	contentType</span><br><span class="line">    </span><br><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;#d1&#x27;</span>).click(function () &#123;</span><br><span class="line">        	$.ajax(&#123;</span><br><span class="line">        			url:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        			<span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        			data:JSON.stringify( &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">25</span>&#125;),</span><br><span class="line">        			contentType:<span class="string">&#x27;application/json&#x27;</span>,  // 指定编码格式</span><br><span class="line">        			success:function () &#123;</span><br><span class="line">        		   &#125;</span><br><span class="line">       		 &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">***************************************************************************************</span><br><span class="line">后端:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ab_ison</span>(<span class="params">reguesthi</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">if</span> request.is_ajax(<span class="params"></span>):</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.is_ajax())</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.POST)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.FILES)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.body)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># b&#x27;&#123;&quot;username&quot;:&quot;jason&quot;,&quot;age&quot;:25&#125; &#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment">#针对json格式数据需要你自己手动处理</span></span></span></span><br><span class="line"><span class="params"><span class="function">        json_bytes= request.body</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json_str = json_bytes.decode(&#x27;utf-8&#x27;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json_dict = json.Loads(json_str)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json.Loads括号内如果传入了一个二进制格式的数据那么内部自动解码再反序列化</span></span></span></span><br><span class="line"><span class="params"><span class="function">        json_dict = json.Loads(<span class="params">json_bytes</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># &#123;&#x27;username&#x27;:&#x27;jason&#x27;,&#x27;age&#x27;: 2&#125;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">print</span>(<span class="params">json_dict,<span class="built_in">type</span>(<span class="params">json_dict</span>)</span>) <span class="comment"># &#123;&#x27;username&#x27;:&#x27;jason&#x27;,&#x27;age&#x27;: 25&#125;</span></span></span></span><br><span class="line"><span class="params"><span class="function">     <span class="keyword">return</span> render(<span class="params">request,<span class="string">&#x27;ab_json.htmL&#x27;</span></span>)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="ajax传输json格式数据需要注意点"><a href="#ajax传输json格式数据需要注意点" class="headerlink" title="ajax传输json格式数据需要注意点"></a>ajax传输json格式数据需要注意点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">针对发送:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ajax发送json格式数据需要注意点:</span></span><br><span class="line"><span class="string">    1.ContentType参数指定成: application/json</span></span><br><span class="line"><span class="string">    2.数据是真正的json格式数据</span></span><br><span class="line"><span class="string">    3.django后端不会帮你处理json格式数据需要你自己去request.body获取并处理</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">针对接收:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">后端如果是用HttpResponse返回的json格式数据回调函数不会自动帮你反序列化</span></span><br><span class="line"><span class="string">如果后端直接用的是JsonResponse返回的数据回调函数会自动反序列化(前端设置dataType:&#x27;json&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">HttpResponse返回json格式数据解决方式</span></span><br><span class="line"><span class="string">    1.自己在前端利用JSON.parse( )</span></span><br><span class="line"><span class="string">    2.在ajax里面配置一个参数(dataType=&#x27;json&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-Django内置序列化模块-serializers"><a href="#6-Django内置序列化模块-serializers" class="headerlink" title="6.Django内置序列化模块(serializers)"></a>6.Django内置序列化模块(serializers)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ab_ser</span>(<span class="params">request</span>):</span></span><br><span class="line">    book_queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 自己构造字典</span></span><br><span class="line">    <span class="comment"># book_list = []</span></span><br><span class="line">    <span class="comment"># for book_obj in book_queryset:</span></span><br><span class="line">    <span class="comment">#     book_list.append(&#123;&#x27;title&#x27;:book_obj.title,</span></span><br><span class="line">    <span class="comment">#                       &#x27;price&#x27;:book_obj.price,</span></span><br><span class="line">    <span class="comment">#                       &#x27;publish_time&#x27;:book_obj.publish_time</span></span><br><span class="line">    <span class="comment">#                       &#125;)</span></span><br><span class="line">    <span class="comment"># res = json.dumps(book_list)</span></span><br><span class="line">    <span class="comment"># return render(request,&#x27;ab_ser.html&#x27;,locals())</span></span><br><span class="line">    res = serializers.serialize(<span class="string">&#x27;json&#x27;</span>,book_queryset)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res)</span><br></pre></td></tr></table></figure>

<h3 id="5-基于Ajax实现二次确认"><a href="#5-基于Ajax实现二次确认" class="headerlink" title="5.基于Ajax实现二次确认"></a>5.基于Ajax实现二次确认</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;.del_link&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function (a) &#123;</span><br><span class="line">            var $aEle = $(this);</span><br><span class="line">            var deleteId = $(this).attr(<span class="string">&#x27;delete_id&#x27;</span>);</span><br><span class="line">            // 提示二次确认</span><br><span class="line">            res = confirm(<span class="string">&#x27;你确定真的要删吗?&#x27;</span>);</span><br><span class="line">            // 判断是否删除</span><br><span class="line">            <span class="keyword">if</span> (res)&#123;</span><br><span class="line">                // 发送ajax请求</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&quot;/book_delete/&quot;</span> + deleteId,</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">                    data:&#123;&#125;,</span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                        // <span class="number">1.</span>页面刷新  不推荐使用</span><br><span class="line">                        window.location.reload();</span><br><span class="line">                        // <span class="number">2.</span>DOM操作  正规 用户体验好</span><br><span class="line">                        $aEle.parent().parent().remove()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                	alert(<span class="string">&#x27;怂逼不敢删啦&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="6-借助于插件完成二次确认弹框展示"><a href="#6-借助于插件完成二次确认弹框展示" class="headerlink" title="6.借助于插件完成二次确认弹框展示"></a>6.借助于插件完成二次确认弹框展示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">前端:</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;.del_book&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, function () &#123;</span><br><span class="line">            let $del_id = $(this)</span><br><span class="line">            let book_id = $(this).attr(<span class="string">&#x27;book_id&#x27;</span>)</span><br><span class="line">            console.log(book_id)</span><br><span class="line"></span><br><span class="line">            swal(&#123;</span><br><span class="line">                    title: <span class="string">&quot;Are you sure?&quot;</span>,</span><br><span class="line">                    text: <span class="string">&quot;You will not be able to recover this imaginary file!&quot;</span>,</span><br><span class="line">                    <span class="built_in">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">                    showCancelButton: true,</span><br><span class="line">                    confirmButtonClass: <span class="string">&quot;btn-danger&quot;</span>,</span><br><span class="line">                    confirmButtonText: <span class="string">&quot;Yes, delete it!&quot;</span>,</span><br><span class="line">                    cancelButtonText: <span class="string">&quot;No, cancel plx!&quot;</span>,</span><br><span class="line">                    closeOnConfirm: false,</span><br><span class="line">                    closeOnCancel: false</span><br><span class="line">                &#125;,</span><br><span class="line">                function (isConfirm) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isConfirm) &#123;</span><br><span class="line">                        $.ajax(&#123;</span><br><span class="line">                            url: <span class="string">&#x27;/app01/delete_book/&#x27;</span>,</span><br><span class="line">                            <span class="built_in">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">                            data: &#123;<span class="string">&#x27;id&#x27;</span>: book_id&#125;,</span><br><span class="line">                            success: function (data) &#123;</span><br><span class="line">                                swal(data.key, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">                                $del_id.parent().parent().remove()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        swal(<span class="string">&#x27;小怂逼,我就知道你不敢删&#x27;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">后端:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Delete_book</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        back_dict = &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;&#x27;</span>, &#125;  </span><br><span class="line">        <span class="keyword">if</span> request.is_ajax():</span><br><span class="line">            book_id = request.GET.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">            back_dict[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&#x27;你完了,赶紧跑路吧&#x27;</span></span><br><span class="line">            </span><br><span class="line">            models.Book.objects.<span class="built_in">filter</span>(pk=book_id).delete()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(back_dict)</span><br></pre></td></tr></table></figure>

<h3 id="7-批量插入数据"><a href="#7-批量插入数据" class="headerlink" title="7.批量插入数据"></a>7.批量插入数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bulk_create() 批量插入数据,括号内放可迭代对象</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">0</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">25</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">50</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">75</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 往book表中插入1万条书籍数据</span></span><br><span class="line">    <span class="comment"># 效率极低</span></span><br><span class="line">    <span class="comment"># for i in range(1,10001):</span></span><br><span class="line">    <span class="comment">#     models.Book.objects.create(title=&#x27;第%s本书&#x27;%i)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 批量插入</span></span><br><span class="line">    <span class="comment"># book_list = []</span></span><br><span class="line">    <span class="comment"># for i in range(1,10001):</span></span><br><span class="line">    <span class="comment">#     book_list.append(models.Book(title=&#x27;第%s本书&#x27;%i))</span></span><br><span class="line">    <span class="comment"># models.Book.objects.bulk_create(book_list) </span></span><br></pre></td></tr></table></figure>

<h3 id="8-自定义分页器"><a href="#8-自定义分页器" class="headerlink" title="8.自定义分页器"></a>8.自定义分页器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">只需要掌握课上推导思路即可 无需再过多研究</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">获取当前页码</span></span><br><span class="line"><span class="string">    current_page = request.GET.get(&#x27;page&#x27;,1)</span></span><br><span class="line"><span class="string">    current_page = int(current_page)</span></span><br><span class="line"><span class="string">    book_queryset = models.Book.objects.all()</span></span><br><span class="line"><span class="string">    all_count = book_queryset.count()</span></span><br><span class="line"><span class="string">    # 规定每页展示多少条数据</span></span><br><span class="line"><span class="string">    per_page_num = 10</span></span><br><span class="line"><span class="string">    page_num,more = divmod(all_count,per_page_num)</span></span><br><span class="line"><span class="string">    if more:</span></span><br><span class="line"><span class="string">        page_num += 1</span></span><br><span class="line"><span class="string">    html = &#x27;&#x27;</span></span><br><span class="line"><span class="string">    xxx = current_page</span></span><br><span class="line"><span class="string">    if current_page &lt;= 6:</span></span><br><span class="line"><span class="string">        xxx = 6</span></span><br><span class="line"><span class="string">    for i in range(xxx-5,xxx+6):</span></span><br><span class="line"><span class="string">        if i == current_page:</span></span><br><span class="line"><span class="string">            i = &#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;%(i,i)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            i = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;%(i,i)</span></span><br><span class="line"><span class="string">        html += i</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # 起始位置</span></span><br><span class="line"><span class="string">    start_page = (current_page - 1) * per_page_num</span></span><br><span class="line"><span class="string">    # 终止位置</span></span><br><span class="line"><span class="string">    end_page = current_page * per_page_num</span></span><br><span class="line"><span class="string">    # 查询数据并展示到前端页面</span></span><br><span class="line"><span class="string">    book_queryset = book_queryset[start_page:end_page]</span></span><br><span class="line"><span class="string">    return render(request, &#x27;home.html&#x27;, locals())</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="分页器"><a href="#分页器" class="headerlink" title="分页器"></a>分页器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pagination</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, current_page, all_count, per_page_num=<span class="number">2</span>, pager_count=<span class="number">11</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        封装分页相关数据</span></span><br><span class="line"><span class="string">        :param current_page: 当前页</span></span><br><span class="line"><span class="string">        :param all_count:    数据库中的数据总条数</span></span><br><span class="line"><span class="string">        :param per_page_num: 每页显示的数据条数</span></span><br><span class="line"><span class="string">        :param pager_count:  最多显示的页码个数</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.current_page = current_page</span><br><span class="line">        self.all_count = all_count</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 总页码</span></span><br><span class="line">        all_pager, tmp = <span class="built_in">divmod</span>(all_count, per_page_num)</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            all_pager += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">        self.all_pager = all_pager</span><br><span class="line">        self.pager_count = pager_count</span><br><span class="line">        self.pager_count_half = <span class="built_in">int</span>((pager_count - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_html</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 如果总页码 &lt; 11个：</span></span><br><span class="line">        <span class="keyword">if</span> self.all_pager &lt;= self.pager_count:</span><br><span class="line">            pager_start = <span class="number">1</span></span><br><span class="line">            pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 总页码  &gt; 11</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 当前页如果&lt;=页面上最多显示11/2个页码</span></span><br><span class="line">            <span class="keyword">if</span> self.current_page &lt;= self.pager_count_half:</span><br><span class="line">                pager_start = <span class="number">1</span></span><br><span class="line">                pager_end = self.pager_count + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 当前页大于5</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 页码翻到最后</span></span><br><span class="line">                <span class="keyword">if</span> (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line">                    pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">                    pager_start = self.all_pager - self.pager_count + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pager_start = self.current_page - self.pager_count_half</span><br><span class="line">                    pager_end = self.current_page + self.pager_count_half + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        page_html_list = []</span><br><span class="line">        <span class="comment"># 添加前面的nav和ul标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;nav aria-label=&#x27;Page navigation&#x27; class=&#x27;text-center&#x27;&gt;</span></span><br><span class="line"><span class="string">                    &lt;ul class=&#x27;pagination&#x27;&gt;</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        first_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (<span class="number">1</span>)</span><br><span class="line">        page_html_list.append(first_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &lt;= <span class="number">1</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page - <span class="number">1</span>,)</span><br><span class="line"></span><br><span class="line">        page_html_list.append(prev_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pager_start, pager_end):</span><br><span class="line">            <span class="keyword">if</span> i == self.current_page:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            page_html_list.append(temp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &gt;= self.all_pager:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page + <span class="number">1</span>,)</span><br><span class="line">        page_html_list.append(next_page)</span><br><span class="line"></span><br><span class="line">        last_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.all_pager,)</span><br><span class="line">        page_html_list.append(last_page)</span><br><span class="line">        <span class="comment"># 尾部添加标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                                           &lt;/nav&gt;</span></span><br><span class="line"><span class="string">                                           &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                                       &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(page_html_list)</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book</span>(<span class="params">request</span>):</span></span><br><span class="line">   book_list = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">   current_page = request.GET.get(<span class="string">&quot;page&quot;</span>,<span class="number">1</span>)</span><br><span class="line">   all_count = book_list.count()</span><br><span class="line">   page_obj = Pagination(current_page=current_page,all_count=all_count,per_page_num=<span class="number">10</span>)</span><br><span class="line">   page_queryset = book_list[page_obj.start:page_obj.end]</span><br><span class="line">   <span class="keyword">return</span> render(request,<span class="string">&#x27;booklist.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h5 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2&quot;&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">for</span> <span class="title">book</span> <span class="title">in</span> <span class="title">page_queryset</span> %&#125;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span>&gt;&#123;&#123; <span class="title">book</span>.<span class="title">title</span> &#125;&#125;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">endfor</span> %&#125;</span></span><br><span class="line"><span class="class">            &#123;&#123; <span class="title">page_obj</span>.<span class="title">page_html</span>|<span class="title">safe</span> &#125;&#125;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/29/cookie%E4%B8%8Esession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/29/cookie%E4%B8%8Esession/" class="post-title-link" itemprop="url">cookie与session</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-29 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-29T18:20:25+08:00">2019-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cookie与session"><a href="#cookie与session" class="headerlink" title="cookie与session"></a>cookie与session</h1><h3 id="1-cookie-session简介"><a href="#1-cookie-session简介" class="headerlink" title="1.cookie,session简介"></a>1.cookie,session简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议四大特性</span><br><span class="line">	<span class="number">1.</span>基于请求响应</span><br><span class="line">    <span class="number">2.</span>基于TCP、IP作用于应用层之上</span><br><span class="line">    <span class="number">3.</span>无连接</span><br><span class="line">    <span class="number">4.</span>无状态</span><br><span class="line">    	</span><br><span class="line">基于HTTP协议的通信无法记录客户端状态(无状态)</span><br><span class="line">但是现在很多软件都需要记录用户的状态 为了解决这个问题</span><br><span class="line">发明了cookie session等一系列的技术</span><br><span class="line"></span><br><span class="line">cookie</span><br><span class="line">	保存在客户端浏览器上面的键值对数据</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 浏览器保存用户的关键信息</span></span><br><span class="line"><span class="string">    以后访问的时候浏览器自动发送关键信息从而实现身份识别</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    关键型数据直接保存在浏览器上不安全</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> </span><br><span class="line">    </span><br><span class="line">session</span><br><span class="line">	保存在服务器上面的键值对数据(数据类型不固定)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 服务端返回给浏览器一个随机字符串</span></span><br><span class="line"><span class="string">    之后访问都将随机字符串发送给服务端</span></span><br><span class="line"><span class="string">    服务端内部做比对</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># session需要依赖于cookie才可以工作</span></span><br><span class="line">客户端浏览器可以保存服务端发送过来的cookie数据也可以选择拒绝</span><br></pre></td></tr></table></figure>

<h4 id="cookie操作"><a href="#cookie操作" class="headerlink" title="cookie操作"></a>cookie操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">视图函数返回的HttpResponse对象</span><br><span class="line"><span class="keyword">return</span> HttpResponse()</span><br><span class="line"><span class="keyword">return</span> render()</span><br><span class="line"><span class="keyword">return</span> redirect()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">obj = HttpResponse()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = render()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = redirect()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置cookie</span></span><br><span class="line">    obj = HttpResponse(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">    obj.set_cookie(key,value)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加盐(加密)</span></span><br><span class="line">	obj.set_signed_cookie(key,value,salt=<span class="string">&#x27;盐&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 获取cookie</span></span><br><span class="line">	request.COOKIES.get(key)</span><br><span class="line">    request.get_signed_cookie(key,salt=<span class="string">&#x27;盐&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 删除cookie</span></span><br><span class="line">	obj.delete_cookie(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有效时间</span></span><br><span class="line">    obj.set_cookie(key,value,max_age=<span class="number">3</span>,expires=<span class="number">3</span>)</span><br><span class="line">        max_age=<span class="number">3</span></span><br><span class="line">        expires=<span class="number">3</span></span><br><span class="line">            两者都是设置有效时间 并且都是以秒为单位</span><br><span class="line">            需要注意的是 针对IE浏览器需要使用expires</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">校验用户是否登录才能访问视图函数的装饰器</span></span><br><span class="line"><span class="string">	能够记住用户在没有登陆之前想要访问的页面 登录之后跳转到对应的页面</span></span><br><span class="line"><span class="string">    request.path()				# 仅获取url</span></span><br><span class="line"><span class="string">    request.path.info			# 仅获取url</span></span><br><span class="line"><span class="string">    request.get_full_path		# 获取url及问号后数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="session操作"><a href="#session操作" class="headerlink" title="session操作"></a>session操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.session是存储在服务器端的 django默认情况下是需要借助于django_session表来存储数据 也就意味着如果你想要操作session那么必须先执行数据库迁移命令让django先把django_session表创建出来(no such table:django_session)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.django默认的session有效时间是14天</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.session存储在服务端 可以有很多地方存储</span></span><br><span class="line"><span class="string">	1.表</span></span><br><span class="line"><span class="string">	2.文件</span></span><br><span class="line"><span class="string">	3.缓存</span></span><br><span class="line"><span class="string">	4.其他</span></span><br><span class="line"><span class="string">	...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置session:</span></span><br><span class="line">	request.session[<span class="string">&#x27;key&#x27;</span>] = value </span><br><span class="line">    </span><br><span class="line">    session设置时发生的事:</span><br><span class="line">        <span class="number">1.</span>django内部自动生成一个随机字符串</span><br><span class="line">        <span class="number">2.</span>django内部会将随机字符串和数据存入django_session表中</span><br><span class="line">        	<span class="number">2.1</span>先在内存中产生操作数据的缓存</span><br><span class="line">            <span class="number">2.2</span>在响应结果django中间件的时候才真正的操作sh<span class="string">u&#x27;ju&#x27;</span>ku</span><br><span class="line">        <span class="number">3.</span>将随机字符串返回给客户端浏览器保存</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 获取session:</span></span><br><span class="line">	request.session.get(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    session读取时发生的事:</span><br><span class="line">        <span class="number">1.</span>自动从客户端浏览器请求中获取sessionid对应的随机字符串</span><br><span class="line">        <span class="number">2.</span>拿着随机字符串去django_session表中查找数据比对</span><br><span class="line">        <span class="number">3.</span></span><br><span class="line">        	如果比对上了 则将对应的数据取出并以字典的形式封装到request.session中</span><br><span class="line">            如果比对不上 则request.session.get(key)返回的是<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 清除session:</span></span><br><span class="line">	request.session.delete()  		<span class="comment"># 只删服务端 客户端不删</span></span><br><span class="line"> 	request.session.flush()  		<span class="comment"># 客户端浏览器和服务端都删(推荐使用)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 设置有效时间</span></span><br><span class="line">    request.session.set_expiry(value)	</span><br><span class="line">    	括号内可以放四种类型参数</span><br><span class="line">        	<span class="number">1.</span>整数   						   多少秒</span><br><span class="line">            <span class="number">2.</span>datatime/timedelt(日期格式)	  到指定日期就失效</span><br><span class="line">            <span class="number">3.0</span> 				  			关闭当前浏览器就失效</span><br><span class="line">            <span class="number">4.</span>不写						   django内部session默认失效时间(<span class="number">14</span>天)</span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">django_session表中的数据是取决于浏览器的</span></span><br><span class="line"><span class="string">	同一个计算机上(IP地址)同一个浏览器只会有一条数据生效</span></span><br><span class="line"><span class="string">	(当session过期的时候可能会出现多条数据对应一个浏览器 但是该现象不会持续很久 内部会自动识别过期的数据清除 也可以通过代码清除)</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	主要是为了节省服务端数据库资源</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">103</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/04/Go%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/04/Go%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">Go开发环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-04 18:20:25" itemprop="dateCreated datePublished" datetime="2020-05-04T18:20:25+08:00">2020-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Go%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">Go语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Go开发环境搭建"><a href="#Go开发环境搭建" class="headerlink" title="Go开发环境搭建"></a>Go开发环境搭建</h1><h2 id="一-下载地址"><a href="#一-下载地址" class="headerlink" title="一 下载地址"></a><font color='red'>一 下载地址</font></h2><p><font color='blue'>安装包下载地址为：<a target="_blank" rel="noopener" href="https://golang.org/dl/%E3%80%82">https://golang.org/dl/。</a></font></p>
<p><font color='blue'>如果打不开可以使用这个地址：<a target="_blank" rel="noopener" href="https://golang.google.cn/dl/%E3%80%82">https://golang.google.cn/dl/。</a></font></p>
<p>各个系统对应的包名：</p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>包名</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>go1.13.3.windows-amd64.msi</td>
</tr>
<tr>
<td>Linux</td>
<td>go1.13.3.linux-amd64.tar.gz</td>
</tr>
<tr>
<td>Mac</td>
<td>go1.13.3.darwin-amd64.pkg</td>
</tr>
<tr>
<td>FreeBSD</td>
<td>go1.13.3.freebsd-amd64.tar.gz</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://tva1.sinaimg.cn/large/006y8mN6gy1g88akvb3mgj31im0dimzn.jpg"><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g88akvb3mgj31im0dimzn.jpg" alt="image-20191023180544174"></a></p>
<h2 id="二-安装"><a href="#二-安装" class="headerlink" title="二 安装"></a><font color='red'>二 安装</font></h2><h3 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h3><p><font color='red'>1、下载二进制包：go1.13.3.linux-amd64.tar.gz</font></p>
<p><font color='red'>2、将下载的二进制包解压至 /usr/local目录。</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -C /usr/local -xzf go1.13.3.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p><font color='red'>3、将 /usr/local/go/bin 目录添加至PATH环境变量：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/go/bin</span><br></pre></td></tr></table></figure>

<h3 id="Windows安装"><a href="#Windows安装" class="headerlink" title="Windows安装"></a><font color='red'>Windows安装</font></h3><p>Windows 下可以使用 .msi 后缀(在下载列表中可以找到该文件，如go1.13.3.windows-amd64.msi)的安装包来安装。</p>
<p>默认情况下 <strong>.msi</strong> 文件会安装在 <strong>c:\Go</strong> 目录下。你可以将 <strong>c:\Go\bin</strong> 目录添加到 <strong>Path</strong> 环境变量中。添加后你需要重启命令窗口才能生效</p>
<h3 id="Mac安装"><a href="#Mac安装" class="headerlink" title="Mac安装"></a><font color='red'>Mac安装</font></h3><p>Mac下直接双击go1.13.3.darwin-amd64.pkg，一路下一步安装即可</p>
<h2 id="三-测试安装"><a href="#三-测试安装" class="headerlink" title="三 测试安装"></a><font color='red'>三 测试安装</font></h2><p><font color='red'>1、创建工作目录 <strong>C:&gt;Go_Project</strong>。</font></p>
<p><font color='red'>2、 创建文件test.go,写入如下代码</font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color='red'>3、打开cmd，切换目录到C:&gt;Go_Project下，执行如下命令：</font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> run test.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<p><font color='red'>看到打印结果：</font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>

<h2 id="四-命令介绍"><a href="#四-命令介绍" class="headerlink" title="四 命令介绍"></a><font color='red'>四 命令介绍</font></h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>直接在终端中输入 <code>go help</code> 即可显示所有的 go 命令以及相应命令功能简介，主要有下面这些:</p>
<ul>
<li>build: 编译包和依赖</li>
<li>clean: 移除对象文件</li>
<li>doc: 显示包或者符号的文档</li>
<li>env: 打印go的环境信息</li>
<li>bug: 启动错误报告</li>
<li>fix: 运行go tool fix</li>
<li>fmt: 运行gofmt进行格式化</li>
<li>generate: 从processing source生成go文件</li>
<li>get: 下载并安装包和依赖</li>
<li>install: 编译并安装包和依赖</li>
<li>list: 列出包</li>
<li>run: 编译并运行go程序</li>
<li>test: 运行测试</li>
<li>tool: 运行go提供的工具</li>
<li>version: 显示go的版本</li>
<li>vet: 运行go tool vet</li>
</ul>
<h3 id="build-和-run-命令"><a href="#build-和-run-命令" class="headerlink" title="build 和 run 命令"></a>build 和 run 命令</h3><p>就像其他静态类型语言一样，要执行 go 程序,需要先编译，然后在执行产生的可执行文件。<code>go build</code> 命令就是用来编译 go程序生成可执行文件的。但并不是所以的 go 程序都可以编译生成可执行文件的, 要生成可执行文件，go程序需要满足两个条件:</p>
<ul>
<li>该go程序需要属于main包</li>
<li>在main包中必须还得包含main函数</li>
</ul>
<p>也就是说go程序的入口就是 <code>main.main</code>, 即main包下的main函数,　例子(test.go):</p>
<p>编译hello.go,然后运行可执行程序:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run test.go   # 将会生成可执行文件 test</span><br><span class="line">$ ./test           # 运行可执行文件</span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>

<p>上面就是 go build 的基本用法，另外如果使用 go build 编译的不是一个可执行程序，而是一个包，那么将不会生成可执行文件。</p>
<p>而 <code>go run</code> 命令可以将上面两步并为一步执行(不会产生中间文件)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run test.go</span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>

<p>上面两个命令都是在开发中非常常用的。</p>
<p>此外 go clean 命令，可以用于将清除产生的可执行程序:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go clean    # 不加参数，可以删除当前目录下的所有可执行文件</span><br><span class="line">$ go clean hello.go  # 会删除对应的可执行文件</span><br></pre></td></tr></table></figure>

<h2 id="get-命令"><a href="#get-命令" class="headerlink" title="get 命令"></a><font color='red'>get 命令</font></h2><p>这个命令同样也是很常用的，我们可以使用它来下载并安装第三方包, 使用方式:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get src</span><br></pre></td></tr></table></figure>

<p>从指定源上面下载或者更新指定的代码和依赖，并对他们进行编译和安装，例如我们想使用 beego 来开发web应用，我们首先就需要获取 beego:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/astaxie/beego</span><br></pre></td></tr></table></figure>

<p>这条命令将会自动下载安装 beego 以及它的依赖，然后我们就可以使用下面的方式使用:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/astaxie/beego&quot;</span>   # 这里需要使用 src 下的完整路径</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    beego.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/03/Go%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/03/Go%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">Go语言介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-03 18:20:25" itemprop="dateCreated datePublished" datetime="2020-05-03T18:20:25+08:00">2020-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Go%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">Go语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Go语言介绍"><a href="#Go语言介绍" class="headerlink" title="Go语言介绍"></a>Go语言介绍</h1><h2 id="Go语言介绍-1"><a href="#Go语言介绍-1" class="headerlink" title="Go语言介绍"></a>Go语言介绍</h2><p><img src="https://img2018.cnblogs.com/blog/1825659/201910/1825659-20191023175923306-409864979.jpg" alt="img"></p>
<p>Go 即Golang，是Google公司2009年11月正式对外公开的一门编程语言。</p>
<p>Go是静态强类型语言，是区别于解析型语言的编译型语言。</p>
<p>解析型语言——源代码是先翻译为中间代码，然后由解析器对代码进行解释执行。</p>
<p>编译型语言——源代码编译生成机器语言，然后由机器直接执行机器码即可执行。</p>
<h2 id="Go语言特性"><a href="#Go语言特性" class="headerlink" title="Go语言特性"></a>Go语言特性</h2><p>跨平台的编译型语言</p>
<p>语法接近C语言</p>
<p>管道（channel），切片（slice），并发（routine）</p>
<p>有垃圾回收的机制</p>
<p>支持面向对象和面向过程的编程模式</p>
<h2 id="Go语言发展（版本-特性）"><a href="#Go语言发展（版本-特性）" class="headerlink" title="Go语言发展（版本/特性）"></a>Go语言发展（版本/特性）</h2><p>2009年11月7日 weekly.2009-11-06 —— 早期的版本</p>
<p>2012年3月28日 go1 —— 稳定版版的发布</p>
<p>2013年5月14日 go1.1 —— 语言本身的变化、库的变化等。</p>
<p>2013年12月01日 go1.2 —— 提供更好的调度和一个新的语言特性。</p>
<p>2014年6月18日 go1.3 —— 主要是在实现的工作上的变化，以及精准的垃圾回收。</p>
<p>2014年12月10日 go1.4 —— 包含了2个很小的语言变更。</p>
<p>2015年8月19日 go1.5 —— 实现的架构变化，同时保留了和旧版本的兼容性。</p>
<p>2016年2月7日 go1.6 —— 语言本身、运行时、和库的实现的变化。</p>
<p>2016年8月15日 go1.7 —— 标准库有显着的性能改进和变化。</p>
<p>2017年2月26日 go1.8 —— 标准库有显着的性能改进和变化。</p>
<p>2017年8月24日 go1.9 —— 是包含语言，标准库，以及运行时的诸多变化。这个版本中的大部分工作都是对运行时和工具的改进。</p>
<p>2018年2月16日 go1.10 —— 大部分更改都在工具链，运行时和库的实现中。</p>
<p>2018年8月24日 go1.11 —— modules和WebAssembly支持。</p>
<h2 id="Go语言应用"><a href="#Go语言应用" class="headerlink" title="Go语言应用"></a>Go语言应用</h2><h3 id="谁在用"><a href="#谁在用" class="headerlink" title="谁在用"></a>谁在用</h3><h4 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h4><p>这个不用多做介绍，作为开发Go语言的公司，当仁不让。Google基于Go有很多优秀的项目，比如：<a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes">https://github.com/kubernetes/kubernetes</a> ，大家也可以在Github上 <a target="_blank" rel="noopener" href="https://github.com/google/">https://github.com/google/</a> 查看更多Google的Go开源项目。</p>
<h4 id="Facebook"><a href="#Facebook" class="headerlink" title="Facebook"></a>Facebook</h4><p>Facebook也在用，为此他们还专门在Github上建立了一个开源组织facebookgo，大家可以通过<a target="_blank" rel="noopener" href="https://github.com/facebookgo%E8%AE%BF%E9%97%AE%E6%9F%A5%E7%9C%8Bfacebook%E5%BC%80%E6%BA%90%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8C%E6%AF%94%E5%A6%82%E8%91%97%E5%90%8D%E7%9A%84%E6%98%AF%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7%E7%9A%84grace%E3%80%82">https://github.com/facebookgo访问查看facebook开源的项目，比如著名的是平滑升级的grace。</a></p>
<h4 id="腾讯"><a href="#腾讯" class="headerlink" title="腾讯"></a>腾讯</h4><p>腾讯作为国内的大公司，还是敢于尝试的，尤其是Docker容器化这一块，他们在15年已经做了docker万台规模的实践，具体可以参考<a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/tencent-millions-scale-docker-application-practice">http://www.infoq.com/cn/articles/tencent-millions-scale-docker-application-practice</a> 。</p>
<p>主要职责是：</p>
<p>负责腾讯游戏蓝鲸平台后台开发工作<br>负责容器相关的开发工作</p>
<p>和蓝鲸平台，容器开发有关。腾讯作为主要使用C/C++的公司，使用Go会方便很多，也有很多优势，不过日积月累的C/C++代码很难改造，也不敢动，所以新业务会在Go方面尝试。</p>
<h4 id="百度"><a href="#百度" class="headerlink" title="百度"></a>百度</h4><p>目前所知的百度的使用是在运维这边，是百度运维的一个BFE项目，负责前端流量的接入。他们的负责人在2016年有分享，大家可以看下这个 <a target="_blank" rel="noopener" href="http://www.infoq.com/cn/presentations/application-of-golang-in-baidu-frontend">http://www.infoq.com/cn/presentations/application-of-golang-in-baidu-frontend</a> .</p>
<p>其次就是百度的消息系统，从其最近的Golang招聘介绍就可以看出来.</p>
<p>负责公司手百消息通讯系统服务器端开发及维护</p>
<h4 id="京东"><a href="#京东" class="headerlink" title="京东"></a>京东</h4><p>京东云消息推送系统、云存储，以及京东商城等都有使用Go做开发。</p>
<h4 id="小米"><a href="#小米" class="headerlink" title="小米"></a>小米</h4><p>小米对Golang的支持，莫过于运维监控系统的开源，也就是 <a target="_blank" rel="noopener" href="http://open-falcon.com/">http://open-falcon.com/</a> 。</p>
<p>此外，小米互娱、小米商城、小米视频、小米生态链等团队都在使用Golang。</p>
<h4 id="360"><a href="#360" class="headerlink" title="360"></a>360</h4><p>360对Golang的使用也不少，一个是开源的日志搜索系统Poseidon，托管在Github上，<a target="_blank" rel="noopener" href="https://github.com/Qihoo360/poseidon">https://github.com/Qihoo360/poseidon</a>.</p>
<p>还有360的推送团队也在使用，他们还写了篇博文在Golang的官方博客上 <a target="_blank" rel="noopener" href="https://blog.golang.org/qihoo%E3%80%82">https://blog.golang.org/qihoo。</a></p>
<p>360直播在招聘Golang开发工程师。</p>
<p>美团、滴滴、新浪以及七牛等。一般的选择，都是选择用于自己公司合适的产品系统来做，比如消息推送的、监控的、容器的等，Golang特别适合做网络并发的服务，这是他的强项，所以也是被优先用于这些项目。</p>
<h3 id="应用领域"><a href="#应用领域" class="headerlink" title="应用领域"></a>应用领域</h3><p>服务开发、并发、分布式、微服务等方向</p>
<h2 id="Go语言项目"><a href="#Go语言项目" class="headerlink" title="Go语言项目"></a>Go语言项目</h2><p>docker:基于lxc的一个虚拟打包工具，能够实现PAAS平台的组建。</p>
<p>kubernetes ：Kubernetes是Google开源的一个容器编排引擎，它支持自动化部署、大规模可伸缩、应用容器化管理。在生产环境中部署一个应用程序时，通常要部署该应用的多个实例以便对应用请求进行负载均衡</p>
<p>区块链：BTCD 是用go语言实现的完整节点的比特币实现</p>
<p>nsq：bitly开源的消息队列系统，性能非常高，目前他们每天处理数十亿条的消息</p>
<p>packer:用来生成不同平台的镜像文件，例如VM、vbox、AWS等，作者是vagrant的作者</p>
<p>skynet：分布式调度框架</p>
<p>Doozer：分布式同步工具，类似ZooKeeper</p>
<p>Heka：mazila开源的日志处理系统</p>
<p>cbfs：couchbase开源的分布式文件系统</p>
<p>tsuru：开源的PAAS平台，和SAE实现的功能一模一样</p>
<p>groupcache：memcahe作者写的用于Google下载系统的缓存系统</p>
<p>god：类似redis的缓存系统，但是支持分布式和扩展性</p>
<p>gor：网络流量抓包和重放工具</p>
<h2 id="Go语架构"><a href="#Go语架构" class="headerlink" title="Go语架构"></a>Go语架构</h2><p>GOPATH的工作区包含bin，src，和pkg这三个：</p>
<p>src——源码（包含第三方的和自己项目的）</p>
<p>bin——编译生成的可执行程序</p>
<p>pkg——编译时生成的对象文件</p>
<h2 id="Go语言发展前景"><a href="#Go语言发展前景" class="headerlink" title="Go语言发展前景"></a>Go语言发展前景</h2><p>Go语言将登上语言榜前列，与C和Java并列前三甲</p>
<p>Go语言称霸云计算</p>
<p>Go将统治下一个10年</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/04/18/Git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/18/Git/" class="post-title-link" itemprop="url">Git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-18 18:20:25" itemprop="dateCreated datePublished" datetime="2020-04-18T18:20:25+08:00">2020-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Git%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">Git相关</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><h2 id="1-git介绍"><a href="#1-git介绍" class="headerlink" title="1.git介绍"></a>1.git介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常见git相关软件有git，github，gitee，gitlab等等</span></span><br><span class="line">	-git：一种版本管理软件</span><br><span class="line">    -github：网站,全球开源代码,放在上面,我们可以看到并下载 --&gt; 本质其实是一个git的远程仓库</span><br><span class="line">    -gitee：<span class="string">&#x27;中国版&#x27;</span>的github,公有,私有(中小型公司的代码放在私有仓库中)</span><br><span class="line">    -gitlab：公司内部的(公司内部的github)</span><br><span class="line">   </span><br><span class="line"><span class="comment"># git作用:</span></span><br><span class="line">	该软件实现了版本控制,协同开发(多人合作开发),合并代码等等</span><br></pre></td></tr></table></figure>

<h2 id="2-git安装"><a href="#2-git安装" class="headerlink" title="2.git安装"></a>2.git安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>官网:</span><br><span class="line">	https://git-scm.com/download/win</span><br><span class="line">	无脑安装,一路下一步</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>安装完成后桌面任意位置,鼠标右键,会看到:</span><br><span class="line">	git gui here 	<span class="comment"># 图形化界面</span></span><br><span class="line">    git bash here	<span class="comment"># 命令行(常用)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 与git类似的软件还有svn,两则区别:</span></span><br><span class="line">	-git的版本管理不需要服务端(远程仓库)</span><br><span class="line">    -svn要进行版本管理,必须有服务端(服务器宕机就完蛋)</span><br></pre></td></tr></table></figure>

<h4 id="Git和Svn图解"><a href="#Git和Svn图解" class="headerlink" title="Git和Svn图解"></a><strong>Git和Svn图解</strong></h4><p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210722172456713.png" alt="image-20210722172456713"></p>
<p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210722172509006.png" alt="image-20210722172509006"></p>
<h2 id="3-git相关图解"><a href="#3-git相关图解" class="headerlink" title="3.git相关图解"></a>3.git相关图解</h2><p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210722172848576.png" alt="image-20210722172848576"></p>
<p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210722172701013.png" alt="image-20210722172701013"></p>
<p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210722172713277.png" alt="image-20210722172713277"></p>
<h3 id="流程-核心总结"><a href="#流程-核心总结" class="headerlink" title="流程(核心总结)"></a>流程(核心总结)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git工作流程核心总结:</span></span><br><span class="line">	<span class="number">1.</span>有红色信息(工作区有内容),可以执行 add </span><br><span class="line">	<span class="number">2.</span>全绿信息(内容全部在暂存区),才可以执行 commit</span><br><span class="line">	<span class="number">3.</span>只有被版本库控制的代码,才能被监听,可以回滚到任何一个版本</span><br></pre></td></tr></table></figure>

<h2 id="4-git常用命令"><a href="#4-git常用命令" class="headerlink" title="4.git常用命令"></a>4.git常用命令</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git分为三个区:</span></span><br><span class="line">	工作区(写代码的地方)</span><br><span class="line">	暂存区(临时存储代码的地方)</span><br><span class="line">	版本库()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在提交到版本库之前,要先配置用户信息</span></span><br><span class="line">    	全局配置(记录在用户家路径.gitconfig内):</span><br><span class="line">            git config --<span class="keyword">global</span> user.email <span class="string">&quot;306334678@qq.com&quot;</span></span><br><span class="line">            git config --<span class="keyword">global</span> user.name <span class="string">&quot;liuqingzheng&quot;</span></span><br><span class="line">            </span><br><span class="line">    	局部配置(记录在仓库.git文件夹下的config内)</span><br><span class="line">            git config user.email <span class="string">&quot;33@qq.com&quot;</span></span><br><span class="line">            git config user.name <span class="string">&quot;egon&quot;</span></span><br><span class="line">     </span><br><span class="line"> <span class="comment"># git常用命令:</span></span><br><span class="line">	git init   	<span class="comment"># 初始化仓库,在当前路径下生成一个.git文件夹,隐藏的</span></span><br><span class="line">    git add .   <span class="comment"># 把工作区的更该(.表示当前路径下所有更改,都提交),提交到暂存区</span></span><br><span class="line">    git status  <span class="comment"># 查看文件状态(绿色表示在暂存区,不在版本库,红色表示工作区更改了,没有提交到暂存区）</span></span><br><span class="line">    git reset . <span class="comment"># 把提交到暂存区的，拉回到工作区(以后基本不用)</span></span><br><span class="line">    git commit -m <span class="string">&#x27;注释&#x27;</span>   <span class="comment"># 把暂存区的所有内容,提交到版本库</span></span><br><span class="line">    git log   	<span class="comment"># 查看版本提交的日志（谁提交的，提交时间，提交的版本号）</span></span><br><span class="line">	git reflog 	<span class="comment"># 查看版本提交的日志</span></span><br><span class="line">    git reset --hard 74c071f922  <span class="comment">#工作区的内容回退到 74c071f922 版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">	空文件夹,不会被git管理,python中包会(包有__init__.py)</span><br></pre></td></tr></table></figure>

<h2 id="5-git过滤文件"><a href="#5-git过滤文件" class="headerlink" title="5.git过滤文件"></a>5.git过滤文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在仓库目录下新建.gitignore文件,并在文件中写入要忽略的文件,文件夹,模糊匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line">	文件或文件夹名		<span class="comment"># 代表所有目录下的同名文件或文件夹都被过滤</span></span><br><span class="line">	/文件或文件夹名	<span class="comment"># 代表仓库根目录下的文件或文件夹被过滤</span></span><br><span class="line"></span><br><span class="line">    eg:</span><br><span class="line">        a.txt：项目中所有a.txt文件和文件夹都会被过滤</span><br><span class="line">        /a.txt：项目中只有根目录下a.txt文件和文件夹会被过滤</span><br><span class="line">        /b/a.txt：项目中只有根目录下的b文件夹下的a.txt文件和文件夹会被过滤</span><br><span class="line">        *x*：名字中有一个x的都会被过滤（*代表<span class="number">0</span>~n个任意字符）</span><br><span class="line">        空文件夹不会被提交了,空包会被提交,包中有一个init空文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># pycharm软件</span></span><br><span class="line">	-绿色		<span class="comment"># 在暂存区，没有提交到版本库</span></span><br><span class="line">	-红色		<span class="comment"># 在工作区新增，没有提交到暂存区</span></span><br><span class="line">	-蓝色		<span class="comment"># 在工作区修改的，没有提交到暂存区</span></span><br><span class="line">	-黄色		<span class="comment"># 忽略的文件</span></span><br><span class="line">	-白色		<span class="comment"># 已经被git管理的</span></span><br></pre></td></tr></table></figure>

<h2 id="6-git分支操作"><a href="#6-git分支操作" class="headerlink" title="6.git分支操作"></a>6.git分支操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">    git branch 分支名</span><br><span class="line">    git checkout -b 分支名   <span class="comment"># 创建并切换到新分支</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line">	git checkout dev</span><br><span class="line">    </span><br><span class="line"><span class="comment">#查看分支</span></span><br><span class="line">	git branch</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除分支</span></span><br><span class="line">	git branch -d 分支名</span><br><span class="line"></span><br><span class="line"><span class="comment">#合并分支</span></span><br><span class="line">	git merge 分支名 <span class="comment"># 将dev分支合并到master分支:切换到master分支,执行合并dev分支的命令(细心)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 分支合并可能会出冲突</span></span><br><span class="line">	<span class="number">1.</span>文件夹重复</span><br></pre></td></tr></table></figure>

<h2 id="7-git-远程仓库"><a href="#7-git-远程仓库" class="headerlink" title="7.git 远程仓库"></a>7.git 远程仓库</h2><h3 id="7-1使用用户名密码连接"><a href="#7-1使用用户名密码连接" class="headerlink" title="7.1使用用户名密码连接"></a>7.1使用用户名密码连接</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在 gitee上新建空仓库</span><br><span class="line"><span class="number">2.</span>luffy_api中</span><br><span class="line">	-git init</span><br><span class="line">    -git add .</span><br><span class="line">    -git commit -m <span class="string">&#x27;第一次提交&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># git remote add 名字 远程仓库地址</span></span><br><span class="line">    -git remote add origin https://gitee.com/liuqingzheng/luffy_api.git  <span class="comment"># 增加远程仓库</span></span><br><span class="line">	<span class="comment"># git push 远程仓库名字 分支名字</span></span><br><span class="line">    -git push origin master  <span class="comment"># 把本地版本库内容，提交到远程仓库，需要输入giee的用户名密码</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>远程仓库操作</span><br><span class="line">	-增加</span><br><span class="line">    	-git remote add 名字 远程仓库地址</span><br><span class="line">    -查看</span><br><span class="line">    	-git remote</span><br><span class="line">    -删除</span><br><span class="line">    	-git remote remove origin</span><br><span class="line">    -提交到远程仓库</span><br><span class="line">    	-git push origin master</span><br></pre></td></tr></table></figure>

<h3 id="7-2采用ssh协议连接远程"><a href="#7-2采用ssh协议连接远程" class="headerlink" title="7.2采用ssh协议连接远程"></a>7.2采用ssh协议连接远程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.https方式：使用用户名+密码认证方式</span><br><span class="line">2.ssh方式：公钥私钥方式</span><br><span class="line">	 -本地生成公钥私钥</span><br><span class="line">    	-https://gitee.com/profile/sshkeys</span><br><span class="line">        -cmd窗口中：ssh-keygen -t rsa -C &quot;306334678@qq.com&quot;</span><br><span class="line">        -生成到用户家路径的 .ssh文件夹下</span><br><span class="line">        -id_rsa      # 私钥</span><br><span class="line">        -id_rsa.pub  # 公钥</span><br><span class="line">     -把公钥配置到gitee上</span><br><span class="line">     -以后再提交代码就不需要输入用户名密码了</span><br><span class="line">        -重新配置远程仓库</span><br><span class="line">       		git remote add origin git@gitee.com:liuqingzheng/luffy_api.git</span><br><span class="line">        	git push origin master  # 选yes</span><br></pre></td></tr></table></figure>

<h2 id="8-项目创始者和项目开发者"><a href="#8-项目创始者和项目开发者" class="headerlink" title="8.项目创始者和项目开发者"></a>8.项目创始者和项目开发者</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.项目开发者,需要把代码clone到本地</span><br><span class="line">	-git clone https://gitee.com/liuqingzheng/luffy_api.git</span><br><span class="line">    -修改代码</span><br><span class="line">    -提交到远程</span><br><span class="line">    	git push origin master</span><br><span class="line">2.项目创始者</span><br><span class="line">	-需要远程新建仓库</span><br><span class="line">	-本地代码push上去</span><br></pre></td></tr></table></figure>

<h2 id="9-协同开发"><a href="#9-协同开发" class="headerlink" title="9.协同开发"></a>9.协同开发</h2><h3 id="9-1协同开发介绍及冲突问题"><a href="#9-1协同开发介绍及冲突问题" class="headerlink" title="9.1协同开发介绍及冲突问题"></a>9.1协同开发介绍及冲突问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>管理员，开发者（<span class="number">10</span>开发者）</span><br><span class="line">	-能提交代码（能增删查改代码）</span><br><span class="line"><span class="number">2.</span>有一个开发者提交了代码</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>另一个开发者，在提交之前，必须先拉取代码(让你本地保持最新)</span><br><span class="line">	git pull origin master</span><br><span class="line">    可能会出冲突，解决冲突，再提交</span><br><span class="line">      </span><br><span class="line"><span class="number">4</span> 冲突(多人在同一个分支开发，导致冲突)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD  # 冲突的开始</span></span><br><span class="line"><span class="string">    # 自己的代码</span></span><br><span class="line"><span class="string">    =======  # 分割线</span></span><br><span class="line"><span class="string">    # 别人的代码</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt;&gt;&gt;&gt;&gt; b63c408abd05b87fc492d40523240561999dba50  # 冲突的结束(版本)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 冲突解决：</span></span><br><span class="line">	-改同样的功能出现的冲突，看一下谁的代码更好，保留好代码，删除不好代码</span><br><span class="line">    -改的不是同样的功能出现了冲突，留着两个人的</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 避免冲突</span></span><br><span class="line">	-没事就拉一下代码(*****)</span><br></pre></td></tr></table></figure>

<h3 id="9-2线上分支合并"><a href="#9-2线上分支合并" class="headerlink" title="9.2线上分支合并"></a>9.2线上分支合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>本地和远端分支</span><br><span class="line">	<span class="comment"># 本地建立分支，同步到远端</span></span><br><span class="line">    	-git branch dev</span><br><span class="line">        -git push origin dev</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 远端建立分支，同步到本地</span></span><br><span class="line">    	-远端建立分支</span><br><span class="line">        -git pull origin dev</span><br><span class="line">        -git branch   <span class="comment"># 看不到</span></span><br><span class="line">        -git checkout dev  <span class="comment">#切到dev分支，本地就能看到了</span></span><br><span class="line">              </span><br><span class="line"><span class="number">2.</span>提一个pr：pull request，分支合并的请求</span><br><span class="line"><span class="number">3.</span>领导点审核通过，测试通过：合并分支，扁平化合并</span><br><span class="line">	-git 变基（git rebase）</span><br><span class="line">    </span><br><span class="line"><span class="number">4.</span>远端：dev分支代码和master分支代码完全一致</span><br></pre></td></tr></table></figure>

<h3 id="9-3本地分支合并推送到远程"><a href="#9-3本地分支合并推送到远程" class="headerlink" title="9.3本地分支合并推送到远程"></a>9.3本地分支合并推送到远程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>由于dev分支和master分支合并时，有冲突，就不能自动合并了，我们需要本地合并完，解决冲突，再提交</span><br><span class="line"><span class="number">2.</span>把dev合并到master</span><br><span class="line">	-git checkout master</span><br><span class="line">    -git merge dev</span><br><span class="line">    -有冲突，解决冲突</span><br><span class="line">    -再提交</span><br><span class="line">      </span><br><span class="line"><span class="number">3.</span>本地的分支提交到远端分支(如果名字不一样)</span><br><span class="line">	git push origin dev111:dev222  <span class="comment"># 尽量不要做</span></span><br></pre></td></tr></table></figure>

<h3 id="9-4-pycharm操作git"><a href="#9-4-pycharm操作git" class="headerlink" title="9.4 pycharm操作git"></a>9.4 pycharm操作git</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 git clone 地址</span><br><span class="line">详情见视频</span><br></pre></td></tr></table></figure>

<h2 id="10-企业git使用流程"><a href="#10-企业git使用流程" class="headerlink" title="10.企业git使用流程"></a>10.企业git使用流程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>领导给你一个git地址，git clone下来，pycharm打开，本地把代码运行起来</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>你改bug，提交，提交不上去</span><br><span class="line">	-需要有一个gitlab账号（你去注册一个，别人帮你注册好了）</span><br><span class="line">    -公司会把你的账号，添加到项目的开发者</span><br><span class="line">    -ssh操作：本地生成公钥私钥，自己配置在gitlab上</span><br><span class="line">    -把你的公钥给管这个东西的人（一般不做）</span><br><span class="line"><span class="number">3.</span>使用pycharm操作，提交即可</span><br><span class="line">	-勤拉代码</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/18/selenium%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/18/selenium%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">selenium的使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-18 18:20:25" itemprop="dateCreated datePublished" datetime="2019-10-18T18:20:25+08:00">2019-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="selenium的使用"><a href="#selenium的使用" class="headerlink" title="selenium的使用"></a>selenium的使用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果使用requests模块，发送请求获取的数据不全，它不能执行js</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># selenium:可以使用代码控制模拟人操作浏览器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 操作某个浏览器，就需要有浏览器驱动</span></span><br><span class="line"><span class="comment"># http://npm.taobao.org/mirrors/chromedriver/  谷歌驱动的淘宝镜像站</span></span><br><span class="line"><span class="comment"># 谷歌浏览器版本要跟驱动版本对应</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 92.0.4515.131  下载相应版本驱动，放到项目代码中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip3 install selenium</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># from selenium import webdriver</span></span><br><span class="line"><span class="comment"># import time</span></span><br><span class="line"><span class="comment"># # 打开一个谷歌浏览器</span></span><br><span class="line"><span class="comment"># bro=webdriver.Chrome(executable_path=&#x27;chromedriver.exe&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># #地址栏中输入百度</span></span><br><span class="line"><span class="comment"># bro.get(&#x27;https://www.cnblogs.com/&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># time.sleep(2)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(bro.page_source)  #当前页面的html内容</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># bro.close()  # 关闭浏览器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;https://dig.chouti.com/&#x27;,headers=&#123;</span></span><br><span class="line"><span class="comment">#     &#x27;User-Agent&#x27;:&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line"><span class="comment"># &#125;)</span></span><br><span class="line"><span class="comment"># print(res.text)</span></span><br></pre></td></tr></table></figure>

<h2 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1.基本使用"></a>1.基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器对象</span></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">bro.implicitly_wait(<span class="number">10</span>)  <span class="comment"># 隐士等待，去找控件，如果没有会等10s</span></span><br><span class="line"></span><br><span class="line">bro.get(<span class="string">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub_button=bro.find_element_by_css_selector(&#x27;#s-top-loginbtn&#x27;)</span></span><br><span class="line"><span class="comment"># 选中(如果有id，优先用它)</span></span><br><span class="line">sub_button = bro.find_element_by_id(<span class="string">&#x27;s-top-loginbtn&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击</span></span><br><span class="line">sub_button.click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到用户名密码登录</span></span><br><span class="line">user_btn = bro.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;TANGRAM__PSP_11__footerULoginBtn&quot;]&#x27;</span>)</span><br><span class="line"><span class="comment"># user_btn=bro.find_element_by_id(&#x27;TANGRAM__PSP_11__footerULoginBtn&#x27;)</span></span><br><span class="line">user_btn.click()</span><br><span class="line"></span><br><span class="line">username = bro.find_element_by_id(<span class="string">&#x27;TANGRAM__PSP_11__userName&#x27;</span>)</span><br><span class="line">password = bro.find_element_by_id(<span class="string">&#x27;TANGRAM__PSP_11__password&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 往输入框中写东西</span></span><br><span class="line">username.send_keys(<span class="string">&#x27;6666666@qq.com&#x27;</span>)</span><br><span class="line">password.send_keys(<span class="string">&#x27;lqz12345&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sumbit_btn = bro.find_element_by_id(<span class="string">&#x27;TANGRAM__PSP_11__submit&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">sumbit_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">bro.close()</span><br></pre></td></tr></table></figure>

<h2 id="2-无头浏览器"><a href="#2-无头浏览器" class="headerlink" title="2.无头浏览器"></a>2.无头浏览器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;window-size=1920x3000&#x27;</span>) <span class="comment">#指定浏览器分辨率</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>) <span class="comment">#谷歌文档提到需要加上这个属性来规避bug</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--hide-scrollbars&#x27;</span>) <span class="comment">#隐藏滚动条, 应对一些特殊页面</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;blink-settings=imagesEnabled=false&#x27;</span>) <span class="comment">#不加载图片, 提升速度</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--headless&#x27;</span>) <span class="comment">#浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>,chrome_options=chrome_options)</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(driver.page_source)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>

<h2 id="3-获取元素位置-属性-大小"><a href="#3-获取元素位置-属性-大小" class="headerlink" title="3.获取元素位置,属性,大小"></a>3.获取元素位置,属性,大小</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">driver=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;https://kyfw.12306.cn/otn/resources/login.html&#x27;</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">user_login=driver.find_element_by_css_selector(<span class="string">&#x27;.login-hd-account&gt;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">user_login.click()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">img=driver.find_element_by_id(<span class="string">&#x27;J-loginImg&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(img.<span class="built_in">id</span>)    <span class="comment">#selenium提供的id，忽略</span></span><br><span class="line"><span class="built_in">print</span>(img.tag_name) <span class="comment"># 标签名</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-----&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img.location) <span class="comment"># img标签的位置</span></span><br><span class="line"><span class="built_in">print</span>(img.size)     <span class="comment"># img标签大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取属性</span></span><br><span class="line"><span class="comment"># print(img.get_attribute(&#x27;src&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(img.get_attribute(<span class="string">&#x27;class&#x27;</span>))</span><br><span class="line"></span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>

<h2 id="4-等待元素被加载"><a href="#4-等待元素被加载" class="headerlink" title="4.等待元素被加载"></a>4.等待元素被加载</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两种等待方式</span></span><br><span class="line">	显示等待</span><br><span class="line">	隐式等待：只需要写一句话，等待所有要获取的标签</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 两种等待方式</span></span><br><span class="line"><span class="string"># 显示等待(忽略掉)</span></span><br><span class="line"><span class="string">    wait=WebDriverWait(driver,10)</span></span><br><span class="line"><span class="string">    wait.until(EC.presence_of_element_located((By.ID,&#x27;content_left&#x27;)))</span></span><br><span class="line"><span class="string">    contents=browser.find_element(By.CSS_SELECTOR,&#x27;#content_left&#x27;)</span></span><br><span class="line"><span class="string"># 隐式等待：</span></span><br><span class="line"><span class="string">    -driver.implicitly_wait(10)</span></span><br><span class="line"><span class="string">    -driver.find_element_by_css_selector()</span></span><br><span class="line"><span class="string">    -只需要写一句话，等待所有要获取的标签</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(driver.page_source)</span><br><span class="line"><span class="comment"># 再找控件，只要没加载成功，就会等待，最多等10s</span></span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>

<h2 id="5-元素操作"><a href="#5-元素操作" class="headerlink" title="5.元素操作"></a>5.元素操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击，清空，输入操作</span></span><br><span class="line"></span><br><span class="line">input_search=driver.find_element_by_id(<span class="string">&#x27;kw&#x27;</span>)</span><br><span class="line">input_search.send_keys(<span class="string">&#x27;美女&#x27;</span>)  <span class="comment"># 输入</span></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">input_search.clear() <span class="comment"># 清空</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">input_search.send_keys(<span class="string">&#x27;性感美女&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">btn=driver.find_element_by_id(<span class="string">&#x27;su&#x27;</span>)</span><br><span class="line">btn.click()  <span class="comment"># 点击</span></span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure>

<h2 id="6-执行js"><a href="#6-执行js" class="headerlink" title="6.执行js"></a>6.执行js</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;http://127.0.0.1:8000/&#x27;</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">driver.execute_script(<span class="string">&quot;name=&#x27;egon&#x27;;&quot;</span>) <span class="comment"># 这里面写js代码</span></span><br><span class="line">driver.execute_script(<span class="string">&quot;alert(name)&quot;</span>) <span class="comment"># 这里面写js代码</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># driver.close()</span></span><br></pre></td></tr></table></figure>

<h2 id="7-切换选项卡"><a href="#7-切换选项卡" class="headerlink" title="7.切换选项卡"></a>7.切换选项卡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser=webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">browser.execute_script(<span class="string">&#x27;window.open()&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(browser.window_handles) <span class="comment">#获取所有的选项卡</span></span><br><span class="line"><span class="comment"># browser.switch_to_window(browser.window_handles[1])</span></span><br><span class="line"><span class="comment"># browser.switch_to_window(browser.window_handles[1])</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">1</span>])</span><br><span class="line">browser.get(<span class="string">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># browser.switch_to_window(browser.window_handles[0])</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line">browser.get(<span class="string">&#x27;https://www.sina.com.cn&#x27;</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>

<h2 id="8-模拟前进后退"><a href="#8-模拟前进后退" class="headerlink" title="8.模拟前进后退"></a>8.模拟前进后退</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">browser.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">browser.get(<span class="string">&#x27;https://www.taobao.com&#x27;</span>)</span><br><span class="line">browser.get(<span class="string">&#x27;http://www.sina.com.cn/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">browser.back()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.forward()</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>

<h2 id="9-异常处理"><a href="#9-异常处理" class="headerlink" title="9.异常处理"></a>9.异常处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException,NoSuchFrameException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>

<h2 id="10-selenium登录cnblogs获取cookie"><a href="#10-selenium登录cnblogs获取cookie" class="headerlink" title="10.selenium登录cnblogs获取cookie"></a>10.selenium登录cnblogs获取cookie</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#selenium登录cnblogs获取cookie</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException,NoSuchFrameException</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">browser = webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">####  登录过程</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     browser.get(&#x27;http://www.cnblogs.com&#x27;)</span></span><br><span class="line"><span class="comment">#     submit_btn=browser.find_element_by_link_text(&#x27;登录&#x27;)  # a标签的内容</span></span><br><span class="line"><span class="comment">#     submit_btn.click()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     username=browser.find_element_by_id(&#x27;mat-input-0&#x27;)</span></span><br><span class="line"><span class="comment">#     password=browser.find_element_by_id(&#x27;mat-input-1&#x27;)</span></span><br><span class="line"><span class="comment">#     username.send_keys(&#x27;616564099@qq.com&#x27;)</span></span><br><span class="line"><span class="comment">#     password.send_keys(&#x27;1111&#x27;)</span></span><br><span class="line"><span class="comment">#     input(&#x27;等会&#x27;)</span></span><br><span class="line"><span class="comment">#     sub_btn=browser.find_element_by_css_selector(&#x27;body &gt; app-root &gt; mat-sidenav-container &gt; mat-sidenav-content &gt; div &gt; div &gt; app-sign-in &gt; app-content-container &gt; div &gt; div &gt; div &gt; form &gt; div &gt; button &gt; span.mat-button-wrapper&#x27;)</span></span><br><span class="line"><span class="comment">#     sub_btn.click()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # 人工参与，滑动</span></span><br><span class="line"><span class="comment">#     input(&#x27;等会&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # 获取到登录后的cookie</span></span><br><span class="line"><span class="comment">#     print(browser.get_cookies())</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     with open(&#x27;cookie.json&#x27;,&#x27;w&#x27;) as f:</span></span><br><span class="line"><span class="comment">#         json.dump(browser.get_cookies(),f)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># except Exception as e:</span></span><br><span class="line"><span class="comment">#     print(e)</span></span><br><span class="line"><span class="comment"># finally:</span></span><br><span class="line"><span class="comment">#     browser.close()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不登录了，把cookie写入浏览器</span></span><br><span class="line"><span class="comment"># browser.get(&#x27;http://www.cnblogs.com&#x27;)</span></span><br><span class="line"><span class="comment"># with open(&#x27;cookie.json&#x27;,&#x27;r&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     cookie=json.load(f)</span></span><br><span class="line"><span class="comment"># time.sleep(5)</span></span><br><span class="line"><span class="comment"># for item in cookie:  # 设置cookie必须用字典，cookie的json文件是列表，所以用循环往里放</span></span><br><span class="line"><span class="comment">#     browser.add_cookie(item)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># browser.refresh()  # 刷新页面</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># time.sleep(5)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># browser.close()</span></span><br></pre></td></tr></table></figure>

<h2 id="11-抽屉半自动点赞"><a href="#11-抽屉半自动点赞" class="headerlink" title="11.抽屉半自动点赞"></a>11.抽屉半自动点赞</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 登录过程</span></span><br><span class="line"><span class="comment"># bro=webdriver.Chrome(executable_path=&#x27;chromedriver.exe&#x27;)</span></span><br><span class="line"><span class="comment"># bro.implicitly_wait(10)</span></span><br><span class="line"><span class="comment"># bro.get(&#x27;https://dig.chouti.com/&#x27;)</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     sub_btn=bro.find_element_by_id(&#x27;login_btn&#x27;)</span></span><br><span class="line"><span class="comment">#     print(sub_btn)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # sub_btn.click()  # 报错</span></span><br><span class="line"><span class="comment">#     bro.execute_script(&#x27;arguments[0].click();&#x27;,sub_btn)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     # username=bro.find_element_by_css_selector(&#x27;body &gt; div.login-dialog.dialog.animated2.scaleIn &gt; div &gt; div.login-body &gt; div.form-item.login-item.clearfix.phone-item.mt24 &gt; div.input-item.input-item-short.left.clearfix &gt; input&#x27;)</span></span><br><span class="line"><span class="comment">#     username=bro.find_element_by_css_selector(&#x27;div.input-item&gt;input.login-phone&#x27;)</span></span><br><span class="line"><span class="comment">#     username.send_keys(&#x27;18953675221&#x27;)</span></span><br><span class="line"><span class="comment">#     # password=bro.find_element_by_css_selector(&#x27;body &gt; div.login-dialog.dialog.animated2.scaleIn &gt; div &gt; div.login-footer &gt; div.form-item.login-item.clearfix.mt24 &gt; div&#x27;)</span></span><br><span class="line"><span class="comment">#     password = bro.find_element_by_css_selector(&#x27;div.input-item&gt;input.pwd-password-input&#x27;)</span></span><br><span class="line"><span class="comment">#     password.send_keys(&#x27;lqz123&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     time.sleep(3)</span></span><br><span class="line"><span class="comment">#     btn=bro.find_element_by_css_selector(&#x27;body &gt; div.login-dialog.dialog.animated2.scaleIn &gt; div &gt; div.login-footer &gt; div:nth-child(4) &gt; button&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     btn.click()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     input(&#x27;等&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     with open(&#x27;chouti.json&#x27;,&#x27;w&#x27;) as f:</span></span><br><span class="line"><span class="comment">#         json.dump(bro.get_cookies(),f)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># finally:</span></span><br><span class="line"><span class="comment">#     bro.close()</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">bro=webdriver.Chrome(executable_path=<span class="string">&#x27;chromedriver.exe&#x27;</span>)</span><br><span class="line">bro.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">bro.get(<span class="string">&#x27;https://dig.chouti.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把屏幕滑倒最底下</span></span><br><span class="line">bro.execute_script(<span class="string">&#x27;window.scrollTo(0, document.body.scrollHeight);&#x27;</span>)</span><br><span class="line"><span class="comment"># bro.find_elements_by_css_selector(&#x27;.link-item&#x27;)</span></span><br><span class="line">cookie=&#123;&#125;</span><br><span class="line"><span class="comment">##从文件中读出cookie</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;chouti.json&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    res=json.load(f)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> res:</span><br><span class="line">    cookie[item[<span class="string">&#x27;name&#x27;</span>]]=item[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cookie) <span class="comment"># requests能够使用的cookie</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">div= bro.find_element_by_class_name(<span class="string">&#x27;link-con&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">header=&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">div_list=div.find_elements_by_class_name(<span class="string">&#x27;link-item&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">    article_id=div.get_attribute(<span class="string">&#x27;data-id&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(article_id)</span><br><span class="line">    <span class="comment"># 使用requests发送请求</span></span><br><span class="line">    res=requests.post(<span class="string">&#x27;https://dig.chouti.com/link/vote&#x27;</span>,data=&#123;<span class="string">&#x27;linkId&#x27;</span>: article_id&#125;,cookies=cookie,headers=header)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line">bro.close()</span><br></pre></td></tr></table></figure>

<h2 id="打码平台使用"><a href="#打码平台使用" class="headerlink" title="打码平台使用"></a>打码平台使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chaojiying_Client</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, username, password, soft_id</span>):</span></span><br><span class="line">        self.username = username</span><br><span class="line">        password = password.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        self.password = md5(password).hexdigest()</span><br><span class="line">        self.soft_id = soft_id</span><br><span class="line">        self.base_params = &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: self.username,</span><br><span class="line">            <span class="string">&#x27;pass2&#x27;</span>: self.password,</span><br><span class="line">            <span class="string">&#x27;softid&#x27;</span>: self.soft_id,</span><br><span class="line">        &#125;</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;Keep-Alive&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PostPic</span>(<span class="params">self, im, codetype</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        im: 图片字节</span></span><br><span class="line"><span class="string">        codetype: 题目类型 参考 http://www.chaojiying.com/price.html</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;codetype&#x27;</span>: codetype,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        files = &#123;<span class="string">&#x27;userfile&#x27;</span>: (<span class="string">&#x27;ccc.jpg&#x27;</span>, im)&#125;</span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/Processing.php&#x27;</span>, data=params, files=files,</span><br><span class="line">                          headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ReportError</span>(<span class="params">self, im_id</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        im_id:报错题目的图片ID</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: im_id,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/ReportError.php&#x27;</span>, data=params, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    chaojiying = Chaojiying_Client(<span class="string">&#x27;306334678&#x27;</span>, <span class="string">&#x27;lqz12345&#x27;</span>, <span class="string">&#x27;903641&#x27;</span>)  <span class="comment"># 用户中心&gt;&gt;软件ID 生成一个替换 96001</span></span><br><span class="line">    im = <span class="built_in">open</span>(<span class="string">&#x27;a.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()  <span class="comment"># 本地图片文件路径 来替换 a.jpg 有时WIN系统须要//</span></span><br><span class="line">    <span class="built_in">print</span>(chaojiying.PostPic(im, <span class="number">1902</span>))  <span class="comment"># 1902 验证码类型  官方网站&gt;&gt;价格体系 3.4+版 print 后要加()</span></span><br></pre></td></tr></table></figure>

<h2 id="xpath使用"><a href="#xpath使用" class="headerlink" title="xpath使用"></a>xpath使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 一门在html中查找数据的语言</span><br><span class="line"><span class="number">2</span> 记住的语法：</span><br><span class="line">	/   取当前路径下的xx   </span><br><span class="line">    //  取所有路径下的xx   </span><br><span class="line">    .   当前路径    </span><br><span class="line">    ..   上一层</span><br><span class="line"><span class="meta">	@    取属性</span></span><br><span class="line">    </span><br><span class="line"><span class="number">4</span> lxml解析模块提供的xpath</span><br><span class="line">doc=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string"> &lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;base href=&#x27;http://example.com/&#x27; /&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;Example website&lt;/title&gt;</span></span><br><span class="line"><span class="string"> &lt;/head&gt;</span></span><br><span class="line"><span class="string"> &lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div id=&#x27;images&#x27;&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image1.html&#x27; name=&#x27;sss&#x27;&gt;Name: My image 1 &lt;br /&gt;&lt;img src=&#x27;image1_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image2.html&#x27; name=&#x27;lqz&#x27;&gt;Name: My image 2 &lt;br /&gt;&lt;img src=&#x27;image2_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image3.html&#x27;&gt;Name: My image 3 &lt;br /&gt;&lt;img src=&#x27;image3_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image4.html&#x27; class=&#x27;li&#x27;&gt;Name: My image 4 &lt;br /&gt;&lt;img src=&#x27;image4_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image5.html&#x27; class=&#x27;li li-item&#x27; name=&#x27;items&#x27;&gt;Name: My image 5 &lt;br /&gt;&lt;img src=&#x27;image5_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">   &lt;a href=&#x27;image6.html&#x27; name=&#x27;items&#x27;&gt;&lt;span&gt;&lt;h5&gt;test&lt;/h5&gt;&lt;/span&gt;Name: My image 6 &lt;br /&gt;&lt;img src=&#x27;image6_thumb.jpg&#x27; /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string"> &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入要解析的内容</span></span><br><span class="line">html=etree.HTML(doc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># res=html.xpath(&#x27;//body&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 所有节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//*&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 指定节点（结果为列表）</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//head&#x27;)</span></span><br><span class="line"><span class="comment"># 3 子节点，子孙节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//div/a&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a&#x27;) #无数据</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a&#x27;)</span></span><br><span class="line"><span class="comment"># 4 父节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[@href=&quot;image1.html&quot;]/..&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[@href=&quot;image1.html&quot;]&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[1]/..&#x27;)</span></span><br><span class="line"><span class="comment"># 也可以这样</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[1]/parent::*&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[1]/parent::p&#x27;)</span></span><br><span class="line"><span class="comment"># 5 属性匹配</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[@href=&quot;image1.html&quot;]&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[@name=&quot;sss&quot;]&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 文本获取  text()</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[@href=&quot;image1.html&quot;]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a/text()&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 属性获取</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a/@href&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/@name&#x27;)</span></span><br><span class="line"><span class="comment"># # 注意从1 开始取（不是从0）</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[2]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># 8 属性多值匹配</span></span><br><span class="line"><span class="comment">#  a 标签有多个class类，直接匹配就不可以了，需要用contains</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[@class=&quot;li&quot;]&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[contains(@class,&quot;li&quot;)]&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[contains(@class,&quot;li&quot;)]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># 9 多属性匹配</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[contains(@class,&quot;li&quot;) or @name=&quot;items&quot;]&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[contains(@class,&quot;li&quot;) and @name=&quot;items&quot;]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//body//a[contains(@class,&quot;li&quot;)]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># 10 按序选择</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[2]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[2]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[2]/@name&#x27;)</span></span><br><span class="line"><span class="comment"># 取最后一个</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[last()]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># 位置小于3的</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[position()&lt;3]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># 倒数第二个</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[last()-2]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># 11 节点轴选择</span></span><br><span class="line"><span class="comment"># ancestor：祖先节点</span></span><br><span class="line"><span class="comment"># 使用了* 获取所有祖先节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a/ancestor::*&#x27;)</span></span><br><span class="line"><span class="comment"># # 获取祖先节点中的div</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a/ancestor::div&#x27;)</span></span><br><span class="line"><span class="comment"># attribute：属性值</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/attribute::*&#x27;)</span></span><br><span class="line"><span class="comment"># child：直接子节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/child::*&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/child::img/@src&#x27;)</span></span><br><span class="line"><span class="comment"># descendant：所有子孙节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[6]/descendant::*&#x27;)</span></span><br><span class="line"><span class="comment"># following:当前节点之后所有节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following::*&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following::*[1]/@href&#x27;)</span></span><br><span class="line"><span class="comment"># following-sibling:当前节点之后同级节点</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following-sibling::*&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following-sibling::a&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following-sibling::*[2]/text()&#x27;)</span></span><br><span class="line"><span class="comment"># a=html.xpath(&#x27;//a[1]/following-sibling::*[2]/@href&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/12/%E7%88%AC%E8%99%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/12/%E7%88%AC%E8%99%AB/" class="post-title-link" itemprop="url">爬虫</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-10-12T18:20:25+08:00">2019-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><h2 id="1-爬虫介绍"><a href="#1-爬虫介绍" class="headerlink" title="1.爬虫介绍"></a>1.爬虫介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 爬虫流程</span></span><br><span class="line">	模拟发送http请求-----》解析数据（清洗数据）----》入库</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 百度，谷歌：就是爬虫</span></span><br><span class="line">	-百度搜索，输入关键字---》搜的是百度的数据库---》页面中看到---》点击具体内容---》跳转到互联网的某个网页</span><br><span class="line">   </span><br><span class="line">	-seo优化：让百度爬到你，你直接主动上报，</span><br><span class="line">    -sem：花钱做广告买关键词</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 爬虫协议</span></span><br><span class="line">	-哪部分允许爬取，哪部分不允许爬取</span><br><span class="line">	-https://www.csdn.net/robots.txt</span><br><span class="line">        </span><br><span class="line"><span class="comment"># python中爬虫相关内容</span></span><br><span class="line">    -模拟发送http请求（requests，selenium）-----》解析数据（清洗数据）（json，bs4。。。）----》入库（文件，mysql，redis，excel，mongodb）</span><br><span class="line">    -反扒：</span><br><span class="line">    	-封ip：代理池</span><br><span class="line">        -封账号：cookie池</span><br><span class="line">        -请求头中带特殊校验：相应的破解出哪写字段</span><br><span class="line">        -数据加密：js解析出加密方式，自行组装数据</span><br><span class="line">        -html：css反扒，字体反扒</span><br></pre></td></tr></table></figure>

<h2 id="2-requests库介绍"><a href="#2-requests库介绍" class="headerlink" title="2.requests库介绍"></a>2.requests库介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requests模块，基于urllib3 封装，方便的发送http的请求</span></span><br><span class="line"><span class="comment"># 安装:</span></span><br><span class="line">	pip3 install requests</span><br></pre></td></tr></table></figure>

<h2 id="3-requests发送get请求"><a href="#3-requests发送get请求" class="headerlink" title="3.requests发送get请求"></a>3.requests发送get请求</h2><h3 id="3-1-普通请求"><a href="#3-1-普通请求" class="headerlink" title="3.1 普通请求"></a>3.1 普通请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(<span class="string">&#x27;https://www.cnblogs.com/xiaoyuanqujing/articles/11805698.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text) <span class="comment"># 返回的数据</span></span><br><span class="line"></span><br><span class="line">search = <span class="built_in">input</span>(<span class="string">&#x27;请输入要搜索的内容：&#x27;</span>)</span><br><span class="line">res = requests.get(<span class="string">&#x27;https://www.baidu.com/s?wd=&#x27;</span> + search)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;search.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-携带参数"><a href="#3-2-携带参数" class="headerlink" title="3.2 携带参数"></a>3.2 携带参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">&#x27;https://www.sogou.com/web&#x27;</span>,</span><br><span class="line">                      headers=&#123;</span><br><span class="line">                        <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36&#x27;</span>,</span><br><span class="line">                      &#125;,params=&#123;<span class="string">&#x27;query&#x27;</span>:<span class="string">&#x27;美女&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;search.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line">res=urlencode(&#123;<span class="string">&#x27;wd&#x27;</span>:<span class="string">&#x27;美女&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">19</span>&#125;,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h3 id="Url编码解码"><a href="#Url编码解码" class="headerlink" title="Url编码解码"></a>Url编码解码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># url编码和解码</span></span><br><span class="line">	<span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote,unquote</span><br><span class="line">    <span class="comment"># res=quote(&#x27;美女&#x27;)					# 编码</span></span><br><span class="line">    <span class="comment"># print(res)  #%E7%BE%8E%E5%A5%B3</span></span><br><span class="line"></span><br><span class="line">    res=unquote(<span class="string">&#x27;%E7%BE%8E%E5%A5%B3&#x27;</span>)	 <span class="comment"># 解码</span></span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-携带请求头"><a href="#3-3-携带请求头" class="headerlink" title="3.3 携带请求头"></a>3.3 携带请求头</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果被做了反扒，但是用浏览器可以，一定是模拟的不像</span></span><br><span class="line">header=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;BIDUPSID=185720F0FEA0DC697147E75D48AFB1D8; PSTM=1593942899; BAIDUID=185720F0FEA0DC69D0675C2EEDB05721:SL=0:NR=10:FG=1; sug=3; ORIGIN=0; bdime=0; sugstore=1; BD_UPN=12314753; __yjs_duid=1_61812ebe639caffca8271e1786971c8b1617936053918; BDUSS=lhDOTR6OWU0UWdmcFBLTDdxRUlqQXJtdFFjajlxfjFhVUpRLTNDNEd0VW51Uk5oSVFBQUFBJCQAAAAAAAAAAAEAAACwPo3XwM~E0Lqiyc-6o9Cjx~gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcs7GAnLOxgW; BDUSS_BFESS=lhDOTR6OWU0UWdmcFBLTDdxRUlqQXJtdFFjajlxfjFhVUpRLTNDNEd0VW51Uk5oSVFBQUFBJCQAAAAAAAAAAAEAAACwPo3XwM~E0Lqiyc-6o9Cjx~gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcs7GAnLOxgW; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BDSFRCVID_BFESS=uQLOJeC62GhrmIcHWL4ru7XUvDmJR3TTH6aoUKcPVTiblG6zzmh3EG0Pbf8g0K4bdMXhogKK0eOTHkuF_2uxOjjg8UtVJeC6EG0Ptf8g0f5; H_BDCLCKID_SF_BFESS=tRk8oK-aJKvbfP0kKno_MtCsqxby26n9-Rb9aJ5y-J7nhMTz5Mn1DT_OQl_fXpQq5m3ion3vQpbZ8h5D34vW-fLRDmct-p5MQ26xKl0MLPbcsU5nBU4VhnkD2fnMBMPj5mOnaIQc3fAKftnOM46JehL3346-35543bRTLnLy5KJYMDFCjTA-D6QyeUbQa4JWHD6QB4TaajrjDnCrBPjUXUI82h5y05OkbmteaU3PJMnhMUna54ovynKZDnORXx745j5b-bA-Bh3tfKJKbPQ63ML1Db3JqP7M0aQtsCouan3oepvoD-oc3MvByPjdJJQOBKQB0KnGbUQkeq8CQft20b0EeMtjW6LEJJkO_D_atKvDqTrP-trf5DCShUFsWPKJB2Q-XPoO3KJZfqRhyhJIjpk0jn7P-tQiW5cpoMbgylRM8P3y0bb2DUA1y4vpK-ogQgTxoUJ2fnRJEUcGqj5Ah--ebPRiJPQ9Qg-qahQ7tt5W8ncFbT7l5hKpbt-q0x-jLTnhVn0MBCK0hD0wjT0-DjcM-Uv05-PXKCJ0X458HJOoDDvFqfbcy4LdjG5NeRvbLnc7-hRu2PKboM5Cbxbmj4Pu3-Aq54RIL5505tnqtMcNb-0xeJrhQfbQ0bjuqP-jW5Ta-qI-HR7JOpkxbfnxy-P0QRPH-Rv92DQMVU52QqcqEIQHQT3m5-5bbN3ht6IHJJIq_I82JIvbfP0k5R35hnjH-UIs-lorB2Q-5KL-3bnKDqTnyhJdjbD0jn7P-f3LWHue-UbdJJjoSqvn0hjxMtDjQNjEhtr3t2TxoUJt5DnJhhkm-4OYW-kebPRiJPQ9QgbWLlQ7tt5W8ncFbT7l5hKpbt-q0x-jLTnhVn0M5DK0HPonHjAKDjvP; delPer=0; BD_CK_SAM=1; PSINO=3; BAIDUID_BFESS=185720F0FEA0DC69D0675C2EEDB05721:SL=0:NR=10:FG=1; H_PS_PSSID=34300_34335_34273_31254_34377_33848_34092_34107_34111_26350_34360; COOKIE_SESSION=3698_4_8_9_18_23_0_1_7_3_0_11_2964_0_0_0_1628046671_1627963945_1628050426%7C9%23101_72_1627963943%7C9; H_PS_645EC=4707Tvcdepk6pvKnFnabHvwqrLGAFZiyVAOXDTeK8IdAgRrAQD714rlnFSA; BA_HECTOR=0ha5al208l240k2hf91ggk5e30q&#x27;</span>&#125;</span><br><span class="line">res = requests.get(<span class="string">&#x27;https://www.baidu.com/s?wd=帅哥&#x27;</span>,headers=header)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;search.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure>

<h3 id="3-4携带cookie"><a href="#3-4携带cookie" class="headerlink" title="3.4携带cookie"></a>3.4携带cookie</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = requests.get(&#x27;http://www.aa7a.cn/&#x27;, headers=&#123;</span><br><span class="line">    # &#x27;cookie&#x27;: &#x27;ECS_ID=b435f5897f41c2f2c322fa3065165c9fbc56ddd5; ECS[visit_times]=1; _jzqa=1.4423902263705487400.1628049030.1628049030.1628049030.1; _jzqc=1; _jzqy=1.1628049030.1628049030.1.jzqsr=baidu.-; _jzqckmp=1; UM_distinctid=17b0f48bcda509-0e53827f49b667-5e422810-1fa400-17b0f48bcdb54c; CNZZDATA4603183=cnzz_eid%3D1414483188-1628045968-null%26ntime%3D1628045968; Hm_lvt_c29657ca36c6c88e02fed9a397826038=1628049030; CNZZDATA1260462072=271803043-1628045968-null%7C1628045968; Qs_lvt_201322=1628049030; mediav=%7B%22eid%22%3A%22179539%22%2C%22ep%22%3A%22%22%2C%22vid%22%3A%22%22%2C%22ctn%22%3A%22%22%2C%22vvid%22%3A%22%22%2C%22_mvnf%22%3A1%2C%22_mvctn%22%3A0%2C%22_mvck%22%3A1%2C%22_refnf%22%3A0%7D; _qzjc=1; __xsptplusUT_422=1; __xsptplus422=422.1.1628049032.1628049032.1%234%7C%7C%7C%7C%7C%23%23HXwWiieCoDk4evQa5H5dKIEBtnxLTY12%23; ECS[username]=616564099%40qq.com; ECS[user_id]=61399; ECS[password]=4a5e6ce9d1aba9de9b31abdf303bbdc2; _qzja=1.1591066928.1628049030327.1628049030327.1628049030327.1628049032756.1628049055229.616564099%2540qq_com.1.0.3.1; _qzjb=1.1628049030327.3.0.0.0; _qzjto=3.1.0; _jzqb=1.8.10.1628049030.1; Qs_pv_201322=2246468261428716000%2C1231523507243942000; Hm_lpvt_c29657ca36c6c88e02fed9a397826038=1628049055; cto_bundle=Gd60IF9TJTJGRHFuTzdidXZYZGEyVW9ydFFJV25YY0RqSlBRODRlTDdjSG9RT01NUlg4NmYyVjhPMzNmenolMkJDMlRiQjJWTHA2UlBoUUdNOGtBTnoyTkZqdmJMOEI5Vk14aVU4JTJGbHdyTXFqaCUyRlY1dWt3JTNE&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">print(&#x27;616564099@qq.com &#x27; in res.text)</span><br></pre></td></tr></table></figure>

<h2 id="4-requests发送post请求"><a href="#4-requests发送post请求" class="headerlink" title="4.requests发送post请求"></a>4.requests发送post请求</h2><h3 id="4-1-自动登录某网站"><a href="#4-1-自动登录某网站" class="headerlink" title="4.1 自动登录某网站"></a>4.1 自动登录某网站</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">res = requests.post(<span class="string">&#x27;http://www.aa7a.cn/user.php&#x27;</span>, data=&#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;616564099@qq.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;lqz123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;captcha&#x27;</span>: <span class="string">&#x27;zxv7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;remember&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;ref&#x27;</span>: <span class="string">&#x27;http://www.aa7a.cn/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;act&#x27;</span>: <span class="string">&#x27;act_login&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line"><span class="comment"># 取出cookie,登录成功的cookie</span></span><br><span class="line">cookie=res.cookies  <span class="comment"># CookieJar对象</span></span><br><span class="line"><span class="built_in">print</span>(cookie)</span><br><span class="line"></span><br><span class="line">res2=requests.get(<span class="string">&#x27;http://www.aa7a.cn/&#x27;</span>,cookies=cookie)		<span class="comment"># 登陆状态</span></span><br><span class="line"><span class="comment"># res2=requests.get(&#x27;http://www.aa7a.cn/&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;616564099@qq.com&#x27;</span> <span class="keyword">in</span> res2.text)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-body体中携带数据"><a href="#4-2-body体中携带数据" class="headerlink" title="4.2 body体中携带数据"></a>4.2 body体中携带数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># body体携带数据</span></span><br><span class="line"><span class="comment"># res = requests.post(&#x27;&#x27;,data=&#123;&#125;)  # urlencoded方式</span></span><br><span class="line"><span class="comment"># res = requests.post(&#x27;&#x27;,json=&#x27;json格式字符串&#x27;)  # aplication/json方式</span></span><br><span class="line"><span class="comment"># res = requests.post(&#x27;&#x27;,json=&#x27;&#x27;,headers=&#123;</span></span><br><span class="line"><span class="comment"># &#x27;content-type&#x27;: &#x27;application/json;charset=utf-8&#x27;</span></span><br><span class="line"><span class="comment"># &#125;)</span></span><br></pre></td></tr></table></figure>

<h2 id="5-response属性-编码问题-获取二进制-解析Json"><a href="#5-response属性-编码问题-获取二进制-解析Json" class="headerlink" title="5  .response属性,编码问题,获取二进制,解析Json"></a>5  .response属性,编码问题,获取二进制,解析Json</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># response属性，</span></span><br><span class="line">	respone=requests.get(<span class="string">&#x27;http://www.aa7a.cn/&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span>(respone.text)   				<span class="comment"># 响应体的字符串</span></span><br><span class="line">		<span class="built_in">print</span>(respone.content) 				<span class="comment"># 响应体的二进制（图片，视频，页面）</span></span><br><span class="line">		<span class="built_in">print</span>(respone.status_code) 			<span class="comment"># 响应的状态码</span></span><br><span class="line">		<span class="built_in">print</span>(respone.headers)    			<span class="comment"># 响应头</span></span><br><span class="line">		<span class="built_in">print</span>(respone.cookies)    			<span class="comment"># 返回的cookie</span></span><br><span class="line">		<span class="built_in">print</span>(respone.cookies.get_dict())  	<span class="comment"># cookieJar对象转成字典</span></span><br><span class="line">		<span class="built_in">print</span>(respone.cookies.items())    	<span class="comment"># 相当于字典的items</span></span><br><span class="line">		<span class="built_in">print</span>(respone.url)               	<span class="comment"># 当次请求地址</span></span><br><span class="line">		<span class="built_in">print</span>(respone.history)           	<span class="comment"># 重定向过才有值</span></span><br><span class="line">		<span class="built_in">print</span>(respone.encoding)          	<span class="comment"># 响应的编码格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭：response.close()</span></span><br><span class="line"><span class="comment"># from contextlib import closing</span></span><br><span class="line"><span class="comment"># with closing(requests.get(&#x27;xxx&#x27;,stream=True)) as response:</span></span><br><span class="line"><span class="comment">#     for line in response.iter_content():	# 防止文件过大</span></span><br><span class="line"><span class="comment">#     pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编码问题，</span></span><br><span class="line"><span class="comment"># 可能会遇到打印respone.text出现乱码，在浏览器页面中看不会出现乱码</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;http://www.aa7a.cn/&#x27;)</span></span><br><span class="line"><span class="comment"># # respone.encoding=&#x27;gbk&#x27;  # 修改编码方式</span></span><br><span class="line"><span class="comment"># respone.encoding=respone.apparent_encoding   # 页面使用的编码方式</span></span><br><span class="line"><span class="comment"># print(respone.text)   # 响应体的字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取二进制，</span></span><br><span class="line">res=requests.get(<span class="string">&#x27;http://www.aa7a.cn/data/afficheimg/20201102gophex.png&#x27;</span>)</span><br><span class="line"><span class="comment"># print(res.content)</span></span><br><span class="line"><span class="comment"># with open(&#x27;致命诱惑.png&#x27;,&#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(res.content)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># with open(&#x27;致命诱惑.png&#x27;,&#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     for line in res.iter_content(1024):</span></span><br><span class="line"><span class="comment">#         f.write(line)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  解析json</span></span><br><span class="line"><span class="comment"># import json</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;https://api.luffycity.com/api/v1/course/category/actual/?courseType=actual&#x27;)</span></span><br><span class="line"><span class="comment"># # print(json.loads(res.text))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(res.json())</span></span><br></pre></td></tr></table></figure>

<h2 id="6-爬取视频"><a href="#6-爬取视频" class="headerlink" title="6.爬取视频"></a>6.爬取视频</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  爬取视频</span></span><br><span class="line"><span class="comment">#https://www.pearvideo.com/category_loading.jsp?reqType=5&amp;categoryId=5&amp;start=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import re</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;https://www.pearvideo.com/category_loading.jsp?reqType=5&amp;categoryId=5&amp;start=0&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # print(res.text)</span></span><br><span class="line"><span class="comment"># # 如果使用bs4，非常简单</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># video_list=re.findall(&#x27;&lt;a href=&quot;(.*?)&quot; class=&quot;vervideo-lilink actplay&quot;&gt;&#x27;,res.text)</span></span><br><span class="line"><span class="comment"># # print(video_list)</span></span><br><span class="line"><span class="comment"># for video in video_list:</span></span><br><span class="line"><span class="comment">#     video_url=&#x27;https://www.pearvideo.com/&#x27;+video</span></span><br><span class="line"><span class="comment">#     # print(video_url)</span></span><br><span class="line"><span class="comment">#     video_id=video.split(&#x27;_&#x27;)[-1]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     header=&#123;</span></span><br><span class="line"><span class="comment">#         &#x27;Referer&#x27;:video_url</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     res2=requests.get(&#x27;https://www.pearvideo.com/videoStatus.jsp?contId=%s&amp;mrd=0.5165499193941832&#x27;%video_id,headers=header)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     video_f_url=res2.json()[&#x27;videoInfo&#x27;][&#x27;videos&#x27;][&#x27;srcUrl&#x27;]</span></span><br><span class="line"><span class="comment">#     video_real_url=video_f_url.replace(video_f_url.rsplit(&#x27;/&#x27;)[-1].split(&#x27;-&#x27;)[0], &#x27;cont-%s&#x27; % video_id)</span></span><br><span class="line"><span class="comment">#     print(video_real_url)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     res3=requests.get(video_real_url)</span></span><br><span class="line"><span class="comment">#     with open(&#x27;%s.mp4&#x27;%video_id,&#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#         for line in res3.iter_content(1024):</span></span><br><span class="line"><span class="comment">#             f.write(line)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析过程</span></span><br><span class="line"><span class="comment"># referer:上一次访问的地址，可以做图片防盗链</span></span><br><span class="line"><span class="comment"># header=&#123;</span></span><br><span class="line"><span class="comment">#     &#x27;Referer&#x27;: &#x27;https://www.pearvideo.com/video_1737590&#x27;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;https://www.pearvideo.com/videoStatus.jsp?contId=1737590&amp;mrd=0.5165499193941832&#x27;,headers=header)</span></span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以播放的视频</span></span><br><span class="line"><span class="comment"># &#x27;https://video.pearvideo.com/mp4/short/20210729/cont-1736870-15732687-hd.mp4&#x27;</span></span><br><span class="line"><span class="comment"># ## 不可以播放的视频</span></span><br><span class="line"><span class="comment"># &#x27;https://video.pearvideo.com/mp4/short/20210729/1628062847275-15732687-hd.mp4&#x27;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x27;https://video.pearvideo.com/mp4/short/20210729/   cont-1736870   -15732687-hd.mp4&#x27;</span></span><br><span class="line"><span class="comment"># &#x27;https://video.pearvideo.com/mp4/short/20210729/   1628062847275   -15732687-hd.mp4&#x27;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># s=&#x27;https://video.pearvideo.com/mp4/short/20210729/  1628062847275 -15732687-hd.mp4&#x27;</span></span><br><span class="line"><span class="comment"># s.replace(s.rsplit(&#x27;/&#x27;)[-1].split(&#x27;-&#x27;)[0],&#x27;cont-%s&#x27;%video_id)</span></span><br></pre></td></tr></table></figure>

<h2 id="7-requests高级用法"><a href="#7-requests高级用法" class="headerlink" title="7.requests高级用法"></a>7.requests高级用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向代理和反向代理</span></span><br><span class="line">	-正向代理是代理客户端</span><br><span class="line">    -反向代理是代理服务端（nginx是反向代理服务器）</span><br><span class="line">    </span><br><span class="line"><span class="comment"># requests使用个代理，正向代理</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 1 SSL Cert Verification（了解）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 不验证证书</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;https://www.12306.cn&#x27;,verify=False) #不验证证书,报警告,返回200</span></span><br><span class="line"><span class="comment"># print(respone.status_code)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ## 携带证书</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;https://www.12306.cn&#x27;,</span></span><br><span class="line"><span class="comment">#                      cert=(&#x27;/path/server.crt&#x27;,</span></span><br><span class="line"><span class="comment">#                            &#x27;/path/key&#x27;))</span></span><br><span class="line"><span class="comment"># print(respone.status_code)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2 使用代理</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># proxies = &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;http&#x27;:&#x27;http://117.69.230.132:3256&#x27;,</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;https://www.12306.cn&#x27;,</span></span><br><span class="line"><span class="comment">#                      proxies=proxies)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(respone.status_code)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># proxies = &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;http&#x27;:&#x27;http://117.69.230.132:3256&#x27;,</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># # respone=requests.get(&#x27;http://127.0.0.1:8000&#x27;,proxies=proxies)</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;http://127.0.0.1:8000&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(respone.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># proxies = &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;http&#x27;:&#x27;http://103.228.245.98:3128&#x27;,</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;http://101.133.225.166:8888/&#x27;,proxies=proxies)</span></span><br><span class="line"><span class="comment">#  respone=requests.get(&#x27;http://101.133.225.166:8888/&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(respone.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 如果你有很多代理，每次发请求，随机取一个代理ip，发送，这样我们的ip就不会被封</span></span><br><span class="line"><span class="comment">## 花钱买</span></span><br><span class="line"><span class="comment">## 白嫖</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># res=requests.get(&#x27;http://demo.spiderpy.cn/get/&#x27;).json()[&#x27;proxy&#x27;]</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># proxies = &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;https&#x27;:&#x27;https://%s&#x27;%res,</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;http://www.baidu.com&#x27;,proxies=proxies)</span></span><br><span class="line"><span class="comment"># # respone=requests.get(&#x27;http://www.baidu.com&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(respone.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 借助于第三方，自己搭建(读一读人家源码)</span></span><br><span class="line"><span class="comment">#https://github.com/jhao104/proxy_pool</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 超时时间</span></span><br><span class="line"><span class="comment"># respone=requests.get(&#x27;https://www.baidu.com&#x27;,timeout=0.0001)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 认证（像老款路由器的登录）</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># from requests.auth import HTTPBasicAuth</span></span><br><span class="line"><span class="comment"># r=requests.get(&#x27;xxx&#x27;,auth=HTTPBasicAuth(&#x27;user&#x27;,&#x27;password&#x27;))</span></span><br><span class="line"><span class="comment"># print(r.status_code)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 异常处理</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># from requests.exceptions import * #可以查看requests.exceptions获取异常类型</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     r=requests.get(&#x27;http://www.baidu.com&#x27;,timeout=0.00001)</span></span><br><span class="line"><span class="comment"># # except ReadTimeout:</span></span><br><span class="line"><span class="comment"># #     print(&#x27;===:&#x27;)</span></span><br><span class="line"><span class="comment"># # except ConnectionError: #网络不通</span></span><br><span class="line"><span class="comment"># #     print(&#x27;-----&#x27;)</span></span><br><span class="line"><span class="comment"># # except Timeout:</span></span><br><span class="line"><span class="comment"># #     print(&#x27;aaaaa&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># except Exception:</span></span><br><span class="line"><span class="comment">#     print(&#x27;Error&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件上传</span></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># files=&#123;&#x27;myfile&#x27;:open(&#x27;1 自动处理cookie.py&#x27;,&#x27;rb&#x27;)&#125;</span></span><br><span class="line"><span class="comment"># respone=requests.post(&#x27;http://127.0.0.1:8000/upload_file/&#x27;,files=files)</span></span><br><span class="line"><span class="comment"># print(respone.text)</span></span><br></pre></td></tr></table></figure>

<h2 id="8-案例"><a href="#8-案例" class="headerlink" title="8.案例"></a>8.案例</h2><h3 id="抽屉自动点赞"><a href="#抽屉自动点赞" class="headerlink" title="抽屉自动点赞"></a>抽屉自动点赞</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">header=&#123;</span><br><span class="line">    &#x27;Cookie&#x27;:&#x27;&#x27;,</span><br><span class="line">    &#x27;User-Agent&#x27;:&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36&#x27;</span><br><span class="line">&#125;</span><br><span class="line"># res=requests.post(&#x27;https://dig.chouti.com/link/vote&#x27;,data=&#123;&#x27;linkId&#x27;:&#x27;31857081&#x27;&#125;,headers=header)</span><br><span class="line"># print(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 所有的都点赞，----》id解析---》bs4模块（解析xml）</span><br><span class="line"></span><br><span class="line">res=requests.get(&#x27;https://dig.chouti.com/top/24hr?_=1628136305346&#x27;,headers=header).json()</span><br><span class="line">for item in res[&#x27;data&#x27;]:</span><br><span class="line">    id=item[&#x27;id&#x27;]</span><br><span class="line">    res=requests.post(&#x27;https://dig.chouti.com/link/vote&#x27;,data=&#123;&#x27;linkId&#x27;:&#x27;%s&#x27;%id&#125;,headers=header)</span><br><span class="line">    print(res.text)</span><br></pre></td></tr></table></figure>

<h3 id="抽屉一键点赞"><a href="#抽屉一键点赞" class="headerlink" title="抽屉一键点赞"></a>抽屉一键点赞</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理</span></span><br><span class="line">res = requests.get(<span class="string">&#x27;http://101.91.213.1:7777/get&#x27;</span>)</span><br><span class="line">url = res.json()[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> res.json()[<span class="string">&#x27;https&#x27;</span>]:</span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;https://%s&#x27;</span> % url&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://%s&#x27;</span> % url&#125;</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;deviceId=web.eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqaWQiOiI5MDliODgzMC02MjIxLTQ5NWEtYWJjYi03MjhiMmRhMGYzNWYiLCJleHBpcmUiOiIxNjMwNzU2Mzc3Njg2In0.pnymmoRStRVGmsqqrsJwUectURgUWqLHcRTevTPvhQM; __snaker__id=VW6MZRbKUWxfJBYV; gdxidpyhxdE=xSnRNEtkyjloYBUChPHZj%2Bgcos32R0%2Bi%2FEmGSTk3Stp93Sel2s4nksKwTqIuC7kJnG4KdiAPCXjKlYE%5CTtiCE44r1UeksOfxlLaZByqw7ISuuJqpyhQArfZhA84H9dcViXdN75uHiqi5Hi7NUf%5ChOw8mk30oeCWuaRSC6uAgv%5Cprs6IB%3A1628165637339; _9755xjdesxxd_=32; YD00000980905869%3AWM_NI=Jkn9h6aE%2Bg%2FWSnjknMv2a7HlieiMAHa3kkj735kWD0jrg%2B0fI0xx7iQZAEV8iU1NAN5f3IiYI%2B2MpdiLNTRKBbqh5w8kCpj9Flu37bsTYk2auuIzZGQQ31P%2ByDmdChWEQWU%3D; YD00000980905869%3AWM_NIKE=9ca17ae2e6ffcda170e2e6eed2d77f879f9c97f933b6a88ba3d54f839a9e85b662a592fca9cf3ba5b5fcd5c92af0fea7c3b92a8ab5a2daeb3ea39be588ae5d91b2a68ced47b6eeafd8cb68abbba7aec444a3eda58ce93df1eba5b8c73caaaea9ccb36e8bf0b899b66393868fa6d534ab8bffafc446f7bafdaaec538bf5feaef370ab9482b5d14182bebf89b87dfcb58d91e93386b4bbd4b66ab18c978cb16bb7ab879bd94d938ffdd2d321bb9ca385c264959b9fb8d837e2a3; YD00000980905869%3AWM_TID=Zt%2F%2B7qkRN1FEURERFRZ7zkcoXO0xxtsI; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqaWQiOiJjdHVfNjI4MTY0NzgyNjIiLCJleHBpcmUiOiIxNjMwNzU2NzgyNTgzIn0.nB3jIUUh1_3vmTHb8FlN-WI13uYmYeZGXTQkTn96QdI; Hm_lvt_03b2668f8e8699e91d479d62bc7630f1=1628164379,1628165837; Hm_lpvt_03b2668f8e8699e91d479d62bc7630f1=1628166261&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># for i in [&#x27;https://dig.chouti.com/top/24hr?_=1628165842958&#x27;, &#x27;https://dig.chouti.com/top/72hr?_=1628165842959&#x27;,</span></span><br><span class="line"><span class="comment">#           &#x27;https://dig.chouti.com/top/168hr?_=1628165842960&#x27;]:</span></span><br><span class="line">res = requests.get(<span class="string">&#x27;https://dig.chouti.com/&#x27;</span>, proxies=proxies, headers=header)</span><br><span class="line"></span><br><span class="line">res.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">soup = BeautifulSoup(res.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">res = soup.find_all(<span class="string">&#x27;div&#x27;</span>, class_=<span class="string">&#x27;link-item&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">id</span> = i[<span class="string">&#x27;data-id&#x27;</span>]</span><br><span class="line">    res2 = requests.post(</span><br><span class="line">        <span class="comment"># &#x27;https://dig.chouti.com/link/vote&#x27;</span></span><br><span class="line">        <span class="string">&#x27;https://dig.chouti.com/link/cancel/vote&#x27;</span>, data=&#123;<span class="string">&#x27;linkId&#x27;</span>: <span class="string">&#x27;%s&#x27;</span> % <span class="built_in">id</span>&#125;, proxies=proxies,</span><br><span class="line">        headers=header)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(res2.json())</span><br></pre></td></tr></table></figure>

<h3 id="爬取汽车之家新闻"><a href="#爬取汽车之家新闻" class="headerlink" title="爬取汽车之家新闻"></a>爬取汽车之家新闻</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip3 install beautifulsoup4</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    res=requests.get(<span class="string">&#x27;https://www.autohome.com.cn/news/%s/#liststart&#x27;</span>%i)</span><br><span class="line">    <span class="comment"># print(res.text)</span></span><br><span class="line">    <span class="comment"># 第一个参数，要解析的内容，第二参数：使用的解析器  html.parser  bs4内置的解析器   lxml</span></span><br><span class="line">    soup=BeautifulSoup(res.text,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pip3 install lxml</span></span><br><span class="line">    <span class="comment"># soup=BeautifulSoup(res.text,&#x27;lxml&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># find_all找所有</span></span><br><span class="line">    ul_list=soup.find_all(name=<span class="string">&#x27;ul&#x27;</span>,class_=<span class="string">&#x27;article&#x27;</span>)</span><br><span class="line">    <span class="comment"># ul_list=soup.find_all(name=&#x27;ul&#x27;)</span></span><br><span class="line">    <span class="comment"># print(len(ul_list))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ul <span class="keyword">in</span> ul_list:</span><br><span class="line">        li_list=ul.find_all(name=<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            h3=li.find(name=<span class="string">&#x27;h3&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> h3:</span><br><span class="line">                title=h3.text   <span class="comment"># 获取标签的文本内容，标签对象.text</span></span><br><span class="line">                <span class="comment"># print(title)</span></span><br><span class="line">                desc=li.find(name=<span class="string">&#x27;p&#x27;</span>).text</span><br><span class="line">                <span class="comment"># print(desc)</span></span><br><span class="line">                img_url=li.find(name=<span class="string">&#x27;img&#x27;</span>)[<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> img_url.startswith(<span class="string">&#x27;http&#x27;</span>):</span><br><span class="line">                    img_url=<span class="string">&#x27;https:&#x27;</span>+img_url</span><br><span class="line">                <span class="comment"># print(img_url)</span></span><br><span class="line">                url=<span class="string">&#x27;https:&#x27;</span>+li.find(name=<span class="string">&#x27;a&#x27;</span>)[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">                <span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                新闻标题：%s</span></span><br><span class="line"><span class="string">                新闻摘要：%s</span></span><br><span class="line"><span class="string">                新闻图片：%s</span></span><br><span class="line"><span class="string">                新闻地址：%s          </span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>%(title,desc,img_url,url))</span><br></pre></td></tr></table></figure>

<h3 id="爬取汽车之家新闻并存入缓存"><a href="#爬取汽车之家新闻并存入缓存" class="headerlink" title="爬取汽车之家新闻并存入缓存"></a>爬取汽车之家新闻并存入缓存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">res = requests.get(<span class="string">&#x27;http://101.91.213.1:7777/get&#x27;</span>)</span><br><span class="line">url = res.json()[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;https://%s&#x27;</span> % url,</span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(<span class="string">&#x27;https://www.autohome.com.cn/all/&#x27;</span>, proxies=proxies)</span><br><span class="line"></span><br><span class="line">res.encoding = <span class="string">&#x27;gbk&#x27;</span></span><br><span class="line">soup = BeautifulSoup(res.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tag = soup.find_all(name=<span class="string">&#x27;ul&#x27;</span>, class_=<span class="string">&#x27;article&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> tag:</span><br><span class="line">    li_list = ul.find_all(name=<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">        h3 = li.find(name=<span class="string">&#x27;h3&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> h3:</span><br><span class="line">            title = h3.text</span><br><span class="line">            url = <span class="string">&#x27;https:&#x27;</span> + li.find(<span class="string">&#x27;a&#x27;</span>)[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">            desc = li.find(<span class="string">&#x27;p&#x27;</span>).text</span><br><span class="line">            img_url = li.find(<span class="string">&#x27;img&#x27;</span>)[<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> img_url.startswith(<span class="string">&#x27;http&#x27;</span>):</span><br><span class="line">                img_url = <span class="string">&#x27;https:&#x27;</span> + img_url</span><br><span class="line"></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">                <span class="string">&#x27;desc&#x27;</span>: desc,</span><br><span class="line">                <span class="string">&#x27;img_url&#x27;</span>: desc,</span><br><span class="line">                <span class="string">&#x27;url&#x27;</span>: url</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">            conn = redis.Redis()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">            conn.lpush(<span class="string">&#x27;car_data&#x27;</span>, json.dumps(data))  <span class="comment"># 左侧插入，上部</span></span><br></pre></td></tr></table></figure>

<h2 id="9-bs4相关"><a href="#9-bs4相关" class="headerlink" title="9.bs4相关"></a>9.bs4相关</h2><h3 id="9-1遍历文档树"><a href="#9-1遍历文档树" class="headerlink" title="9.1遍历文档树"></a>9.1遍历文档树</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html_doc = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story &lt;span&gt;lqz&lt;/span&gt;&lt;/b&gt;&lt;span&gt;egon&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span></span><br><span class="line"><span class="string">and they lived at the bottom of a well.&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">soup=BeautifulSoup(html_doc,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.prettify()  # 美化</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1、用法</span></span><br><span class="line"><span class="comment"># html=soup.html</span></span><br><span class="line"><span class="comment"># title=soup.html.head.title</span></span><br><span class="line"><span class="comment"># title=soup.title</span></span><br><span class="line"><span class="comment"># print(title)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、获取标签的名称 ---&gt; 标签对象.name</span></span><br><span class="line"><span class="comment"># a=soup.body.a</span></span><br><span class="line"><span class="comment"># a=soup.a.name</span></span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"><span class="comment"># print(soup.body.name)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、获取标签的属性  ----&gt;标签对象[&#x27;标签名&#x27;]</span></span><br><span class="line"><span class="comment"># href=soup.body.a[&#x27;href&#x27;]</span></span><br><span class="line"><span class="comment"># attrs=soup.body.a.attrs  # 所有属性，---》字典</span></span><br><span class="line"><span class="comment"># href=soup.body.a.attrs[&#x27;href&#x27;]</span></span><br><span class="line"><span class="comment"># print(attrs[&#x27;class&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c=soup.p.attrs[&#x27;class&#x27;]</span></span><br><span class="line"><span class="comment"># print(c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4、获取标签的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.b.text  # 拿到当前标签子子孙所有的text</span></span><br><span class="line"><span class="comment"># res=soup.p.text</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.p.string # 当前标签有且只有一个文本内容才能拿出来</span></span><br><span class="line"><span class="comment"># res=soup.b.string # 当前标签有且只有一个文本内容才能拿出来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.p.strings   # 把子子孙放到生成器中</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(list(res))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#5、嵌套选择</span></span><br><span class="line"><span class="comment"># res=soup.html.body.p</span></span><br><span class="line"><span class="comment"># print(type(res))  # bs4.element.Tag</span></span><br><span class="line"><span class="keyword">from</span> bs4.element <span class="keyword">import</span> Tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####了解</span></span><br><span class="line"><span class="comment">#6、子节点、子孙节点</span></span><br><span class="line"><span class="comment"># print(soup.p.contents) #p下所有子节点，放到列表中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(soup.p.children) #得到一个迭代器,包含p下所有子节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i,child in enumerate(soup.p.children):</span></span><br><span class="line"><span class="comment">#     print(i,child)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(soup.p.descendants) #获取子孙节点,p下所有的标签都会选择出来</span></span><br><span class="line"><span class="comment"># for i,child in enumerate(soup.p.descendants):</span></span><br><span class="line"><span class="comment">#     print(i,child)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#7、父节点、祖先节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(soup.a.parent) #获取a标签的父节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(soup.body.parent)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(soup.a.parents) #找到a标签所有的祖先节点，父亲的父亲，父亲的父亲的父亲...</span></span><br><span class="line"><span class="comment"># print(list(soup.a.parents))</span></span><br><span class="line"><span class="comment"># print(len(list(soup.a.parents)))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#8、兄弟节点</span></span><br><span class="line"><span class="comment"># print(soup.a.next_sibling) #下一个兄弟</span></span><br><span class="line"><span class="comment"># print(soup.a.previous_sibling) #上一个兄弟</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(list(soup.a.next_siblings)) #下面的兄弟们=&gt;生成器对象</span></span><br><span class="line"><span class="comment"># print(list(soup.a.previous_siblings)) #上面的兄弟们=&gt;生成器对象</span></span><br></pre></td></tr></table></figure>

<h3 id="9-2bs4搜索文档树"><a href="#9-2bs4搜索文档树" class="headerlink" title="9.2bs4搜索文档树"></a>9.2bs4搜索文档树</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html_doc = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body id=&#x27;body&#x27;&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story &lt;span&gt;lqz&lt;/span&gt;&lt;/b&gt;&lt;span&gt;egon&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span></span><br><span class="line"><span class="string">and they lived at the bottom of a well.&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">soup=BeautifulSoup(html_doc,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索文档树  find  find_all</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 五种过滤器: 字符串、正则表达式、列表、True、方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##### 字符串</span></span><br><span class="line"><span class="comment"># res=soup.find(name=&#x27;body&#x27;)</span></span><br><span class="line"><span class="comment"># res=soup.find(name=&#x27;p&#x27;,class_=&#x27;story&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找id为link2的标签</span></span><br><span class="line"><span class="comment"># res=soup.find(id=&#x27;link2&#x27;,name=&#x27;a&#x27;,class_=&#x27;sister&#x27;,href=&#x27;http://example.com/lacie&#x27;)</span></span><br><span class="line"><span class="comment"># res=soup.find(href=&#x27;http://example.com/lacie&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.find(attrs=&#123;&#x27;class&#x27;:[&#x27;sister&#x27;]&#125;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 正则表达式</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># res=soup.find_all(name=re.compile(&#x27;^b&#x27;)) #找出b开头的标签，结果有body和b标签</span></span><br><span class="line"><span class="comment"># res=soup.find(name=re.compile(&#x27;^b&#x27;))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.find_all(class_=re.compile(&#x27;^s&#x27;))</span></span><br><span class="line"><span class="comment"># res=soup.find_all(href=re.compile(&#x27;^http&#x27;))</span></span><br><span class="line"><span class="comment"># res=soup.find_all(id=re.compile(&#x27;^l&#x27;))</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####列表、</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.find_all(name=[&#x27;body&#x27;,&#x27;b&#x27;])</span></span><br><span class="line"><span class="comment"># res=soup.find_all(id=[&#x27;link1&#x27;,&#x27;link2&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.find_all(attrs=&#123;&#x27;id&#x27;:[&#x27;link1&#x27;,&#x27;link2&#x27;]&#125;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># True、</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># links=soup.find_all(href=True)</span></span><br><span class="line"><span class="comment"># print(links)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.find_all(name=True)</span></span><br><span class="line"><span class="comment"># res=soup.find_all(id=True)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#方法</span></span><br><span class="line"><span class="comment"># def has_class_but_no_id(tag):</span></span><br><span class="line"><span class="comment">#     return tag.has_attr(&#x27;class&#x27;) and not tag.has_attr(&#x27;id&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(len(soup.find_all(name=has_class_but_no_id)))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿出当前页面所有图片</span></span><br><span class="line">soup.find_all(name=<span class="string">&#x27;img&#x27;</span>,href=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 建议 遍历文档树和搜索文档树混用</span></span><br><span class="line"><span class="comment"># soup.body.div.find</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 其他参数  find，find_all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#limit</span></span><br><span class="line"><span class="comment"># soup.find()</span></span><br><span class="line"><span class="comment"># res=soup.find_all(name=&#x27;a&#x27;,href=True,limit=2)  # 限制获取的条数</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># recursive 是否递归查找</span></span><br><span class="line"><span class="comment"># res=soup.find_all(name=&#x27;a&#x27;,recursive=False)</span></span><br><span class="line"><span class="comment"># res=soup.find_all(name=&#x27;html&#x27;,recursive=False)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="css选择器"><a href="#css选择器" class="headerlink" title="css选择器"></a>css选择器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">html_doc = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;title&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;b&gt;The Dormouse&#x27;s story  &lt;p&gt;asdfasdf&lt;/p&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="string">    Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span></span><br><span class="line"><span class="string">    &lt;div class=&#x27;panel-1&#x27;&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&#x27;list&#x27; id=&#x27;list-1&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element&#x27;&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element&#x27;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element&#x27;&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&#x27;list list-small&#x27; id=&#x27;list-2&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element&#x27;&gt;&lt;h1 class=&#x27;yyyy&#x27;&gt;Foo&lt;/h1&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element xxx&#x27;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&#x27;element&#x27;&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup=BeautifulSoup(html_doc,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">#id</span></span><br><span class="line"><span class="string">.类名</span></span><br><span class="line"><span class="string">标签</span></span><br><span class="line"><span class="string">标签&gt;标签</span></span><br><span class="line"><span class="string">标签 标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=soup.p.select(&#x27;.sister&#x27;)  # 使用css选择器</span></span><br><span class="line"><span class="comment"># res=soup.p.select(&#x27;#link1&#x27;)  # 使用css选择器</span></span><br><span class="line"><span class="comment"># res=soup.select(&#x27;body&gt;p&#x27;)  # 使用css选择器 body的子标签p</span></span><br><span class="line">res=soup.select(<span class="string">&#x27;body p&#x27;</span>)  <span class="comment"># 使用css选择器 body的子子孙孙标签p</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### css选择器是通用的：bs4，lxml解析也可以是css选择器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##css选择器不会写怎么办？</span></span><br><span class="line"><span class="string">&#x27;#maincontent &gt; div:nth-child(3) &gt; table &gt; tbody &gt; tr:nth-child(13) &gt; td:nth-child(3)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## xpath选择</span></span><br><span class="line"><span class="string">&#x27;//*[@id=&quot;maincontent&quot;]/div[2]/table/tbody/tr[18]/td[2]&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="自己搭建代理"><a href="#自己搭建代理" class="headerlink" title="自己搭建代理"></a>自己搭建代理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自己服务器上的代理</span></span><br><span class="line">res = requests.get(<span class="string">&#x27;http://101.91.213.1:7777/get&#x27;</span>)</span><br><span class="line">url = res.json()[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;https://%s&#x27;</span> % url,</span><br><span class="line">&#125;</span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># response=requests.get(&#x27;http://www.baidu.com&#x27;)</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://www.baidu.com/&#x27;</span>, proxies=proxies, headers=header)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 详情参考：</span></span><br><span class="line">	https://github.com/jhao104/proxy_pool</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/10/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E8%81%94%E5%90%88%E5%94%AF%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/10/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E8%81%94%E5%90%88%E5%94%AF%E4%B8%80/" class="post-title-link" itemprop="url">数据库字段联合唯一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-10 17:27:55" itemprop="dateCreated datePublished" datetime="2019-10-10T17:27:55+08:00">2019-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">其他分类</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="字段联合唯一-unique-together"><a href="#字段联合唯一-unique-together" class="headerlink" title="字段联合唯一(unique_together)"></a>字段联合唯一(unique_together)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">字段联合唯一(unique_together):</span><br><span class="line">	eg:</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">            name = models.CharField(<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            age = models.CharField(<span class="string">&#x27;年龄&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            height = models.CharField(<span class="string">&#x27;身高&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">            width = models.CharField(<span class="string">&#x27;体重&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">                unique_together = ((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>,<span class="string">&quot;height&quot;</span>),)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上述表示该表中每一条数据的name,age,heght字段值联合唯一</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/18/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/18/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8/" class="post-title-link" itemprop="url">自定义过滤器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-18 18:20:25" itemprop="dateCreated datePublished" datetime="2019-07-18T18:20:25+08:00">2019-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤功能：安装分类过滤（django-filter）</span></span><br><span class="line">	<span class="number">1.</span>第一种：</span><br><span class="line">		filter_backends=[DjangoFilterBackend]</span><br><span class="line">		filter_fields=[<span class="string">&#x27;course_category&#x27;</span>]  <span class="comment"># 依据的是Course(课程)表</span></span><br><span class="line">	<span class="number">2.</span>第二种：（实现区间过滤）</span><br><span class="line">		filter_backends=[DjangoFilterBackend]</span><br><span class="line">		filter_class = CourseFilterSet</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">CourseFilterSet</span>(<span class="params">FilterSet</span>):</span></span><br><span class="line">    		<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        		model = models.Course</span><br><span class="line">        		fields = [<span class="string">&#x27;course_category&#x27;</span>,]</span><br><span class="line"></span><br><span class="line">	<span class="number">3.</span>第三种：自己写</span><br><span class="line">		自定义一个过滤类：继承基类：BaseFilterBackend，重写filter_queryset，返回的数据，就是过滤后的数据</span><br><span class="line">		配置在视图类上:</span><br><span class="line">			filter_backends=[自定义的类，]</span><br></pre></td></tr></table></figure>

<h2 id="手写自定义过滤器"><a href="#手写自定义过滤器" class="headerlink" title="手写自定义过滤器"></a>手写自定义过滤器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义过滤器:</span></span><br><span class="line">    <span class="number">1.</span>写一个类CourseNameFilter,继承BaseFilterBackend</span><br><span class="line">    <span class="number">2.</span>重写filter_queryset，在内部实现过滤逻辑，返回queryset对象</span><br><span class="line">    <span class="number">3.</span>在视图类中配置</span><br><span class="line">		filter_backends = [CourseNameFilter]</span><br></pre></td></tr></table></figure>

<h2 id="借助Django-filter实现过滤功能"><a href="#借助Django-filter实现过滤功能" class="headerlink" title="借助Django-filter实现过滤功能"></a>借助Django-filter实现过滤功能</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方案一:</span></span><br><span class="line">	只能使用课程(course表)中的字段</span><br><span class="line"><span class="comment"># 视图类中</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filter_fields=[<span class="string">&#x27;course_category&#x27;</span>,<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/api/course/actual_course/?course_category=<span class="number">2</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案二:</span></span><br><span class="line">	可以自定义字段，及规则实现过滤   </span><br><span class="line"><span class="comment"># 视图类中:</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line">    filter_class = CourseFilterSet  <span class="comment">#写一个类</span></span><br><span class="line"><span class="comment"># 过滤类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseFilterSet</span>(<span class="params">FilterSet</span>):</span></span><br><span class="line">    min_price = filters.NumberFilter(field_name=<span class="string">&#x27;price&#x27;</span>, lookup_expr=<span class="string">&#x27;gte&#x27;</span>)</span><br><span class="line">    max_price = filters.NumberFilter(field_name=<span class="string">&#x27;price&#x27;</span>, lookup_expr=<span class="string">&#x27;lte&#x27;</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Course</span><br><span class="line">        fields = [<span class="string">&#x27;course_category&#x27;</span>,<span class="string">&#x27;max_price&#x27;</span>,<span class="string">&#x27;min_price&#x27;</span>]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/10/%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E9%A2%91%E7%8E%87%E6%BA%90%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/10/%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E9%A2%91%E7%8E%87%E6%BA%90%E7%A0%81/" class="post-title-link" itemprop="url">Drf认证权限频率源码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-07-10T18:20:25+08:00">2019-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三大组件源码分析"><a href="#三大组件源码分析" class="headerlink" title="三大组件源码分析"></a>三大组件源码分析</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIView---&gt;dispathch方法的---&gt;self.initial(request, *args, **kwargs)（497行）---&gt;APIView的initial方法---&gt;有三句话</span></span><br><span class="line">    self.perform_authentication(request)  <span class="comment"># 认证</span></span><br><span class="line">    self.check_permissions(request)       <span class="comment"># 权限</span></span><br><span class="line">    self.check_throttles(request)         <span class="comment"># 频率</span></span><br></pre></td></tr></table></figure>

<h2 id="认证源码"><a href="#认证源码" class="headerlink" title="认证源码"></a>认证源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 认证源码分析过程:</span></span><br><span class="line"><span class="comment"># self.perform_authentication(request)---&gt;新的request对象的.user(是个方法，包装成了数据数属性)---&gt;新的Request类中找到了user方法---&gt;self._authenticate()---&gt;Request类中的_authenticate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_authenticate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> authenticator <span class="keyword">in</span> self.authenticators: <span class="comment"># 配置在视图类中认证类实例化得到的对象</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                user_auth_tuple = authenticator.authenticate(self)</span><br><span class="line">            <span class="keyword">except</span> exceptions.APIException:</span><br><span class="line">                self._not_authenticated()</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_auth_tuple <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                self._authenticator = authenticator</span><br><span class="line">                self.user, self.auth = user_auth_tuple</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment"># self.authenticators,self是Request类的对象,authenticators属性是Request这个类在实例化的时候,传入的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Request类在实例化的时候代码</span></span><br><span class="line">    <span class="keyword">return</span> Request(</span><br><span class="line">            request,</span><br><span class="line">            parsers=self.get_parsers(),</span><br><span class="line">            authenticators=self.get_authenticators(),  <span class="comment"># 要看的</span></span><br><span class="line">            negotiator=self.get_content_negotiator(),</span><br><span class="line">            parser_context=parser_context</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># self.get_authenticators()是APIView的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authenticators</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="comment"># 列表推导式</span></span><br><span class="line">            <span class="keyword">return</span> [auth() <span class="keyword">for</span> auth <span class="keyword">in</span> self.authentication_classes]</span><br><span class="line">            <span class="comment"># 返回结果是我们配在视图类中自己写的认证类列表的对象</span></span><br><span class="line">            <span class="keyword">return</span> [LoginAuth(),]</span><br></pre></td></tr></table></figure>

<h2 id="权限源码"><a href="#权限源码" class="headerlink" title="权限源码"></a>权限源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限源码分析:</span></span><br><span class="line"><span class="comment"># APIView---》dispatch-self.initial---》self.check_permissions(request)</span></span><br><span class="line">   <span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions(): 		<span class="comment"># 一个个权限类对象</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> permission.has_permission(request, self):</span><br><span class="line">                self.permission_denied(</span><br><span class="line">                    request,</span><br><span class="line">                    message=<span class="built_in">getattr</span>(permission, <span class="string">&#x27;message&#x27;</span>, <span class="literal">None</span>),</span><br><span class="line">                    code=<span class="built_in">getattr</span>(permission, <span class="string">&#x27;code&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<h2 id="频率源码"><a href="#频率源码" class="headerlink" title="频率源码"></a>频率源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 频率源码分析</span></span><br><span class="line"><span class="comment"># APIVIew的dispatch--&gt;self.initial(request,*args,**kwargs)-&gt;self.check_throttles(request)</span></span><br><span class="line">        throttle_durations = []</span><br><span class="line">        <span class="keyword">for</span> throttle <span class="keyword">in</span> self.get_throttles():		<span class="comment"># 一个个频率类对象</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> throttle.allow_request(request, self):</span><br><span class="line">                throttle_durations.append(throttle.wait())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> throttle_durations:</span><br><span class="line">            <span class="comment"># Filter out `None` values which may happen in case of config / rate</span></span><br><span class="line">            <span class="comment"># changes, see #1438</span></span><br><span class="line">            durations = [duration <span class="keyword">for</span> duration <span class="keyword">in</span> throttle_durations <span class="keyword">if</span> duration <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">            duration = <span class="built_in">max</span>(durations, default=<span class="literal">None</span>)</span><br><span class="line">            self.throttled(request, duration)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/22/JWT%E8%AE%A4%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/22/JWT%E8%AE%A4%E8%AF%81/" class="post-title-link" itemprop="url">JWT认证</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-22 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-22T18:20:25+08:00">2019-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JWT认证"><a href="#JWT认证" class="headerlink" title="JWT认证"></a>JWT认证</h1><h2 id="1-JWT介绍"><a href="#1-JWT介绍" class="headerlink" title="1.JWT介绍"></a>1.JWT介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jwt是什么?</span></span><br><span class="line">	Json web token (JWT),一种前后端的认证方式</span><br><span class="line">    </span><br><span class="line"><span class="comment"># jwt的构成:</span></span><br><span class="line">	-三段式(header,payload,signature)</span><br><span class="line">    -头：认证方式,加密方式,公司名字...</span><br><span class="line">    	&#123;</span><br><span class="line">          <span class="string">&#x27;typ&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,		<span class="comment"># 声明类型</span></span><br><span class="line">          <span class="string">&#x27;alg&#x27;</span>: <span class="string">&#x27;HS256&#x27;</span>	<span class="comment"># 声明加密算法</span></span><br><span class="line">        &#125;</span><br><span class="line">        使用base64转码:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9   <span class="comment"># jwt第一部分</span></span><br><span class="line">            </span><br><span class="line">    -荷载：用户信息，过期时间，签发时间...</span><br><span class="line">    	&#123;</span><br><span class="line">          <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,	</span><br><span class="line">          <span class="string">&quot;exp&quot;</span>: <span class="number">1214356</span>		<span class="comment"># jwt过期时间</span></span><br><span class="line">        &#125;</span><br><span class="line">        使用base64转码:eyJzdWIiOiIxMjM...Y3ODkwIiwibmFtZSI6I  <span class="comment"># jwt第二部分</span></span><br><span class="line">            </span><br><span class="line">    -签名</span><br><span class="line">    	将前面的头和荷载通过某种加密方式得到的 串 </span><br><span class="line">        结合一二部分通过header中声明加密方式进行加盐secret组合加密	  <span class="comment"># 构成jwt第三部分</span></span><br><span class="line">       	将这三个部分用<span class="string">&#x27;.&#x27;</span>连接成一个完整字符串,构成最终的jwt	`</span><br><span class="line">    	</span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">	secret是保存在服务器端的，jwt的签发生成也是在服务器端的，secret就是用来进行jwt的签发和jwt的验证，所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以签发jwt了</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># (工作原理)签发和校验</span></span><br><span class="line">	签发:</span><br><span class="line">        用户登录成功，构造token的头部(base64编码)，固定的，构造荷载(base64编码)，使用设置好的加密方式对头和荷载加密，得到token，拼到最后，生成一个token串,eg:</span><br><span class="line">  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br><span class="line"></span><br><span class="line">	校验:</span><br><span class="line">        用户携带token,来到后端,把头和荷载再使用同样的加密方式加密,得到签名,比较新签名和旧签名是否一致,如果一致,说明token可以信任,解析出当前用户(荷载)继续往后走</span><br></pre></td></tr></table></figure>

<h2 id="2-JWT快速使用"><a href="#2-JWT快速使用" class="headerlink" title="2.JWT快速使用"></a>2.JWT快速使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 签发和验证</span></span><br><span class="line"><span class="comment"># 使用第三方:</span></span><br><span class="line">	-djangorestframework-jwt			<span class="comment"># 好久不维护，还能用</span></span><br><span class="line">    -djangorestframework-simplejwt		<span class="comment"># 最新的官网:https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># 安装:</span></span><br><span class="line">	pip3 install djangorestframework-jwt</span><br><span class="line">	pip3 install djangorestframework-simplejwt</span><br></pre></td></tr></table></figure>

<h3 id="1-djangorestframework-jwt"><a href="#1-djangorestframework-jwt" class="headerlink" title="1.djangorestframework-jwt"></a>1.djangorestframework-jwt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入:</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 签发token串(加密):</span></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的编码方法,传入用户对象返回荷载payload</span></span><br><span class="line">    jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的编码方法,传入payload返回token串</span></span><br><span class="line">    jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">    </span><br><span class="line">        eg:</span><br><span class="line">            payload = jwt_payload_handler(user)</span><br><span class="line">            token = jwt_encode_handler(payload)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 校验token串(反解校验):</span></span><br><span class="line">    <span class="comment"># 第三方模块rest_framework_jwt提供的解码方法,传入token返回荷载payload</span></span><br><span class="line">	jwt_decode_handler = api_settings.JWT_DECODE_HANDLER</span><br><span class="line">    </span><br><span class="line">    	eg:</span><br><span class="line">            payload = jwt_decode_handler(token)</span><br></pre></td></tr></table></figure>

<h4 id="1-1签发"><a href="#1-1签发" class="headerlink" title="1.1签发"></a>1.1签发</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 签发:</span></span><br><span class="line">	只需要在路由中加入配置,向这个地址发送post请求，携带用户名密码，就可以签发token(内部使用的是auth的user表)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由层配置</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token</span><br><span class="line">	urlpatterns = [</span><br><span class="line">        <span class="comment"># 签发token，登录功能，不需要写了</span></span><br><span class="line">        path(<span class="string">&#x27;login/&#x27;</span>, obtain_jwt_token),</span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只需要在前端向xxx/login/地址发送post请求，携带用户名密码，就可以签发token</span></span><br><span class="line">	eg:</span><br><span class="line">        http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/login/</span><br><span class="line">		&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;lqz&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;lqz12345&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 签发的串:</span></span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImxxeiIsImV4cCI6MTYyNTcyODkwMywiZW1haWwiOiIifQ.SX3kyZJYXQMeJa3MK8raiZNmfGqyR8S3bg1Dvimf_5k</span><br></pre></td></tr></table></figure>

<h4 id="1-2认证"><a href="#1-2认证" class="headerlink" title="1.2认证"></a>1.2认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类中配置，认证类，和权限类</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> JSONWebTokenAuthentication</span><br><span class="line">    <span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        authentication_classes = [JSONWebTokenAuthentication,]</span><br><span class="line">        <span class="comment"># 第三方jwt认证需要结合权限IsAuthenticated才可以正常使用</span></span><br><span class="line">        permission_classes = [IsAuthenticated,]</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 前端访需要认证的接口时,需要在请求头中加入,如果不携带或者篡改就会导致认证不通过</span></span><br><span class="line">	请求头中携带参数:</span><br><span class="line">        Authorization：jwt空格token串</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">	Authorization：jwt eyJ0eXAiOiJKV1QiLChbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJ1c2VybmFtZSI6InJvb3QiLCJleHAiOjE2MjU3Mjk3MDAsImVtYWlsIjoiM0BxcS5jb20ifQ.V6X_4wdBvrrRSPOuUf8z5gENB1kJyGimxiLBEjbiQGY</span><br></pre></td></tr></table></figure>

<h4 id="1-3自定制签发格式"><a href="#1-3自定制签发格式" class="headerlink" title="1.3自定制签发格式"></a>1.3自定制签发格式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义签发格式:</span></span><br><span class="line">	只需要写一个函数，在配置文件中配置即可</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 创建任一py文件书写函数:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span>(<span class="params">token, user=<span class="literal">None</span>, request=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="number">100</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:user.username,</span><br><span class="line">            <span class="string">&#x27;token&#x27;</span>: token,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># settings.py中配置</span></span><br><span class="line">	导入自定义函数并配置到JWT_AUTH相关配置字典中</span><br><span class="line">        JWT_AUTH =&#123;</span><br><span class="line">            <span class="comment"># 设置签发token的过期时间</span></span><br><span class="line">            <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果不自定义,返回的格式是固定只有token字段</span></span><br><span class="line">            <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>:<span class="string">&#x27;自定义返回格式函数绝对路径&#x27;</span>,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-djangorestframework-jwt模块obtain-jwt-token源码分析"><a href="#3-djangorestframework-jwt模块obtain-jwt-token源码分析" class="headerlink" title="3.djangorestframework-jwt模块obtain_jwt_token源码分析"></a>3.djangorestframework-jwt模块obtain_jwt_token源码分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">ObtainJSONWebToken.as_view()---&gt;ObtainJSONWebToken----&gt;post方法</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():  <span class="comment"># 验证用户登录和签发token，都在序列化类的validate方法中完成的</span></span><br><span class="line">            user = serializer.<span class="built_in">object</span>.get(<span class="string">&#x27;user&#x27;</span>) <span class="keyword">or</span> request.user</span><br><span class="line">            token = serializer.<span class="built_in">object</span>.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">            response_data = jwt_response_payload_handler(token, user, request)</span><br><span class="line">            response = Response(response_data)</span><br><span class="line">            <span class="comment"># 返回了咱们自定制的格式 </span></span><br><span class="line">            <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               &#123;</span></span><br><span class="line"><span class="string">                	&#x27;code&#x27;:100,</span></span><br><span class="line"><span class="string">                	&#x27;msg&#x27;:&#x27;登录成功&#x27;,</span></span><br><span class="line"><span class="string">                	&#x27;username&#x27;:user.username,</span></span><br><span class="line"><span class="string">                	&#x27;token&#x27;: token,</span></span><br><span class="line"><span class="string">            	&#125;</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">self, attrs</span>):</span></span><br><span class="line">        credentials = &#123;</span><br><span class="line">            self.username_field: attrs.get(self.username_field),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: attrs.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(credentials.values()):</span><br><span class="line">            <span class="comment"># 根据用户名密码去auth的user表校验，是否存在</span></span><br><span class="line">            user = authenticate(**credentials)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                    msg = _(<span class="string">&#x27;User account is disabled.&#x27;</span>)</span><br><span class="line">                    <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br><span class="line">				<span class="comment"># 生成payload</span></span><br><span class="line">                payload = jwt_payload_handler(user)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&#x27;token&#x27;</span>: jwt_encode_handler(payload), <span class="comment"># 通过payload生成token</span></span><br><span class="line">                    <span class="string">&#x27;user&#x27;</span>: user</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">               <span class="comment"># 不在抛异常，前端就看到信息了</span></span><br><span class="line">                <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(msg)</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/15/Drf%E8%AE%A4%E8%AF%81%E6%9D%83%E9%99%90%E5%8F%8A%E9%A2%91%E7%8E%87/" class="post-title-link" itemprop="url">Drf过认证权限频率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-15 18:20:25" itemprop="dateCreated datePublished" datetime="2019-06-15T18:20:25+08:00">2019-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-认证Authentication"><a href="#1-认证Authentication" class="headerlink" title="1.认证Authentication"></a>1.认证Authentication</h2><h3 id="1-1自定义认证"><a href="#1-1自定义认证" class="headerlink" title="1.1自定义认证"></a>1.1自定义认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义认证的实现:</span></span><br><span class="line">	写一个类,继承BaseAuththentication,重写authenticate方法,认证逻辑写在该方法内</span><br><span class="line">    	认证通过:</span><br><span class="line">            返回两个值,其中一个值最终给了Request对象的user</span><br><span class="line">        认证失败:</span><br><span class="line">            抛异常:APIException或者AuthenticationFailed</span><br></pre></td></tr></table></figure>

<h4 id="自定义认证流程"><a href="#自定义认证流程" class="headerlink" title="自定义认证流程"></a>自定义认证流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件编写自己的认证类,并继承继承BaseAuththentication父类,重写authenticate方法,认证逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义认证类</span></span><br><span class="line"><span class="comment"># 3.认证生效范围配置:</span></span><br><span class="line">	全局认证:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部认证:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,认证只生效该视图类</span></span><br><span class="line">        authentication_classes = [MyAuth]</span><br><span class="line">        </span><br><span class="line"><span class="comment"># ps:全局认证局部不认证</span></span><br><span class="line">    <span class="number">1.</span>先在settings.py中配置好全局认证</span><br><span class="line">    <span class="number">2.</span>视图类书写:authentication_classes = [](优先使用局部)</span><br></pre></td></tr></table></figure>

<h4 id="编写models"><a href="#编写models" class="headerlink" title="编写models"></a>编写models</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    username=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    user_type=models.IntegerField(choices=((<span class="number">1</span>,<span class="string">&#x27;超级用户&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;普通用户&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;二笔用户&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserToken</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    user=models.OneToOneField(to=<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line">    token=models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写认证类"><a href="#编写认证类" class="headerlink" title="编写认证类"></a>编写认证类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用下创建任一py文件并编写认证类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> AuthenticationFailed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyAuth</span>(<span class="params">BaseAuthentication</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="comment"># 从请求头中获取当次请求携带的token字符串(登录后会返回随机字符串,未登录则没有随机字符串)</span></span><br><span class="line">            token = request.META.get(<span class="string">&#x27;HTTP_TOKEN&#x27;</span>)</span><br><span class="line">            <span class="comment"># token = request.query_params.get(&#x27;token&#x27;)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">                <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;请求头中缺少token参数&#x27;</span>)</span><br><span class="line">            user_token = UserToken.objects.<span class="built_in">filter</span>(token=token).first()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_token:</span><br><span class="line">                <span class="keyword">return</span> user_token.user, token</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">&#x27;校验失败&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="编写视图类"><a href="#编写视图类" class="headerlink" title="编写视图类"></a>编写视图类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入需要的py文件并编写视图类</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line">    <span class="keyword">from</span> app01.models <span class="keyword">import</span> User, UserToken</span><br><span class="line">    <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">    <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyAuth</span><br><span class="line">    <span class="keyword">import</span> uuid</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">LoginView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">   </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            user = User.objects.<span class="built_in">filter</span>(username=username, password=password).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                token = uuid.uuid4()</span><br><span class="line">                <span class="comment"># 根据user=user去查询,如果有,使用defaults更新,如果没有,新增一条</span></span><br><span class="line">                UserToken.objects.update_or_create(defaults=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;, user=user)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">100</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;登陆成功&#x27;</span>, <span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">101</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;用户名或密码错误&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="全局认证"><a href="#全局认证" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="comment"># 中括号内填写认证类的绝对路径</span></span><br><span class="line">        <span class="string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span>:[<span class="string">&quot;app01.MyAuthenticate.MyAuth&quot;</span>]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部认证"><a href="#局部认证" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line">	<span class="comment"># 中括号内填写认证类名</span></span><br><span class="line">	authentication_classes = [MyAuth]</span><br></pre></td></tr></table></figure>

<h3 id="1-2内置认证"><a href="#1-2内置认证" class="headerlink" title="1.2内置认证"></a>1.2内置认证</h3><h4 id="全局认证-1"><a href="#全局认证-1" class="headerlink" title="全局认证"></a>全局认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局认证,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <span class="comment"># session认证</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,   	<span class="comment"># 基本认证</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 认证失败会有两种可能的返回值:</span></span><br><span class="line">	<span class="number">401</span> Unauthorized 未认证</span><br><span class="line">	<span class="number">403</span> Permission Denied 权限被禁止</span><br></pre></td></tr></table></figure>

<h4 id="局部认证-1"><a href="#局部认证-1" class="headerlink" title="局部认证"></a>局部认证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部认证,只需要在视图类里加入类属性:</span></span><br><span class="line"></span><br><span class="line">导入内置认证类:</span><br><span class="line">    <span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication, BasicAuthentication</span><br><span class="line"></span><br><span class="line">配置类属性:</span><br><span class="line">    authentication_classes = [SessionAuthentication, BasicAuthentication]</span><br></pre></td></tr></table></figure>

<h2 id="2-权限Permissions"><a href="#2-权限Permissions" class="headerlink" title="2.权限Permissions"></a>2.权限Permissions</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 权限控制可以限制用户对于视图的访问和对于具体数据对象的访问</span></span><br><span class="line">    -在执行视图的dispatch()方法前，会先进行视图访问权限的判断</span><br><span class="line">	-在通过get_object()获取具体对象时，会进行模型对象访问权限的判断</span><br></pre></td></tr></table></figure>

<h3 id="2-1自定义权限"><a href="#2-1自定义权限" class="headerlink" title="2.1自定义权限"></a>2.1自定义权限</h3><h4 id="自定义权限流程"><a href="#自定义权限流程" class="headerlink" title="自定义权限流程"></a>自定义权限流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建任一py文件,编写权限类(继承或不继承BasePermission父类),重写has_permission方法,权限逻辑写在该方法内</span></span><br><span class="line"><span class="comment"># 2.编写视图类,并导入自定义权限类</span></span><br><span class="line"><span class="comment"># 3.权限生效范围配置:</span></span><br><span class="line">	全局权限:</span><br><span class="line">        REST_FRAMEWORK=&#123;</span><br><span class="line">        	<span class="comment"># 中括号内填写权限类的绝对路径</span></span><br><span class="line">        	<span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">    局部权限:</span><br><span class="line">        <span class="comment"># 视图类中加类属性,权限只生效该视图类</span></span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="编写权限类"><a href="#编写权限类" class="headerlink" title="编写权限类"></a>编写权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建任一py文件或写在上述认证类中都可</span></span><br><span class="line">	<span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">MyPermission</span>(<span class="params">BasePermission</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="keyword">if</span> request.user.user_type == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限"><a href="#全局权限" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span>: [<span class="string">&quot;app01.MyAuthenticate.MyPermission&quot;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限"><a href="#局部权限" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyPermission</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [MyPermission]</span><br></pre></td></tr></table></figure>

<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如需自定义权限，需继承rest_framework.permissions.BasePermission父类，并实现以下两个任何一个方法或全部</span></span><br><span class="line">    - `.has_permission(self, request, view)`</span><br><span class="line">      是否可以访问视图,view表示当前视图对象</span><br><span class="line"></span><br><span class="line">    - `.has_object_permission(self, request, view, obj)`</span><br><span class="line">      是否可以访问数据对象,view表示当前视图,obj为数据对象</span><br></pre></td></tr></table></figure>

<h3 id="2-2内置权限"><a href="#2-2内置权限" class="headerlink" title="2.2内置权限"></a>2.2内置权限</h3><h4 id="内置权限类"><a href="#内置权限类" class="headerlink" title="内置权限类"></a>内置权限类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf提供的内置权限类,一般配套内置认证使用</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny,IsAuthenticated,IsAdminUser,IsAuthenticatedOrReadOnly</span><br><span class="line">    - AllowAny 						<span class="comment"># 允许所有用户</span></span><br><span class="line">    - IsAuthenticated 				<span class="comment"># 仅通过认证的用户</span></span><br><span class="line">    - IsAdminUser 					<span class="comment"># 仅管理员用户</span></span><br><span class="line">    - IsAuthenticatedOrReadOnly 	<span class="comment"># 登陆认证用户可以对数据进行增删改操作，未登陆认证的只能查看数据</span></span><br></pre></td></tr></table></figure>

<h4 id="全局权限-1"><a href="#全局权限-1" class="headerlink" title="全局权限"></a>全局权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置,在settings.py文件中配置:</span></span><br><span class="line">    REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 通过认证的用户才有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 若未指明,则采用如下配置:</span></span><br><span class="line">	REST_FRAMEWORK=&#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="comment"># 所有用户都有权限</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部权限-1"><a href="#局部权限-1" class="headerlink" title="局部权限"></a>局部权限</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部权限,只需要在视图类里加入类属性:</span></span><br><span class="line">    导入权限类:</span><br><span class="line">        <span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line">    视图类属性:</span><br><span class="line">        permission_classes = [IsAuthenticated]</span><br></pre></td></tr></table></figure>

<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建超级用户，登陆到admin，创建普通用户(注意设置职员状态，也就是能登陆)</span></span><br><span class="line"><span class="comment"># 全局配置IsAuthenticated</span></span><br><span class="line"><span class="comment"># setting.py</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"> 	path(<span class="string">&#x27;test/&#x27;</span>, views.TestView.as_view()),</span><br><span class="line">    </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;个人中心&#x27;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 登陆到admin后台后，直接访问可以，如果没登陆，不能访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意:如果全局配置了</span></span><br><span class="line">	rest_framework.permissions.IsAdminUser</span><br><span class="line"><span class="comment"># 就只有管理员能访问，其他用户访问不了</span></span><br></pre></td></tr></table></figure>

<h2 id="3-访问频率Throttling"><a href="#3-访问频率Throttling" class="headerlink" title="3.访问频率Throttling"></a>3.访问频率Throttling</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问频率限制用处:</span></span><br><span class="line">    可以对接口访问的频次进行限制，以减轻服务器压力</span><br><span class="line">    一般用于付费购买次数,投票等场景使用</span><br></pre></td></tr></table></figure>

<h3 id="频率限制的使用"><a href="#频率限制的使用" class="headerlink" title="频率限制的使用"></a>频率限制的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制用户的访问次数，根据ip，根据用户id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写个类，继承基类，重写某个方法</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> BaseThrottle,SimpleRateThrottle</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">        scope = <span class="string">&#x27;ip_throttle&#x27;</span>  <span class="comment"># 一定要写</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">            <span class="comment"># 返回谁，就以谁做限制</span></span><br><span class="line">            <span class="comment"># 按ip限制</span></span><br><span class="line">            <span class="built_in">print</span>(request.META)</span><br><span class="line">            <span class="keyword">return</span> request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在视图类中配置</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 在配置文件中配置</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 频率限制的配置信息</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ip_throttle&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>  <span class="comment"># key要跟类中的scop对应，1分钟只能访问3此</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 局部使用</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ViewSetMixin,ListAPIView</span>):</span></span><br><span class="line">        throttle_classes = [MyThrottle,]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 全局使用（在配置文件中）</span></span><br><span class="line">	<span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [<span class="string">&#x27;app01.auth.MyThrottle&#x27;</span>],</span><br></pre></td></tr></table></figure>

<h3 id="3-1自定义频率类"><a href="#3-1自定义频率类" class="headerlink" title="3.1自定义频率类"></a>3.1自定义频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义频率类逻辑:</span></span><br><span class="line">    <span class="number">1.</span>取出访问者ip</span><br><span class="line">    <span class="number">2.</span>判断当前ip不在访问字典里,添加进去,并且直接返回<span class="literal">True</span>,表示第一次访问,在字典里,继续往下走</span><br><span class="line">    <span class="number">3.</span>循环判断当前ip的列表，有值并且当前时间减去列表的最后一个时间大于60s，把这种数据pop掉，这样列表中只有60s以内的访问时间</span><br><span class="line">    <span class="number">4.</span>判断当前列表长度:</span><br><span class="line">        当列表小于<span class="number">3</span>,说明一分钟以内访问不足三次,把当前时间插入到列表第一个位置,返回<span class="literal">True</span>,通过</span><br><span class="line">    	当大于等于<span class="number">3</span>,说明一分钟内访问超过三次,返回<span class="literal">False</span>验证失败</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 自定义频率类MyThrottles</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThrottles</span>():</span></span><br><span class="line">    VISIT_RECORD = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.history = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="comment"># 1.取出访问者ip</span></span><br><span class="line">        <span class="comment"># print(request.META)</span></span><br><span class="line">        ip = request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>)</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="comment"># 2.判断当前ip不在访问字典里，添加进去，并且直接返回True,表示第一次访问</span></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> self.VISIT_RECORD:</span><br><span class="line">            self.VISIT_RECORD[ip] = [ctime, ]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        self.history = self.VISIT_RECORD.get(ip)</span><br><span class="line">        <span class="comment"># 3.循环判断当前ip的列表,有值并且当前时间减去列表最后一个时间大于60s,pop掉这种数据,这样列表中仅剩60s以内的访问时间</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> ctime - self.history[-<span class="number">1</span>] &gt; <span class="number">60</span>:</span><br><span class="line">            <span class="comment"># 默认取走列表中最后一个属性值</span></span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="comment"># 4.判断,当列表小于3,说明一分钟内访问不足三次,把当前时间插入到列表第一个位置,返回True,顺利通过</span></span><br><span class="line">        <span class="comment"># 5.当大于等于3,说明一分钟内访问超过三次，返回False验证失败</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history) &lt; <span class="number">3</span>:</span><br><span class="line">            self.history.insert(<span class="number">0</span>, ctime)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        ctime = time.time()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span> - (ctime - self.history[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h4 id="全局限次"><a href="#全局限次" class="headerlink" title="全局限次"></a>全局限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py文件中配置:</span></span><br><span class="line">	REST_FRAMEWORK = &#123; </span><br><span class="line">        <span class="comment"># 访问频率全局配置,访问限次已经在频率类中写好,不用指定</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>:[<span class="string">&#x27;app01.MyAuthenticate.MyThrottles&#x27;</span>],</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="局部限次"><a href="#局部限次" class="headerlink" title="局部限次"></a>局部限次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在视图类里添加属性:</span></span><br><span class="line">	导入频率限次类:</span><br><span class="line">        <span class="keyword">from</span> app01.MyAuthenticate <span class="keyword">import</span> MyThrottles</span><br><span class="line">    添加类属性:</span><br><span class="line">		throttle_classes = [MyThrottles,]</span><br></pre></td></tr></table></figure>

<h3 id="3-2内置频率类"><a href="#3-2内置频率类" class="headerlink" title="3.2内置频率类"></a>3.2内置频率类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf内置频率类,配套内置认证内置权限使用,频率类又区分为登录和未登录:</span></span><br><span class="line">	REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="comment"># 访问频率全局配置</span></span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,		<span class="comment"># 未登录访问限次</span></span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>		<span class="comment"># 登录访问限次</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;5/m&#x27;</span>,		<span class="comment"># 未登录一分钟访问限次五次</span></span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span>		<span class="comment"># 登录一分钟访问限次十次</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="限制匿名用户每分钟访问3次-未登录"><a href="#限制匿名用户每分钟访问3次-未登录" class="headerlink" title="限制匿名用户每分钟访问3次(未登录)"></a>限制匿名用户每分钟访问3次(未登录)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全局配置:</span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;3/m&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 使用second(秒),minute(分钟),hour(小时)或day(天)来指明周期。</span></span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="限制登陆用户每分钟访问10次"><a href="#限制登陆用户每分钟访问10次" class="headerlink" title="限制登陆用户每分钟访问10次"></a>限制登陆用户每分钟访问10次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置:</span></span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">            <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/m&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 可以全局使用，局部使用</span></span><br></pre></td></tr></table></figure>

<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.AnonRateThrottle</span></span><br><span class="line">	限制所有匿名未认证用户，使用IP区分用户。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;anon&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.UserRateThrottle</span></span><br><span class="line">	限制认证用户，使用User <span class="built_in">id</span> 来区分。</span><br><span class="line">	使用DEFAULT_THROTTLE_RATES[<span class="string">&#x27;user&#x27;</span>] 来设置频次</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ScopedRateThrottle</span></span><br><span class="line">	限制用户对于每个视图的访问频次，使用ip或user <span class="built_in">id</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    <span class="comment"># 视图类:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactListView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">        	throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">        	...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ContactDetailView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;contacts&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UploadView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">            throttle_scope = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># setting.py配置</span></span><br><span class="line">        REST_FRAMEWORK = &#123;</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;rest_framework.throttling.ScopedRateThrottle&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;contacts&#x27;</span>: <span class="string">&#x27;1000/day&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;uploads&#x27;</span>: <span class="string">&#x27;20/day&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

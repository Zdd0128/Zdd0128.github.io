<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/24/auth%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/24/auth%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">auth模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-24 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-24T18:20:25+08:00">2019-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="auth模块"><a href="#auth模块" class="headerlink" title="auth模块"></a>auth模块</h1><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auth模块主要是用来做用户相关的功能</span><br><span class="line">	注册 登录 验证 修改密码 注销</span><br><span class="line"></span><br><span class="line">访问admin需要管理员账号</span><br><span class="line">	该账号数据均来源于数据库迁移之后生成的auth_user表</span><br><span class="line">    </span><br><span class="line">如何创建admin管理员账号</span><br><span class="line">	createsuperuser</span><br></pre></td></tr></table></figure>

<h3 id="方法总结"><a href="#方法总结" class="headerlink" title="方法总结"></a>方法总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.比对用户名和密码是否正确</span></span><br><span class="line">    user_obj =auth.authenticate(request,username=username,password=password)</span><br><span class="line">    <span class="comment">#括号内必须同时传入用户名和密码</span></span><br><span class="line">    <span class="built_in">print</span>(user_obj) 				<span class="comment"># 用户对象  jason  数据不符合则返回None</span></span><br><span class="line">    <span class="built_in">print</span> (user_obj.username) 		<span class="comment"># jason</span></span><br><span class="line">    <span class="built_in">print</span> (user_obj.password) 		<span class="comment"># 密文</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.保存用户状态</span></span><br><span class="line">	auth.login(request,user_obj) <span class="comment"># 类似于request.session[key] = user_obj</span></span><br><span class="line">	<span class="comment"># 只要执行了该方法 你就可以在任何地方通过request.user获取到当前登陆的用户对象</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 3.判断当前用户是否登陆</span></span><br><span class="line">	request.user.is_authenticated()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 4.获取当前登陆用户</span></span><br><span class="line">	request.user</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 5.校验用户是否登陆装饰器</span></span><br><span class="line">	<span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line">	<span class="comment">#局部配置</span></span><br><span class="line"><span class="meta">		@login_required(<span class="params">login_url=<span class="string">&#x27;/1ogin/&#x27;</span></span>)</span></span><br><span class="line">	<span class="comment">#全局配置</span></span><br><span class="line">		LOGIN_URL = <span class="string">&#x27;/login/&#x27;</span></span><br><span class="line">	<span class="number">1.</span>如果局部和全局都有该听谁的?</span><br><span class="line">		局部&gt;全局</span><br><span class="line">	<span class="number">2.</span>局部和全局哪个好呢?</span><br><span class="line">		全局的好处在于无需重复写代码但是跳转的页面却很单一</span><br><span class="line">		局部的好处在于不同的视图函数在用户没有登陆的情况下可以跳转到不同的页面</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 6.比对原密码</span></span><br><span class="line">request.user.checkpassword(old_password)|</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.修改密码</span></span><br><span class="line">	request.user.set_password(new_password) 	<span class="comment"># 仅仅是在修改对象的属性</span></span><br><span class="line">	request.user.save() 						<span class="comment"># 这一步才是真正的操作数据库</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 8.注销</span></span><br><span class="line">	auth.logout(request)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 9.注册</span></span><br><span class="line">	<span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">	<span class="comment">#操作auth_user表写入数据 </span></span><br><span class="line">		User.objects.create(username=username,password=password) <span class="comment"># 写入数据 不能用create 密码没有加密处理</span></span><br><span class="line">	<span class="comment">#创建普通用户</span></span><br><span class="line">	User.objects.create_user(username=username,password=password)</span><br><span class="line">	<span class="comment">#创建超级用户(了解):使用代码创建超级用户邮箱是必填的 而用命令创建则可以不填</span></span><br><span class="line">    User.objects.create_superuser(username=username,email=<span class="string">&#x27;123@qq.com&#x27;</span>,password=password)</span><br></pre></td></tr></table></figure>

<h3 id="如何扩展auth-user表"><a href="#如何扩展auth-user表" class="headerlink" title="如何扩展auth_user表"></a>如何扩展auth_user表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.dbimport models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User,Abstractuser</span><br><span class="line"><span class="comment"># Create your modelshere.</span></span><br><span class="line"><span class="comment"># 第一种: 一对一关系 不推荐</span></span><br><span class="line"><span class="comment"># classUserDetail(models.Model):</span></span><br><span class="line">    <span class="comment">#phone = models.BigIntegerField( )</span></span><br><span class="line">    <span class="comment">#user = models.OneTooneField(to=&#x27;User&#x27;)</span></span><br><span class="line"><span class="comment">#第二种:面向对象的继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> (<span class="params"> AbstractUser</span>):</span> </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    如果继承了AbstractUser</span></span><br><span class="line"><span class="string">    那么在执行数据库迁移命令的时候auth_ _user表就不会再创建出来了</span></span><br><span class="line"><span class="string">    而UserInfo表中会出现auth_ user所有的字段外加自己扩展的字段</span></span><br><span class="line"><span class="string">    这么做的好处在于你能够直接点击你自己的表更加快速的完成操作及扩展</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">	前提:</span></span><br><span class="line"><span class="string">        1.在继承之前没有执行过数据库迁移命令</span></span><br><span class="line"><span class="string">        	auth_user没有被创建,如果当前库已经创建了那么你就重新换一个库</span></span><br><span class="line"><span class="string">        2.继承的类里面不要覆盖AbstractUser里面的字段名</span></span><br><span class="line"><span class="string">        	表里面有的字段都不要动,只扩展额外字段即可</span></span><br><span class="line"><span class="string">        3.需要在配置文件中告诉django你要用userInfo替代auth_user</span></span><br><span class="line"><span class="string">        	AUTH_USER_MODEL = &#x27;app01.UserInfo&#x27;</span></span><br><span class="line"><span class="string">            					&#x27;应用名.表名&#x27;</span></span><br><span class="line"><span class="string">     &#x27;&#x27;&#x27;</span></span><br><span class="line">        phone = models. BigIntegerField()</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">你如果自己写表替代了auth_user</span></span><br><span class="line"><span class="string">那么auth模块的功能还是正常使用 参考的表由原来的auth_user变成了你自己写的表</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="settings源码"><a href="#settings源码" class="headerlink" title="settings源码"></a>settings源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">django有两个配置文件</span><br><span class="line">	一个是暴露给用户自定义的配置</span><br><span class="line">    一个是项目默认的配置</span><br><span class="line">用户没有配置的情况下使用的是项目默认的配置</span><br><span class="line">用户配置了的情况下则使用用户配置的</span><br><span class="line"></span><br><span class="line">如何实现</span><br><span class="line">	先读取项目默认配置</span><br><span class="line">    再读取自定义配置</span><br><span class="line">    <span class="comment"># 字典的键存在则替换 不存在则创建</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazySettings</span>(<span class="params">...</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_setup</span>(<span class="params">self, name=<span class="literal">None</span></span>):</span></span><br><span class="line">        settings_module = os.environ.get(ENVIRONMENT_VARIABLE)  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">		self._wrapped = Settings(settings_module)  <span class="comment"># Settings(&#x27;day53.settings&#x27;)</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Settings</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, settings_module</span>):</span>  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> setting <span class="keyword">in</span> <span class="built_in">dir</span>(global_settings):  <span class="comment"># 获取全局配置文件可以点的变量名</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper():  <span class="comment"># 校验配置必须全大写</span></span><br><span class="line">                <span class="built_in">setattr</span>(self, setting, <span class="built_in">getattr</span>(global_settings, setting))</span><br><span class="line">                <span class="comment"># setting指代的是所有全大写的变量名</span></span><br><span class="line">                <span class="comment"># getattr(global_settings, setting)获取全大写变量名对应的值</span></span><br><span class="line">                <span class="comment"># 给对象设置属性 可以简单的理解为 给字典添加键值对</span></span><br><span class="line">        self.SETTINGS_MODULE = settings_module  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">        mod = importlib.import_module(self.SETTINGS_MODULE)</span><br><span class="line">settings = LazySettings(...)</span><br><span class="line">	   <span class="keyword">for</span> setting <span class="keyword">in</span> <span class="built_in">dir</span>(mod):  <span class="comment"># 获取</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper():</span><br><span class="line">                setting_value = <span class="built_in">getattr</span>(mod, setting)</span><br><span class="line">                <span class="built_in">setattr</span>(self, setting, setting_value)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/20/Django%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/20/Django%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="post-title-link" itemprop="url">Django中间件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-20 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-20T18:20:25+08:00">2019-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Django中间件"><a href="#Django中间件" class="headerlink" title="Django中间件"></a>Django中间件</h1><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">什么是中间件?</span><br><span class="line">	中间件就是程序中可织入的，可重用的，与业务逻辑无关的各种组件</span><br><span class="line">    中间件处于操作系统软件与用户的应用软件的中间</span><br><span class="line">	中间件在操作系统、网络和数据库之上,应用软件的下层,总的作用是为处于自己上层的应用软件提供运行与开发的环境，帮助用户灵活、高效地开发和集成复杂的应用软件。</span><br><span class="line">    </span><br><span class="line">django中间件</span><br><span class="line">	类似于django的保安 请求来的时候和响应走的时都必须经过他</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django默认有七个中间件</span></span><br><span class="line">	每个中间件你可以简单的理解为具有不同的功能</span><br></pre></td></tr></table></figure>

<h3 id="1-自定义中间件"><a href="#1-自定义中间件" class="headerlink" title="1.自定义中间件"></a>1.自定义中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义中间件</span></span><br><span class="line">    <span class="number">1.</span>在应用或项目文件夹下创建任意一个文件夹</span><br><span class="line">    <span class="number">2.</span>在该文件夹内创建任意一个py文件</span><br><span class="line">    <span class="number">3.</span>在py文件内书写自己的类,该类要继承所有中间件都继承的 MiddlewareMixin </span><br><span class="line">    (<span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin)</span><br><span class="line">    <span class="number">4.</span>需要在配置文件中书写类的完整路径</span><br><span class="line">    	MIDDLEWARE = [</span><br><span class="line">                <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;自己定义的中间件路径1&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;自己定义的中间件路径2&#x27;</span>,</span><br><span class="line">            	...</span><br><span class="line">					]</span><br><span class="line">ps:</span><br><span class="line">    django中间件可以用于编写全局相关的功能</span><br><span class="line">    	eg:全局身份校验  全局防爬校验 </span><br></pre></td></tr></table></figure>

<h3 id="2-process-request与process-response-掌握"><a href="#2-process-request与process-response-掌握" class="headerlink" title="2.process_request与process_response(掌握)"></a>2.process_request与process_response(掌握)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>process_request(self,request)</span><br><span class="line">	<span class="number">1.</span>请求来的时候按照配置文件中注册的中间件从上往下依次走每个中间件里的process_request方法,没有定义直接跳过</span><br><span class="line">	<span class="number">2.</span>该方法也可以返回HttpResponse对象,一旦返回了则请求不再继续往下走,直接原路返回(可借助此方法实现很多限制校验功能)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>process_response(self,request,response)</span><br><span class="line">	<span class="number">1.</span>响应走的时候会依次按照配置文件中注册的中间件从下往上依次经过每个中间件里的process_response方法,没有定义直接跳过	</span><br><span class="line">	<span class="number">2.</span>形参response就是返回给前端浏览器的内容,该方法要么将response返回要么自己返回一个HttpResponse对象</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	1.只要是形参中带有response的方法 那么该方法就必须返回一个response对象或HttpResponse对象</span></span><br><span class="line"><span class="string">    2.当process_request返回HttpResponse对象之后,会直接走同级别process_response往上,而不会将所有的process_response都走一遍</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">	在Flask框架也有类似的中间件 但flask的特点是只要返回响应就必须将所有类似于process_response功能方法全部走一遍</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-中间件了解"><a href="#3-中间件了解" class="headerlink" title="3.中间件了解"></a>3.中间件了解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>process_view(self,view_name,*args,**kwargs)</span><br><span class="line">	路由匹配成功之后执行视图函数之前自动触发</span><br><span class="line">	</span><br><span class="line"><span class="number">2.</span>process_exception(self,request,exception)</span><br><span class="line">	当视图函数报错之后自动执行</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>process_template_response(self,request,response)</span><br><span class="line">	返回的HttpResponse对象必须含有render属性(或表明该对象是一个TemplateResponse对象或等价方法)</span><br></pre></td></tr></table></figure>

<h3 id="4-csrf跨站请求伪造"><a href="#4-csrf跨站请求伪造" class="headerlink" title="4.csrf跨站请求伪造"></a>4.csrf跨站请求伪造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">钓鱼网站</span><br><span class="line"></span><br><span class="line">理论:</span><br><span class="line">    做一个与正规网站一模一样的界面 用户在上面操作</span><br><span class="line">    比如转账</span><br><span class="line">    转账请求确实是发送给了正规的网站后台只不过收款人变了</span><br><span class="line">    变成了钓鱼网站指定的账户</span><br><span class="line">原理:</span><br><span class="line">    获取用户输入的表单内容</span><br><span class="line">    给用户展示了一个没有name属性的框</span><br><span class="line">    自己偷偷的写了一个既有name又有value的隐藏框</span><br></pre></td></tr></table></figure>

<h3 id="5-如何做到csrf符合校验"><a href="#5-如何做到csrf符合校验" class="headerlink" title="5.如何做到csrf符合校验"></a>5.如何做到csrf符合校验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms表单</span></span><br><span class="line">	表单中直接书写下列的语句即可:</span><br><span class="line">		&#123;% csrf_token %&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># ajax</span></span><br><span class="line">	方式<span class="number">1</span>:借助于&#123;% csrf_token %&#125;生成的标签(不推荐)</span><br><span class="line">		data:&#123;<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:$(<span class="string">&quot;[name=csrfmiddlewaretoken]&quot;</span>).val()&#125;</span><br><span class="line">    </span><br><span class="line">    方式<span class="number">2</span>:借助于模板语法直接获取</span><br><span class="line">    	data:&#123;<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:<span class="string">&#x27;&#123;&#123; csrf_token &#125;&#125;&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    方式<span class="number">3</span>:将官方提供的代码写入js文件后引入即可</span><br></pre></td></tr></table></figure>

<h4 id="官方提供代码"><a href="#官方提供代码" class="headerlink" title="官方提供代码"></a>官方提供代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function getCookie(name) &#123;</span><br><span class="line">    var cookieValue = null;</span><br><span class="line">    <span class="keyword">if</span> (document.cookie &amp;&amp; document.cookie !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        var cookies = document.cookie.split(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (var i = <span class="number">0</span>; i &lt; cookies.length; i++) &#123;</span><br><span class="line">            var cookie = jQuery.trim(cookies[i]);</span><br><span class="line">            // Does this cookie string begin <span class="keyword">with</span> the name we want?</span><br><span class="line">            <span class="keyword">if</span> (cookie.substring(<span class="number">0</span>, name.length + <span class="number">1</span>) === (name + <span class="string">&#x27;=&#x27;</span>)) &#123;</span><br><span class="line">                cookieValue = decodeURIComponent(cookie.substring(name.length + <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cookieValue;</span><br><span class="line">&#125;</span><br><span class="line">var csrftoken = getCookie(<span class="string">&#x27;csrftoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">function csrfSafeMethod(method) &#123;</span><br><span class="line">  // these HTTP methods do <span class="keyword">not</span> require CSRF protection</span><br><span class="line">  <span class="keyword">return</span> (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">  beforeSend: function (xhr, settings) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!csrfSafeMethod(settings.<span class="built_in">type</span>) &amp;&amp; !this.crossDomain) &#123;</span><br><span class="line">      xhr.setRequestHeader(<span class="string">&quot;X-CSRFToken&quot;</span>, csrftoken);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="6-csrf相关装饰器"><a href="#6-csrf相关装饰器" class="headerlink" title="6.csrf相关装饰器"></a>6.csrf相关装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from django.views.decorators.csrf import csrf_exempt, csrf_protect</span></span><br><span class="line"><span class="string">form django.utils.decorators import method_decorator </span></span><br><span class="line"><span class="string">	csrf_protect  局部校验csrf</span></span><br><span class="line"><span class="string">		针对 csrf_protect 符合CBV装饰器三种方法</span></span><br><span class="line"><span class="string">	csrf_exempt   局部不校验csrf</span></span><br><span class="line"><span class="string">		针对 csrf_exempt 只能给dispatch方法加才生效</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @csrf_protect</span></span><br><span class="line"><span class="comment"># @csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        money = request.POST.get(<span class="string">&#x27;money&#x27;</span>)</span><br><span class="line">        target_user = request.POST.get(<span class="string">&#x27;target_user&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s 给 %s 转了 %s 元钱&#x27;</span>%(username,target_user,money))</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># @method_decorator(csrf_protect,name=&#x27;post&#x27;)  		# 针对csrf_protect 第二种方法可以</span></span><br><span class="line"><span class="comment"># @method_decorator(csrf_exempt,name=&#x27;post&#x27;)  		# 针对csrf_exempt 第二种方法不可以</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogin</span>(<span class="params">views.View</span>):</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  				# 针对csrf_protect 第三种方法可以</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_exempt)  				# 针对csrf_exempt 第三种方法可以</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().dispatch(request,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from get&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  				# 针对csrf_protect 第一种方法可以</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_exempt)  				# 针对csrf_exempt 第一种方法不可以</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from post&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">总结:</span></span><br><span class="line"><span class="string">    两者在FBV上使用方式一样 同普通装饰器玩法</span></span><br><span class="line"><span class="string">	而在CBV上两者却有区别:</span></span><br><span class="line"><span class="string">    	csrf_protect 三种方法都可以使用</span></span><br><span class="line"><span class="string">    	csrf_exempt 只能作用于第三种dispatch方法</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> </span><br></pre></td></tr></table></figure>

<h4 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a>补充知识点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模块:importlib</span></span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">res = <span class="string">&#x27;myfile.b&#x27;</span></span><br><span class="line">ret = importlib.import_module(res)  <span class="comment"># from myfile import b</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    该方法最小只能到py文件名</span><br></pre></td></tr></table></figure>

<h3 id="7-重要思想"><a href="#7-重要思想" class="headerlink" title="7.重要思想"></a>7.重要思想</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __init__</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_all</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">for</span> info <span class="keyword">in</span> settings.INFO_DIRS:  <span class="comment"># &#x27;myfile.email.Email&#x27;</span></span><br><span class="line">        flag, msg = info.rsplit(<span class="string">&#x27;.&#x27;</span>, maxsplit=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># flag = &#x27;myfile.email&#x27;   msg = &#x27;Email&#x27;</span></span><br><span class="line">        <span class="comment"># 1.利用字符串导入模块</span></span><br><span class="line">        res = importlib.import_module(flag)  <span class="comment"># from myfile import email</span></span><br><span class="line">        <span class="comment"># 2.利用反射获取类名</span></span><br><span class="line">        cls = <span class="built_in">getattr</span>(res, msg)  <span class="comment"># Email QQ Wechat</span></span><br><span class="line">        <span class="comment"># 3.生成类的对象</span></span><br><span class="line">        obj = cls()</span><br><span class="line">        <span class="comment"># 4.利用鸭子类型直接调用send方法</span></span><br><span class="line">        obj.send(content)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># settings</span></span><br><span class="line">	INFO_DIRS = [</span><br><span class="line">    <span class="string">&#x27;myfile.email.Email&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.qq.QQ&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.wechat.Wechat&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.phone.Phone&#x27;</span>,</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/16/forms%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/16/forms%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">forms组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-16 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-16T18:20:25+08:00">2019-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="forms组件"><a href="#forms组件" class="headerlink" title="forms组件"></a>forms组件</h1><h3 id="前戏"><a href="#前戏" class="headerlink" title="前戏"></a>前戏</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">前戏</span><br><span class="line">	写一个注册页面获取用户的用户名和密码</span><br><span class="line">    发送到后端之后在后端完成对用户名和密码的数据校验</span><br><span class="line">    	<span class="number">1.</span>用户名里面不能含有JPZ</span><br><span class="line">        <span class="number">2.</span>密码不能为空</span><br><span class="line">    将提示信息渲染到前端页面</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">前端:</span><br><span class="line">    &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    	&lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">        	&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; error_dict.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">    	&lt;/p&gt;</span><br><span class="line">    	&lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">        	&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; error_dict.password &#125;&#125;&lt;/span&gt;</span><br><span class="line">    	&lt;/p&gt;</span><br><span class="line">    		&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">后端:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">        error_dict = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;JPZ&#x27;</span> <span class="keyword">in</span> username:</span><br><span class="line">                error_dict[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;不符合社会主义核心价值观&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(password) == <span class="number">0</span>:</span><br><span class="line">                error_dict[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;密码不能为空 你个DSB!&#x27;</span></span><br><span class="line">            <span class="comment"># 将提示信息返回给前端页面展示</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;reg.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">1.</span>前端页面标签书写</span><br><span class="line"><span class="number">2.</span>前端页面信息展示</span><br><span class="line"><span class="number">3.</span>后端数据校验</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">forms组件可以一条龙服务 帮你完成上面的三件事情</span><br><span class="line">	<span class="number">1.</span>渲染标签</span><br><span class="line">    <span class="number">2.</span>校验数据</span><br><span class="line">    <span class="number">3.</span>展示信息</span><br></pre></td></tr></table></figure>

<h3 id="forms组件校验数据"><a href="#forms组件校验数据" class="headerlink" title="forms组件校验数据"></a>forms组件校验数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms代码书写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="comment"># username字段最少不能少于3位 最多不能超过8位</span></span><br><span class="line">    username = forms.CharField(max_length=<span class="number">8</span>,min_length=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># password字段最大值不能超过699</span></span><br><span class="line">    password = forms.IntegerField(max_value=<span class="number">699</span>)</span><br><span class="line">    <span class="comment"># email字段必须符合邮箱格式</span></span><br><span class="line">    email = forms.EmailField()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 校验数据</span></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># 1.类加括号 传入字典即可</span></span><br><span class="line">	form_obj = views.MyForm(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;嘿嘿嘿&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 2.判断数据是否合法(只有全部合法结果才为True)</span></span><br><span class="line">	form_obj.is_valid()</span><br><span class="line">	<span class="literal">False</span></span><br><span class="line"><span class="comment"># 3.查看所有合法的数据</span></span><br><span class="line">	form_obj.cleaned_data</span><br><span class="line">	&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="number">123</span>&#125;</span><br><span class="line"><span class="comment"># 4.查看所有不合法的数据及原因</span></span><br><span class="line">	form_obj.errors</span><br><span class="line">	&#123;<span class="string">&#x27;email&#x27;</span>: [<span class="string">&#x27;Enter a valid email address.&#x27;</span>]&#125;</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">总结:</span></span><br><span class="line"><span class="string">    1.类加括号传入字典实例化得到对象</span></span><br><span class="line"><span class="string">    2.对象.is_vaild() 		查看传入的数据是否符合条件要求(全部)</span></span><br><span class="line"><span class="string">      对象.cleaned_data 		查看所有合法数据</span></span><br><span class="line"><span class="string">      对象.errors 			查看所有不合法条件</span></span><br><span class="line"><span class="string">    3.校验数据可以多传 但不可少传(默认必传required=True)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件渲染标签"><a href="#forms组件渲染标签" class="headerlink" title="forms组件渲染标签"></a>forms组件渲染标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1.先生成一个对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="comment"># 2.将该对象传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">方式<span class="number">1</span></span><br><span class="line">	简单粗暴 一次性渲染label文本和<span class="built_in">input</span>框</span><br><span class="line">    &#123;&#123; form_obj.as_p &#125;&#125;</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    优点:速度快</span></span><br><span class="line"><span class="string">    缺点:封装程度高 不便于扩展</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">方式<span class="number">2</span></span><br><span class="line">	一步步需要自己书写字段对象</span><br><span class="line">    &#123;&#123; form_obj.username.label &#125;&#125;</span><br><span class="line">    &#123;&#123; form_obj.username &#125;&#125;</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    优点:字段之间相互解耦</span></span><br><span class="line"><span class="string">    缺点:字段多的时候书写麻烦</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">方式<span class="number">3</span></span><br><span class="line">	<span class="keyword">for</span>循环依次获取每个字段对象</span><br><span class="line">	&#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    推荐使用</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># forms组件无法渲染提交按钮和form标签都需要你自己编写</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件展示提示信息"><a href="#forms组件展示提示信息" class="headerlink" title="forms组件展示提示信息"></a>forms组件展示提示信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">	使用forms组件渲染标签之后再获取用户数据的时候</span></span><br><span class="line"><span class="string">	浏览器会自动帮助我们校验数据</span></span><br><span class="line"><span class="string">	但是浏览器层面的数据校验弱不禁风没有实际意义</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何取消浏览器自动校验数据的功能(novalidate)</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> novalidate&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1.先生成一个对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="comment"># 3.判断请求方式</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 获取用户数据</span></span><br><span class="line">        <span class="comment"># request.POST  # 可以直接看成是一个字典</span></span><br><span class="line">        <span class="comment"># 校验用户数据</span></span><br><span class="line">        <span class="comment"># MyForm()  # forms组件校验数据刚好需要传入一个字典</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;上述两步合一步&#x27;&#x27;&#x27;</span></span><br><span class="line">        form_obj = MyForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form_obj.is_valid():</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;注册成功&#x27;</span>)</span><br><span class="line">    <span class="comment"># 2.将该对象传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;</span><br><span class="line">            &lt;span style=<span class="string">&quot;color:red&quot;</span>&gt;&#123;&#123; form.errors<span class="number">.0</span> &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="forms组件常用参数"><a href="#forms组件常用参数" class="headerlink" title="forms组件常用参数"></a>forms组件常用参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">max_length			<span class="comment"># 最大范围</span></span><br><span class="line">min_length			<span class="comment"># 最小范围</span></span><br><span class="line">label 				<span class="comment"># 字段名</span></span><br><span class="line">error_messages		<span class="comment"># 自定义报错信息</span></span><br><span class="line">initial				<span class="comment"># 默认值 类似于placeholder</span></span><br><span class="line">required			<span class="comment"># 控制字段是否必填 默认是True</span></span><br><span class="line">invalid				<span class="comment"># 不符合格式提示(邮箱格式校验)</span></span><br><span class="line">validators			<span class="comment"># 额外的校验功能(正则)</span></span><br><span class="line">novalidate			<span class="comment"># 设置浏览器不提示信息</span></span><br><span class="line">widget				<span class="comment"># 定义字段类型和属性(标签加样式)</span></span><br><span class="line">	eg:</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;form-control 类名1 类名2&#x27;</span>&#125;)  </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 正则校验(validators)</span></span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span>(<span class="params">Form</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 手机号正则校验</span></span><br><span class="line">    phone = forms.CharField(label=<span class="string">&#x27;手机号&#x27;</span>,error_messages=&#123;<span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;手机号不能为空&#x27;</span>,&#125;,</span><br><span class="line">        validators=[</span><br><span class="line">           RegexValidator(<span class="string">r&#x27;^[0-9]+$&#x27;</span>, <span class="string">&#x27;请输入数字&#x27;</span>),</span><br><span class="line">           RegexValidator(<span class="string">r&#x27;^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d&#123;8&#125;$&#x27;</span>,<span class="string">&#x27;手机号格式不正确&#x27;</span>)</span><br><span class="line">        ],</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">       )</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 身份证正则校验</span></span><br><span class="line">    userinfo = forms.CharField(label=<span class="string">&#x27;身份证&#x27;</span>,error_messages=&#123;<span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;身份证不能为空&#x27;</span>,&#125;,</span><br><span class="line">        validators=[</span><br><span class="line">          RegexValidator(<span class="string">r&#x27;^[0-9]+$&#x27;</span>, <span class="string">&#x27;请输入数字&#x27;</span>),</span><br><span class="line">          RegexValidator(<span class="string">r&#x27;^(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)&#x27;</span>, <span class="string">&#x27;身份证格式不正确&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">    ) </span><br></pre></td></tr></table></figure>

<h4 id="其他参数及字段"><a href="#其他参数及字段" class="headerlink" title="其他参数及字段"></a>其他参数及字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">radioSelect</span><br><span class="line">单radio值为字符串</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    username = forms.CharField(min_length=<span class="number">8</span>,label=<span class="string">&quot;用户名&quot;</span>,initial=<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">                                error_messages=&#123;</span><br><span class="line">                                    <span class="string">&quot;required&quot;</span>: <span class="string">&quot;不能为空&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;invalid&quot;</span>: <span class="string">&quot;格式错误&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;min_length&quot;</span>: <span class="string">&quot;用户名最短8位&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">    						  )</span><br><span class="line">   </span><br><span class="line">    gender = forms.ChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;男&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;女&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;保密&quot;</span>)),</span><br><span class="line">        label=<span class="string">&quot;性别&quot;</span>,</span><br><span class="line">        initial=<span class="number">3</span>,</span><br><span class="line">        widget=forms.widgets.RadioSelect()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单选Select</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.ChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>), ),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=<span class="number">3</span>,</span><br><span class="line">        widget=forms.widgets.Select()</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">多选Select</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.MultipleChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>), ),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">        widget=forms.widgets.SelectMultiple()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单选checkbox</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    keep = forms.ChoiceField(</span><br><span class="line">        label=<span class="string">&quot;是否记住密码&quot;</span>,</span><br><span class="line">        initial=<span class="string">&quot;checked&quot;</span>,</span><br><span class="line">        widget=forms.widgets.CheckboxInput()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">多选checkbox</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.MultipleChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>),),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">        widget=forms.widgets.CheckboxSelectMultiple()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h3 id="forms组件钩子函数"><a href="#forms组件钩子函数" class="headerlink" title="forms组件钩子函数"></a>forms组件钩子函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">在forms组件中有两种钩子:</span></span><br><span class="line"><span class="string">	1.局部钩子</span></span><br><span class="line"><span class="string">		当你需要给单个字段增加校验规则的时候可以使用</span></span><br><span class="line"><span class="string">	2.全局钩子</span></span><br><span class="line"><span class="string">		当你需要给多个字段增加校验规则的时候可以使用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="局部钩子"><a href="#局部钩子" class="headerlink" title="局部钩子"></a>局部钩子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">提供更加复杂的与业务相关的校验功能</span><br><span class="line">钩子函数其实就是在书写forms类的过程中定义方法</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;钩子函数都是在数据校验的最后一个环节执行&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">局部钩子(单个字段校验使用)</span><br><span class="line">	<span class="comment"># 校验当前用户名是否已存在</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户名</span></span><br><span class="line">        username = self.cleaned_data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="comment"># 查询数据库并判断</span></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;jason&#x27;</span>:</span><br><span class="line">            <span class="comment"># 提示用户名已存在</span></span><br><span class="line">            self.add_error(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;用户名已存在&#x27;</span>)</span><br><span class="line">        <span class="comment"># 将钩子函数勾出来的数据再放回去</span></span><br><span class="line">        <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>

<h4 id="全局钩子"><a href="#全局钩子" class="headerlink" title="全局钩子"></a>全局钩子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全局钩子(多个字段校验使用)</span><br><span class="line">	<span class="comment"># 校验密码与确认密码是否一致</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 获取密码与确认密码</span></span><br><span class="line">        password = self.cleaned_data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        confirm_password = self.cleaned_data.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">        <span class="comment"># 判断两次输入的密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> password == confirm_password:</span><br><span class="line">            self.add_error(<span class="string">&#x27;confirm_password&#x27;</span>,<span class="string">&#x27;两次密码不一致&#x27;</span>)</span><br><span class="line">        <span class="comment"># 将钩子函数勾出来的数据再放回去</span></span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/12/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/12/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1/" class="post-title-link" itemprop="url">模型层之必知必会十三条</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-12T18:20:25+08:00">2019-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="必知必会十三条"><a href="#必知必会十三条" class="headerlink" title="必知必会十三条"></a>必知必会十三条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">all</span>()		 			查询所有数据</span><br><span class="line"><span class="number">2.</span><span class="built_in">filter</span>()				带有过滤条件的查询</span><br><span class="line"><span class="number">3.</span>get()					直接拿数据对象 但是条件不存在直接报错</span><br><span class="line"><span class="number">4.</span>first()				拿queryset里面的第一个数据</span><br><span class="line"><span class="number">5.</span>last()				拿quertset里面的最后一个数据</span><br><span class="line"><span class="number">6.</span>values()				可以指定获取数据的字段  select name,age <span class="keyword">from</span>... 列表套字典</span><br><span class="line"><span class="number">7.</span>values_list()			列表套元组</span><br><span class="line"><span class="number">8.</span>distinct()			去重 去重一定要是一模一样的数据(主键千万要注意)</span><br><span class="line"><span class="number">9.</span>order_by()			排序 </span><br><span class="line">	res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  默认是升序  </span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)   加负号降序</span><br><span class="line"><span class="number">10.</span>reverse() 			反转 前提是数据已经排序过</span><br><span class="line"><span class="number">11.</span>count() 				统计当前数据的个数</span><br><span class="line"><span class="number">12.</span>exclude()			排除在外</span><br><span class="line">	查询<span class="built_in">id</span>不为<span class="number">3</span>的所有图书</span><br><span class="line">		books = BookInfo.objects.exclude(<span class="built_in">id</span> = <span class="number">3</span>)  <span class="comment"># 与filter函数作用相反。 返回QuerySet查询集(可以遍历)</span></span><br><span class="line"><span class="number">13.</span>exists()				返回布尔值 数据本身就自带布尔值 基本用不到</span><br></pre></td></tr></table></figure>

<h3 id="filter函数-条件查询"><a href="#filter函数-条件查询" class="headerlink" title="filter函数(条件查询)"></a>filter函数(条件查询)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">filter</span>函数 (条件查询)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__gt 大于</span></span><br><span class="line"><span class="string">__gte 大于等于 </span></span><br><span class="line"><span class="string">__lt 小于</span></span><br><span class="line"><span class="string">__lte 小于等于</span></span><br><span class="line"><span class="string">__in 范围查询</span></span><br><span class="line"><span class="string">__date日期查询</span></span><br><span class="line"><span class="string">__isnull 是否为空 True表示为null False表示not null</span></span><br><span class="line"><span class="string">__contains 包含 模糊查询 默认区分大小写</span></span><br><span class="line"><span class="string">__icontains 不区分大小写</span></span><br><span class="line"><span class="string">__endswith以..结尾 __startswith以..开头(__iendswith 不区分大小写)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># filter条件查询(可以通过逗号,连接多个条件)  返回QuerySet查询集(可以遍历)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__exact = <span class="string">&#x27;天龙八部&#x27;</span>)  <span class="comment"># __exact 等于。 __exact 可以省略。 (__iexact 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__contains = <span class="string">&#x27;天&#x27;</span>)  <span class="comment"># __contains 包含。模糊查询。 (__icontains 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__endswith = <span class="string">&#x27;部&#x27;</span>)  <span class="comment"># __endswith 以..结尾。 __startswith 以..开头。 (__iendswith 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__isnull = <span class="literal">False</span>)  <span class="comment"># __isnull 是否为空。 True：表示为null。 False表示not null。</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(id__in = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>])  <span class="comment"># __in 范围查询。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(id__gt = <span class="number">3</span>)  <span class="comment"># __gt 大于。 __lt 小于。 __gte 大于等于。 __lte 小于等于。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(pub_date__gt = date(<span class="number">1980</span>,<span class="number">1</span>,<span class="number">1</span>))  <span class="comment"># 日期查询。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(pub_date__year = <span class="number">1980</span>)   <span class="comment"># 日期查询。(year、month、day、week_day、hour、minute、second)</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/" class="post-title-link" itemprop="url">Django之模型层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-10T18:20:25+08:00">2019-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模型层"><a href="#模型层" class="headerlink" title="模型层"></a>模型层</h1><h3 id="1-数据库正反向迁移"><a href="#1-数据库正反向迁移" class="headerlink" title="1.数据库正反向迁移"></a>1.数据库正反向迁移</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">正向迁移(将django中的类导入到MySQL中变成表)</span><br><span class="line">	python manage.py makemigrations</span><br><span class="line">    python manage.py migrate</span><br><span class="line">反向迁移</span><br><span class="line">	inspectdb</span><br><span class="line">    应用场景:</span><br><span class="line">        展示数据库中表时或要更换数据库磁盘</span><br></pre></td></tr></table></figure>

<h3 id="2-Django测试环境"><a href="#2-Django测试环境" class="headerlink" title="2.Django测试环境"></a>2.Django测试环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">django默认情况下是不允许单独使用某个功能部分(models.py)</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>要么自己新建一个py文件</span><br><span class="line"><span class="number">2.</span>要么使用自带的tests文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day47.settings&quot;</span>)</span><br><span class="line">    <span class="comment"># 导入django并配置</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="comment"># 下面就可以书写测试代码了</span></span><br></pre></td></tr></table></figure>

<h3 id="3-必知必会十三条"><a href="#3-必知必会十三条" class="headerlink" title="3.必知必会十三条"></a>3.必知必会十三条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">all</span>()		 			<span class="comment"># 查询所有数据</span></span><br><span class="line"><span class="number">2.</span><span class="built_in">filter</span>()				<span class="comment"># 带有过滤条件的查询</span></span><br><span class="line"><span class="number">3.</span>get()					<span class="comment"># 直接拿数据对象 但是条件不存在直接报错</span></span><br><span class="line"><span class="number">4.</span>first()				<span class="comment"># 拿queryset里面的第一个数据</span></span><br><span class="line"><span class="number">5.</span>last()				<span class="comment"># 拿quertset里面的最后一个数据</span></span><br><span class="line"><span class="number">6.</span>values()				<span class="comment"># 指定获取数据的字段 select name,age from... 列表套字典</span></span><br><span class="line"><span class="number">7.</span>values_list()			<span class="comment"># 指定获取数据的字段 列表套元组</span></span><br><span class="line"><span class="number">8.</span>distinct()			<span class="comment"># 去重 去重一定要是一模一样的数据(主键千万要注意)</span></span><br><span class="line"><span class="number">9.</span>order_by()			<span class="comment"># 排序 默认升序</span></span><br><span class="line">	res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  	<span class="comment"># 默认是升序  </span></span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)   <span class="comment"># 加负号降序</span></span><br><span class="line"><span class="number">10.</span>reverse() 			<span class="comment"># 反转 前提是数据已经排序过</span></span><br><span class="line"><span class="number">11.</span>count() 				<span class="comment"># 计数 统计当前数据的个数</span></span><br><span class="line"><span class="number">12.</span>exclude()			<span class="comment"># 取反 将括号内排除在外</span></span><br><span class="line">	查询<span class="built_in">id</span>不为<span class="number">3</span>的所有图书</span><br><span class="line">		books = models.BookInfo.objects.exclude(<span class="built_in">id</span> = <span class="number">3</span>)  <span class="comment"># 与filter函数作用相反 </span></span><br><span class="line"><span class="number">13.</span>exists()				<span class="comment"># 返回布尔值 数据本身就自带布尔值 基本用不到</span></span><br></pre></td></tr></table></figure>

<h3 id="4-双下划线查询"><a href="#4-双下划线查询" class="headerlink" title="4.双下划线查询"></a>4.双下划线查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__gt 				大于</span></span><br><span class="line"><span class="string">__gte 				大于等于 </span></span><br><span class="line"><span class="string">__lt 				小于</span></span><br><span class="line"><span class="string">__lte 				小于等于</span></span><br><span class="line"><span class="string">__in 				范围查询</span></span><br><span class="line"><span class="string">__date				日期查询</span></span><br><span class="line"><span class="string">__isnull 			是否为空 True表示为null False表示not null</span></span><br><span class="line"><span class="string">__contains 			包含 模糊查询 默认区分大小写</span></span><br><span class="line"><span class="string">__icontains 		包含 模糊查询 不区分大小写</span></span><br><span class="line"><span class="string">__endswith			以..结尾 (__iendswith 不区分大小写)</span></span><br><span class="line"><span class="string">__startswith		以..开头 (__istartswith 不区分大小写)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询价格大于200的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Books.objects.filter(price__gt=200)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Books.objects.filter(price__lt=200)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># res2 = models.Books.objects.filter(price__gte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res2)</span></span><br><span class="line">    <span class="comment"># res3 = models.Books.objects.filter(price__lte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 成员运算</span></span><br><span class="line">    <span class="comment"># res4 = models.Books.objects.filter(price__in=(456.23,111))</span></span><br><span class="line">    <span class="comment"># print(res4)</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 范围查询</span></span><br><span class="line">    <span class="comment"># res5 = models.Books.objects.filter(price__range=(100,456.23))</span></span><br><span class="line">    <span class="comment"># print(res5)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模糊查询</span></span><br><span class="line">    <span class="comment"># 查询书籍名称中含有字母a的书</span></span><br><span class="line">    <span class="comment"># res6 = models.Books.objects.filter(title__contains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res6)  # 区分大小写</span></span><br><span class="line">    <span class="comment"># res7 = models.Books.objects.filter(title__icontains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res7)  # 忽略大小写</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日期相关</span></span><br><span class="line">    <span class="comment"># 查看出版月份是五月的书</span></span><br><span class="line">    <span class="comment"># res8 = models.Books.objects.filter(publish_time__month=5)</span></span><br><span class="line">    <span class="comment"># print(res8)</span></span><br><span class="line">    <span class="comment"># print(res8.query)</span></span><br><span class="line">    <span class="comment"># res9 = models.Books.objects.filter(publish_time__year=2021)</span></span><br><span class="line">    <span class="comment"># print(res9)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-正反向概念"><a href="#5-正反向概念" class="headerlink" title="5.正反向概念"></a>5.正反向概念</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向</span></span><br><span class="line">	外键字段在我这里,我查你就是正向</span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">	外键字段不在我这里,我查你就是反向</span><br><span class="line">    </span><br><span class="line">    book ---&gt; 外键字段在书那儿(正向) ---&gt;publish</span><br><span class="line">    publish ---&gt; 外键字段在书那儿(反向) ---&gt;book</span><br></pre></td></tr></table></figure>

<h3 id="6-正反向跨表查询"><a href="#6-正反向跨表查询" class="headerlink" title="6.正反向跨表查询"></a>6.正反向跨表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">正向查询按字段</span></span><br><span class="line"><span class="string">反向查询按表名小写</span></span><br><span class="line"><span class="string">		_set</span></span><br><span class="line"><span class="string">		...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">基于对象</span></span><br><span class="line"><span class="string">	正向查询:</span></span><br><span class="line"><span class="string">		当查询结果有多个的时候 必须要加.all()</span></span><br><span class="line"><span class="string">		当查询结果只有一个的时候 直接拿到数据对象不需要加.all()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	反向查询:</span></span><br><span class="line"><span class="string">        当查询结果有多个的时候 必须要加_set.all()</span></span><br><span class="line"><span class="string">        当查询结果只有一个的时候 直接拿到数据对象不需要加_set.all()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-一对多表关系外键字段的增删改"><a href="#7-一对多表关系外键字段的增删改" class="headerlink" title="7.一对多表关系外键字段的增删改"></a>7.一对多表关系外键字段的增删改</h3><h4 id="1-外键字段的增"><a href="#1-外键字段的增" class="headerlink" title="1.外键字段的增"></a>1.外键字段的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;一对多表关系外键默认级联更新级联删除&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(create)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.create(name=<span class="string">&#x27;三国演义&#x27;</span>, price=<span class="string">&#x27;999&#x27;</span>, publish_id=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.create(name=<span class="string">&#x27;孟子&#x27;</span>, price=<span class="string">&#x27;989&#x27;</span>, 	publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h4 id="2-外键字段的删"><a href="#2-外键字段的删" class="headerlink" title="2.外键字段的删"></a>2.外键字段的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(delete)</span></span><br><span class="line">    models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).delete()  <span class="comment"># 级联删除</span></span><br></pre></td></tr></table></figure>

<h4 id="3-外键字段的改"><a href="#3-外键字段的改" class="headerlink" title="3.外键字段的改"></a>3.外键字段的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(update)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">6</span>).update(publish_id=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">8</span>).update(publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h3 id="8-多对多第三张表数据的增删改"><a href="#8-多对多第三张表数据的增删改" class="headerlink" title="8.多对多第三张表数据的增删改"></a>8.多对多第三张表数据的增删改</h3><h4 id="1-第三张表数据的增"><a href="#1-第三张表数据的增" class="headerlink" title="1.第三张表数据的增"></a>1.第三张表数据的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第三张表添加数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    向第三张表中添加数据之前要拿到任一张表的某个对象</span></span><br><span class="line"><span class="string">    再通过正反向概念实现第三张表的数据添加</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(add(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(book_obj.authors)  <span class="comment"># 相当于拿到第三张表</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(1, 2, 3)  # 书籍主键为1的书籍绑定主键为1,2,3的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.add(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.add(1,2,3)</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    author_obj.book_set.add(book_obj)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">add给第三张表添加数据:</span></span><br><span class="line"><span class="string">	括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">	已存在的数据不可重复添加 </span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据增加)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-第三张表数据的改"><a href="#2-第三张表数据的改" class="headerlink" title="2.第三张表数据的改"></a>2.第三张表数据的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(set(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.set([2,3,4])  # 括号内必须放一个可迭代对象</span></span><br><span class="line">    author_obj1 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj2 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.<span class="built_in">set</span>([author_obj1, author_obj2])</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.set([1,2])</span></span><br><span class="line">    book_obj1 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    book_obj2 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">set</span>([book_obj1,book_obj2])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">set修改第三张表中的数据:</span></span><br><span class="line"><span class="string">    括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">    括号内必须放一个可迭代对象</span></span><br><span class="line"><span class="string">    set会将第三张表中已存在数据更新为括号内指定数据</span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-第三张表数据的删"><a href="#3-第三张表数据的删" class="headerlink" title="3.第三张表数据的删"></a>3.第三张表数据的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(remove(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.remove(1,2)  # 删除主键为1的书籍所关联的主键为1,2的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.remove(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.remove(<span class="number">1</span>,<span class="number">3</span>)	<span class="comment"># 删除主键为1的作者所关联的主键为1,3的书籍</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj.book_set.remove(book_obj)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">remove删除第三张表中的数据:</span></span><br><span class="line"><span class="string">   括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">   remove会将第三张表中已存在数据删除</span></span><br><span class="line"><span class="string">   (站在任一张表的角度都可以实现对第三张表的数据删除)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-第三张表数据的查"><a href="#4-第三张表数据的查" class="headerlink" title="4.第三张表数据的查"></a>4.第三张表数据的查</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查</span></span><br><span class="line"></span><br><span class="line">	book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    book_obj.authors.first()  <span class="comment"># 查一个,默认第一个</span></span><br><span class="line">    book_obj.authors.<span class="built_in">all</span>()  <span class="comment"># 查所有</span></span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h3 id="9-多表查询"><a href="#9-多表查询" class="headerlink" title="9.多表查询"></a>9.多表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################基于对象的跨表查询#####################</span></span><br><span class="line">    <span class="comment"># 子查询:将一张表的查询结果当做另外一条SQL语句的条件(括号括起来)</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=4).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.publish</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.title)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Author.None</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # &lt;QuerySet [&lt;Author: 作者对象:oscar&gt;, &lt;Author: 作者对象:egon&gt;]&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = author_obj.author_detail</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line">    <span class="comment"># print(res.phone)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.查询东方出版社出版的书籍</span></span><br><span class="line">    <span class="comment"># 先查询出版社对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(title=&#x27;东方出版社&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里 自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># 先查询120数据对象</span></span><br><span class="line">    <span class="comment"># author_detail_obj = models.AuthorDetail.objects.filter(phone=120).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者那里本身没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_detail_obj.author</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="comment"># print(res.age)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">########################基于双下滑线的跨表查询</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.查询北方出版社出版的书籍名称</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(title=&#x27;北方&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># res =models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># res =models.AuthorDetail.objects.filter(phone=120).values(&#x27;author__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    <span class="comment">############进阶操作#############</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(book__pk=4)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;).values(&#x27;addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询书籍主键为3的作者的电话号码</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__book__pk=3).values(&#x27;phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3).values(&#x27;author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="10-聚合查询-aggregate"><a href="#10-聚合查询-aggregate" class="headerlink" title="10.聚合查询(aggregate)"></a>10.聚合查询(aggregate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询</span></span><br><span class="line">关键字:</span><br><span class="line">    aggregate()</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;max min sum count avg&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max,Min,Sum,Avg,Count</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 求书的最高价格</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.aggregate(Max(&#x27;price&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.aggregate(Sum(&#x27;price&#x27;),Avg(&#x27;price&#x27;),Count(&#x27;pk&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br></pre></td></tr></table></figure>

<h3 id="11-分组查询-annotate"><a href="#11-分组查询-annotate" class="headerlink" title="11.分组查询(annotate)"></a>11.分组查询(annotate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组查询</span></span><br><span class="line">关键字:</span><br><span class="line">	annotate()</span><br><span class="line">	annotate前放values那么按其括号内字段分组</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1.统计每一本书的作者个数</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).values(&#x27;title&#x27;, &#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># 2.统计出每个出版社卖的最便宜的书的价格</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.annotate(not_expensive=Min(&#x27;book__price&#x27;)).values(&#x27;title&#x27;,&#x27;not_expensive&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.统计不止一个作者的图书</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).filter(author_num__gt=1).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 4.查询各个作者出的书的总价格</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.annotate(sum_price=Sum(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;sum_price&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;如果你按照表里面某个指定的字段分组&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;publish_time&#x27;).annotate()</span></span><br></pre></td></tr></table></figure>

<h3 id="12-F查询"><a href="#12-F查询" class="headerlink" title="12.F查询"></a>12.F查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">当查询条件的左右两边数据都来自于表中则可以使用F查询</span></span><br><span class="line"><span class="string">F查询还可以统一修改表中的字段数据(数字)</span></span><br><span class="line"><span class="string">	导入语句:</span></span><br><span class="line"><span class="string">        from django.db.models import F,Value</span></span><br><span class="line"><span class="string">        from django.db.models.functions import Concat</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># F查询</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">    <span class="comment"># 1.查询库存数大于卖出数的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(kucun__gt=F(&#x27;maichu&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 2.将所有的书籍价格上涨100块</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.update(price=F(&#x27;price&#x27;) + 100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.将所有的书籍名称加上&quot;爆款&quot;后缀</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># models.Book.objects.update(title=F(&#x27;title&#x27;) + &#x27;爆款&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># from django.db.models.functions import Concat</span></span><br><span class="line">    <span class="comment"># from django.db.models import Value</span></span><br><span class="line">    <span class="comment"># ret3 = models.Book.objects.update(title=Concat(F(&#x27;title&#x27;), Value(&#x27;爆款&#x27;)))</span></span><br></pre></td></tr></table></figure>

<h4 id="针对字符串不能直接拼接-需导入模块"><a href="#针对字符串不能直接拼接-需导入模块" class="headerlink" title="针对字符串不能直接拼接 需导入模块"></a>针对字符串不能直接拼接 需导入模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Concat</span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Value</span><br><span class="line">    </span><br><span class="line">    ret = models.Book.objects.update(title=Concat(F(<span class="string">&#x27;title&#x27;</span>), Value(<span class="string">&#x27;爆款&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="13-Q查询"><a href="#13-Q查询" class="headerlink" title="13.Q查询"></a>13.Q查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.filter默认只支持and连接查询条件如果需要修改则需要使用Q</span></span><br><span class="line"><span class="string">        from django.db.models import Q</span></span><br><span class="line"><span class="string">        filter(Q(),Q())</span></span><br><span class="line"><span class="string">        filter(Q()|Q())</span></span><br><span class="line"><span class="string">        filter(~Q(),~Q())</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">2.查询条件还可以由变量名模式改为字符串形式</span></span><br><span class="line"><span class="string">        q = Q()</span></span><br><span class="line"><span class="string">        q.connector=&#x27;or&#x27;	# 改变查询参数之间关系 默认是and</span></span><br><span class="line"><span class="string">        q.children.append((&#x27;字段名&#x27;,&#x27;需要查询的数据&#x27;))</span></span><br><span class="line"><span class="string">        filter(q)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.查询书名是三国演义爆款或者库存是100的书籍</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;filter()括号内可以写多个参数 逗号隔开 默认只支持and连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(title=&#x27;三国演义爆款&#x27;,kucun=100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;),Q(kucun=100))  # and</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100))  # or</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(~Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100)) # not</span></span><br><span class="line">    <span class="comment"># print(res1.query)</span></span><br></pre></td></tr></table></figure>

<h4 id="Q查询进阶用法"><a href="#Q查询进阶用法" class="headerlink" title="Q查询进阶用法"></a>Q查询进阶用法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;Q进阶用法&#x27;&#x27;&#x27;</span></span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">   <span class="comment"># condition = input(&#x27;请输入你需要按照什么字段查询数据&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># data = input(&#x27;请输入你需要查询的数据名称&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># q = Q()  # 生成一个Q对象</span></span><br><span class="line">   <span class="comment"># q.children.append((condition,data))</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.filter(q)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line">   q = Q()</span><br><span class="line">   q.connector = <span class="string">&#x27;or&#x27;</span>  <span class="comment"># 可以修改连接条件</span></span><br><span class="line">   q.children.append((<span class="string">&#x27;title__contains&#x27;</span>,<span class="string">&#x27;三&#x27;</span>))</span><br><span class="line">   q.children.append((<span class="string">&#x27;price__gt&#x27;</span>,<span class="number">200</span>))  <span class="comment"># 可以添加多个条件 并且也是and关系</span></span><br><span class="line">   res = models.Book.objects.<span class="built_in">filter</span>(q)</span><br><span class="line">   <span class="built_in">print</span>(res)</span><br><span class="line">   <span class="built_in">print</span>(res.query)</span><br></pre></td></tr></table></figure>

<h3 id="14-事务"><a href="#14-事务" class="headerlink" title="14.事务"></a>14.事务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.什么是事务?</span></span><br><span class="line"><span class="string">	事务是数据库操作的最小工作单元,作为逻辑工作单元执行一系列操作,这些操作作为一个整体一起向系统提交,要么都执行,要么都不执行,事务是一组不可分割的操作机集合</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.事务四大特性 	ACID</span></span><br><span class="line"><span class="string">	1.原子性:</span></span><br><span class="line"><span class="string">		事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做</span></span><br><span class="line"><span class="string">	2.一致性:</span></span><br><span class="line"><span class="string">		事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态</span></span><br><span class="line"><span class="string">	3.独立性:</span></span><br><span class="line"><span class="string">		一个事务的执行不能其它事务干扰</span></span><br><span class="line"><span class="string">	4.持久性:</span></span><br><span class="line"><span class="string">		永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MySQL</span></span><br><span class="line"><span class="string">	start transcation</span></span><br><span class="line"><span class="string">	commit</span></span><br><span class="line"><span class="string">	rollback</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="comment"># 创建一条订单数据</span></span><br><span class="line">            models.Order.objects.create(num=<span class="string">&quot;110110111&quot;</span>, product_id=<span class="number">1</span>, count=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 能执行成功</span></span><br><span class="line">     		models.Product.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(kucun=F(<span class="string">&quot;kucun&quot;</span>) - <span class="number">1</span>, maichu=F(<span class="string">&quot;maichu&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<h4 id="执行原生SQL语句"><a href="#执行原生SQL语句" class="headerlink" title="执行原生SQL语句"></a>执行原生SQL语句</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.raw(<span class="string">&#x27;select * from app01_book&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h4 id="数据库三大范式"><a href="#数据库三大范式" class="headerlink" title="数据库三大范式"></a>数据库三大范式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.第一范式(确保每列保持原子性)</span><br><span class="line">	确保每一个字段都必须是不可拆分的原子值</span><br><span class="line">2.第二范式(确保表中的每列都和主键相关)</span><br><span class="line">	一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中</span><br><span class="line">3.第三范式(确保每列都和主键列直接相关,而不是间接相关)</span><br><span class="line">	每一列数据都和主键直接相关，而不能间接相关</span><br></pre></td></tr></table></figure>

<h3 id="15-模型层字段及参数"><a href="#15-模型层字段及参数" class="headerlink" title="15.模型层字段及参数"></a>15.模型层字段及参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">models.AutoField(primary_key=<span class="literal">True</span>)		<span class="comment"># 主键字段</span></span><br><span class="line">models.CharField(max_length=<span class="number">32</span>)			<span class="comment"># varchar(32)</span></span><br><span class="line">models.IntergeField()					<span class="comment"># 整型</span></span><br><span class="line">models.DateField()						<span class="comment"># 年月日</span></span><br><span class="line">models.DateTimeField()					<span class="comment"># 年月日时分秒</span></span><br><span class="line">	auto_now								<span class="comment"># 记录每次修改时间</span></span><br><span class="line">    auto_now_add							<span class="comment"># 记录第一次修改时间</span></span><br><span class="line">models.DecimalField()					<span class="comment"># 浮点型</span></span><br><span class="line">	max_digits								<span class="comment"># 总位数</span></span><br><span class="line">    decimal_places							<span class="comment"># 小数位</span></span><br><span class="line">models.BooleanField()					<span class="comment"># 布尔值类型</span></span><br><span class="line">	给这个字段传布尔值会自动转换成数字<span class="number">0</span>或<span class="number">1</span></span><br><span class="line">    一般用在状态二选一</span><br><span class="line">TextField()								<span class="comment"># 存储大段文本(bbs项目会使用)</span></span><br><span class="line">EmailField()							<span class="comment"># 存储邮箱格式数据</span></span><br><span class="line">FileField()								<span class="comment"># 存储数据路径(bbs项目会使用)</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义字段"><a href="#自定义字段" class="headerlink" title="自定义字段"></a>自定义字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;自定义字段&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCharField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,max_length,*args,**kwargs</span>):</span></span><br><span class="line">        self.max_length = max_length</span><br><span class="line">        <span class="built_in">super</span>().__init__(max_length=max_length,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_type</span>(<span class="params">self, connection</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;char(%s)&#x27;</span>%self.max_length</span><br></pre></td></tr></table></figure>

<h4 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">max_length			<span class="comment"># 指定长度</span></span><br><span class="line">varbose_name		<span class="comment"># 字段解释</span></span><br><span class="line">default				<span class="comment"># 字段默认值</span></span><br><span class="line">null				<span class="comment"># 字段可以为空</span></span><br><span class="line">auto_now			<span class="comment"># date字段参数 记录每次修改时间</span></span><br><span class="line">auto_now_add		<span class="comment"># date字段参数 记录第一次修改时间</span></span><br><span class="line">to					<span class="comment"># 指定关联哪张表的主键</span></span><br><span class="line">unique				<span class="comment"># 唯一约束</span></span><br><span class="line">db_index			<span class="comment"># 索引</span></span><br><span class="line">choices				<span class="comment"># 存对应关系(一般元组套元组)</span></span><br></pre></td></tr></table></figure>

<h3 id="16-choices参数"><a href="#16-choices参数" class="headerlink" title="16.choices参数"></a>16.choices参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># choices参数</span></span><br><span class="line">创建用户表</span><br><span class="line">	性别</span><br><span class="line">    	两到三种状态</span><br><span class="line">    学历</span><br><span class="line">    	也是有限个</span><br><span class="line">    在职状态</span><br><span class="line">    	也是有限个</span><br><span class="line">    婚姻</span><br><span class="line">    	也是有限个</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;针对某个字段可以列举完全的情况 一般都是使用choices参数&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    host = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>,<span class="string">&#x27;在线&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>,<span class="string">&#x27;待上线&#x27;</span>),</span><br><span class="line">        (<span class="number">3</span>,<span class="string">&#x27;宕机&#x27;</span>),</span><br><span class="line">        (<span class="number">4</span>,<span class="string">&#x27;待上架&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    status = models.IntegerField(choices=status_choices)</span><br><span class="line"></span><br><span class="line">    desc_choices = (</span><br><span class="line">        (<span class="string">&#x27;哈哈&#x27;</span>,<span class="string">&#x27;哈哈哈哈哈哈&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;呵呵&#x27;</span>,<span class="string">&#x27;呵呵呵呵呵呵&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘿嘿&#x27;</span>,<span class="string">&#x27;嘿嘿嘿嘿嘿嘿&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘻嘻&#x27;</span>,<span class="string">&#x27;嘻嘻嘻嘻嘻嘻&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">32</span>,choices=desc_choices)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">*****获取对应关系*****</span><br><span class="line">.get_字段名_display()</span><br></pre></td></tr></table></figure>

<h3 id="17-查看原生SQL语句方法"><a href="#17-查看原生SQL语句方法" class="headerlink" title="17.查看原生SQL语句方法"></a>17.查看原生SQL语句方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>测试环境</span><br><span class="line">	自己拷贝代码</span><br><span class="line"><span class="number">2.</span>pycharm自带的测试环境</span><br><span class="line">    python console</span><br><span class="line"><span class="number">3.</span>配置文件查看所有orm内部SQL语句</span><br><span class="line">    <span class="comment"># 直接拷贝到配置文件中即可</span></span><br><span class="line">        LOGGING = &#123;</span><br><span class="line">        <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            	&#125;,</span><br><span class="line">        	&#125;</span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-ORM查询优化-数据库查询优化"><a href="#18-ORM查询优化-数据库查询优化" class="headerlink" title="18.ORM查询优化(数据库查询优化)"></a>18.ORM查询优化(数据库查询优化)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">惰性查询</span><br><span class="line">	用不到的数据即使写了orm语句也不会执行</span><br><span class="line">        <span class="number">1.</span>only与defer</span><br><span class="line">        <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>only与defer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;title&#x27;)  # 列表套字典</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.only(&#x27;title&#x27;)  # 列表套对象</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.price)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    only括号内写什么字段</span></span><br><span class="line"><span class="string">        生成的对象就含有对应的属性 在查找该属性的时候不再走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则每次都会走数据库查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.defer(&#x27;title&#x27;)	# 列表套对象</span></span><br><span class="line">    <span class="comment"># # print(res1)  </span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    defer与only刚好相反</span></span><br><span class="line"><span class="string">        生成的对象就不含有对应的属性 在查找该属性的时候需要每次走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则不需要走数据库查询</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># print(res.publish.title)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>select_related与prefetch_related</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.select_related(&#x27;publish&#x27;)</span></span><br><span class="line">    <span class="comment"># for i in res:</span></span><br><span class="line">    <span class="comment">#     print(i.publish.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select_related相当于连表操作</span></span><br><span class="line"><span class="string">        先将models后面的表和括号内外键字段关联的表连接起来</span></span><br><span class="line"><span class="string">        之后一次性把所有的数据封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    res = models.Book.objects.prefetch_related(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(i.publish.title)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    prefetch_related相当于子查询</span></span><br><span class="line"><span class="string">        先查询models后面的表的所有的数据</span></span><br><span class="line"><span class="string">        然后将括号内外键关联的表的数据全部查询出来</span></span><br><span class="line"><span class="string">        之后整合到一起封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">总结:</span><br><span class="line">    <span class="number">1.</span>only与defer</span><br><span class="line">        only:查询括号内的字段不需要走数据库 查询括号内以外的字段每次都要走数据库</span><br><span class="line">        defer:查询括号内字段要走数据库 查询括号内以外字段时不需要走数据库</span><br><span class="line">    <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line">    	select_related:相当于链表操作,先将models后的表与括号内指定外键字段关联的表拼接,再把所有数据封装到数据对象中</span><br><span class="line">        prefertch_related:相当于子查询,先将models后的表所有数据查询出来,再将括号内指定外键字段关联的表所有数据查询出来,再整合到一起封装到数据对象中</span><br></pre></td></tr></table></figure>

<h3 id="19-框架设计模型-MTV与MVC"><a href="#19-框架设计模型-MTV与MVC" class="headerlink" title="19.框架设计模型(MTV与MVC)"></a>19.框架设计模型(MTV与MVC)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MTV</span><br><span class="line">	M:models模型层</span><br><span class="line">    T:templates模板层</span><br><span class="line">	V:views视图层</span><br><span class="line">MVC</span><br><span class="line">	M:models模型层</span><br><span class="line">    V:views视图层</span><br><span class="line">    C:controller控制层</span><br><span class="line">        </span><br><span class="line">django框架自称是MTV 其实本质也是MVC</span><br></pre></td></tr></table></figure>

<h3 id="20-多对多表关系三种创建方式"><a href="#20-多对多表关系三种创建方式" class="headerlink" title="20.多对多表关系三种创建方式"></a>20.多对多表关系三种创建方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">第一种(全自动):  </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     <span class="string">&#x27;&#x27;&#x27;第三张表的扩展性极差 eg:无法添加额外的字段&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第二种(纯手动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        book_id = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">        author_id = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">        desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;第三张表可以自定义 但是orm查询不太方便&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第三种(半自动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>,</span><br><span class="line">                                     through=<span class="string">&#x27;Books2Author&#x27;</span>,</span><br><span class="line">                                     through_fields=(<span class="string">&#x27;book&#x27;</span>,<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">                                     )</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	<span class="comment"># books = models.ManyToManyField(to=&#x27;Books&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through=&#x27;Books2Author&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through_fields=(&#x27;author&#x27;,&#x27;book&#x27;)</span></span><br><span class="line">    	<span class="comment">#                                )</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	book = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">    	author = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">    	desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;扩展性高 无法使用add\set\remove\clear 其他操作不影响&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">through_fields字段先后顺序</span></span><br><span class="line"><span class="string">	判断本质:</span></span><br><span class="line"><span class="string">		通过第三张表查询对应的的表 需要用到哪个字段就把哪个字段放前面</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/15/%E6%A8%A1%E6%9D%BF%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/15/%E6%A8%A1%E6%9D%BF%E5%B1%82/" class="post-title-link" itemprop="url">Django之模板层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-15 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-15T18:20:25+08:00">2019-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模板层"><a href="#模板层" class="headerlink" title="模板层"></a>模板层</h1><h3 id="1-模板语法传值"><a href="#1-模板语法传值" class="headerlink" title="1.模板语法传值"></a>1.模板语法传值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/Dominic-Ji/articles/<span class="number">11109067.</span>html<span class="comment">#_label15</span></span><br><span class="line">    </span><br><span class="line">注释</span><br><span class="line">	&lt;!--HTML注释--&gt;	浏览器能够查看</span><br><span class="line">    &#123;<span class="comment">#模板语法注释#&#125;    浏览器查看不了</span></span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># python基本数据类型</span></span><br><span class="line">    f = <span class="number">1.1</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line">    d = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>&#125;</span><br><span class="line">    t = (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>)</span><br><span class="line">    se = &#123;<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 函数(自动加括号调用函数 展示的是函数的返回值)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">args</span>):</span>  <span class="comment"># 模板语法不支持给函数传递额外的参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from func&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;下午有点困&#x27;</span></span><br><span class="line">    <span class="comment"># 面向对象</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span>  <span class="comment"># 自动加括号实例化产生对象</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_obj</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from obj&#x27;</span></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cls</span>(<span class="params">cls</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from cls&#x27;</span></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_func</span>():</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from func&#x27;</span></span><br><span class="line">    obj = MyClass()</span><br><span class="line">       </span><br><span class="line"><span class="comment"># 后端给前端传值</span></span><br><span class="line">    <span class="comment"># 1.指名道姓的传(需要传的值较少)</span></span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">&#x27;reg.html&#x27;</span>,&#123;...&#125;)</span><br><span class="line">    <span class="comment"># 2.一次性批量传(效率偏低) 为了教学方便我们使用locals居多</span></span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">&#x27;reg.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">        </span><br><span class="line">总结:</span><br><span class="line">	<span class="number">1.</span>当向前端传递一个函数时候,函数会自动加括号调用,前端展示的是函数的返回值</span><br><span class="line">    <span class="number">2.</span>当向前端传递一个类的时候,类会自动加括号实例化产生对象,前端展示的是对象</span><br><span class="line">    <span class="number">3.</span>当向前端传递一个对象的时候,前端展示的是对象的内存地址,可通过点的方法获取属性或调用方法</span><br><span class="line">    <span class="number">4.</span>模板语法不支持传参,若函数或类需要接收参数,不支持使用</span><br><span class="line">    <span class="number">5.</span>前端接收到后端传递过来的容器类型数据,内部元素可使用句点符(.)获取(.数字 数字就是索引 字典用.key) </span><br></pre></td></tr></table></figure>

<h3 id="2-模板语法取值"><a href="#2-模板语法取值" class="headerlink" title="2.模板语法取值"></a>2.模板语法取值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">取值只能使用句点符(.)</span><br><span class="line">&lt;p&gt;&#123;&#123; l<span class="number">.0</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.username &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.hobby<span class="number">.3</span>.addr &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-模板语法之过滤器-内置方法"><a href="#3-模板语法之过滤器-内置方法" class="headerlink" title="3.模板语法之过滤器(内置方法)"></a>3.模板语法之过滤器(内置方法)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">过滤器: </span><br><span class="line">    管道符 左侧当做过滤器的第一个参数 右侧有时候还可以支持再传一个参数(冒号开头)</span><br><span class="line">    </span><br><span class="line">&lt;p&gt;统计长度:&#123;&#123; l|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;自增运算:&#123;&#123; i|add:<span class="number">123</span> &#125;&#125;、拼接操作:&#123;&#123; s|add:<span class="string">&#x27;去你妹的&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;日期转换:&#123;&#123; ctime|date:<span class="string">&#x27;Y-m-d&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文件大小:&#123;&#123; file_size|filesizeformat &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取字符(三个点也算):&#123;&#123; desc|truncatechars:<span class="number">6</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取单词(三个点不算):&#123;&#123; desc|truncatewords:<span class="number">3</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;切片操作:&#123;&#123; s|<span class="built_in">slice</span>:<span class="string">&#x27;0:4&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;默认值(判断布尔值):&#123;&#123; b|default:<span class="string">&#x27;这个东西布尔值是False&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht|safe &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; xss &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    </span><br><span class="line">后端转义</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line">    ht1 = <span class="string">&#x27;&lt;h1&gt;一级标题&lt;/h1&gt;&#x27;</span></span><br><span class="line">    ht1 = mark_safe(ht1)</span><br></pre></td></tr></table></figure>

<h3 id="4-模板语法之标签"><a href="#4-模板语法之标签" class="headerlink" title="4.模板语法之标签"></a>4.模板语法之标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#125;&#125;	变量相关(引用变量值)</span><br><span class="line">&#123;% %&#125;	逻辑相关(流程控制 模块方法)</span><br><span class="line"></span><br><span class="line">&lt;p&gt;标签: 流程控制&lt;/p&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> lll %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.first %&#125;</span><br><span class="line">        &lt;p&gt;这是我的第一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">elif</span> forloop.last %&#125;</span><br><span class="line">        &lt;p&gt;这是我的最后一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        &lt;p&gt;该对象里面没有值&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    <span class="keyword">if</span>语句支持 <span class="keyword">and</span> 、<span class="keyword">or</span>、==、&gt;、&lt;、!=、&lt;=、&gt;=、<span class="keyword">in</span>、<span class="keyword">not</span> <span class="keyword">in</span>、<span class="keyword">is</span>、<span class="keyword">is</span> <span class="keyword">not</span>判断</span><br></pre></td></tr></table></figure>

<h3 id="5-自定义过滤器-标签-inclusion-tag"><a href="#5-自定义过滤器-标签-inclusion-tag" class="headerlink" title="5.自定义过滤器 标签 inclusion_tag"></a>5.自定义过滤器 标签 inclusion_tag</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在应用下创建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内创建一个任意名称的py文件</span><br><span class="line"><span class="number">3.</span>在py文件内必须要书写两行固定的代码</span><br><span class="line">	<span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line">    register = Library()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">is_safe=<span class="literal">False</span>,name=<span class="string">&#x27;aaa&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_plus</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义标签(自定义函数)</span></span><br><span class="line"><span class="meta">@register.simple_tag(<span class="params">name=<span class="string">&#x27;bbb&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c,d</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%s-%s-%s-%s&#x27;</span>%(a,b,c,d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义inclusion_tag(自行概括)</span></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params">filename=<span class="string">&#x27;ccc.html&#x27;</span>,name=<span class="string">&#x27;myinc&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">n</span>):</span></span><br><span class="line">    new_l = [<span class="string">&#x27;第%s页&#x27;</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">locals</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 详解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">name=<span class="string">&#x27;baby&#x27;</span> </span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_sum</span>(<span class="params">v1，v2</span>) :</span></span><br><span class="line">	<span class="keyword">return</span> v1 + v2</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;&#123; n|baby:<span class="number">666</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义标签(参数可以有多个)    类似于自定义函数</span></span><br><span class="line"><span class="meta">@register.simple_tag(<span class="params">name=<span class="string">&#x27;plus&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">a,b,c,d</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;%s-%s-%s-%s&#x27;</span>%(a,b,c,d)</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">标签多个参数彼此之间空格隔开</span><br><span class="line">&lt;p&gt;&#123;% plus <span class="string">&#x27;jason&#x27;</span> <span class="number">123</span> <span class="number">123</span> <span class="number">123</span> %&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义inclusion_tag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">内部原理</span></span><br><span class="line"><span class="string">	先定义一个方法</span></span><br><span class="line"><span class="string">	在页面上调用该方法并且可以传值</span></span><br><span class="line"><span class="string">    该访法会生成一些数据然后传递给一个htm1页面</span></span><br><span class="line"><span class="string">    之后将渲染好的结果放到调用的位置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params"><span class="string">&#x27;left_menu.html&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">left</span>(<span class="params">n</span>):</span> </span><br><span class="line">	data = [<span class="string">&#x27;第&#123;&#125;项&#x27;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">		<span class="comment">#第一种</span></span><br><span class="line">		<span class="comment"># return &#123;&#x27;data&#x27;:data&#125; 	# 将data传递给1eft_menu.html</span></span><br><span class="line">		<span class="comment">#第二种</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">locals</span>() 		<span class="comment"># 将data传递给left_menu.html</span></span><br><span class="line"><span class="comment"># 使用    </span></span><br><span class="line">left_menu.html 页面</span><br><span class="line">	&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> data %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; foo &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">	&lt;/ul&gt;</span><br><span class="line">    </span><br><span class="line">使用到该方法页面:</span><br><span class="line">	&#123;% load mytag %&#125;</span><br><span class="line">	&#123;% left 数字 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 总结:当html页面某一个地方的页面需要传参数才能够动态的渲染出来，并且在多个页面上都需要使用到该局部那么就考虑将该局部页面做成inclusion_tag形式</span></span><br><span class="line">(在讲bbs的时候会使用到)</span><br></pre></td></tr></table></figure>

<h3 id="6-模板的继承-使用较多"><a href="#6-模板的继承-使用较多" class="headerlink" title="6.模板的继承(使用较多)"></a>6.模板的继承(使用较多)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">需求</span><br><span class="line">	页面主体不变 部分区域变化</span><br><span class="line"></span><br><span class="line">模板继承</span><br><span class="line">	<span class="number">1.</span>需要现在母版中使用block提前划定区域</span><br><span class="line">    	&#123;% block 区域名称 %&#125;</span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="number">2.</span>在子版中先继承再局部替换</span><br><span class="line">    	&#123;% extends <span class="string">&#x27;母版.html&#x27;</span> %&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;% block 区域名称 %&#125;</span><br><span class="line">    		自定义内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">	母版一般情况下都应该至少含有三个区域</span><br><span class="line">    	css区域</span><br><span class="line">        content区域</span><br><span class="line">        js区域</span><br><span class="line">    </span><br><span class="line">补充</span><br><span class="line">	&#123;&#123; block.<span class="built_in">super</span> &#125;&#125;  调用母版内容</span><br></pre></td></tr></table></figure>

<h3 id="7-模板的导入-了解"><a href="#7-模板的导入-了解" class="headerlink" title="7.模板的导入(了解)"></a>7.模板的导入(了解)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#x27;myform.html&#x27; %&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/12/%E8%A7%86%E5%9B%BE%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/12/%E8%A7%86%E5%9B%BE%E5%B1%82/" class="post-title-link" itemprop="url">Django之视图层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-12T18:20:25+08:00">2019-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h1><h3 id="1-小白必会三板斧"><a href="#1-小白必会三板斧" class="headerlink" title="1.小白必会三板斧"></a>1.小白必会三板斧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>小白必会三板斧</span><br><span class="line">	HttpResponse	<span class="comment">#返回字符串</span></span><br><span class="line">    render			<span class="comment">#返回HTML页面</span></span><br><span class="line">    redirect		<span class="comment">#重定向</span></span><br><span class="line">    </span><br><span class="line">***视图函数必须返回一个HttpResponse对象***</span><br></pre></td></tr></table></figure>

<h3 id="2-JsonResponse"><a href="#2-JsonResponse" class="headerlink" title="2.JsonResponse"></a>2.JsonResponse</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">JsonResponse</span><br><span class="line">	<span class="comment"># 锻炼思维</span></span><br><span class="line">	    <span class="keyword">import</span> json</span><br><span class="line">        <span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">            d = &#123;<span class="string">&quot;username&quot;</span>:<span class="string">&#x27;jason高大威武&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>&#125;</span><br><span class="line">            <span class="comment"># res = json.dumps(d,ensure_ascii=False)</span></span><br><span class="line">            <span class="comment"># return HttpResponse(res)</span></span><br><span class="line">            l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line">            <span class="comment"># return JsonResponse(d,json_dumps_params=&#123;&#x27;ensure_ascii&#x27;:False&#125;)</span></span><br><span class="line">            <span class="keyword">return</span> JsonResponse(l,safe=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">JsonResponse是HttpResponse的一个子类(有很多的子类),助创建JSON编码的响应</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">总结:</span><br><span class="line">    <span class="number">1.J</span>sonResponse序列化默认转码 指定json_dumps_params=&#123;<span class="string">&#x27;ensure_ascii&#x27;</span>:<span class="literal">False</span>&#125;不转码</span><br><span class="line">    <span class="number">2.J</span>sonResponse序列化对象默认的是字典 序列化其他类型需指定safe=<span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="3-json序列化时间类型"><a href="#3-json序列化时间类型" class="headerlink" title="3.json序列化时间类型"></a>3.json序列化时间类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源码只可以看 千万不要随意上手  xadmin  iview  (odoo框架)</span></span><br><span class="line"><span class="comment"># stackoverflow</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date,datetime,timedelta</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># current_time = date.today()</span></span><br><span class="line"><span class="comment"># print(current_time + timedelta(days=-3))</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	isinstance() 函数用来判断一个对象是否是一个已知的类型</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyJsonEncode</span>(<span class="params">json.JSONEncoder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default</span>(<span class="params">self, o</span>):</span></span><br><span class="line">        <span class="comment"># o就是当前即将被序列化的数据对象</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(o,date):	<span class="comment"># 判断一个对象是否是一个已知的类型</span></span><br><span class="line">            <span class="keyword">return</span> o.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(o,datetime):</span><br><span class="line">            <span class="keyword">return</span> o.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;ctime1&#x27;</span>:date.today(),<span class="string">&#x27;ctime2&#x27;</span>:datetime.today()&#125;</span><br><span class="line">res = json.dumps(d,cls=MyJsonEncode)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">TypeError: Object of type datetime is not JSON serializable</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-form表单上传文件"><a href="#4-form表单上传文件" class="headerlink" title="4.form表单上传文件"></a>4.form表单上传文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">必须要指定的参数</span><br><span class="line">	<span class="number">1.</span>method=<span class="string">&#x27;post&#x27;</span></span><br><span class="line">    <span class="number">2.</span>enctype=<span class="string">&#x27;/multipart/form-data/&#x27;</span></span><br><span class="line">    </span><br><span class="line">        &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">            &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myfile&quot;</span> multiple&gt;</span><br><span class="line">            &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span> <span class="title">btn</span>-<span class="title">block</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># print(request.POST)</span></span><br><span class="line">        <span class="comment"># print(request.GET)</span></span><br><span class="line">        <span class="comment"># print(request.FILES)  # 获取文件数据</span></span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&#x27;myfile&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(file_obj.name)  <span class="comment"># 获取文件名</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_obj.name,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                f.write(chunk)</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    在f.chunks()上循环而不是用read()保证大文件不会大量使用你的系统内存</span><br></pre></td></tr></table></figure>

<h3 id="5-FBV与CBV"><a href="#5-FBV与CBV" class="headerlink" title="5.FBV与CBV"></a>5.FBV与CBV</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">FBV 基于函数的视图</span><br><span class="line">	FBV使用频率较低(基础阶段)</span><br><span class="line">CBV 基于类的视图,本质也是FBV</span><br><span class="line">	CBV实际开发项目使用频率较高(高级阶段)</span><br><span class="line">views.py视图层</span><br><span class="line">	视图函数</span><br><span class="line">    	不仅仅可以是函数也可以是类</span><br><span class="line">        	<span class="number">1.</span>面向过程式编程</span><br><span class="line">            <span class="number">2.</span>面向对象式编程</span><br><span class="line">       </span><br><span class="line"><span class="comment"># FBV</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CBV</span></span><br><span class="line">    视图层代码:</span><br><span class="line">    	<span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line">    	<span class="class"><span class="keyword">class</span> <span class="title">Mylogin</span>(<span class="params">View</span>):</span></span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            	<span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get方法&#x27;</span>)</span><br><span class="line">        	<span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            	<span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    路由层代码:</span><br><span class="line">    	url(<span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view())</span><br></pre></td></tr></table></figure>

<h3 id="6-CBV源码-必会"><a href="#6-CBV源码-必会" class="headerlink" title="6.CBV源码(必会)"></a>6.CBV源码(必会)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切入点</span></span><br><span class="line">url(<span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;类名点名字还加括号  名字要么是绑定给类的方法 要么是无参函数&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>as_view()绑定给类的方法</span><br><span class="line"><span class="meta">	@classonlymethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>)</span></span><br><span class="line"><span class="function">2.<span class="title">CBV</span>路由匹配本质与<span class="title">FBV</span>一致</span></span><br><span class="line"><span class="function">	# <span class="title">CBV</span></span></span><br><span class="line"><span class="function">    <span class="title">url</span>(<span class="params"><span class="string">r&#x27;^login/&#x27;</span>, views.Mylogin.as_view(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function">    # <span class="title">CBV</span>本质</span></span><br><span class="line"><span class="function">    # <span class="title">url</span>(<span class="params"><span class="string">r&#x27;^login/&#x27;</span>, views.view</span>)</span></span><br><span class="line"><span class="function">3.匹配成功之后执行<span class="title">view</span>函数代码</span></span><br><span class="line"><span class="function">	<span class="title">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">         self = cls(**initkwargs)</span><br><span class="line">         <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line"><span class="number">4.</span>查看dispatch方法(对象查找属性和方法一定要严格按照顺序来)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 判断当前请求方法是否符合八个默认的请求方法中</span></span><br><span class="line">        <span class="comment"># 1.get</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            <span class="comment"># getattr(对象,&#x27;get&#x27;,&#x27;拿不到的报错信息&#x27;)  &gt;&gt;&gt; Mylogin里面的get方法</span></span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)  <span class="comment"># get(request,...)</span></span><br></pre></td></tr></table></figure>

<h3 id="7-CBV装饰器"><a href="#7-CBV装饰器" class="headerlink" title="7.CBV装饰器"></a>7.CBV装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Django针对CBV添加装饰器需要导入一个模块</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># @method_decorator(装饰器,name=&#x27;post&#x27;)   # 第二种方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogin</span>(<span class="params">views.View</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># @method_decorator(装饰器)  	# 第三种方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().dispatch(request,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from get&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @method_decorator(装饰器)  	# 第一种</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from post&#x27;</span>)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/10/%E8%B7%AF%E7%94%B1%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/10/%E8%B7%AF%E7%94%B1%E5%B1%82/" class="post-title-link" itemprop="url">Django之路由层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-10T18:20:25+08:00">2019-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一-路由层"><a href="#一-路由层" class="headerlink" title="一.路由层"></a>一.路由层</h2><h3 id="1-路由层之路由匹配"><a href="#1-路由层之路由匹配" class="headerlink" title="1.路由层之路由匹配"></a>1.路由层之路由匹配</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">urls.py</span><br><span class="line"></span><br><span class="line">url()方法第一个参数其实是一个正则表达式</span><br><span class="line">第一个参数只要能够匹配到内容就算是符合匹配条件直接停止匹配 执行视图函数</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由匹配</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">^:以什么什么开头</span></span><br><span class="line"><span class="string">$:以什么什么结尾</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^test/$&#x27;</span>,views.test),</span><br><span class="line">url(<span class="string">r&#x27;^testadd/$&#x27;</span>,views.testadd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消自动加斜杠(默认为True)</span></span><br><span class="line">	APPEND_SLASH = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="2-无名分组"><a href="#2-无名分组" class="headerlink" title="2.无名分组"></a>2.无名分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">无名分组:</span><br><span class="line">    给路由匹配的正则表达式加括号</span><br><span class="line">    </span><br><span class="line">在路由匹配的时候如果给正则表达式加上了括号</span><br><span class="line">那么匹配到路由之后会将括号内正则表达式匹配的到内容当做位置参数传递给视图函数</span><br><span class="line">url(<span class="string">r&#x27;^test/(\d+)/(\d+)/&#x27;</span>,views.test)  <span class="comment"># def test(request,正则匹配的内容)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-有名分组"><a href="#3-有名分组" class="headerlink" title="3.有名分组"></a>3.有名分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">有名分组:</span><br><span class="line">    给路由匹配的正则表达式加括号并命名</span><br><span class="line">    </span><br><span class="line">在路由匹配的时候如果给正则表达式加上了括号并且命名</span><br><span class="line">那么匹配到路由之后会将括号内正则表达式匹配的到内容当做关键字参数传递给视图函数</span><br><span class="line">url(<span class="string">r&#x27;^testadd/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.testadd)  <span class="comment"># testadd(request,user_id=正则匹配的内容)</span></span><br></pre></td></tr></table></figure>

<p><strong>两者结合使用?</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^testsub/(\d+)/(?P&lt;sub_id&gt;\d+)/&#x27;</span>,views.sub)</span><br><span class="line">无名有名分组两者不能混合使用!!!</span><br><span class="line"></span><br><span class="line">单独的情况下可以重复使用多次!!!</span><br><span class="line">url(<span class="string">r&#x27;^testsub/(\d+)/(\d+)/&#x27;</span>)</span><br><span class="line">url(<span class="string">r&#x27;^testsub/(?P&lt;sub_id&gt;\d+)/(?P&lt;sub_id&gt;\d+)/&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-反向解析"><a href="#4-反向解析" class="headerlink" title="4.反向解析"></a>4.反向解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;通过别名反向解析到一个结果 该结果可以访问到对应的视图函数&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">前端页面反向解析</span><br><span class="line">	&#123;% url <span class="string">&#x27;index_view&#x27;</span> %&#125;</span><br><span class="line">    </span><br><span class="line">后端流程反向解析</span><br><span class="line">	<span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect, reverse</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">request</span>):</span></span><br><span class="line">        <span class="comment"># 第一种</span></span><br><span class="line">    	_url = reverse(<span class="string">&#x27;index_view&#x27;</span>)</span><br><span class="line">    	<span class="built_in">print</span>(_url)</span><br><span class="line">    	<span class="comment"># return redirect(&#x27;/index/&#x27;)</span></span><br><span class="line">        <span class="comment"># 第二种</span></span><br><span class="line">    	<span class="keyword">return</span> redirect(<span class="string">&#x27;index_view&#x27;</span>)  <span class="comment"># 还可以直接写别名</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 起别名不能冲突</span></span><br></pre></td></tr></table></figure>

<h3 id="5-无名有名反向解析"><a href="#5-无名有名反向解析" class="headerlink" title="5.无名有名反向解析"></a>5.无名有名反向解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">无名:</span><br><span class="line">    url(<span class="string">r&#x27;^login/(\d+)/&#x27;</span>,views.login,name=<span class="string">&#x27;login_view&#x27;</span>)</span><br><span class="line">    reverse(<span class="string">&#x27;login_view&#x27;</span>,args=(<span class="number">1</span>,))</span><br><span class="line">    &#123;% url <span class="string">&#x27;login_view&#x27;</span> <span class="number">1</span> %&#125;</span><br><span class="line">    <span class="comment"># 数字只要能够让\d+匹配到就可以 在实际项目中一般都是动态获取</span></span><br><span class="line"></span><br><span class="line">有名:</span><br><span class="line">    url(<span class="string">r&#x27;^reg/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.reg,name=<span class="string">&#x27;reg_view&#x27;</span>)</span><br><span class="line">    reverse(<span class="string">&#x27;reg_view&#x27;</span>,kwargs=&#123;<span class="string">&#x27;user_id&#x27;</span>:<span class="number">666</span>&#125;)</span><br><span class="line">    &#123;% url <span class="string">&#x27;reg_view&#x27;</span> user_id=<span class="number">123</span> %&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;无论是无名分组还是有名分组的反向解析都可以使用一样的格式&quot;&quot;&quot;</span></span><br><span class="line">    url(<span class="string">r&#x27;^reg/(?P&lt;user_id&gt;\d+)/&#x27;</span>,views.reg,name=<span class="string">&#x27;reg_view&#x27;</span>)</span><br><span class="line">    reverse(<span class="string">&#x27;reg_view&#x27;</span>,args=(<span class="number">123</span>,))</span><br><span class="line">    &#123;% url <span class="string">&#x27;reg_view&#x27;</span> <span class="number">123</span> %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="反向解析实战演练思路"><a href="#反向解析实战演练思路" class="headerlink" title="反向解析实战演练思路"></a>反向解析实战演练思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">项目需求:反向解析完成用户的编辑与删除</span><br><span class="line"></span><br><span class="line">编辑功能:</span><br><span class="line">	<span class="number">1.</span>先开设一个编辑数据的url接口</span><br><span class="line">	<span class="number">2.</span>思考如何携带用户想要编辑的数据的主键值</span><br><span class="line">    	有名分组 </span><br><span class="line">    <span class="number">3.</span>查询出用户想要编辑的数据展示给用户看</span><br><span class="line">    </span><br><span class="line">删除功能:</span><br><span class="line">	<span class="number">1.</span>思考如何携带用户想要编辑的数据的主键值</span><br><span class="line">    	无名分组 </span><br><span class="line">    <span class="number">2.</span>获取数据主键值并删除</span><br></pre></td></tr></table></figure>

<h3 id="6-路由分发"><a href="#6-路由分发" class="headerlink" title="6.路由分发"></a>6.路由分发</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">当django的app特别多的时候 一个urls.py太过冗余</span><br><span class="line">在django中每一个app都可以拥有自己的urls.py static文件夹 templates文件夹</span><br><span class="line"></span><br><span class="line">路由分发</span><br><span class="line">	总路由不再做url与视图函数直接匹配</span><br><span class="line">    而是先根据url分辨出请求哪个业务</span><br><span class="line">    之后分配给下面的app再去匹配视图函数</span><br><span class="line"> 	</span><br><span class="line">复杂版本</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> urls <span class="keyword">as</span> app01_urls</span><br><span class="line">    <span class="keyword">from</span> app02 <span class="keyword">import</span> urls <span class="keyword">as</span> app02_urls</span><br><span class="line">    url(<span class="string">r&#x27;^app01/&#x27;</span>,include(app01_urls)),</span><br><span class="line">    url(<span class="string">r&#x27;^app02/&#x27;</span>,include(app02_urls)),</span><br><span class="line">    </span><br><span class="line">简化版本</span><br><span class="line">    url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>)),</span><br><span class="line">    url(<span class="string">r&#x27;^app02/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>)),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子路由还是按照之前总路由的写法</span></span><br></pre></td></tr></table></figure>

<h3 id="7-名称空间"><a href="#7-名称空间" class="headerlink" title="7.名称空间"></a>7.名称空间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">多个应用在反向解析的时候出现了别名冲突的情况</span><br><span class="line">django是无法做到一一对应的	&gt;&gt;&gt;   名称空间</span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>,namespace=<span class="string">&#x27;app01&#x27;</span>)),</span><br><span class="line">url(<span class="string">r&#x27;^app02/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>,namespace=<span class="string">&#x27;app02&#x27;</span>)),</span><br><span class="line"></span><br><span class="line">reverse(<span class="string">&#x27;app01:index_view&#x27;</span>)</span><br><span class="line">reverse(<span class="string">&#x27;app02:index_view&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#123;% url <span class="string">&#x27;app01:index_view&#x27;</span> %&#125;</span><br><span class="line">&#123;% url <span class="string">&#x27;app02:index_view&#x27;</span> %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 名称空间其实也可以不需要使用</span></span><br><span class="line">只需要确保多个应用之间别名不冲突</span><br><span class="line">	eg:起别名的时候加上应用名前缀</span><br></pre></td></tr></table></figure>

<h3 id="8-伪静态页面"><a href="#8-伪静态页面" class="headerlink" title="8.伪静态页面"></a>8.伪静态页面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">静态页面</span><br><span class="line">	页面上的数据一般都是直接写死的</span><br><span class="line">伪静态页面</span><br><span class="line">	目的是为了提升网页被SEO查询出来的概率</span><br><span class="line">   </span><br><span class="line">伪静态作用：</span><br><span class="line">	伪静态页面，目的是为了更好的被搜索引擎收录而通过一定的规则，把动态页面的地址转换成以htm或html结尾的地址，看起来是静态的，实际是依然是动态页面。</span><br><span class="line"> </span><br><span class="line">如何优化都干不过RMB玩家</span><br><span class="line"><span class="string">&quot;&quot;&quot;所有的搜索引擎都是爬虫程序&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="9-虚拟环境"><a href="#9-虚拟环境" class="headerlink" title="9.虚拟环境"></a>9.虚拟环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">什么是虚拟环境？</span><br><span class="line">	虚拟环境其实就是一个文件夹，只是存储在特殊的位置</span><br><span class="line"></span><br><span class="line">针对不同的项目配置专属的解释器环境</span><br><span class="line">	项目<span class="number">1</span></span><br><span class="line">    	pymysql</span><br><span class="line">        django</span><br><span class="line">    项目<span class="number">2</span></span><br><span class="line">    	flask</span><br><span class="line">        jinja2</span><br><span class="line">    项目<span class="number">3</span></span><br><span class="line">    	tornado</span><br><span class="line">        websocket</span><br><span class="line">虚拟环境作用:</span><br><span class="line">	<span class="number">1.</span>能够在一台计算机上给不同的项目配置专属的解释器环境</span><br><span class="line">    <span class="number">2.</span>解决同一台机器上不同的python工程的依赖、版本以及间接权限等问题</span><br></pre></td></tr></table></figure>

<h3 id="10-Django版本区别"><a href="#10-Django版本区别" class="headerlink" title="10.Django版本区别"></a>10.Django版本区别</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">django1.X与django2.X、django3.X区别</span><br><span class="line"><span class="number">1.</span>路由层</span><br><span class="line">	<span class="number">1.</span>X使用的url方法</span><br><span class="line">    <span class="number">2.</span>X和<span class="number">3.</span>X使用的path方法</span><br><span class="line">    	url第一个参数是正则表达式 path第一个参数不支持正则</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;如果还想使用正则 可以考虑re_path与url一模一样&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    path还支持五种默认的转换器(自动帮你转换数据类型)</span><br><span class="line">    并且还支持自定义转换器</span><br><span class="line">    <span class="built_in">str</span>,匹配除了路径分隔符（/）之外的非空字符串，这是默认的形式</span><br><span class="line">    <span class="built_in">int</span>,匹配正整数，包含<span class="number">0</span>。</span><br><span class="line">    slug,匹配字母、数字以及横杠、下划线组成的字符串。</span><br><span class="line">    uuid,匹配格式化的uuid，如 075194d3-<span class="number">6885</span>-417e-a8a8-6c931e272f00。</span><br><span class="line">    path,匹配任何非空字符串，包含了路径分隔符（/）（不能用？）</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MonthConverter</span>:</span></span><br><span class="line">        regex=<span class="string">&#x27;\d&#123;2&#125;&#x27;</span> <span class="comment"># 属性名必须为regex</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">to_python</span>(<span class="params">self, value</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(value)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">to_url</span>(<span class="params">self, value</span>):</span></span><br><span class="line">            <span class="keyword">return</span> value <span class="comment"># 匹配的regex是两个数字，返回的结果也必须是两个数字数字</span></span><br><span class="line">     </span><br><span class="line">    register_converter(MonthConverter,<span class="string">&#x27;mon&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">    urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;articles/&lt;int:year&gt;/&lt;mon:month&gt;/&lt;sl ug:other&gt;/&#x27;</span>,views.article_detail, name=<span class="string">&#x27;aaa&#x27;</span>),</span><br><span class="line">    ]</span><br><span class="line"><span class="number">2.</span>模型层</span><br><span class="line">	<span class="number">1.</span>X模型层创建外键的时候默认就是级联更新级联删除</span><br><span class="line">    <span class="number">2.</span>X和<span class="number">3.</span>X需要通过参数自己指定(on_delete=models.CASCADE)</span><br><span class="line">    	on_delete有CASCADE、PROTECT、SET_NULL、SET_DEFAULT、SET()五个可选择的值</span><br><span class="line">            CASCADE：此值设置，是级联删除</span><br><span class="line">            PROTECT：此值设置，是会报完整性错误</span><br><span class="line">            SET_NULL：此值设置，会把外键设置为null，前提是允许为null</span><br><span class="line">            SET_DEFAULT：此值设置，会把设置为外键的默认值</span><br><span class="line">            SET()：此值设置，会调用外面的值，可以是一个函数</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/08/Django%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/08/Django%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Django基本操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-08 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-08T18:20:25+08:00">2019-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Django入门"><a href="#Django入门" class="headerlink" title="Django入门"></a>Django入门</h1><h3 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是Django框架?</span><br><span class="line">	Django 是一个用Python语言写的开源web开发框架，采用了MTV的框架模式，即模型M，视图V和模版T,Django中对象关系映射(ORM)的设计也是十分优美的,能够让一个不会SQL语句的小白也能够通过Python 面向对象的代码简单快捷的操作数据库。</span><br><span class="line">        <span class="number">1.</span>模型层(Model)即数据存取层,是用来处理数据相关的所有事务的, 如何存取、验证有效性、包含哪些行为以及数据之间的关系等</span><br><span class="line">        <span class="number">2.</span>模板层(Template)即表现层,是用来处理表现相关的决定:将不同的HTML页面展示给用户</span><br><span class="line">        <span class="number">3.</span>视图层(view)即业务逻辑层,是用来书写业务核心逻辑代码的,是模型层与模板层的桥梁</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span>Django框架的优点:</span><br><span class="line">	<span class="number">1.</span>功能完善、要素齐全：该有的、可以没有的都有，自带大量常用工具和框架，无须你自定义、组合、增删及修改。</span><br><span class="line">	<span class="number">2.</span>完善的文档：经过十多年的发展和完善，Django有广泛的实践案例和完善的在线文档。开发者遇到问题时可以搜索在线文档寻求解决方案。</span><br><span class="line">	<span class="number">3.</span>强大的数据库访问组件：Django的Model层自带数据库ORM组件，使得开发者无须学习其他数据库访问技术（SQL、pymysql、SQLALchemy等）。</span><br><span class="line">	<span class="number">4.</span>灵活的URL映射：Django使用正则表达式管理URL映射，灵活性高。新版的<span class="number">2.0</span>，进一步提高了URL编写的优雅性。</span><br><span class="line">	<span class="number">5.</span>丰富的Template模板语言：类似jinjia模板语言，不但原生功能丰富，还可以自定义模板标签，并且与其ORM的用法非常相似。</span><br><span class="line">	<span class="number">6.</span>自带后台管理系统admin：只需要通过简单的几行配置和代码就可以实现一个完整的后台数据管理控制平台。</span><br><span class="line">	<span class="number">7.</span>完整的错误信息提示：在开发调试过程中如果出现运行错误或者异常，Django可以提供非常完整的错误信息帮助定位问题。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>Django框架的缺点:</span><br><span class="line">    <span class="number">1.</span>性能偏低:与C, C++性能上相比，Django性能偏低</span><br><span class="line">    <span class="number">2.</span>改动困难:很多类和方法都封装了，直接使用比较简单，但改动起来就比较困难</span><br><span class="line">    <span class="number">3.</span>过于笨重:对于一些轻量级应用不需要的功能模块Django也包括了，不如Flask轻便</span><br></pre></td></tr></table></figure>

<h3 id="1-Python三大主流Web框架"><a href="#1-Python三大主流Web框架" class="headerlink" title="1.Python三大主流Web框架"></a>1.Python三大主流Web框架</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django</span></span><br><span class="line"><span class="string">	特点:大而全 自带的功能特别特别特别的多 类似于航空母舰,扩展性很强</span></span><br><span class="line"><span class="string">	不足之处:</span></span><br><span class="line"><span class="string">		有时候过于笨重</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flask</span></span><br><span class="line"><span class="string">	特点:小而精 自带的功能特别特别特别的少 类似于游骑兵</span></span><br><span class="line"><span class="string">	第三方的模块特别特别特别的多，如果将flask第三方的模块加起来完全可以盖过django</span></span><br><span class="line"><span class="string">	并且也越来越像django</span></span><br><span class="line"><span class="string">	不足之处:</span></span><br><span class="line"><span class="string">		比较依赖于第三方的开发者</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">tornado</span></span><br><span class="line"><span class="string">	特点:异步非阻塞 支持高并发</span></span><br><span class="line"><span class="string">		牛逼到甚至可以开发游戏服务器</span></span><br><span class="line"><span class="string">	不足之处:</span></span><br><span class="line"><span class="string">		暂时你不会</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Django基本操作"><a href="#2-Django基本操作" class="headerlink" title="2.Django基本操作"></a>2.Django基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行操作</span></span><br><span class="line">	<span class="number">1.</span>创建django项目</span><br><span class="line">  	<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  	你可以先切换到对应的D盘 然后再创建</span></span><br><span class="line"><span class="string">  	&quot;&quot;&quot;</span></span><br><span class="line">  	django-admin startproject 项目名</span><br><span class="line">    </span><br><span class="line">    	mysite文件夹</span><br><span class="line">      	manage.py</span><br><span class="line">      	mysite文件夹</span><br><span class="line">        	__init__.py</span><br><span class="line">        	settings.py</span><br><span class="line">          urls.py</span><br><span class="line">          wsgi.py</span><br><span class="line">     <span class="number">2.</span>启动django项目</span><br><span class="line">	 <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">		 一定要先切换到项目目录下	</span></span><br><span class="line"><span class="string">		 cd /项目名</span></span><br><span class="line"><span class="string">	 &quot;&quot;&quot;</span></span><br><span class="line">     python3 manage.py runserver</span><br><span class="line">     <span class="comment"># http://127.0.0.1:8000/</span></span><br><span class="line"> </span><br><span class="line">	<span class="number">3.</span>创建应用</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Next, start your first app by running python manage.py startapp [app_label].</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">	python manage.py startapp 应用名 </span><br><span class="line">    应用名应该做到见名知意</span><br><span class="line">      user</span><br><span class="line">      order</span><br><span class="line">      web</span><br><span class="line">      ...</span><br><span class="line">      但是我们教学统一就用app01/02/03/04</span><br><span class="line">      </span><br><span class="line">	有很多文件</span><br><span class="line">  </span><br><span class="line"><span class="comment"># pycharm操作</span></span><br><span class="line">	<span class="number">1</span> new project 选择左侧第二个django</span><br><span class="line">    	书写项目名称和解释器选择</span><br><span class="line">  </span><br><span class="line"> 	<span class="number">2</span> 启动</span><br><span class="line">  		<span class="number">1.</span>还是用命令行启动</span><br><span class="line">    	<span class="number">2.</span>点击绿色小箭头即可</span><br><span class="line"></span><br><span class="line">  	<span class="number">3</span> 创建应用</span><br><span class="line">  		<span class="number">1.</span>pycharm提供的终端直接输入完整命令</span><br><span class="line">    	<span class="number">2.</span>pycharm </span><br><span class="line">      		tools </span><br><span class="line">        		run manage.py task提示(前期不要用 给我背完整命令)</span><br><span class="line">                </span><br><span class="line"> 	<span class="number">4</span> 修改端口号以及创建server	</span><br><span class="line">		edit confi....</span><br></pre></td></tr></table></figure>

<h4 id="动态静态网页"><a href="#动态静态网页" class="headerlink" title="动态静态网页"></a>动态静态网页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">静态网页</span></span><br><span class="line"><span class="string">	页面上的数据是直接写死的 万年不变</span></span><br><span class="line"><span class="string">动态网页</span></span><br><span class="line"><span class="string">	数据是实时获取的</span></span><br><span class="line"><span class="string">	eg:</span></span><br><span class="line"><span class="string">		1.后端获取当前时间展示到html页面上</span></span><br><span class="line"><span class="string">		2.数据是从数据库中获取的展示到html页面上</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用Django前期注意事项"><a href="#使用Django前期注意事项" class="headerlink" title="使用Django前期注意事项"></a>使用Django前期注意事项</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何让你的计算机能够正常的启动django项目</span></span><br><span class="line"> 	<span class="number">1.</span>计算机的名称不能有中文</span><br><span class="line">  	<span class="number">2.</span>一个pycharm窗口只开一个项目 <span class="comment"># 不要文件夹套文件夹</span></span><br><span class="line">  	<span class="number">3.</span>项目里面所有的文件也尽量不要出现中文</span><br><span class="line">  	<span class="number">4.</span>python解释器尽量使用<span class="number">3.4</span>~<span class="number">3.6</span>之间的版本</span><br><span class="line">  	(如果你的项目报错 你点击最后一个报错信息 去源码中把逗号删掉)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django版本问题</span></span><br><span class="line">	<span class="number">1.</span>X <span class="number">2.</span>X <span class="number">3.</span>X(最新版本)</span><br><span class="line">  		<span class="number">1.</span>X和<span class="number">2.</span>X本身差距也不大 </span><br><span class="line">  		公司之前用的<span class="number">1.8</span> 有一些项目用的<span class="number">2.0</span></span><br><span class="line">  </span><br><span class="line"> 		django版本(https://blog.csdn.net/winterye12/article/details/<span class="number">101539059</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># django安装</span></span><br><span class="line">  pip3 install django==<span class="number">1.11</span><span class="number">.11</span></span><br><span class="line">  如果已经安装了其他版本 无需自己卸载</span><br><span class="line">  直接重新装 会自动卸载安装新的</span><br><span class="line">  </span><br><span class="line">  如果报错 看看是不是timeout </span><br><span class="line">  如果是 那么只是网速波动 重新安装即可</span><br><span class="line">  </span><br><span class="line">  验证是否安装成功的方式<span class="number">1</span></span><br><span class="line">  	终端输入django-admin看看有没有反应</span><br></pre></td></tr></table></figure>

<h4 id="命令行-pycharm创建Django项目的区别"><a href="#命令行-pycharm创建Django项目的区别" class="headerlink" title="命令行,pycharm创建Django项目的区别"></a>命令行,pycharm创建Django项目的区别</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 命令行创建不会自动有templates文件夹 需要你自己手动创建而pycharm会自动帮你创建并且还会自动在配置文件中配置对应的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pycharm创建</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)]</span><br><span class="line">]</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 命令行创建</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">]</span><br><span class="line">        </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">用命令创建django项目的时候不单单需要创建templates文件夹还需要去配置文件中配置路径</span></span><br><span class="line"><span class="string">		&#x27;DIRS&#x27;: [os.path.join(BASE_DIR, &#x27;templates&#x27;)]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-应用"><a href="#3-应用" class="headerlink" title="3.应用"></a>3.应用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django是一款专门用来开发app的web框架</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">django框架就类似于是一所大学(空壳子)</span></span><br><span class="line"><span class="string">app就类似于大学里面各个学院(具体功能的app)</span></span><br><span class="line"><span class="string">	比如开发淘宝</span></span><br><span class="line"><span class="string">		订单相关</span></span><br><span class="line"><span class="string">		用户相关</span></span><br><span class="line"><span class="string">		投诉相关</span></span><br><span class="line"><span class="string">		创建不同的app对应不同的功能</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	选课系统</span></span><br><span class="line"><span class="string">		学生功能</span></span><br><span class="line"><span class="string">		老师功能</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">一个app就是一个独立的功能模块</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">***********************创建的应用一定要去配置文件中注册***********************</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.apps.App01Config&#x27;</span>,     <span class="comment"># 全写</span></span><br><span class="line">  	<span class="string">&#x27;app01&#x27;</span>,			 	      <span class="comment"># 简写</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建出来的的应用第一步先去配置文件中注册 其他的先不要给我干</span></span><br><span class="line">ps:你在用pycharm创建项目的时候 pycharm可以帮你创建一个app并且自动注册</span><br><span class="line">************************************************************************</span><br></pre></td></tr></table></figure>

<h3 id="4-主要文件介绍"><a href="#4-主要文件介绍" class="headerlink" title="4.主要文件介绍"></a>4.主要文件介绍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-mysite项目文件夹</span><br><span class="line">  --mysite文件夹		  	  项目文件夹</span><br><span class="line">  		---settings.py	    	配置文件</span><br><span class="line">    	---urls.py				路由与视图函数对应关系(路由层)</span><br><span class="line">    	---wsgi.py				wsgiref模块(不考虑)</span><br><span class="line">  --manage.py			  	django的入口文件</span><br><span class="line">  --db.sqlite3				django自带的sqlite3数据库(小型数据库 功能不是很多还有bug)</span><br><span class="line">  --app01文件夹		  	  应用文件夹</span><br><span class="line">  	    ---migrations文件夹  	  数据库迁移记录</span><br><span class="line">  		---admin.py				django后台管理</span><br><span class="line">   	 	---apps.py				注册使用</span><br><span class="line">    	---models.py			数据库相关的 模型类(orm)</span><br><span class="line">  		---tests.py				测试文件</span><br><span class="line">    	---views.py				视图函数(视图层)</span><br></pre></td></tr></table></figure>

<h3 id="5-Django三板斧"><a href="#5-Django三板斧" class="headerlink" title="5.Django三板斧"></a>5.Django三板斧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">HttpResponse</span></span><br><span class="line"><span class="string">	返回字符串类型的数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">render</span></span><br><span class="line"><span class="string">	返回html文件的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">redirect</span></span><br><span class="line"><span class="string">	重定向</span></span><br><span class="line"><span class="string">	  return redirect(&#x27;https://www.mzitu.com/&#x27;)</span></span><br><span class="line"><span class="string">    return redirect(&#x27;/home/&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-静态文件配置"><a href="#6-静态文件配置" class="headerlink" title="6.静态文件配置"></a>6.静态文件配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登陆功能</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">我们将html文件默认都放在templates文件夹下</span></span><br><span class="line"><span class="string">我们将网站所使用的静态文件默认都放在static文件夹下</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">静态文件</span></span><br><span class="line"><span class="string">	前端已经写好了的 能够直接调用使用的文件</span></span><br><span class="line"><span class="string">		网站写好的js文件</span></span><br><span class="line"><span class="string">		网站写好的css文件</span></span><br><span class="line"><span class="string">		网站用到的图片文件</span></span><br><span class="line"><span class="string">		第三方前端框架</span></span><br><span class="line"><span class="string">		...</span></span><br><span class="line"><span class="string">		拿来就可以直接使用的</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># django默认是不会自动帮你创建static文件夹 需要你自己手动创建</span></span><br><span class="line">一般情况下我们在static文件夹内还会做进一步的划分处理</span><br><span class="line">	-static</span><br><span class="line">  	--js</span><br><span class="line">    --css</span><br><span class="line">    --img</span><br><span class="line">    其他第三方文件</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在浏览器中输入url能够看到对应的资源</span></span><br><span class="line"><span class="string">是因为后端提前开设了该资源的借口</span></span><br><span class="line"><span class="string">如果访问不到资源 说明后端没有开设该资源的借口</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://127.0.0.1:8000/static/bootstrap-3.3.7-dist/css/bootstrap.min.css</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态文件配置</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">****************************************************************</span></span><br><span class="line"><span class="string">当你在写django项目的时候 可能会出现后端代码修改了但是前端页面没有变化的情况</span></span><br><span class="line"><span class="string">	1.你在同一个端口开了好几个django项目 </span></span><br><span class="line"><span class="string">		一直在跑的其实是第一个django项目</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	2.浏览器缓存的问题</span></span><br><span class="line"><span class="string">		settings</span></span><br><span class="line"><span class="string">			network</span></span><br><span class="line"><span class="string">				disable cache 勾选上	</span></span><br><span class="line"><span class="string">*****************************************************************</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/ooo/&#x27;</span>  <span class="comment"># 类似于访问静态文件的令牌</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">如果你想要访问静态文件 你就必须以static开头</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/static/bootstrap-3.3.7-dist/js/bootstrap.min.js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/static/令牌</span></span><br><span class="line"><span class="string">取列表里面从上往下依次查找</span></span><br><span class="line"><span class="string">    bootstrap-3.3.7-dist/js/bootstrap.min.js</span></span><br><span class="line"><span class="string">    都没有才会报错</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态文件配置</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static&#x27;</span>),</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static1&#x27;</span>),</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static2&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态文件动态解析</span></span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;&#123;% static &#x27;bootstrap-3.3.7-dist/css/bootstrap.min.css&#x27; %&#125;&quot;</span>&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;&#123;% static &#x27;bootstrap-3.3.7-dist/js/bootstrap.min.js&#x27; %&#125;&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line"><span class="comment"># form表单默认是get请求数据</span></span><br><span class="line">	http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/login/?username=jason&amp;password=<span class="number">123</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">form表单action参数</span></span><br><span class="line"><span class="string">	1.不写 		默认朝当前所在的url提交数据</span></span><br><span class="line"><span class="string">	2.全写    	指名道姓</span></span><br><span class="line"><span class="string">	3.只写后缀 	   /login/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在前期我们使用django提交post请求的时候 需要取配置文件中注释掉一行代码</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="7-request对象方法"><a href="#7-request对象方法" class="headerlink" title="7.request对象方法"></a>7.request对象方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">request.method 				<span class="comment"># 返回请求方式 并且是全大写的字符串形式 &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">request.POST  				<span class="comment"># 获取用户post请求提交的普通数据不包含文件</span></span><br><span class="line">	request.POST.get()  		<span class="comment"># 只获取列表最后一个元素</span></span><br><span class="line">	request.POST.getlist()  	<span class="comment"># 直接将列表取出</span></span><br><span class="line">    </span><br><span class="line">request.GET 				<span class="comment"># 获取用户提交的get请求数据</span></span><br><span class="line">	request.GET.get()  			<span class="comment"># 只获取列表最后一个元素</span></span><br><span class="line">    request.GET.getlist()  		<span class="comment"># 直接将列表取出</span></span><br><span class="line"></span><br><span class="line">request.POST.FILES			<span class="comment"># 获取POST请求提交的文件数据</span></span><br><span class="line">request.body				<span class="comment"># 获取ajax传输的json格式数据</span></span><br><span class="line"></span><br><span class="line">request.get.path			<span class="comment"># 获取当前请求方式路由</span></span><br><span class="line">request.get.path.info		<span class="comment"># 获取当前请求方式路由 同path</span></span><br><span class="line">request.get.full.path		<span class="comment"># 获取当前请求方式路由以及问号后面参数</span></span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">get请求携带的数据是有大小限制的 大概好像只有4KB左右</span></span><br><span class="line"><span class="string">	而post请求则没有限制</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 返回一个登陆界面</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get请求和post请求应该有不同的处理机制</span></span><br><span class="line"><span class="string">    :param request: 请求相关的数据对象 里面有很多简易的方法</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># print(type(request.method))  # 返回请求方式 全大写的字符串形式 &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">    <span class="comment"># if request.method == &#x27;GET&#x27;:</span></span><br><span class="line">    <span class="comment">#     print(&#x27;来了 老弟&#x27;)</span></span><br><span class="line">    <span class="comment">#     return render(request,&#x27;login.html&#x27;)</span></span><br><span class="line">    <span class="comment"># elif request.method == &#x27;POST&#x27;:</span></span><br><span class="line">    <span class="comment">#     return HttpResponse(&quot;收到了 宝贝&quot;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;收到了 宝贝&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Pycharm连接数据库-MySQL"><a href="#Pycharm连接数据库-MySQL" class="headerlink" title="Pycharm连接数据库(MySQL)"></a>Pycharm连接数据库(MySQL)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">三个位置查找数据库相关</span></span><br><span class="line"><span class="string">	右侧上方database</span></span><br><span class="line"><span class="string">	左下方database</span></span><br><span class="line"><span class="string">	配置里面的plugins插件搜索安装</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	再没有卸载pycharm重新装	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pycharm可以充当很多款数据库软件的客户端</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">参考截图和视频操作即可</span></span><br><span class="line"><span class="string">	需要提前创建好库</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-Django连接数据库-MySQL"><a href="#8-Django连接数据库-MySQL" class="headerlink" title="8.Django连接数据库(MySQL)"></a>8.Django连接数据库(MySQL)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认用的是sqlite3</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: os.path.join(BASE_DIR, <span class="string">&#x27;db.sqlite3&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># django链接MySQL</span></span><br><span class="line">	<span class="number">1.</span>第一步配置文件中配置</span><br><span class="line">        DATABASES = &#123;</span><br><span class="line">        <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;day60&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;admin123&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;PORT&#x27;</span>:<span class="number">3306</span>,</span><br><span class="line">            <span class="string">&#x27;CHARSET&#x27;</span>:<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="number">2.</span>代码声明	</span><br><span class="line">        django默认用的是mysqldb模块链接MySQL</span><br><span class="line">        但是该模块的兼容性不好 需要手动改为用pymysql链接</span><br><span class="line"></span><br><span class="line">        你需要告诉django不要用默认的mysqldb而是用pymysql</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	配置完数据库信息后还需要在项目名下的init或者任意的应用名下的init文件中书写以下代码:</span></span><br><span class="line"><span class="string">		import pymysql</span></span><br><span class="line"><span class="string">        pymysql.install_as_MySQLdb()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>      </span><br></pre></td></tr></table></figure>

<h3 id="9-Django-ORM"><a href="#9-Django-ORM" class="headerlink" title="9.Django ORM"></a>9.Django ORM</h3><h4 id="什么是ORM"><a href="#什么是ORM" class="headerlink" title="什么是ORM?"></a>什么是ORM?</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是ORM?</span><br><span class="line">	对象关系映射（Object Relational Mapping，简称ORM）是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。从效果上说,它其实是创建了一个可在编程语言里使用的“虚拟对象数据库”</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>为什么要有ORM?</span><br><span class="line">	ORM提供了实现持久化层的另一种模式,它采用映射元数据来描述对象关系的映射,使得ORM中间件能在任何一个应用的业务逻辑层和数据库层之间充当桥梁</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>ORM有什么作用?</span><br><span class="line">	ORM将一个Python的对象映射为数据库中的一张关系表。它将SQL封装起来，程序员不再需要关心数据库的具体操作，只需要专注于自己本身代码和业务逻辑的实现。</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> ORM核心原则： </span><br><span class="line">　　<span class="number">1.</span>简单：以最基本的形式建模数据 </span><br><span class="line">　　<span class="number">2.</span>传达性：数据库结构被任何人都能理解的语言文档化</span><br><span class="line">　　<span class="number">3.</span>精确性：基于数据模型创建正确标准化了的结构</span><br><span class="line">　　</span><br><span class="line"><span class="number">5.</span>优缺点:	</span><br><span class="line">	优点:</span><br><span class="line">		<span class="number">1.</span>提高开发效率:能够让一个不会sql语句的小白也能够通过python面向对象的代码简单快捷的操作数据库,进而提升开发效率</span><br><span class="line">		<span class="number">2.</span>解耦合:ORM提供了对数据库的映射,不用sql直接编码,能像操作对象一样从数据库获取数据</span><br><span class="line">	缺点:</span><br><span class="line">		封装程度太高 有时候sql语句的效率偏低 降低了程序性能</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ORM. 对象关系映射</span></span><br><span class="line"><span class="string">作用:能够让一个不会sql语句的小白也能够通过python面向对象的代码简单快捷的操作数据库</span></span><br><span class="line"><span class="string">不足之处:封装程度太高 有时候sql语句的效率偏低 需要你自己写SQL语句</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">类							 表</span></span><br><span class="line"><span class="string">属性							字段</span></span><br><span class="line"><span class="string">对象							记录</span></span><br><span class="line"><span class="string">对象属性					   记录某个字段对应的值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">应用下面的models.py文件</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 先去models.py中书写一个类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        <span class="comment"># id int primary_key auto_increment</span></span><br><span class="line">        <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># username varchar(32)</span></span><br><span class="line">        username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        <span class="comment"># password int</span></span><br><span class="line">        password = models.IntegerField()</span><br><span class="line"></span><br><span class="line">*************************<span class="comment"># 2 数据库迁移命令*************************</span></span><br><span class="line">python3 manage.py makemigrations 将操作记录记录到小本本上(migrations文件夹)</span><br><span class="line">python3 manage.py migrate  将操作真正的同步到数据库中</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只要你修改了models.py中跟数据库相关的代码 就必须重新执行上述的两条命令</span></span><br><span class="line">******************************************************************</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># id int primary_key auto_increment</span></span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>,verbose_name=<span class="string">&#x27;主键&#x27;</span>)</span><br><span class="line">    <span class="comment"># username varchar(32)</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>,verbose_name=<span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    CharField必须要指定max_length参数 不指定会直接报错</span></span><br><span class="line"><span class="string">    verbose_name该参数是所有字段都有的 就是用来对字段的解释</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># password int</span></span><br><span class="line">    password = models.IntegerField(verbose_name=<span class="string">&#x27;密码&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># 由于一张表中必须要有一个主键字段 并且一般情况下都叫id字段</span></span><br><span class="line">    <span class="comment"># 所以orm当你不定义主键字段的时候 orm会自动帮你创建一个名为id主键字段</span></span><br><span class="line">    <span class="comment"># 也就意味着 如果创建模型表的时候主键字段名没有额外的叫法 那么主键字段可以省略不写</span></span><br><span class="line">    <span class="comment"># username varchar(32)</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># password int</span></span><br><span class="line">    password = models.IntegerField()</span><br></pre></td></tr></table></figure>

<h3 id="10-字段的增删改查"><a href="#10-字段的增删改查" class="headerlink" title="10.字段的增删改查"></a>10.字段的增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字段的增加</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;CharField() 括号内必须指定max_length 否则报错&#x27;&#x27;&#x27;</span></span><br><span class="line">  <span class="number">1.</span>可以在终端内直接给出默认值</span><br><span class="line">  <span class="number">2.</span>该字段可以为空(null=<span class="literal">True</span>)</span><br><span class="line">    info = models.CharField(max_length=<span class="number">32</span>,verbose_name=<span class="string">&#x27;个人简介&#x27;</span>,null=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">  <span class="number">3.</span>直接给字段设置默认值(default=<span class="string">&#x27;study)</span></span><br><span class="line"><span class="string">    hobby = models.CharField(max_length=32,verbose_name=&#x27;</span>兴趣<span class="string">&#x27;,default=&#x27;</span>study<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"># 字段的修改</span></span><br><span class="line"><span class="string">	直接修改代码然后执行数据库迁移的两条命令即可！</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 字段的删</span></span><br><span class="line"><span class="string">	直接注释对应的字段然后执行数据库迁移的两条命令即可！</span></span><br><span class="line"><span class="string">    执行完毕之后字段对应的数据也都没有了</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在操作models.py的时候一定要细心</span></span><br><span class="line"><span class="string">	千万不要注释一些字段</span></span><br><span class="line"><span class="string">	执行迁移命令之前最好先检查一下自己写的代码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="11-数据的增删改查"><a href="#11-数据的增删改查" class="headerlink" title="11.数据的增删改查"></a>11.数据的增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查</span></span><br><span class="line">	res = models.User.objects.<span class="built_in">filter</span>(username=username)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">返回值你先看成是列表套数据对象的格式</span></span><br><span class="line"><span class="string">它也支持索引取值 切片操作 但是不支持负数索引</span></span><br><span class="line"><span class="string">它也不推荐你使用索引的方式取值</span></span><br><span class="line"><span class="string">user_obj = models.User.objects.filter(username=username).first()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">filter</span>括号内可以携带多个参数 参数与参数之间默认是<span class="keyword">and</span>关系</span><br><span class="line">你可以把<span class="built_in">filter</span>联想成where记忆</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">res = models.User.objects.create(username=username,password=password)</span><br><span class="line"><span class="comment"># 返回值res就是当前被创建的对象本身</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种增加</span></span><br><span class="line">user_obj = models.User(username=username,password=password)</span><br><span class="line">user_obj.save()  <span class="comment"># 保存数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">res = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).delete()</span><br><span class="line">msg = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>)</span><br><span class="line">msg.delete()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).update(<span class="string">&#x27;name&#x27;</span>=<span class="string">&#x27;jason&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="12-orm表关系的创建"><a href="#12-orm表关系的创建" class="headerlink" title="12.orm表关系的创建"></a>12.orm表关系的创建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">表关系</span><br><span class="line">	一对多</span><br><span class="line">    多对多</span><br><span class="line">    一对一</span><br><span class="line"> </span><br><span class="line">图书管理系统表设计</span><br><span class="line">	图书表</span><br><span class="line">    出版社表</span><br><span class="line">    作者表</span><br><span class="line">    作者详情表</span><br><span class="line">    ps:<span class="string">&#x27;换位思考&#x27;</span></span><br><span class="line">    </span><br><span class="line">表关系</span><br><span class="line">	图书表与出版社表</span><br><span class="line">    	一对多		外键字段建在多的一方</span><br><span class="line">        	models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>)</span><br><span class="line">    图书表与作者表</span><br><span class="line">    	多对多		外键字段需要建在第三张关系表</span><br><span class="line">        	models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>) </span><br><span class="line">    作者表与作者详情表</span><br><span class="line">    	一对一		外键字段建在任意一方均可 推荐建在查询频率高</span><br><span class="line"> 			models.OneToOneField(to=<span class="string">&#x27;AuthorDetail&#x27;</span>)</span><br><span class="line"><span class="comment"># 复习MySQL创建表的完整语法 字段类型 约束条件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">&#x27;书名&#x27;</span>,max_length=<span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 小数总共8位 小数位占两位</span></span><br><span class="line">    price = models.DecimalField(verbose_name=<span class="string">&#x27;价格&#x27;</span>,max_digits=<span class="number">8</span>,decimal_places=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 书与出版社是一对多 并且书是多的一方 外键字段建在数据表中</span></span><br><span class="line">    publish = models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;针对外键字段 orm会自动加_id后缀 如果你加了再继续加_id&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 书与作者是多对多  orm不需要你自己建 它自动帮你建</span></span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)  <span class="comment"># 告诉orm自动创建第三张关系表</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;虚拟字段 不会在表中展示出来 用于ORM自动创建第三张关系表&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;出版社名称&#x27;</span>,max_length=<span class="number">32</span>)</span><br><span class="line">    addr = models.CharField(verbose_name=<span class="string">&#x27;出版社地址&#x27;</span>,max_length=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    addr = models.CharField(verbose_name=<span class="string">&#x27;地址&#x27;</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    <span class="comment"># 作者与作者详情是一对一 推荐建在查询频率高的</span></span><br><span class="line">    author_detail = models.OneToOneField(to=<span class="string">&#x27;AuthorDetail&#x27;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;针对外键字段 orm会自动加_id后缀 如果你加了再继续加_id&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    age = models.IntegerField(verbose_name=<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">    phone = models.BigIntegerField(verbose_name=<span class="string">&#x27;手机号&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="13-Django请求生命周期流程图"><a href="#13-Django请求生命周期流程图" class="headerlink" title="13.Django请求生命周期流程图"></a>13.Django请求生命周期流程图</h3><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210519200852422.png" alt="image-20210519200852422"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/05/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/05/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">WEB应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-05 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-05T18:20:25+08:00">2019-03-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="WEB应用"><a href="#WEB应用" class="headerlink" title="WEB应用"></a>WEB应用</h1><h2 id="一-Web应用程序是什么"><a href="#一-Web应用程序是什么" class="headerlink" title="一.Web应用程序是什么"></a>一.Web应用程序是什么</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Web应用程序是一种可以通过Web访问的应用程序，程序的最大好处是用户很容易访问应用程序，用户只需要有浏览器即可，不需要再安装其他软件</span><br><span class="line"></span><br><span class="line">应用程序有两种模式C/S、B/S。C/S是客户端/服务器端程序，也就是说这类程序一般独立运行。而B/S就是浏览器端/服务器端应用程序，这类应用程序一般借助IE等浏览器来运行。WEB应用程序一般是B/S模式。Web应用程序首先是“应用程序”，和用标准的程序语言，如C、C++等编写出来的程序没有什么本质上的不同。然而Web应用程序又有自己独特的地方，就是它是基于Web的，而不是采用传统方法运行的。换句话说，它是典型的浏览器/服务器架构的产物。</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是Web框架?</span><br><span class="line">	编写 web 应用程序的基石</span><br><span class="line"><span class="number">2.</span>Web框架工作原理</span><br><span class="line">	接收HTTP请求 --&gt; 分发任务 --&gt; 生成HTML --&gt; 返回包含HTML的HTT应答</span><br><span class="line"><span class="number">3.</span>使用Web框架的好处</span><br><span class="line">	使用Web框架进行Web开发的时候，在进行数据缓存、数据库访问、数据安全校验等方面，不需要自己再重新实现，而是将业务逻辑相关的代码写入框架就可以,减少工作量</span><br></pre></td></tr></table></figure>

<h3 id="1-1-Web应用程序的优点"><a href="#1-1-Web应用程序的优点" class="headerlink" title="1.1 Web应用程序的优点"></a>1.1 Web应用程序的优点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.网络应用程序不需要任何复杂的“展开”过程，你所需要的只是一个适用的浏览器；</span><br><span class="line">2.节省用户硬盘空间:网络应用程序通常耗费很少的用户硬盘空间，或者一点都不耗费；</span><br><span class="line">3.不需要更新:因为所有新的特性都在服务器上执行，从而自动传达到用户端；</span><br><span class="line">4.耦合性强:网络应用程序和服务器端的网络产品都很容易结合，如email功能和搜索功能；</span><br><span class="line">5.跨平台性强:因为它们在网络浏览器窗口中运行，所以大多数情况下它们是通过跨平台使用的 (例如Windows，Mac，Linux等)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Web应用程序的缺点"><a href="#1-2-Web应用程序的缺点" class="headerlink" title="1.2 Web应用程序的缺点"></a>1.2 Web应用程序的缺点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>注重浏览器适用性:网络应用程序强调浏览器的适用性。如果浏览器方没有提供特定的功能，或者弃用特定的平台或操作系统版本（导致不适用），就会影响大量用户；</span><br><span class="line"><span class="number">2.</span>连接不能出问题:网络应用依靠互联网远程服务器端的应用文件 连接出问题时，应用将不能正常使用。</span><br><span class="line"><span class="number">3.</span>不能离线使用:许多网络应用程序不是开源的，只能依赖第三方提供的服务，因此不能针对用户定制化、个性化，而且大多数情况下用户不能离线使用，因而损失了很多灵活性；</span><br><span class="line"><span class="number">4.</span>它们完全依赖应用服务商的可及性。如果公司倒闭，服务器停止使用，用户也无法追索以前的资料。对比而看，即使软件制造商倒闭了，传统的安装软件也可以继续运行，尽管不能再更新或有其他用户服务；</span><br><span class="line"><span class="number">5.</span>相似地，提供方公司对软件和其功能有了更大的控制权。只要他们愿意就能为软件添加新特性，即使用户想等bugs先被解决再更新。跳过较差的软件版本也不可能了。公司可以强加不受欢迎的特性给用户，也可以随意减少带宽来削减开支。</span><br><span class="line"><span class="number">6.</span>公司理论上可以检索任何的用户行为。这有可能引起隐私安全问题。</span><br></pre></td></tr></table></figure>

<h3 id="1-3-B-S架构优点"><a href="#1-3-B-S架构优点" class="headerlink" title="1.3 B/S架构优点"></a>1.3 B/S架构优点</h3><p>浏览器/服务器架构（Browser/Server,简称B/S）能够很好地应用在广域网上，成为越来越多的企业的选择。浏览器/服务器架构相对于其他几种应用程序体系结构，有如下3方面的优点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.对于客户端来说:可以使位于Internet任意位置的客户端都能够正常访问服务器。</span><br><span class="line">  对于服务器来说:通过相应的Web服务和数据库服务可以对数据进行处理。采用标准的通信协议，以便共享数据。</span><br><span class="line">2.在服务器上对数据进行处理，就处理的结果生成网页，以方便客户端直接下载。</span><br><span class="line">3.在客户机上对数据的处理被进一步简化，将浏览器作为客户端的应用程序，以实现对数据的显示。不再需要为客户端单独编写和安装其他类型的应用程序。这样，在客户端只需要安装一套内置浏览器的操作系统，直接安装一套浏览器，就可以实现服务器上数据的访问。而浏览器是计算机的标准设备</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h4><p>​        本质上：浏览器是一个socket客户端，服务器是一个socket服务端</p>
<h2 id="二-基于Socket写一个Web应用"><a href="#二-基于Socket写一个Web应用" class="headerlink" title="二.基于Socket写一个Web应用"></a>二.基于Socket写一个Web应用</h2><p>2.1main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_run</span>():</span></span><br><span class="line">    soc = socket.socket()</span><br><span class="line">    soc.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8008</span>))</span><br><span class="line">    soc.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = soc.accept()</span><br><span class="line">        recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(recv_data)</span><br><span class="line">        <span class="comment"># 1 直接在send里写，发送给客户端</span></span><br><span class="line">        <span class="comment"># conn.send(b&#x27;HTTP/1.1 200 OK\r\n\r\n&lt;h1&gt;hello web&lt;/h1&gt;&lt;img src=&quot;https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=5e3814acf9edab64607f4592965fc4a6/14ce36d3d539b600c0c465d0eb50352ac65cb74b.jpg&quot;&gt;&lt;/img&gt;&#x27;)</span></span><br><span class="line">        <span class="comment">#2 打开一个html文件，发送给客户端</span></span><br><span class="line">        <span class="comment"># with open(&#x27;index.html&#x27;,&#x27;r&#x27;,encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class="line">        <span class="comment">#     data=f.read()</span></span><br><span class="line">        <span class="comment"># conn.send((&#x27;HTTP/1.1 200 OK\r\n\r\n%s&#x27;%data).encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">        <span class="comment"># 3 动态网页，字符串替换</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        now=time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime())</span><br><span class="line">        <span class="built_in">print</span>(now)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data=f.read()</span><br><span class="line">        data=data.replace(<span class="string">&#x27;@@@&#x27;</span>,now)</span><br><span class="line">        conn.send((<span class="string">&#x27;HTTP/1.1 200 OK\r\n\r\n%s&#x27;</span>%data).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server_run()</span><br></pre></td></tr></table></figure>

<p>2.2index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>@@@<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=5e3814acf9edab64607f4592965fc4a6/14ce36d3d539b600c0c465d0eb50352ac65cb74b.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三-纯手撸简单Web框架"><a href="#三-纯手撸简单Web框架" class="headerlink" title="三.纯手撸简单Web框架"></a>三.纯手撸简单Web框架</h2><h3 id="3-1main-py"><a href="#3-1main-py" class="headerlink" title="3.1main.py"></a>3.1main.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;img src=&quot;https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=5e3814acf9edab64607f4592965fc4a6/14ce36d3d539b600c0c465d0eb50352ac65cb74b.jpg&quot;&gt;&lt;/img&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;login.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f :</span><br><span class="line">        data=f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">import</span> datetime</span><br><span class="line">    now=datetime.datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %X&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;time.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f :</span><br><span class="line">        data=f.read()</span><br><span class="line">    data=data.replace(<span class="string">&#x27;@@time@@&#x27;</span>,now)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 创建连接</span></span><br><span class="line">    conn = pymysql.connect(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">3306</span>, user=<span class="string">&#x27;root&#x27;</span>, passwd=<span class="string">&#x27;123456&#x27;</span>, db=<span class="string">&#x27;lqz&#x27;</span>)</span><br><span class="line">    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">    cursor.execute(<span class="string">&quot;select id,name,password from user&quot;</span>)</span><br><span class="line">    user_list = cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    tr_list=[]</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> user_list:</span><br><span class="line">        tr=<span class="string">&#x27;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&#x27;</span>%(row[<span class="string">&#x27;id&#x27;</span>],row[<span class="string">&#x27;name&#x27;</span>],row[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">        tr_list.append(tr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_list.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data=f.read()</span><br><span class="line">    data=data.replace(<span class="string">&#x27;@@body@@&#x27;</span>,<span class="string">&#x27;&#x27;</span>.join(tr_list))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list_new</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 创建连接</span></span><br><span class="line">    conn = pymysql.connect(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">3306</span>, user=<span class="string">&#x27;root&#x27;</span>, passwd=<span class="string">&#x27;123456&#x27;</span>, db=<span class="string">&#x27;lqz&#x27;</span>)</span><br><span class="line">    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">    cursor.execute(<span class="string">&quot;select id,name,password from user&quot;</span>)</span><br><span class="line">    user_list = cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user_list_new.html&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data=f.read()</span><br><span class="line">    <span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line">    template=Template(data)</span><br><span class="line">    response=template.render(user_list=user_list)</span><br><span class="line">    <span class="comment"># response=template.render(&#123;&#x27;user_list&#x27;:user_list&#125;)</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    (<span class="string">&#x27;/index&#x27;</span>, index),</span><br><span class="line">    (<span class="string">&#x27;/login&#x27;</span>, login),</span><br><span class="line">    (<span class="string">&#x27;/time&#x27;</span>, time),</span><br><span class="line">    (<span class="string">&#x27;/user_list&#x27;</span>, user_list),</span><br><span class="line">    (<span class="string">&#x27;/user_list_new&#x27;</span>, user_list_new),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    soc = socket.socket()</span><br><span class="line">    soc.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8006</span>))</span><br><span class="line">    soc.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, port = soc.accept()</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="comment"># data=data.decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        data = <span class="built_in">str</span>(data, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        request_list = data.split(<span class="string">&#x27;\r\n\r\n&#x27;</span>)</span><br><span class="line">        head_list = request_list[<span class="number">0</span>].split(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">        method, url, htt = head_list[<span class="number">0</span>].split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="comment"># conn.send(b&#x27;hello web&#x27;)</span></span><br><span class="line">        conn.send(<span class="string">b&#x27;HTTP/1.1 200 OK \r\n\r\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        func_name = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="keyword">if</span> url == u[<span class="number">0</span>]:</span><br><span class="line">                func_name = u[<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> func_name:</span><br><span class="line">            response = func_name(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response = <span class="string">&#x27;404 not found&#x27;</span></span><br><span class="line"></span><br><span class="line">        conn.send(response.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<h3 id="3-2login-html"><a href="#3-2login-html" class="headerlink" title="3.2login.html"></a>3.2login.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3time-hml"><a href="#3-3time-hml" class="headerlink" title="3.3time.hml"></a>3.3time.hml</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">@@time@@</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-user-list-html"><a href="#3-4-user-list-html" class="headerlink" title="3.4 user_list.html"></a>3.4 user_list.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        @@body@@</span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-user-list-new"><a href="#3-5-user-list-new" class="headerlink" title="3.5 user_list_new"></a>3.5 user_list_new</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>password<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% for user in user_list%&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.password&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;%endfor%&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

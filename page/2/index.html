<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/14/Drf%E8%B7%AF%E7%94%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/14/Drf%E8%B7%AF%E7%94%B1/" class="post-title-link" itemprop="url">Drf路由</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-14 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-14T18:20:25+08:00">2019-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf路由"><a href="#Drf路由" class="headerlink" title="Drf路由"></a>Drf路由</h1><h2 id="1-路由Routers"><a href="#1-路由Routers" class="headerlink" title="1.路由Routers"></a>1.路由Routers</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息</span><br><span class="line"></span><br><span class="line"><span class="comment"># REST framework提供了两个router:</span></span><br><span class="line">    <span class="number">1.</span>SimpleRouter		<span class="comment"># 自动生成两个路由</span></span><br><span class="line">    	eg:</span><br><span class="line">            ^books/$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">			^books/(?P&lt;pk&gt;[^/.]+)/$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">    <span class="number">2.</span>DefaultRouter		<span class="comment"># 自动生成六个路由</span></span><br><span class="line">    	eg:</span><br><span class="line">            ^books/$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">            ^books\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;book-list&#x27;</span>]</span><br><span class="line">            ^books/(?P&lt;pk&gt;[^/.]+)/$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            ^books/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;book-detail&#x27;</span>]</span><br><span class="line">            ^$ [name=<span class="string">&#x27;api-root&#x27;</span>]</span><br><span class="line">            ^\.(?P&lt;<span class="built_in">format</span>&gt;[a-z0-<span class="number">9</span>]+)/?$ [name=<span class="string">&#x27;api-root&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">   	<span class="comment"># DefaultRouter与SimpleRouter的区别:</span></span><br><span class="line">    	DefaultRouter会多附带一个默认的API根视图，返回一个包含所有列表视图的超链接响应数据</span><br></pre></td></tr></table></figure>

<h2 id="2-使用方法"><a href="#2-使用方法" class="headerlink" title="2.使用方法"></a>2.使用方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用前提:视图类必须是继承ViewSetMixin的子类，才能自动生成路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建router对象,并注册视图集</span></span><br><span class="line">	eg:</span><br><span class="line">        <span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"></span><br><span class="line">        router = routers.SimpleRouter()</span><br><span class="line">        router.register(<span class="string">&#x27;router_stu&#x27;</span>,StudentView, base_name=<span class="string">&#x27;student&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">	<span class="comment"># register(prefix, viewset, base_name)参数详解:</span></span><br><span class="line">    	prefix 			<span class="comment"># 该视图集的路由前缀</span></span><br><span class="line">        viewset 		<span class="comment"># 视图集</span></span><br><span class="line">        base_name 		<span class="comment"># 路由别名</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># 2.添加路由数据的两种方式:</span></span><br><span class="line">	方式一:</span><br><span class="line">        urlpatterns+=router.urls </span><br><span class="line">    方式二:</span><br><span class="line">        urlpatterns = [</span><br><span class="line">    		path(<span class="string">&#x27;api/&#x27;</span>, include(router.urls))</span><br><span class="line">		]	</span><br></pre></td></tr></table></figure>

<h3 id="自动生成路由代码演示"><a href="#自动生成路由代码演示" class="headerlink" title="自动生成路由代码演示"></a>自动生成路由代码演示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类代码:</span></span><br><span class="line">	<span class="comment"># 必须是继承ModelViewSet的视图类才能自动生成路由</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line">        <span class="comment"># 这种方法不会自动生成，需要用action配置</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self,request</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;学生登录功能&quot;&quot;&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(self.action)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;登录成功&quot;</span>&#125;)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由代码:</span></span><br><span class="line">	<span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line">    <span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">    urlpatterns = [</span><br><span class="line">        path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用drf提供路由类router给视图集生成路由列表&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 实例化路由类</span></span><br><span class="line">    <span class="comment"># Drf一共提供了两个路由类给我们使用,他们用法一致,功能几乎一样</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter,SimpleRouter</span><br><span class="line">    router = DefaultRouter() 或 router = SimpleRouter()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注册视图集</span></span><br><span class="line">    router.register(<span class="string">&quot;router_stu&quot;</span>,views.StudentModelViewSet)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把生成的路由列表追加到urlpatterns</span></span><br><span class="line">    urlpatterns += router.urls</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    上述代码就自动生成路由地址[增/删/改/查一条/查多条的功能],但不会自动生成我们在视图集自定义方法的路由</span><br><span class="line">    所以我们如果也要给自定义方法生成路由,则需要进行action动作的声明</span><br></pre></td></tr></table></figure>

<h2 id="3-视图集附加action声明"><a href="#3-视图集附加action声明" class="headerlink" title="3.视图集附加action声明"></a>3.视图集附加action声明</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	视图集中，如果想要让Router自动帮我们为自定义的方法生成路由信息，需使用action装饰器,用action装饰器装饰的方法名会作为action动作名,与<span class="built_in">list</span>、retrieve等同</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入装饰器:</span></span><br><span class="line">    rest_framework.decorators.action</span><br><span class="line">    </span><br><span class="line"><span class="comment"># action装饰器可以接收两个参数:</span></span><br><span class="line">    methods: 声明该action对应的请求方式，列表传递</span><br><span class="line">    detail:  声明该action的路径是否与单一资源对应(Tr)</span><br><span class="line">        eg:</span><br><span class="line">            detail=<span class="literal">True</span>   生成的路由是:xxx/&lt;pk&gt;/action方法名/</span><br><span class="line">            detail=<span class="literal">False</span>  生成的路由是:xxx/action方法名/    </span><br></pre></td></tr></table></figure>

<h3 id="action装饰器生成路由代码演示"><a href="#action装饰器生成路由代码演示" class="headerlink" title="action装饰器生成路由代码演示"></a>action装饰器生成路由代码演示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图类代码:</span></span><br><span class="line">    <span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">    <span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StudentModelViewSet</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">        queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">        serializer_class = StudentModelSerializer</span><br><span class="line"></span><br><span class="line">        <span class="comment"># methods 		设置当前方法允许哪些http请求访问当前视图方法</span></span><br><span class="line">        <span class="comment"># detail 		设置当前视图方法是否是操作一个数据</span></span><br><span class="line">        <span class="comment"># detail=False   表示路径名格式应该为 router_stu/login/</span></span><br><span class="line"><span class="meta">        @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;登陆成功&#x27;</span>&#125;)</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># detail=True   表示路径名格式应该为 router_stu/&#123;pk&#125;/get_new_5/</span></span><br><span class="line"><span class="meta">        @action(<span class="params">methods=[<span class="string">&#x27;put&#x27;</span>], detail=<span class="literal">True</span></span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_new_5</span>(<span class="params">self, request,pk</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;获取5条数据成功&#x27;</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 被action装饰的自定义方法会自动生成如下路由:</span></span><br><span class="line">	^router_stu/&#123;pk&#125;/login/$   name: router_stu-login</span><br><span class="line">    ^router_stu/get_new_5/$    name: router_stu-get_new_5 </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/12/Drf%E5%85%A5%E9%97%A8%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/12/Drf%E5%85%A5%E9%97%A8%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">Drf入门规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-12T18:20:25+08:00">2019-05-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Django高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Drf-Djano高级"><a href="#Drf-Djano高级" class="headerlink" title="Drf(Djano高级)"></a>Drf(Djano高级)</h1><h2 id="1-Web开发模式"><a href="#1-Web开发模式" class="headerlink" title="1.Web开发模式"></a>1.Web开发模式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 前后端混合开发</span><br><span class="line">	-模板渲染在后端完成</span><br><span class="line">    var name=<span class="string">&quot;&#123;&#123;dic&#125;&#125;&quot;</span></span><br><span class="line"><span class="number">2</span> 前后端分离（主流）</span><br><span class="line">	-后端只负责写接口，前端来调用，通信使用json格式</span><br><span class="line">    -多端（web，app）都可以使用同一个接口 </span><br></pre></td></tr></table></figure>

<h4 id="前后端不分离"><a href="#前后端不分离" class="headerlink" title="前后端不分离:"></a>前后端不分离:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628182533637.png" alt="image-20210628182533637"></p>
<h4 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离:"></a>前后端分离:</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628182613156.png" alt="image-20210628182613156"></p>
<h2 id="2-API接口"><a href="#2-API接口" class="headerlink" title="2.API接口"></a>2.API接口</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是API接口(应用程序接口)?</span><br><span class="line">    通过网络，规定了前后台信息交互规则的url链接，也就是前后台信息交互的媒介</span><br><span class="line">	为了在团队内部形成共识、防止个人习惯差异引起的混乱，我们需要找到一种大家都觉得很好的接口实现规范，而且这种规范能够让后端写的接口，用途一目了然，减少双方之间的合作成本(详细可以查看微博开放平台:https://<span class="built_in">open</span>.weibo.com/wiki/<span class="number">2</span>/users/show)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>API功能</span><br><span class="line">	<span class="number">1.</span>API确认所有操作都是合法的</span><br><span class="line">	<span class="number">2.</span>在发生错误时，API会根据错误报告机制发出指示</span><br><span class="line">	<span class="number">3.</span>API内置授权和访问控制，确保只有授权人员才能访问特殊数据</span><br><span class="line">	<span class="number">4.</span>可以充当防火墙，防止资源被滥用，允许合法的请求</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>常见API接口形式</span><br><span class="line">	<span class="number">1.</span>HTTP类型接口</span><br><span class="line">		基于HTTP协议提供的API,这类API常常以“网址”形式提供的,像现在主流的RESTful就属于这类接口</span><br><span class="line">        </span><br><span class="line">	<span class="number">2.</span>RPC接口</span><br><span class="line">		RPC它是指远程过程调用，将一部分代码逻辑放在远程服务器上部署，然后在需要的地方调用即可(调用远程方法就像调用本地方法一样),本质上是Client/Server模式，而且支持多种协议和数据传输方式</span><br><span class="line">        </span><br><span class="line">	<span class="number">3.</span>Web Service 接口</span><br><span class="line">		Web Service并不具象地指某种API，我们将以WEB形式提供的服务都称之为Web Service，像RESTful也属于Web Service。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="number">4.</span>API接口四大特点:</span><br><span class="line">    <span class="number">1.</span>url：长得像返回数据的url链接</span><br><span class="line">    <span class="number">2.</span>请求方式：get、post、put、patch、delete</span><br><span class="line">    <span class="number">3.</span>请求参数：json或xml格式的&#123;key:value&#125;类型数据</span><br><span class="line">    <span class="number">4.</span>响应结果：json或xml格式的数据</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="number">5.</span>接口约束子类行为</span><br><span class="line">	-人为</span><br><span class="line">    -abc模块</span><br><span class="line">    -父类抛异常</span><br></pre></td></tr></table></figure>

<h3 id="接口测试工具"><a href="#接口测试工具" class="headerlink" title="接口测试工具"></a>接口测试工具</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接口测试工具:</span></span><br><span class="line">	<span class="number">1.</span>接口测试工具有很多 --&gt; postman,浏览器插件，接口压力测试工具Jmeter</span><br><span class="line">    <span class="number">2.</span>本质就是模拟发送http请求</span><br><span class="line">    <span class="number">3.</span>安装postman ---&gt; 双击即可</span><br><span class="line">    <span class="number">4.</span>前后端交互的编码方式</span><br><span class="line">    	-urlencoded		<span class="comment"># 普通数据</span></span><br><span class="line">        -form-data		<span class="comment"># 普通数据和文件数据</span></span><br><span class="line">        -json			<span class="comment"># json格式数据</span></span><br><span class="line">    <span class="number">5.</span>详见http://www.liuqingzheng.top/python/Django-rest-framework%E6%A1%<span class="number">86</span>%E6%9E%B6/<span class="number">1</span>-drf-drf%E5%<span class="number">85</span>%A5%E9%<span class="number">97</span>%A8%E8%A7%<span class="number">84</span>%E8%8C%<span class="number">83</span>/</span><br></pre></td></tr></table></figure>

<p><strong>工作面板:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184627445.png" alt="image-20210628184627445"></p>
<p><strong>简易get请求:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184657295.png" alt="image-20210628184657295"></p>
<p><strong>简易的post请求:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184729439.png" alt="image-20210628184729439"></p>
<p><strong>案例:请求百度地图接口</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210628184809594.png" alt="image-20210628184809594"></p>
<h2 id="3-RESTful规范"><a href="#3-RESTful规范" class="headerlink" title="3.RESTful规范"></a>3.RESTful规范</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>什么是RESTful?</span><br><span class="line">	RESTful是一种定义Web API接口的设计风格，尤其适用于前后端分离的应用模式中,大部分的接口，都会按照这个规范去写(Web API接口的设计风格)最早出现在<span class="number">2000</span>年Roy Fielding的博士论文中</span><br><span class="line">	</span><br><span class="line"><span class="number">2.</span>RESTful十条:</span><br><span class="line">	<span class="number">1.</span>url链接一般都采用https协议进行传输(提高数据交互过程中的安全性)</span><br><span class="line">    </span><br><span class="line">	<span class="number">2.</span>url中带关键字api(代表该请求url链接是完成前后台数据交互的)</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com</span><br><span class="line">            https://www.baidu.com/api</span><br><span class="line">                </span><br><span class="line">	<span class="number">3.</span>url中带版本信息</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/v1</span><br><span class="line">            https://api.baidu.com/v2</span><br><span class="line">                </span><br><span class="line">    <span class="number">4.</span>数据即资源，均使用名词表示(可复数)</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/users</span><br><span class="line">            https://api.baidu.com/books</span><br><span class="line">            https://api.baidu.com/book</span><br><span class="line">                </span><br><span class="line">    <span class="number">5</span> 资源操作由请求方式决定</span><br><span class="line">        -查询操作----get(查单条,查所有)</span><br><span class="line">        -新增操作----post</span><br><span class="line">        -修改操作----put(整体修改),patch(局部修改)</span><br><span class="line">        -删除操作----delete</span><br><span class="line">        eg:</span><br><span class="line">            https://api.baidu.com/books 	- get请求：获取所有书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- get请求：获取主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books 	- post请求：新增一本书书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span>	- put请求：整体修改主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- patch请求：局部修改主键为<span class="number">1</span>的书</span><br><span class="line">            https://api.baidu.com/books/<span class="number">1</span> 	- delete请求：删除主键为<span class="number">1</span>的书</span><br><span class="line">                </span><br><span class="line">     <span class="number">6</span> 请求url中带搜索筛选条件(通过在url上传参的形式传递搜索条件)</span><br><span class="line">    	https://api.example.com/v1/zoos?limit=<span class="number">10</span>：			<span class="comment"># 指定返回记录的数量</span></span><br><span class="line">        https://api.example.com/v1/zoos?offset=<span class="number">10</span>：			<span class="comment"># 指定返回记录的开始位置</span></span><br><span class="line">        https://api.example.com/v1/zoos?animal_type_id=<span class="number">1</span>：	<span class="comment"># 指定筛选条件</span></span><br><span class="line">            </span><br><span class="line">   	 <span class="number">7.</span>响应中要带状态码（自己定义，http响应状态码）</span><br><span class="line">        &#123;</span><br><span class="line">        	status:<span class="number">200</span></span><br><span class="line">        &#125;</span><br><span class="line">        eg:(常见状态码)</span><br><span class="line">            <span class="number">200</span>：常规请求</span><br><span class="line">			<span class="number">201</span>：创建成功</span><br><span class="line">            <span class="number">301</span>：永久重定向</span><br><span class="line">            <span class="number">302</span>：暂时重定向</span><br><span class="line">            <span class="number">403</span>：请求无权限</span><br><span class="line">            <span class="number">404</span>：请求路径或资源不存在</span><br><span class="line">            <span class="number">405</span>：请求方法不存在</span><br><span class="line">            <span class="number">500</span>：服务器异常</span><br><span class="line"> </span><br><span class="line">      <span class="number">8.</span>响应返回错误或提示信息</span><br><span class="line">         &#123;</span><br><span class="line">             status:<span class="number">200</span></span><br><span class="line">             msg: <span class="string">&quot;无权限操作&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">        </span><br><span class="line">      <span class="number">9.</span>返回结果，遵循如下规范(大概率都没有遵循)</span><br><span class="line">        GET /collection				<span class="comment"># 返回资源对象的列表（数组）</span></span><br><span class="line">        GET /collection/resource	<span class="comment"># 返回单个资源对象</span></span><br><span class="line">        POST /collection			<span class="comment"># 返回新生成的资源对象</span></span><br><span class="line">        PUT /collection/resource	<span class="comment"># 返回完整的资源对象</span></span><br><span class="line">        PATCH /collection/resource	<span class="comment"># 返回完整的资源对象</span></span><br><span class="line">        DELETE /collection/resource	<span class="comment"># 返回一个空文档</span></span><br><span class="line">      </span><br><span class="line">      <span class="number">10.</span>返回数据中带链接地址</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">        <span class="string">&quot;results&quot;</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>:<span class="string">&quot;肯德基(罗餐厅)&quot;</span>,</span><br><span class="line">                <span class="string">&quot;img&quot;</span>: <span class="string">&quot;https://image.baidu.com/kfc/001.png&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        	]</span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-序列化"><a href="#4-序列化" class="headerlink" title="4.序列化"></a>4.序列化</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 什么是序列化和反序列化?</span></span><br><span class="line">	序列化：把我们识别的数据转换成指定的格式提供给别人</span><br><span class="line">	反序列化：把别人提供的数据转换/还原成我们需要的格式</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">    前端js提供过来的json数据,对于python而言就是字符串，我们需要进行反序列化换成模型类对象，这样我们才能把数据保存到数据库中</span><br></pre></td></tr></table></figure>

<h2 id="5-Drf简介及安装"><a href="#5-Drf简介及安装" class="headerlink" title="5.Drf简介及安装"></a>5.Drf简介及安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drf简介:</span></span><br><span class="line">	Django Rest_Framework:是django的一个app，可以借助它快速在django框架开发出符合restful规范的接口</span><br><span class="line"><span class="comment"># Drf提供了：</span></span><br><span class="line">	REST framework还提供了认证、权限、限流、过滤、分页、接口文档等功能支持</span><br><span class="line"><span class="comment"># Drf官方文档：</span></span><br><span class="line">	https://www.django-rest-framework.org/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># python django的版本支持情况</span></span><br><span class="line">    Python（<span class="number">3.5</span>、<span class="number">3.6</span>、<span class="number">3.7</span>、<span class="number">3.8</span>、<span class="number">3.9</span>）</span><br><span class="line">    Django (<span class="number">2.2</span>, <span class="number">3.0</span>, <span class="number">3.1</span>)   <span class="number">2.</span>x用的多，<span class="number">1.</span>x老项目</span><br><span class="line"></span><br><span class="line"><span class="comment"># django版本区别：1版本跟2b没有大的区别</span></span><br><span class="line">	<span class="number">1</span>版本支持路由正则匹配,<span class="number">2</span>版本的路由写什么就是什么,精准匹配,<span class="number">5</span>个转换器(<span class="built_in">int</span>，<span class="built_in">str</span>，slug，path，uuid)</span><br><span class="line">    <span class="number">1</span>版本默认级联更新级联删除,<span class="number">2</span>版本需要自己指定级联删除动作</span><br><span class="line">      </span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">	pip3 install djangorestframework</span><br><span class="line">    <span class="comment"># 注意：跟django版本对应好，django 2.2.2 ---&gt; drf最新</span></span><br></pre></td></tr></table></figure>

<h2 id="6-基于Drf快速实现五个接口"><a href="#6-基于Drf快速实现五个接口" class="headerlink" title="6.基于Drf快速实现五个接口"></a>6.基于Drf快速实现五个接口</h2><h3 id="6-1路由层"><a href="#6-1路由层" class="headerlink" title="6.1路由层"></a>6.1路由层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = SimpleRouter()</span><br><span class="line">router.register(<span class="string">&#x27;book&#x27;</span>, views.BookView)</span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment">#    path(&#x27;admin/&#x27;, admin.site.urls),</span></span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<h3 id="6-2视图层"><a href="#6-2视图层" class="headerlink" title="6.2视图层"></a>6.2视图层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .serizlizer <span class="keyword">import</span> BookSerializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookView</span>(<span class="params">ModelViewSet</span>):</span></span><br><span class="line">    queryset = Books.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>

<h3 id="6-3模型层"><a href="#6-3模型层" class="headerlink" title="6.3模型层"></a>6.3模型层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=models.IntegerField()</span><br><span class="line">    publish=models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-4序列化类"><a href="#6-4序列化类" class="headerlink" title="6.4序列化类"></a>6.4序列化类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Books</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializer</span>(<span class="params">ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=Books</span><br><span class="line">        fields=<span class="string">&#x27;__all__&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-Cbv源码分析"><a href="#7-Cbv源码分析" class="headerlink" title="7.Cbv源码分析"></a>7.Cbv源码分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>views.Book.as_view()执行完的结果一定是个函数内存地址</span><br><span class="line"><span class="number">2.</span>as_view是View类的类方法，类来调用</span><br><span class="line"><span class="number">3.</span>as_view中view这个闭包函数的源码是</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">view</span>(<span class="params">request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 核心代码</span></span><br><span class="line">        <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line"><span class="number">4.</span>执行了View类的dispatch</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 如果是get请求</span></span><br><span class="line">        <span class="comment"># request.method.lower() 是get字符串，下面条件符合</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            <span class="comment"># 通过反射拿到我们写的Book视图类的中的get方法</span></span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">        <span class="comment"># get(request, *args, **kwargs)----&gt;执行Book视图类中的get方法,再同FBV</span></span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line"><span class="number">5.</span>扩展，如果我在Book视图类中重写dispatch方法</span><br><span class="line">	-可以实现，在get，post方法执行之前或者之后执行代码，完成类似装饰器的效果</span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">            <span class="comment"># 加代码</span></span><br><span class="line">            response=<span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">            <span class="comment"># 加代码</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="8-DRF基本使用及执行流程分析"><a href="#8-DRF基本使用及执行流程分析" class="headerlink" title="8.DRF基本使用及执行流程分析"></a>8.DRF基本使用及执行流程分析</h2><h3 id="8-1继承APIView使用"><a href="#8-1继承APIView使用" class="headerlink" title="8.1继承APIView使用"></a>8.1继承APIView使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 这个request是什么？新的，drf的Reqeust对象,用起来，跟老request对象一样</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(request))  		  <span class="comment"># rest_framework.request.Request</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(request._request)) <span class="comment"># django.core.handlers.wsgi.WSGIRequest</span></span><br><span class="line">        <span class="built_in">print</span>(request.GET)  <span class="comment"># 神奇</span></span><br><span class="line">        <span class="built_in">print</span>(request._request.GET)  <span class="comment"># 应该这么用</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;get请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 以后再取值，都从request.data中取(三种编码格式数据都可以取到)</span></span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="built_in">print</span>(request.POST)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;post请求&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-2APIView执行流程"><a href="#8-2APIView执行流程" class="headerlink" title="8.2APIView执行流程"></a>8.2APIView执行流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIView继承了django的View</span></span><br><span class="line"><span class="number">1.</span>APIView中重写了as_view</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_view</span>(<span class="params">cls, **initkwargs</span>):</span></span><br><span class="line">        <span class="comment"># 调用父类的as_view</span></span><br><span class="line">        view = <span class="built_in">super</span>().as_view(**initkwargs)</span><br><span class="line">        <span class="comment"># 只要继承APIView以后所有的视图都没有csrf保护了 不管是否注释掉中间件 </span></span><br><span class="line">        <span class="keyword">return</span> csrf_exempt(view)</span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>请求来了-&gt;路由匹配上-&gt;view(request)-&gt;调用self.dispatch-&gt;apiview中重写了diapatch</span><br><span class="line">执行self.dispatch()----&gt;APIView的dispatch</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">		<span class="comment"># 重新包装了一个新的request对象，基于原来的request对象包装的</span></span><br><span class="line">        <span class="comment"># 这个request对象是新的request对象，是drf提供的Request类的对象</span></span><br><span class="line">        <span class="comment"># 新的request包含原来老的request(django的request)</span></span><br><span class="line">        <span class="comment"># self._request = request</span></span><br><span class="line">        request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        <span class="comment">#print(request._request)  老的request对象</span></span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">        	<span class="comment"># 认证，权限，频率...</span></span><br><span class="line">            self.initial(request, *args, **kwargs)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">                handler = <span class="built_in">getattr</span>(self, request.method.lower(),</span><br><span class="line">                                  self.http_method_not_allowed)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handler = self.http_method_not_allowed</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 视图类中get方法的执行</span></span><br><span class="line">            response = handler(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="comment"># 如果在视图类中有错误，会被捕获（全局异常处理）</span></span><br><span class="line">            response = self.handle_exception(exc)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 把response包装了一下，返回</span></span><br><span class="line">        self.response = self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self.response</span><br><span class="line">	   </span><br><span class="line"><span class="number">3.</span>在视图类中使用的request对象是新的request对象，老的是request._request</span><br><span class="line">	-新的request.GET拿到的还是老的GET，原理如下(Request类重写了__getattr__)</span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, attr</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 通过反射 获取原生的request对象,取其属性或方法</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">getattr</span>(self._request, attr)</span><br><span class="line">            <span class="keyword">except</span> AttributeError:</span><br><span class="line">                <span class="keyword">return</span> self.__getattribute__(attr)</span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">魔法方法：</span></span><br><span class="line"><span class="string">	类中__名字__的方法，就叫魔法方法,学过的__init__(类实例化执行),__str__(打印对象执行)</span></span><br><span class="line"><span class="string">    不需要主动调用,某种特定条件就会触发它的执行</span></span><br><span class="line"><span class="string">    __getattr__：对象.属性，会触发它的执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line"><span class="number">4.</span>结论:以后继承了APIView后，request对象成了新的，但是跟原来一样用</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>新的request对象中有一个属性data</span><br><span class="line">	<span class="comment"># request.data感觉是一个数据属性,其实是一个方法,被@property修饰</span></span><br><span class="line">	-data是post请求携带的数据(三种编码格式)----&gt;字典</span><br><span class="line">    -无论是什么编码格式，只要是post提交的数据，都在request.data中</span><br><span class="line">	-以后再取值，都从request.data中取</span><br></pre></td></tr></table></figure>

<h3 id="8-3APIView和Request对象分析"><a href="#8-3APIView和Request对象分析" class="headerlink" title="8.3APIView和Request对象分析"></a>8.3APIView和Request对象分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 以后如果使用了drf，继承APIView(drf提供了很多view，他们都是继承自APIView)执行流程如下</span><br><span class="line">	-包装出了一个新的request，在视图函数中使用时，跟原来没有区别</span><br><span class="line">    -注意：</span><br><span class="line">    取post提交的数据，不要从request.POST中取了，要从request.data中取</span><br><span class="line">    取get提交的数据，尽量不从request.GET中取了，要从request.query_params中取</span><br><span class="line">    eg:</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">query_params</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self._request.GET</span><br><span class="line">    </span><br><span class="line"><span class="number">2</span> Request类(drf的)中需要掌握的</span><br><span class="line">	-request.data  			<span class="comment"># 方法包装成了数据属性</span></span><br><span class="line">    -request.query_params 	<span class="comment"># 就是request._request.GET</span></span><br><span class="line">    -request.FIELS        	<span class="comment"># 上传的文件</span></span><br><span class="line">    -用起来跟原来一样</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span> APIView类</span><br><span class="line">	-包装新的request</span><br><span class="line">    -执行了认证，权限，频率....</span><br><span class="line">    -处理了全局异常</span><br><span class="line">    -包装了response对象</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/05/04/Ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/04/Ajax/" class="post-title-link" itemprop="url">Ajax</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-04 18:20:25" itemprop="dateCreated datePublished" datetime="2019-05-04T18:20:25+08:00">2019-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h3 id="1-Ajax简介"><a href="#1-Ajax简介" class="headerlink" title="1.Ajax简介"></a>1.Ajax简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">异步提交 局部刷新</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">同步:提交任务之后原地等待任务结果期间不做任何事</span></span><br><span class="line"><span class="string">异步:提交任务之后不原地等待任务结果 等任务产生结果通过异步回调机制</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">前戏页面</span><br><span class="line">	博客园注册页面</span><br><span class="line">    github注册页面</span><br><span class="line"> </span><br><span class="line">能够发送网络请求的方法</span><br><span class="line">	a				get请求</span><br><span class="line">    form表单		   get请求、post请求</span><br><span class="line">    ajax            get请求、post请求</span><br><span class="line"> </span><br><span class="line">ajax不是一门独立的语言 而是一个功能 类似于装饰器</span><br><span class="line">	能够实现ajax功能的书写方式有很多 </span><br><span class="line">    	eg:原生js代码 jQuery封装代码 组件框架代码...</span><br><span class="line">    我们这里学习jQuery版本</span><br><span class="line"> </span><br><span class="line">ajax前戏</span><br><span class="line">	需求:保证页面不刷新的情况下完成数字的和</span><br></pre></td></tr></table></figure>

<h3 id="2-基本语法"><a href="#2-基本语法" class="headerlink" title="2.基本语法"></a>2.基本语法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">基本参数:</span></span><br><span class="line"><span class="string">	url:		提交地址   同form表单action参数</span></span><br><span class="line"><span class="string">	type:		请求方式   同form表单method参数</span></span><br><span class="line"><span class="string">	data:		数据体     需要发送的数据</span></span><br><span class="line"><span class="string">	success:	回调函数   后端返回结果自动执行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">ajax发送给后端</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">            url:<span class="string">&#x27;&#x27;</span>,                       // 控制提交地址 规律与form标签的action参数一致</span><br><span class="line">            <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,                  // 控制请求方式</span><br><span class="line">            data:&#123;<span class="string">&#x27;i1&#x27;</span>:i1Val,<span class="string">&#x27;i2&#x27;</span>:i2Val&#125;, // 发送的数据 一般是字典形式</span><br><span class="line">            success:function (args) &#123;</span><br><span class="line">                    // 异步回调函数</span><br><span class="line">                    &#123;<span class="comment">#alert(args)#&#125;</span></span><br><span class="line">                    // 查看<span class="built_in">input</span>框并且写入数据</span><br><span class="line">                    $(<span class="string">&#x27;#i3&#x27;</span>).val(args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-前后端传输数据的编码格式-contenType"><a href="#3-前后端传输数据的编码格式-contenType" class="headerlink" title="3.前后端传输数据的编码格式(contenType)"></a>3.前后端传输数据的编码格式(contenType)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">contenType</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">前后端数据传输格式主要有三种</span></span><br><span class="line"><span class="string">    application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">	multipart/form-data</span></span><br><span class="line"><span class="string">    application/json</span></span><br><span class="line"><span class="string">朝后端发送数据的时候针对不同的方式后端有不同的处理措施</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># form表单</span></span><br><span class="line">默认数据编码格式是urlencoded</span><br><span class="line">数据格式:username=jason&amp;password=<span class="number">234</span></span><br><span class="line">    <span class="number">1.</span>针对urlencoded格式:</span><br><span class="line">        django后端针对符合urlencoded格式的数据会自动解析并封装到request.POST中</span><br><span class="line">    <span class="number">2.</span>针对form-data格式:</span><br><span class="line">        django后端针对form-data格式的数据文件自动封装到request.FILES中 普通的符合urlencoded还是封装到request.POST中</span><br><span class="line">    <span class="number">3.</span>针对json格式</span><br><span class="line">    	form表单发送不了json格式数据</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"><span class="comment"># ajax</span></span><br><span class="line">默认数据编码格式是urlencoded</span><br><span class="line">数据格式:username=jason&amp;password=<span class="number">234</span></span><br><span class="line">    <span class="number">1.</span>针对urlencoded格式:</span><br><span class="line">        django后端针对符合urlencoded格式的数据会自动解析封装到request.POST中 同form表单</span><br><span class="line">	<span class="number">2.</span>针对form-data:</span><br><span class="line">        django后端能够直接识别到formdata对象并将内部的普通键值自动解析封装到request.POST中 文件数据自动解析并封装到request.FILEs中</span><br><span class="line">    <span class="number">3.</span>针对json格式:</span><br><span class="line">        django后端不会帮你处理json格式数据需要你自己去request.body获取并处理    </span><br></pre></td></tr></table></figure>

<h4 id="dataType参数"><a href="#dataType参数" class="headerlink" title="dataType参数"></a>dataType参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataType</span><br><span class="line">	django后端如果使用JsonResponse给回调函数返回json格式字符串 回调函数会自动反序列化成js中的自定义对象</span><br><span class="line">    django后端不使用JsonResponse而是自己通过json模块序列化的数据 回调函数接收到之后不会自动反序列化</span><br></pre></td></tr></table></figure>

<h3 id="4-Ajax发送文件格式数据"><a href="#4-Ajax发送文件格式数据" class="headerlink" title="4.Ajax发送文件格式数据"></a>4.Ajax发送文件格式数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Ajax发送文件:</span></span><br><span class="line"><span class="string">    1.利用FormData内置对象先生成一个对象</span></span><br><span class="line"><span class="string">    2.向生成的对象里添加想要发送的普通数据或文件数据</span></span><br><span class="line"><span class="string">    3.将生成的对象放在data后面发送给后端</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	ajax发送文件格式数据必须要指定的两个参数</span></span><br><span class="line"><span class="string">		1.contentType:false		声明不使用任何编码 django后端自动识别formDataObj对象</span></span><br><span class="line"><span class="string">		2.processData:false		向浏览器声明不处理formDataObj对象 直接发送</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ajax发送文件数据</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&#x27;#d1&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function () &#123;</span><br><span class="line">                // <span class="number">1.</span>先生成一个内置对象</span><br><span class="line">                let formDataObj = new FormData();</span><br><span class="line">                // <span class="number">2.</span>添加符合urlencoded格式的普通键值对数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;jason&#x27;</span>);</span><br><span class="line">                // <span class="number">3.</span>添加文件数据</span><br><span class="line">                formDataObj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#myfile&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">                // <span class="number">4.</span>ajax发送给后端</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&#x27;&#x27;</span>,  			// 提交地址 规律同form标签的action参数</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,  		// 请求方式</span><br><span class="line">                    data:formDataObj,  	// 发送的数据</span><br><span class="line">                    // Ajax发送文件必须额外指定两个参数</span><br><span class="line">                    contentType:false,  // 不采用任何编码 后端能直接识别formdata对象</span><br><span class="line">                    processData:false,  // 不处理formdata对象 直接发送即可</span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                        ...</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;); </span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">总结:</span><br><span class="line">	<span class="number">1.</span>需要利用内置对象FormData</span><br><span class="line">    	生成一个对象:</span><br><span class="line">        	let formDataObj = new FormData();</span><br><span class="line">        添加普通的键值对</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;username&#x27;</span>,$(<span class="string">&#x27;#d1&#x27;</span>).val());</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;password&#x27;</span>,$(<span class="string">&#x27;#d2&#x27;</span>).val());</span><br><span class="line">        添加文件对象</span><br><span class="line">        	formDate0bj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#d3&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>])</span><br><span class="line">	<span class="number">2.</span>需要指定两个关键性的参数</span><br><span class="line">        contentType :false   // 不需使用任何编码django后端能够自动识别formdata对象</span><br><span class="line">        processData:false	 // 告诉你的浏览器不要对你的数据进行任何处理</span><br><span class="line">	<span class="number">3.</span> django后端能直接识别到formdata对象并且能够将内部的普通键值自动解析封装到request.POST中 文件数据自动解析并封装到request.FILEs中</span><br></pre></td></tr></table></figure>

<h3 id="5-Ajax发送Json格式数据"><a href="#5-Ajax发送Json格式数据" class="headerlink" title="5.Ajax发送Json格式数据"></a>5.Ajax发送Json格式数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">前后端传输数据的时候一定要确保编码格式跟数据真正的格式是一致的</span></span><br><span class="line"><span class="string">不要骗人家!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;username&quot;:&quot;jason&quot;, &quot;age&quot;:25&#125;</span></span><br><span class="line"><span class="string">	在request.POST里面肯定找不到</span></span><br><span class="line"><span class="string">	django针对json格式的数据不会做任何的处理</span></span><br><span class="line"><span class="string">	需自己去request.body获取并处理</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">request对象方法补充</span></span><br><span class="line"><span class="string">	request.is_ajax()</span></span><br><span class="line"><span class="string">	判断当前请求是否是ajax请求 返回布尔值</span></span><br><span class="line"><span class="string">	is_开头基本上返回结果都是布尔值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>	</span><br><span class="line"></span><br><span class="line">前端:</span><br><span class="line">    </span><br><span class="line">ajax发送json格式数据</span><br><span class="line">	django后端不做任何处理 直接以二进制形式存放在request.body中</span><br><span class="line">	data</span><br><span class="line">	contentType</span><br><span class="line">    </span><br><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;#d1&#x27;</span>).click(function () &#123;</span><br><span class="line">        	$.ajax(&#123;</span><br><span class="line">        			url:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        			<span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        			data:JSON.stringify( &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">25</span>&#125;),</span><br><span class="line">        			contentType:<span class="string">&#x27;application/json&#x27;</span>,  // 指定编码格式</span><br><span class="line">        			success:function () &#123;</span><br><span class="line">        		   &#125;</span><br><span class="line">       		 &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">***************************************************************************************</span><br><span class="line">后端:</span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ab_ison</span>(<span class="params">reguesthi</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">if</span> request.is_ajax(<span class="params"></span>):</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.is_ajax())</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.POST)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.FILES)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># print(request.body)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># b&#x27;&#123;&quot;username&quot;:&quot;jason&quot;,&quot;age&quot;:25&#125; &#x27;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment">#针对json格式数据需要你自己手动处理</span></span></span></span><br><span class="line"><span class="params"><span class="function">        json_bytes= request.body</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json_str = json_bytes.decode(&#x27;utf-8&#x27;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json_dict = json.Loads(json_str)</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># json.Loads括号内如果传入了一个二进制格式的数据那么内部自动解码再反序列化</span></span></span></span><br><span class="line"><span class="params"><span class="function">        json_dict = json.Loads(<span class="params">json_bytes</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment"># &#123;&#x27;username&#x27;:&#x27;jason&#x27;,&#x27;age&#x27;: 2&#125;</span></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">print</span>(<span class="params">json_dict,<span class="built_in">type</span>(<span class="params">json_dict</span>)</span>) <span class="comment"># &#123;&#x27;username&#x27;:&#x27;jason&#x27;,&#x27;age&#x27;: 25&#125;</span></span></span></span><br><span class="line"><span class="params"><span class="function">     <span class="keyword">return</span> render(<span class="params">request,<span class="string">&#x27;ab_json.htmL&#x27;</span></span>)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="ajax传输json格式数据需要注意点"><a href="#ajax传输json格式数据需要注意点" class="headerlink" title="ajax传输json格式数据需要注意点"></a>ajax传输json格式数据需要注意点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">针对发送:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ajax发送json格式数据需要注意点:</span></span><br><span class="line"><span class="string">    1.ContentType参数指定成: application/json</span></span><br><span class="line"><span class="string">    2.数据是真正的json格式数据</span></span><br><span class="line"><span class="string">    3.django后端不会帮你处理json格式数据需要你自己去request.body获取并处理</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">针对接收:</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">后端如果是用HttpResponse返回的json格式数据回调函数不会自动帮你反序列化</span></span><br><span class="line"><span class="string">如果后端直接用的是JsonResponse返回的数据回调函数会自动反序列化(前端设置dataType:&#x27;json&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">HttpResponse返回json格式数据解决方式</span></span><br><span class="line"><span class="string">    1.自己在前端利用JSON.parse( )</span></span><br><span class="line"><span class="string">    2.在ajax里面配置一个参数(dataType=&#x27;json&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-Django内置序列化模块-serializers"><a href="#6-Django内置序列化模块-serializers" class="headerlink" title="6.Django内置序列化模块(serializers)"></a>6.Django内置序列化模块(serializers)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ab_ser</span>(<span class="params">request</span>):</span></span><br><span class="line">    book_queryset = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 自己构造字典</span></span><br><span class="line">    <span class="comment"># book_list = []</span></span><br><span class="line">    <span class="comment"># for book_obj in book_queryset:</span></span><br><span class="line">    <span class="comment">#     book_list.append(&#123;&#x27;title&#x27;:book_obj.title,</span></span><br><span class="line">    <span class="comment">#                       &#x27;price&#x27;:book_obj.price,</span></span><br><span class="line">    <span class="comment">#                       &#x27;publish_time&#x27;:book_obj.publish_time</span></span><br><span class="line">    <span class="comment">#                       &#125;)</span></span><br><span class="line">    <span class="comment"># res = json.dumps(book_list)</span></span><br><span class="line">    <span class="comment"># return render(request,&#x27;ab_ser.html&#x27;,locals())</span></span><br><span class="line">    res = serializers.serialize(<span class="string">&#x27;json&#x27;</span>,book_queryset)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res)</span><br></pre></td></tr></table></figure>

<h3 id="5-基于Ajax实现二次确认"><a href="#5-基于Ajax实现二次确认" class="headerlink" title="5.基于Ajax实现二次确认"></a>5.基于Ajax实现二次确认</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;.del_link&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function (a) &#123;</span><br><span class="line">            var $aEle = $(this);</span><br><span class="line">            var deleteId = $(this).attr(<span class="string">&#x27;delete_id&#x27;</span>);</span><br><span class="line">            // 提示二次确认</span><br><span class="line">            res = confirm(<span class="string">&#x27;你确定真的要删吗?&#x27;</span>);</span><br><span class="line">            // 判断是否删除</span><br><span class="line">            <span class="keyword">if</span> (res)&#123;</span><br><span class="line">                // 发送ajax请求</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url:<span class="string">&quot;/book_delete/&quot;</span> + deleteId,</span><br><span class="line">                    <span class="built_in">type</span>:<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">                    data:&#123;&#125;,</span><br><span class="line">                    success:function (args) &#123;</span><br><span class="line">                        // <span class="number">1.</span>页面刷新  不推荐使用</span><br><span class="line">                        window.location.reload();</span><br><span class="line">                        // <span class="number">2.</span>DOM操作  正规 用户体验好</span><br><span class="line">                        $aEle.parent().parent().remove()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                	alert(<span class="string">&#x27;怂逼不敢删啦&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="6-借助于插件完成二次确认弹框展示"><a href="#6-借助于插件完成二次确认弹框展示" class="headerlink" title="6.借助于插件完成二次确认弹框展示"></a>6.借助于插件完成二次确认弹框展示</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">前端:</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="string">&#x27;.del_book&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, function () &#123;</span><br><span class="line">            let $del_id = $(this)</span><br><span class="line">            let book_id = $(this).attr(<span class="string">&#x27;book_id&#x27;</span>)</span><br><span class="line">            console.log(book_id)</span><br><span class="line"></span><br><span class="line">            swal(&#123;</span><br><span class="line">                    title: <span class="string">&quot;Are you sure?&quot;</span>,</span><br><span class="line">                    text: <span class="string">&quot;You will not be able to recover this imaginary file!&quot;</span>,</span><br><span class="line">                    <span class="built_in">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">                    showCancelButton: true,</span><br><span class="line">                    confirmButtonClass: <span class="string">&quot;btn-danger&quot;</span>,</span><br><span class="line">                    confirmButtonText: <span class="string">&quot;Yes, delete it!&quot;</span>,</span><br><span class="line">                    cancelButtonText: <span class="string">&quot;No, cancel plx!&quot;</span>,</span><br><span class="line">                    closeOnConfirm: false,</span><br><span class="line">                    closeOnCancel: false</span><br><span class="line">                &#125;,</span><br><span class="line">                function (isConfirm) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isConfirm) &#123;</span><br><span class="line">                        $.ajax(&#123;</span><br><span class="line">                            url: <span class="string">&#x27;/app01/delete_book/&#x27;</span>,</span><br><span class="line">                            <span class="built_in">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">                            data: &#123;<span class="string">&#x27;id&#x27;</span>: book_id&#125;,</span><br><span class="line">                            success: function (data) &#123;</span><br><span class="line">                                swal(data.key, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">                                $del_id.parent().parent().remove()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        swal(<span class="string">&#x27;小怂逼,我就知道你不敢删&#x27;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">后端:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Delete_book</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        back_dict = &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;&#x27;</span>, &#125;  </span><br><span class="line">        <span class="keyword">if</span> request.is_ajax():</span><br><span class="line">            book_id = request.GET.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">            back_dict[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&#x27;你完了,赶紧跑路吧&#x27;</span></span><br><span class="line">            </span><br><span class="line">            models.Book.objects.<span class="built_in">filter</span>(pk=book_id).delete()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(back_dict)</span><br></pre></td></tr></table></figure>

<h3 id="7-批量插入数据"><a href="#7-批量插入数据" class="headerlink" title="7.批量插入数据"></a>7.批量插入数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bulk_create() 批量插入数据,括号内放可迭代对象</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">0</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">25</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">50</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">https://movie.douban.com/top250?start=<span class="number">75</span>&amp;<span class="built_in">filter</span>=</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 往book表中插入1万条书籍数据</span></span><br><span class="line">    <span class="comment"># 效率极低</span></span><br><span class="line">    <span class="comment"># for i in range(1,10001):</span></span><br><span class="line">    <span class="comment">#     models.Book.objects.create(title=&#x27;第%s本书&#x27;%i)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 批量插入</span></span><br><span class="line">    <span class="comment"># book_list = []</span></span><br><span class="line">    <span class="comment"># for i in range(1,10001):</span></span><br><span class="line">    <span class="comment">#     book_list.append(models.Book(title=&#x27;第%s本书&#x27;%i))</span></span><br><span class="line">    <span class="comment"># models.Book.objects.bulk_create(book_list) </span></span><br></pre></td></tr></table></figure>

<h3 id="8-自定义分页器"><a href="#8-自定义分页器" class="headerlink" title="8.自定义分页器"></a>8.自定义分页器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">只需要掌握课上推导思路即可 无需再过多研究</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">获取当前页码</span></span><br><span class="line"><span class="string">    current_page = request.GET.get(&#x27;page&#x27;,1)</span></span><br><span class="line"><span class="string">    current_page = int(current_page)</span></span><br><span class="line"><span class="string">    book_queryset = models.Book.objects.all()</span></span><br><span class="line"><span class="string">    all_count = book_queryset.count()</span></span><br><span class="line"><span class="string">    # 规定每页展示多少条数据</span></span><br><span class="line"><span class="string">    per_page_num = 10</span></span><br><span class="line"><span class="string">    page_num,more = divmod(all_count,per_page_num)</span></span><br><span class="line"><span class="string">    if more:</span></span><br><span class="line"><span class="string">        page_num += 1</span></span><br><span class="line"><span class="string">    html = &#x27;&#x27;</span></span><br><span class="line"><span class="string">    xxx = current_page</span></span><br><span class="line"><span class="string">    if current_page &lt;= 6:</span></span><br><span class="line"><span class="string">        xxx = 6</span></span><br><span class="line"><span class="string">    for i in range(xxx-5,xxx+6):</span></span><br><span class="line"><span class="string">        if i == current_page:</span></span><br><span class="line"><span class="string">            i = &#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;%(i,i)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            i = &#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;%(i,i)</span></span><br><span class="line"><span class="string">        html += i</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # 起始位置</span></span><br><span class="line"><span class="string">    start_page = (current_page - 1) * per_page_num</span></span><br><span class="line"><span class="string">    # 终止位置</span></span><br><span class="line"><span class="string">    end_page = current_page * per_page_num</span></span><br><span class="line"><span class="string">    # 查询数据并展示到前端页面</span></span><br><span class="line"><span class="string">    book_queryset = book_queryset[start_page:end_page]</span></span><br><span class="line"><span class="string">    return render(request, &#x27;home.html&#x27;, locals())</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="分页器"><a href="#分页器" class="headerlink" title="分页器"></a>分页器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pagination</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, current_page, all_count, per_page_num=<span class="number">2</span>, pager_count=<span class="number">11</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        封装分页相关数据</span></span><br><span class="line"><span class="string">        :param current_page: 当前页</span></span><br><span class="line"><span class="string">        :param all_count:    数据库中的数据总条数</span></span><br><span class="line"><span class="string">        :param per_page_num: 每页显示的数据条数</span></span><br><span class="line"><span class="string">        :param pager_count:  最多显示的页码个数</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.current_page = current_page</span><br><span class="line">        self.all_count = all_count</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 总页码</span></span><br><span class="line">        all_pager, tmp = <span class="built_in">divmod</span>(all_count, per_page_num)</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            all_pager += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">        self.all_pager = all_pager</span><br><span class="line">        self.pager_count = pager_count</span><br><span class="line">        self.pager_count_half = <span class="built_in">int</span>((pager_count - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_html</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 如果总页码 &lt; 11个：</span></span><br><span class="line">        <span class="keyword">if</span> self.all_pager &lt;= self.pager_count:</span><br><span class="line">            pager_start = <span class="number">1</span></span><br><span class="line">            pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 总页码  &gt; 11</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 当前页如果&lt;=页面上最多显示11/2个页码</span></span><br><span class="line">            <span class="keyword">if</span> self.current_page &lt;= self.pager_count_half:</span><br><span class="line">                pager_start = <span class="number">1</span></span><br><span class="line">                pager_end = self.pager_count + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 当前页大于5</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 页码翻到最后</span></span><br><span class="line">                <span class="keyword">if</span> (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line">                    pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">                    pager_start = self.all_pager - self.pager_count + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pager_start = self.current_page - self.pager_count_half</span><br><span class="line">                    pager_end = self.current_page + self.pager_count_half + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        page_html_list = []</span><br><span class="line">        <span class="comment"># 添加前面的nav和ul标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;nav aria-label=&#x27;Page navigation&#x27; class=&#x27;text-center&#x27;&gt;</span></span><br><span class="line"><span class="string">                    &lt;ul class=&#x27;pagination&#x27;&gt;</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        first_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (<span class="number">1</span>)</span><br><span class="line">        page_html_list.append(first_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &lt;= <span class="number">1</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page - <span class="number">1</span>,)</span><br><span class="line"></span><br><span class="line">        page_html_list.append(prev_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pager_start, pager_end):</span><br><span class="line">            <span class="keyword">if</span> i == self.current_page:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            page_html_list.append(temp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &gt;= self.all_pager:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page + <span class="number">1</span>,)</span><br><span class="line">        page_html_list.append(next_page)</span><br><span class="line"></span><br><span class="line">        last_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.all_pager,)</span><br><span class="line">        page_html_list.append(last_page)</span><br><span class="line">        <span class="comment"># 尾部添加标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                                           &lt;/nav&gt;</span></span><br><span class="line"><span class="string">                                           &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                                       &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(page_html_list)</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book</span>(<span class="params">request</span>):</span></span><br><span class="line">   book_list = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line">   current_page = request.GET.get(<span class="string">&quot;page&quot;</span>,<span class="number">1</span>)</span><br><span class="line">   all_count = book_list.count()</span><br><span class="line">   page_obj = Pagination(current_page=current_page,all_count=all_count,per_page_num=<span class="number">10</span>)</span><br><span class="line">   page_queryset = book_list[page_obj.start:page_obj.end]</span><br><span class="line">   <span class="keyword">return</span> render(request,<span class="string">&#x27;booklist.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h5 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2&quot;&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">for</span> <span class="title">book</span> <span class="title">in</span> <span class="title">page_queryset</span> %&#125;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span>&gt;&#123;&#123; <span class="title">book</span>.<span class="title">title</span> &#125;&#125;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &#123;% <span class="title">endfor</span> %&#125;</span></span><br><span class="line"><span class="class">            &#123;&#123; <span class="title">page_obj</span>.<span class="title">page_html</span>|<span class="title">safe</span> &#125;&#125;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/29/cookie%E4%B8%8Esession/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/29/cookie%E4%B8%8Esession/" class="post-title-link" itemprop="url">cookie与session</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-29 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-29T18:20:25+08:00">2019-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cookie与session"><a href="#cookie与session" class="headerlink" title="cookie与session"></a>cookie与session</h1><h3 id="1-cookie-session简介"><a href="#1-cookie-session简介" class="headerlink" title="1.cookie,session简介"></a>1.cookie,session简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议四大特性</span><br><span class="line">	<span class="number">1.</span>基于请求响应</span><br><span class="line">    <span class="number">2.</span>基于TCP、IP作用于应用层之上</span><br><span class="line">    <span class="number">3.</span>无连接</span><br><span class="line">    <span class="number">4.</span>无状态</span><br><span class="line">    	</span><br><span class="line">基于HTTP协议的通信无法记录客户端状态(无状态)</span><br><span class="line">但是现在很多软件都需要记录用户的状态 为了解决这个问题</span><br><span class="line">发明了cookie session等一系列的技术</span><br><span class="line"></span><br><span class="line">cookie</span><br><span class="line">	保存在客户端浏览器上面的键值对数据</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 浏览器保存用户的关键信息</span></span><br><span class="line"><span class="string">    以后访问的时候浏览器自动发送关键信息从而实现身份识别</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    关键型数据直接保存在浏览器上不安全</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> </span><br><span class="line">    </span><br><span class="line">session</span><br><span class="line">	保存在服务器上面的键值对数据(数据类型不固定)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    eg:当用户登录成功之后 服务端返回给浏览器一个随机字符串</span></span><br><span class="line"><span class="string">    之后访问都将随机字符串发送给服务端</span></span><br><span class="line"><span class="string">    服务端内部做比对</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># session需要依赖于cookie才可以工作</span></span><br><span class="line">客户端浏览器可以保存服务端发送过来的cookie数据也可以选择拒绝</span><br></pre></td></tr></table></figure>

<h4 id="cookie操作"><a href="#cookie操作" class="headerlink" title="cookie操作"></a>cookie操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">视图函数返回的HttpResponse对象</span><br><span class="line"><span class="keyword">return</span> HttpResponse()</span><br><span class="line"><span class="keyword">return</span> render()</span><br><span class="line"><span class="keyword">return</span> redirect()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">obj = HttpResponse()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = render()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">obj = redirect()</span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置cookie</span></span><br><span class="line">    obj = HttpResponse(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">    obj.set_cookie(key,value)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加盐(加密)</span></span><br><span class="line">	obj.set_signed_cookie(key,value,salt=<span class="string">&#x27;盐&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 获取cookie</span></span><br><span class="line">	request.COOKIES.get(key)</span><br><span class="line">    request.get_signed_cookie(key,salt=<span class="string">&#x27;盐&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 删除cookie</span></span><br><span class="line">	obj.delete_cookie(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有效时间</span></span><br><span class="line">    obj.set_cookie(key,value,max_age=<span class="number">3</span>,expires=<span class="number">3</span>)</span><br><span class="line">        max_age=<span class="number">3</span></span><br><span class="line">        expires=<span class="number">3</span></span><br><span class="line">            两者都是设置有效时间 并且都是以秒为单位</span><br><span class="line">            需要注意的是 针对IE浏览器需要使用expires</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">校验用户是否登录才能访问视图函数的装饰器</span></span><br><span class="line"><span class="string">	能够记住用户在没有登陆之前想要访问的页面 登录之后跳转到对应的页面</span></span><br><span class="line"><span class="string">    request.path()				# 仅获取url</span></span><br><span class="line"><span class="string">    request.path.info			# 仅获取url</span></span><br><span class="line"><span class="string">    request.get_full_path		# 获取url及问号后数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="session操作"><a href="#session操作" class="headerlink" title="session操作"></a>session操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.session是存储在服务器端的 django默认情况下是需要借助于django_session表来存储数据 也就意味着如果你想要操作session那么必须先执行数据库迁移命令让django先把django_session表创建出来(no such table:django_session)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.django默认的session有效时间是14天</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.session存储在服务端 可以有很多地方存储</span></span><br><span class="line"><span class="string">	1.表</span></span><br><span class="line"><span class="string">	2.文件</span></span><br><span class="line"><span class="string">	3.缓存</span></span><br><span class="line"><span class="string">	4.其他</span></span><br><span class="line"><span class="string">	...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置session:</span></span><br><span class="line">	request.session[<span class="string">&#x27;key&#x27;</span>] = value </span><br><span class="line">    </span><br><span class="line">    session设置时发生的事:</span><br><span class="line">        <span class="number">1.</span>django内部自动生成一个随机字符串</span><br><span class="line">        <span class="number">2.</span>django内部会将随机字符串和数据存入django_session表中</span><br><span class="line">        	<span class="number">2.1</span>先在内存中产生操作数据的缓存</span><br><span class="line">            <span class="number">2.2</span>在响应结果django中间件的时候才真正的操作sh<span class="string">u&#x27;ju&#x27;</span>ku</span><br><span class="line">        <span class="number">3.</span>将随机字符串返回给客户端浏览器保存</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 获取session:</span></span><br><span class="line">	request.session.get(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    session读取时发生的事:</span><br><span class="line">        <span class="number">1.</span>自动从客户端浏览器请求中获取sessionid对应的随机字符串</span><br><span class="line">        <span class="number">2.</span>拿着随机字符串去django_session表中查找数据比对</span><br><span class="line">        <span class="number">3.</span></span><br><span class="line">        	如果比对上了 则将对应的数据取出并以字典的形式封装到request.session中</span><br><span class="line">            如果比对不上 则request.session.get(key)返回的是<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 清除session:</span></span><br><span class="line">	request.session.delete()  		<span class="comment"># 只删服务端 客户端不删</span></span><br><span class="line"> 	request.session.flush()  		<span class="comment"># 客户端浏览器和服务端都删(推荐使用)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 设置有效时间</span></span><br><span class="line">    request.session.set_expiry(value)	</span><br><span class="line">    	括号内可以放四种类型参数</span><br><span class="line">        	<span class="number">1.</span>整数   						   多少秒</span><br><span class="line">            <span class="number">2.</span>datatime/timedelt(日期格式)	  到指定日期就失效</span><br><span class="line">            <span class="number">3.0</span> 				  			关闭当前浏览器就失效</span><br><span class="line">            <span class="number">4.</span>不写						   django内部session默认失效时间(<span class="number">14</span>天)</span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">django_session表中的数据是取决于浏览器的</span></span><br><span class="line"><span class="string">	同一个计算机上(IP地址)同一个浏览器只会有一条数据生效</span></span><br><span class="line"><span class="string">	(当session过期的时候可能会出现多条数据对应一个浏览器 但是该现象不会持续很久 内部会自动识别过期的数据清除 也可以通过代码清除)</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	主要是为了节省服务端数据库资源</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/24/auth%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/24/auth%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">auth模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-24 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-24T18:20:25+08:00">2019-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="auth模块"><a href="#auth模块" class="headerlink" title="auth模块"></a>auth模块</h1><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auth模块主要是用来做用户相关的功能</span><br><span class="line">	注册 登录 验证 修改密码 注销</span><br><span class="line"></span><br><span class="line">访问admin需要管理员账号</span><br><span class="line">	该账号数据均来源于数据库迁移之后生成的auth_user表</span><br><span class="line">    </span><br><span class="line">如何创建admin管理员账号</span><br><span class="line">	createsuperuser</span><br></pre></td></tr></table></figure>

<h3 id="方法总结"><a href="#方法总结" class="headerlink" title="方法总结"></a>方法总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.比对用户名和密码是否正确</span></span><br><span class="line">    user_obj =auth.authenticate(request,username=username,password=password)</span><br><span class="line">    <span class="comment">#括号内必须同时传入用户名和密码</span></span><br><span class="line">    <span class="built_in">print</span>(user_obj) 				<span class="comment"># 用户对象  jason  数据不符合则返回None</span></span><br><span class="line">    <span class="built_in">print</span> (user_obj.username) 		<span class="comment"># jason</span></span><br><span class="line">    <span class="built_in">print</span> (user_obj.password) 		<span class="comment"># 密文</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.保存用户状态</span></span><br><span class="line">	auth.login(request,user_obj) <span class="comment"># 类似于request.session[key] = user_obj</span></span><br><span class="line">	<span class="comment"># 只要执行了该方法 你就可以在任何地方通过request.user获取到当前登陆的用户对象</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 3.判断当前用户是否登陆</span></span><br><span class="line">	request.user.is_authenticated()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 4.获取当前登陆用户</span></span><br><span class="line">	request.user</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 5.校验用户是否登陆装饰器</span></span><br><span class="line">	<span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line">	<span class="comment">#局部配置</span></span><br><span class="line"><span class="meta">		@login_required(<span class="params">login_url=<span class="string">&#x27;/1ogin/&#x27;</span></span>)</span></span><br><span class="line">	<span class="comment">#全局配置</span></span><br><span class="line">		LOGIN_URL = <span class="string">&#x27;/login/&#x27;</span></span><br><span class="line">	<span class="number">1.</span>如果局部和全局都有该听谁的?</span><br><span class="line">		局部&gt;全局</span><br><span class="line">	<span class="number">2.</span>局部和全局哪个好呢?</span><br><span class="line">		全局的好处在于无需重复写代码但是跳转的页面却很单一</span><br><span class="line">		局部的好处在于不同的视图函数在用户没有登陆的情况下可以跳转到不同的页面</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 6.比对原密码</span></span><br><span class="line">request.user.checkpassword(old_password)|</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.修改密码</span></span><br><span class="line">	request.user.set_password(new_password) 	<span class="comment"># 仅仅是在修改对象的属性</span></span><br><span class="line">	request.user.save() 						<span class="comment"># 这一步才是真正的操作数据库</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 8.注销</span></span><br><span class="line">	auth.logout(request)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 9.注册</span></span><br><span class="line">	<span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">	<span class="comment">#操作auth_user表写入数据 </span></span><br><span class="line">		User.objects.create(username=username,password=password) <span class="comment"># 写入数据 不能用create 密码没有加密处理</span></span><br><span class="line">	<span class="comment">#创建普通用户</span></span><br><span class="line">	User.objects.create_user(username=username,password=password)</span><br><span class="line">	<span class="comment">#创建超级用户(了解):使用代码创建超级用户邮箱是必填的 而用命令创建则可以不填</span></span><br><span class="line">    User.objects.create_superuser(username=username,email=<span class="string">&#x27;123@qq.com&#x27;</span>,password=password)</span><br></pre></td></tr></table></figure>

<h3 id="如何扩展auth-user表"><a href="#如何扩展auth-user表" class="headerlink" title="如何扩展auth_user表"></a>如何扩展auth_user表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.dbimport models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User,Abstractuser</span><br><span class="line"><span class="comment"># Create your modelshere.</span></span><br><span class="line"><span class="comment"># 第一种: 一对一关系 不推荐</span></span><br><span class="line"><span class="comment"># classUserDetail(models.Model):</span></span><br><span class="line">    <span class="comment">#phone = models.BigIntegerField( )</span></span><br><span class="line">    <span class="comment">#user = models.OneTooneField(to=&#x27;User&#x27;)</span></span><br><span class="line"><span class="comment">#第二种:面向对象的继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> (<span class="params"> AbstractUser</span>):</span> </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    如果继承了AbstractUser</span></span><br><span class="line"><span class="string">    那么在执行数据库迁移命令的时候auth_ _user表就不会再创建出来了</span></span><br><span class="line"><span class="string">    而UserInfo表中会出现auth_ user所有的字段外加自己扩展的字段</span></span><br><span class="line"><span class="string">    这么做的好处在于你能够直接点击你自己的表更加快速的完成操作及扩展</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">	前提:</span></span><br><span class="line"><span class="string">        1.在继承之前没有执行过数据库迁移命令</span></span><br><span class="line"><span class="string">        	auth_user没有被创建,如果当前库已经创建了那么你就重新换一个库</span></span><br><span class="line"><span class="string">        2.继承的类里面不要覆盖AbstractUser里面的字段名</span></span><br><span class="line"><span class="string">        	表里面有的字段都不要动,只扩展额外字段即可</span></span><br><span class="line"><span class="string">        3.需要在配置文件中告诉django你要用userInfo替代auth_user</span></span><br><span class="line"><span class="string">        	AUTH_USER_MODEL = &#x27;app01.UserInfo&#x27;</span></span><br><span class="line"><span class="string">            					&#x27;应用名.表名&#x27;</span></span><br><span class="line"><span class="string">     &#x27;&#x27;&#x27;</span></span><br><span class="line">        phone = models. BigIntegerField()</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">你如果自己写表替代了auth_user</span></span><br><span class="line"><span class="string">那么auth模块的功能还是正常使用 参考的表由原来的auth_user变成了你自己写的表</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="settings源码"><a href="#settings源码" class="headerlink" title="settings源码"></a>settings源码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">django有两个配置文件</span><br><span class="line">	一个是暴露给用户自定义的配置</span><br><span class="line">    一个是项目默认的配置</span><br><span class="line">用户没有配置的情况下使用的是项目默认的配置</span><br><span class="line">用户配置了的情况下则使用用户配置的</span><br><span class="line"></span><br><span class="line">如何实现</span><br><span class="line">	先读取项目默认配置</span><br><span class="line">    再读取自定义配置</span><br><span class="line">    <span class="comment"># 字典的键存在则替换 不存在则创建</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazySettings</span>(<span class="params">...</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_setup</span>(<span class="params">self, name=<span class="literal">None</span></span>):</span></span><br><span class="line">        settings_module = os.environ.get(ENVIRONMENT_VARIABLE)  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">		self._wrapped = Settings(settings_module)  <span class="comment"># Settings(&#x27;day53.settings&#x27;)</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Settings</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, settings_module</span>):</span>  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> setting <span class="keyword">in</span> <span class="built_in">dir</span>(global_settings):  <span class="comment"># 获取全局配置文件可以点的变量名</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper():  <span class="comment"># 校验配置必须全大写</span></span><br><span class="line">                <span class="built_in">setattr</span>(self, setting, <span class="built_in">getattr</span>(global_settings, setting))</span><br><span class="line">                <span class="comment"># setting指代的是所有全大写的变量名</span></span><br><span class="line">                <span class="comment"># getattr(global_settings, setting)获取全大写变量名对应的值</span></span><br><span class="line">                <span class="comment"># 给对象设置属性 可以简单的理解为 给字典添加键值对</span></span><br><span class="line">        self.SETTINGS_MODULE = settings_module  <span class="comment"># &#x27;day53.settings&#x27;</span></span><br><span class="line">        mod = importlib.import_module(self.SETTINGS_MODULE)</span><br><span class="line">settings = LazySettings(...)</span><br><span class="line">	   <span class="keyword">for</span> setting <span class="keyword">in</span> <span class="built_in">dir</span>(mod):  <span class="comment"># 获取</span></span><br><span class="line">            <span class="keyword">if</span> setting.isupper():</span><br><span class="line">                setting_value = <span class="built_in">getattr</span>(mod, setting)</span><br><span class="line">                <span class="built_in">setattr</span>(self, setting, setting_value)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/20/Django%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/20/Django%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="post-title-link" itemprop="url">Django中间件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-20 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-20T18:20:25+08:00">2019-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Django中间件"><a href="#Django中间件" class="headerlink" title="Django中间件"></a>Django中间件</h1><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">什么是中间件?</span><br><span class="line">	中间件就是程序中可织入的，可重用的，与业务逻辑无关的各种组件</span><br><span class="line">    中间件处于操作系统软件与用户的应用软件的中间</span><br><span class="line">	中间件在操作系统、网络和数据库之上,应用软件的下层,总的作用是为处于自己上层的应用软件提供运行与开发的环境，帮助用户灵活、高效地开发和集成复杂的应用软件。</span><br><span class="line">    </span><br><span class="line">django中间件</span><br><span class="line">	类似于django的保安 请求来的时候和响应走的时都必须经过他</span><br><span class="line">    </span><br><span class="line"><span class="comment"># django默认有七个中间件</span></span><br><span class="line">	每个中间件你可以简单的理解为具有不同的功能</span><br></pre></td></tr></table></figure>

<h3 id="1-自定义中间件"><a href="#1-自定义中间件" class="headerlink" title="1.自定义中间件"></a>1.自定义中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义中间件</span></span><br><span class="line">    <span class="number">1.</span>在应用或项目文件夹下创建任意一个文件夹</span><br><span class="line">    <span class="number">2.</span>在该文件夹内创建任意一个py文件</span><br><span class="line">    <span class="number">3.</span>在py文件内书写自己的类,该类要继承所有中间件都继承的 MiddlewareMixin </span><br><span class="line">    (<span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin)</span><br><span class="line">    <span class="number">4.</span>需要在配置文件中书写类的完整路径</span><br><span class="line">    	MIDDLEWARE = [</span><br><span class="line">                <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;自己定义的中间件路径1&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;自己定义的中间件路径2&#x27;</span>,</span><br><span class="line">            	...</span><br><span class="line">					]</span><br><span class="line">ps:</span><br><span class="line">    django中间件可以用于编写全局相关的功能</span><br><span class="line">    	eg:全局身份校验  全局防爬校验 </span><br></pre></td></tr></table></figure>

<h3 id="2-process-request与process-response-掌握"><a href="#2-process-request与process-response-掌握" class="headerlink" title="2.process_request与process_response(掌握)"></a>2.process_request与process_response(掌握)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>process_request(self,request)</span><br><span class="line">	<span class="number">1.</span>请求来的时候按照配置文件中注册的中间件从上往下依次走每个中间件里的process_request方法,没有定义直接跳过</span><br><span class="line">	<span class="number">2.</span>该方法也可以返回HttpResponse对象,一旦返回了则请求不再继续往下走,直接原路返回(可借助此方法实现很多限制校验功能)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>process_response(self,request,response)</span><br><span class="line">	<span class="number">1.</span>响应走的时候会依次按照配置文件中注册的中间件从下往上依次经过每个中间件里的process_response方法,没有定义直接跳过	</span><br><span class="line">	<span class="number">2.</span>形参response就是返回给前端浏览器的内容,该方法要么将response返回要么自己返回一个HttpResponse对象</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	1.只要是形参中带有response的方法 那么该方法就必须返回一个response对象或HttpResponse对象</span></span><br><span class="line"><span class="string">    2.当process_request返回HttpResponse对象之后,会直接走同级别process_response往上,而不会将所有的process_response都走一遍</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">	在Flask框架也有类似的中间件 但flask的特点是只要返回响应就必须将所有类似于process_response功能方法全部走一遍</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-中间件了解"><a href="#3-中间件了解" class="headerlink" title="3.中间件了解"></a>3.中间件了解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>process_view(self,view_name,*args,**kwargs)</span><br><span class="line">	路由匹配成功之后执行视图函数之前自动触发</span><br><span class="line">	</span><br><span class="line"><span class="number">2.</span>process_exception(self,request,exception)</span><br><span class="line">	当视图函数报错之后自动执行</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>process_template_response(self,request,response)</span><br><span class="line">	返回的HttpResponse对象必须含有render属性(或表明该对象是一个TemplateResponse对象或等价方法)</span><br></pre></td></tr></table></figure>

<h3 id="4-csrf跨站请求伪造"><a href="#4-csrf跨站请求伪造" class="headerlink" title="4.csrf跨站请求伪造"></a>4.csrf跨站请求伪造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">钓鱼网站</span><br><span class="line"></span><br><span class="line">理论:</span><br><span class="line">    做一个与正规网站一模一样的界面 用户在上面操作</span><br><span class="line">    比如转账</span><br><span class="line">    转账请求确实是发送给了正规的网站后台只不过收款人变了</span><br><span class="line">    变成了钓鱼网站指定的账户</span><br><span class="line">原理:</span><br><span class="line">    获取用户输入的表单内容</span><br><span class="line">    给用户展示了一个没有name属性的框</span><br><span class="line">    自己偷偷的写了一个既有name又有value的隐藏框</span><br></pre></td></tr></table></figure>

<h3 id="5-如何做到csrf符合校验"><a href="#5-如何做到csrf符合校验" class="headerlink" title="5.如何做到csrf符合校验"></a>5.如何做到csrf符合校验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms表单</span></span><br><span class="line">	表单中直接书写下列的语句即可:</span><br><span class="line">		&#123;% csrf_token %&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># ajax</span></span><br><span class="line">	方式<span class="number">1</span>:借助于&#123;% csrf_token %&#125;生成的标签(不推荐)</span><br><span class="line">		data:&#123;<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:$(<span class="string">&quot;[name=csrfmiddlewaretoken]&quot;</span>).val()&#125;</span><br><span class="line">    </span><br><span class="line">    方式<span class="number">2</span>:借助于模板语法直接获取</span><br><span class="line">    	data:&#123;<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:<span class="string">&#x27;&#123;&#123; csrf_token &#125;&#125;&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    方式<span class="number">3</span>:将官方提供的代码写入js文件后引入即可</span><br></pre></td></tr></table></figure>

<h4 id="官方提供代码"><a href="#官方提供代码" class="headerlink" title="官方提供代码"></a>官方提供代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function getCookie(name) &#123;</span><br><span class="line">    var cookieValue = null;</span><br><span class="line">    <span class="keyword">if</span> (document.cookie &amp;&amp; document.cookie !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        var cookies = document.cookie.split(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (var i = <span class="number">0</span>; i &lt; cookies.length; i++) &#123;</span><br><span class="line">            var cookie = jQuery.trim(cookies[i]);</span><br><span class="line">            // Does this cookie string begin <span class="keyword">with</span> the name we want?</span><br><span class="line">            <span class="keyword">if</span> (cookie.substring(<span class="number">0</span>, name.length + <span class="number">1</span>) === (name + <span class="string">&#x27;=&#x27;</span>)) &#123;</span><br><span class="line">                cookieValue = decodeURIComponent(cookie.substring(name.length + <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cookieValue;</span><br><span class="line">&#125;</span><br><span class="line">var csrftoken = getCookie(<span class="string">&#x27;csrftoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">function csrfSafeMethod(method) &#123;</span><br><span class="line">  // these HTTP methods do <span class="keyword">not</span> require CSRF protection</span><br><span class="line">  <span class="keyword">return</span> (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">  beforeSend: function (xhr, settings) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!csrfSafeMethod(settings.<span class="built_in">type</span>) &amp;&amp; !this.crossDomain) &#123;</span><br><span class="line">      xhr.setRequestHeader(<span class="string">&quot;X-CSRFToken&quot;</span>, csrftoken);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="6-csrf相关装饰器"><a href="#6-csrf相关装饰器" class="headerlink" title="6.csrf相关装饰器"></a>6.csrf相关装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from django.views.decorators.csrf import csrf_exempt, csrf_protect</span></span><br><span class="line"><span class="string">form django.utils.decorators import method_decorator </span></span><br><span class="line"><span class="string">	csrf_protect  局部校验csrf</span></span><br><span class="line"><span class="string">		针对 csrf_protect 符合CBV装饰器三种方法</span></span><br><span class="line"><span class="string">	csrf_exempt   局部不校验csrf</span></span><br><span class="line"><span class="string">		针对 csrf_exempt 只能给dispatch方法加才生效</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @csrf_protect</span></span><br><span class="line"><span class="comment"># @csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        money = request.POST.get(<span class="string">&#x27;money&#x27;</span>)</span><br><span class="line">        target_user = request.POST.get(<span class="string">&#x27;target_user&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s 给 %s 转了 %s 元钱&#x27;</span>%(username,target_user,money))</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># @method_decorator(csrf_protect,name=&#x27;post&#x27;)  		# 针对csrf_protect 第二种方法可以</span></span><br><span class="line"><span class="comment"># @method_decorator(csrf_exempt,name=&#x27;post&#x27;)  		# 针对csrf_exempt 第二种方法不可以</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogin</span>(<span class="params">views.View</span>):</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  				# 针对csrf_protect 第三种方法可以</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_exempt)  				# 针对csrf_exempt 第三种方法可以</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().dispatch(request,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from get&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_protect)  				# 针对csrf_protect 第一种方法可以</span></span><br><span class="line">    <span class="comment"># @method_decorator(csrf_exempt)  				# 针对csrf_exempt 第一种方法不可以</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self,request</span>):</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;from post&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">总结:</span></span><br><span class="line"><span class="string">    两者在FBV上使用方式一样 同普通装饰器玩法</span></span><br><span class="line"><span class="string">	而在CBV上两者却有区别:</span></span><br><span class="line"><span class="string">    	csrf_protect 三种方法都可以使用</span></span><br><span class="line"><span class="string">    	csrf_exempt 只能作用于第三种dispatch方法</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> </span><br></pre></td></tr></table></figure>

<h4 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a>补充知识点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模块:importlib</span></span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">res = <span class="string">&#x27;myfile.b&#x27;</span></span><br><span class="line">ret = importlib.import_module(res)  <span class="comment"># from myfile import b</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    该方法最小只能到py文件名</span><br></pre></td></tr></table></figure>

<h3 id="7-重要思想"><a href="#7-重要思想" class="headerlink" title="7.重要思想"></a>7.重要思想</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __init__</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_all</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">for</span> info <span class="keyword">in</span> settings.INFO_DIRS:  <span class="comment"># &#x27;myfile.email.Email&#x27;</span></span><br><span class="line">        flag, msg = info.rsplit(<span class="string">&#x27;.&#x27;</span>, maxsplit=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># flag = &#x27;myfile.email&#x27;   msg = &#x27;Email&#x27;</span></span><br><span class="line">        <span class="comment"># 1.利用字符串导入模块</span></span><br><span class="line">        res = importlib.import_module(flag)  <span class="comment"># from myfile import email</span></span><br><span class="line">        <span class="comment"># 2.利用反射获取类名</span></span><br><span class="line">        cls = <span class="built_in">getattr</span>(res, msg)  <span class="comment"># Email QQ Wechat</span></span><br><span class="line">        <span class="comment"># 3.生成类的对象</span></span><br><span class="line">        obj = cls()</span><br><span class="line">        <span class="comment"># 4.利用鸭子类型直接调用send方法</span></span><br><span class="line">        obj.send(content)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># settings</span></span><br><span class="line">	INFO_DIRS = [</span><br><span class="line">    <span class="string">&#x27;myfile.email.Email&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.qq.QQ&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.wechat.Wechat&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myfile.phone.Phone&#x27;</span>,</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/16/forms%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/16/forms%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">forms组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-16 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-16T18:20:25+08:00">2019-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Django进阶</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="forms组件"><a href="#forms组件" class="headerlink" title="forms组件"></a>forms组件</h1><h3 id="前戏"><a href="#前戏" class="headerlink" title="前戏"></a>前戏</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">前戏</span><br><span class="line">	写一个注册页面获取用户的用户名和密码</span><br><span class="line">    发送到后端之后在后端完成对用户名和密码的数据校验</span><br><span class="line">    	<span class="number">1.</span>用户名里面不能含有JPZ</span><br><span class="line">        <span class="number">2.</span>密码不能为空</span><br><span class="line">    将提示信息渲染到前端页面</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">前端:</span><br><span class="line">    &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    	&lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">        	&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; error_dict.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">    	&lt;/p&gt;</span><br><span class="line">    	&lt;p&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">        	&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; error_dict.password &#125;&#125;&lt;/span&gt;</span><br><span class="line">    	&lt;/p&gt;</span><br><span class="line">    		&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">后端:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">        error_dict = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;JPZ&#x27;</span> <span class="keyword">in</span> username:</span><br><span class="line">                error_dict[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;不符合社会主义核心价值观&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(password) == <span class="number">0</span>:</span><br><span class="line">                error_dict[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;密码不能为空 你个DSB!&#x27;</span></span><br><span class="line">            <span class="comment"># 将提示信息返回给前端页面展示</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;reg.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">1.</span>前端页面标签书写</span><br><span class="line"><span class="number">2.</span>前端页面信息展示</span><br><span class="line"><span class="number">3.</span>后端数据校验</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">forms组件可以一条龙服务 帮你完成上面的三件事情</span><br><span class="line">	<span class="number">1.</span>渲染标签</span><br><span class="line">    <span class="number">2.</span>校验数据</span><br><span class="line">    <span class="number">3.</span>展示信息</span><br></pre></td></tr></table></figure>

<h3 id="forms组件校验数据"><a href="#forms组件校验数据" class="headerlink" title="forms组件校验数据"></a>forms组件校验数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms代码书写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="comment"># username字段最少不能少于3位 最多不能超过8位</span></span><br><span class="line">    username = forms.CharField(max_length=<span class="number">8</span>,min_length=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># password字段最大值不能超过699</span></span><br><span class="line">    password = forms.IntegerField(max_value=<span class="number">699</span>)</span><br><span class="line">    <span class="comment"># email字段必须符合邮箱格式</span></span><br><span class="line">    email = forms.EmailField()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 校验数据</span></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># 1.类加括号 传入字典即可</span></span><br><span class="line">	form_obj = views.MyForm(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;jason&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;嘿嘿嘿&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 2.判断数据是否合法(只有全部合法结果才为True)</span></span><br><span class="line">	form_obj.is_valid()</span><br><span class="line">	<span class="literal">False</span></span><br><span class="line"><span class="comment"># 3.查看所有合法的数据</span></span><br><span class="line">	form_obj.cleaned_data</span><br><span class="line">	&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="number">123</span>&#125;</span><br><span class="line"><span class="comment"># 4.查看所有不合法的数据及原因</span></span><br><span class="line">	form_obj.errors</span><br><span class="line">	&#123;<span class="string">&#x27;email&#x27;</span>: [<span class="string">&#x27;Enter a valid email address.&#x27;</span>]&#125;</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">总结:</span></span><br><span class="line"><span class="string">    1.类加括号传入字典实例化得到对象</span></span><br><span class="line"><span class="string">    2.对象.is_vaild() 		查看传入的数据是否符合条件要求(全部)</span></span><br><span class="line"><span class="string">      对象.cleaned_data 		查看所有合法数据</span></span><br><span class="line"><span class="string">      对象.errors 			查看所有不合法条件</span></span><br><span class="line"><span class="string">    3.校验数据可以多传 但不可少传(默认必传required=True)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件渲染标签"><a href="#forms组件渲染标签" class="headerlink" title="forms组件渲染标签"></a>forms组件渲染标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1.先生成一个对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="comment"># 2.将该对象传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">方式<span class="number">1</span></span><br><span class="line">	简单粗暴 一次性渲染label文本和<span class="built_in">input</span>框</span><br><span class="line">    &#123;&#123; form_obj.as_p &#125;&#125;</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    优点:速度快</span></span><br><span class="line"><span class="string">    缺点:封装程度高 不便于扩展</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">方式<span class="number">2</span></span><br><span class="line">	一步步需要自己书写字段对象</span><br><span class="line">    &#123;&#123; form_obj.username.label &#125;&#125;</span><br><span class="line">    &#123;&#123; form_obj.username &#125;&#125;</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    优点:字段之间相互解耦</span></span><br><span class="line"><span class="string">    缺点:字段多的时候书写麻烦</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">方式<span class="number">3</span></span><br><span class="line">	<span class="keyword">for</span>循环依次获取每个字段对象</span><br><span class="line">	&#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    推荐使用</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># forms组件无法渲染提交按钮和form标签都需要你自己编写</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件展示提示信息"><a href="#forms组件展示提示信息" class="headerlink" title="forms组件展示提示信息"></a>forms组件展示提示信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">	使用forms组件渲染标签之后再获取用户数据的时候</span></span><br><span class="line"><span class="string">	浏览器会自动帮助我们校验数据</span></span><br><span class="line"><span class="string">	但是浏览器层面的数据校验弱不禁风没有实际意义</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何取消浏览器自动校验数据的功能(novalidate)</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> novalidate&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 1.先生成一个对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="comment"># 3.判断请求方式</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 获取用户数据</span></span><br><span class="line">        <span class="comment"># request.POST  # 可以直接看成是一个字典</span></span><br><span class="line">        <span class="comment"># 校验用户数据</span></span><br><span class="line">        <span class="comment"># MyForm()  # forms组件校验数据刚好需要传入一个字典</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;上述两步合一步&#x27;&#x27;&#x27;</span></span><br><span class="line">        form_obj = MyForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form_obj.is_valid():</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;注册成功&#x27;</span>)</span><br><span class="line">    <span class="comment"># 2.将该对象传递给html页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;</span><br><span class="line">            &lt;span style=<span class="string">&quot;color:red&quot;</span>&gt;&#123;&#123; form.errors<span class="number">.0</span> &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="forms组件常用参数"><a href="#forms组件常用参数" class="headerlink" title="forms组件常用参数"></a>forms组件常用参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">max_length			<span class="comment"># 最大范围</span></span><br><span class="line">min_length			<span class="comment"># 最小范围</span></span><br><span class="line">label 				<span class="comment"># 字段名</span></span><br><span class="line">error_messages		<span class="comment"># 自定义报错信息</span></span><br><span class="line">initial				<span class="comment"># 默认值 类似于placeholder</span></span><br><span class="line">required			<span class="comment"># 控制字段是否必填 默认是True</span></span><br><span class="line">invalid				<span class="comment"># 不符合格式提示(邮箱格式校验)</span></span><br><span class="line">validators			<span class="comment"># 额外的校验功能(正则)</span></span><br><span class="line">novalidate			<span class="comment"># 设置浏览器不提示信息</span></span><br><span class="line">widget				<span class="comment"># 定义字段类型和属性(标签加样式)</span></span><br><span class="line">	eg:</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;form-control 类名1 类名2&#x27;</span>&#125;)  </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># 正则校验(validators)</span></span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span>(<span class="params">Form</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 手机号正则校验</span></span><br><span class="line">    phone = forms.CharField(label=<span class="string">&#x27;手机号&#x27;</span>,error_messages=&#123;<span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;手机号不能为空&#x27;</span>,&#125;,</span><br><span class="line">        validators=[</span><br><span class="line">           RegexValidator(<span class="string">r&#x27;^[0-9]+$&#x27;</span>, <span class="string">&#x27;请输入数字&#x27;</span>),</span><br><span class="line">           RegexValidator(<span class="string">r&#x27;^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d&#123;8&#125;$&#x27;</span>,<span class="string">&#x27;手机号格式不正确&#x27;</span>)</span><br><span class="line">        ],</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">       )</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 身份证正则校验</span></span><br><span class="line">    userinfo = forms.CharField(label=<span class="string">&#x27;身份证&#x27;</span>,error_messages=&#123;<span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;身份证不能为空&#x27;</span>,&#125;,</span><br><span class="line">        validators=[</span><br><span class="line">          RegexValidator(<span class="string">r&#x27;^[0-9]+$&#x27;</span>, <span class="string">&#x27;请输入数字&#x27;</span>),</span><br><span class="line">          RegexValidator(<span class="string">r&#x27;^(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)&#x27;</span>, <span class="string">&#x27;身份证格式不正确&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">        widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">    ) </span><br></pre></td></tr></table></figure>

<h4 id="其他参数及字段"><a href="#其他参数及字段" class="headerlink" title="其他参数及字段"></a>其他参数及字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">radioSelect</span><br><span class="line">单radio值为字符串</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    username = forms.CharField(min_length=<span class="number">8</span>,label=<span class="string">&quot;用户名&quot;</span>,initial=<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">                                error_messages=&#123;</span><br><span class="line">                                    <span class="string">&quot;required&quot;</span>: <span class="string">&quot;不能为空&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;invalid&quot;</span>: <span class="string">&quot;格式错误&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;min_length&quot;</span>: <span class="string">&quot;用户名最短8位&quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">    						  )</span><br><span class="line">   </span><br><span class="line">    gender = forms.ChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;男&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;女&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;保密&quot;</span>)),</span><br><span class="line">        label=<span class="string">&quot;性别&quot;</span>,</span><br><span class="line">        initial=<span class="number">3</span>,</span><br><span class="line">        widget=forms.widgets.RadioSelect()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单选Select</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.ChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>), ),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=<span class="number">3</span>,</span><br><span class="line">        widget=forms.widgets.Select()</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">多选Select</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.MultipleChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>), ),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">        widget=forms.widgets.SelectMultiple()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单选checkbox</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    keep = forms.ChoiceField(</span><br><span class="line">        label=<span class="string">&quot;是否记住密码&quot;</span>,</span><br><span class="line">        initial=<span class="string">&quot;checked&quot;</span>,</span><br><span class="line">        widget=forms.widgets.CheckboxInput()</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">多选checkbox</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    hobby = forms.MultipleChoiceField(</span><br><span class="line">        choices=((<span class="number">1</span>, <span class="string">&quot;篮球&quot;</span>), (<span class="number">2</span>, <span class="string">&quot;足球&quot;</span>), (<span class="number">3</span>, <span class="string">&quot;双色球&quot;</span>),),</span><br><span class="line">        label=<span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        initial=[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">        widget=forms.widgets.CheckboxSelectMultiple()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h3 id="forms组件钩子函数"><a href="#forms组件钩子函数" class="headerlink" title="forms组件钩子函数"></a>forms组件钩子函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">在forms组件中有两种钩子:</span></span><br><span class="line"><span class="string">	1.局部钩子</span></span><br><span class="line"><span class="string">		当你需要给单个字段增加校验规则的时候可以使用</span></span><br><span class="line"><span class="string">	2.全局钩子</span></span><br><span class="line"><span class="string">		当你需要给多个字段增加校验规则的时候可以使用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="局部钩子"><a href="#局部钩子" class="headerlink" title="局部钩子"></a>局部钩子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">提供更加复杂的与业务相关的校验功能</span><br><span class="line">钩子函数其实就是在书写forms类的过程中定义方法</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;钩子函数都是在数据校验的最后一个环节执行&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">局部钩子(单个字段校验使用)</span><br><span class="line">	<span class="comment"># 校验当前用户名是否已存在</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户名</span></span><br><span class="line">        username = self.cleaned_data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="comment"># 查询数据库并判断</span></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;jason&#x27;</span>:</span><br><span class="line">            <span class="comment"># 提示用户名已存在</span></span><br><span class="line">            self.add_error(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;用户名已存在&#x27;</span>)</span><br><span class="line">        <span class="comment"># 将钩子函数勾出来的数据再放回去</span></span><br><span class="line">        <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>

<h4 id="全局钩子"><a href="#全局钩子" class="headerlink" title="全局钩子"></a>全局钩子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">全局钩子(多个字段校验使用)</span><br><span class="line">	<span class="comment"># 校验密码与确认密码是否一致</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 获取密码与确认密码</span></span><br><span class="line">        password = self.cleaned_data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        confirm_password = self.cleaned_data.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">        <span class="comment"># 判断两次输入的密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> password == confirm_password:</span><br><span class="line">            self.add_error(<span class="string">&#x27;confirm_password&#x27;</span>,<span class="string">&#x27;两次密码不一致&#x27;</span>)</span><br><span class="line">        <span class="comment"># 将钩子函数勾出来的数据再放回去</span></span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/12/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/12/%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E5%8D%81%E4%B8%89%E6%9D%A1/" class="post-title-link" itemprop="url">模型层之必知必会十三条</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-12 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-12T18:20:25+08:00">2019-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="必知必会十三条"><a href="#必知必会十三条" class="headerlink" title="必知必会十三条"></a>必知必会十三条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">all</span>()		 			查询所有数据</span><br><span class="line"><span class="number">2.</span><span class="built_in">filter</span>()				带有过滤条件的查询</span><br><span class="line"><span class="number">3.</span>get()					直接拿数据对象 但是条件不存在直接报错</span><br><span class="line"><span class="number">4.</span>first()				拿queryset里面的第一个数据</span><br><span class="line"><span class="number">5.</span>last()				拿quertset里面的最后一个数据</span><br><span class="line"><span class="number">6.</span>values()				可以指定获取数据的字段  select name,age <span class="keyword">from</span>... 列表套字典</span><br><span class="line"><span class="number">7.</span>values_list()			列表套元组</span><br><span class="line"><span class="number">8.</span>distinct()			去重 去重一定要是一模一样的数据(主键千万要注意)</span><br><span class="line"><span class="number">9.</span>order_by()			排序 </span><br><span class="line">	res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  默认是升序  </span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)   加负号降序</span><br><span class="line"><span class="number">10.</span>reverse() 			反转 前提是数据已经排序过</span><br><span class="line"><span class="number">11.</span>count() 				统计当前数据的个数</span><br><span class="line"><span class="number">12.</span>exclude()			排除在外</span><br><span class="line">	查询<span class="built_in">id</span>不为<span class="number">3</span>的所有图书</span><br><span class="line">		books = BookInfo.objects.exclude(<span class="built_in">id</span> = <span class="number">3</span>)  <span class="comment"># 与filter函数作用相反。 返回QuerySet查询集(可以遍历)</span></span><br><span class="line"><span class="number">13.</span>exists()				返回布尔值 数据本身就自带布尔值 基本用不到</span><br></pre></td></tr></table></figure>

<h3 id="filter函数-条件查询"><a href="#filter函数-条件查询" class="headerlink" title="filter函数(条件查询)"></a>filter函数(条件查询)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">filter</span>函数 (条件查询)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__gt 大于</span></span><br><span class="line"><span class="string">__gte 大于等于 </span></span><br><span class="line"><span class="string">__lt 小于</span></span><br><span class="line"><span class="string">__lte 小于等于</span></span><br><span class="line"><span class="string">__in 范围查询</span></span><br><span class="line"><span class="string">__date日期查询</span></span><br><span class="line"><span class="string">__isnull 是否为空 True表示为null False表示not null</span></span><br><span class="line"><span class="string">__contains 包含 模糊查询 默认区分大小写</span></span><br><span class="line"><span class="string">__icontains 不区分大小写</span></span><br><span class="line"><span class="string">__endswith以..结尾 __startswith以..开头(__iendswith 不区分大小写)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># filter条件查询(可以通过逗号,连接多个条件)  返回QuerySet查询集(可以遍历)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__exact = <span class="string">&#x27;天龙八部&#x27;</span>)  <span class="comment"># __exact 等于。 __exact 可以省略。 (__iexact 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__contains = <span class="string">&#x27;天&#x27;</span>)  <span class="comment"># __contains 包含。模糊查询。 (__icontains 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__endswith = <span class="string">&#x27;部&#x27;</span>)  <span class="comment"># __endswith 以..结尾。 __startswith 以..开头。 (__iendswith 不区分大小写)</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(title__isnull = <span class="literal">False</span>)  <span class="comment"># __isnull 是否为空。 True：表示为null。 False表示not null。</span></span><br><span class="line"></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(id__in = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>])  <span class="comment"># __in 范围查询。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(id__gt = <span class="number">3</span>)  <span class="comment"># __gt 大于。 __lt 小于。 __gte 大于等于。 __lte 小于等于。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(pub_date__gt = date(<span class="number">1980</span>,<span class="number">1</span>,<span class="number">1</span>))  <span class="comment"># 日期查询。</span></span><br><span class="line">books = BookInfo.objects.<span class="built_in">filter</span>(pub_date__year = <span class="number">1980</span>)   <span class="comment"># 日期查询。(year、month、day、week_day、hour、minute、second)</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/10/%E6%A8%A1%E5%9E%8B%E5%B1%82/" class="post-title-link" itemprop="url">Django之模型层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-10 18:20:25" itemprop="dateCreated datePublished" datetime="2019-04-10T18:20:25+08:00">2019-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模型层"><a href="#模型层" class="headerlink" title="模型层"></a>模型层</h1><h3 id="1-数据库正反向迁移"><a href="#1-数据库正反向迁移" class="headerlink" title="1.数据库正反向迁移"></a>1.数据库正反向迁移</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">正向迁移(将django中的类导入到MySQL中变成表)</span><br><span class="line">	python manage.py makemigrations</span><br><span class="line">    python manage.py migrate</span><br><span class="line">反向迁移</span><br><span class="line">	inspectdb</span><br><span class="line">    应用场景:</span><br><span class="line">        展示数据库中表时或要更换数据库磁盘</span><br></pre></td></tr></table></figure>

<h3 id="2-Django测试环境"><a href="#2-Django测试环境" class="headerlink" title="2.Django测试环境"></a>2.Django测试环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">django默认情况下是不允许单独使用某个功能部分(models.py)</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>要么自己新建一个py文件</span><br><span class="line"><span class="number">2.</span>要么使用自带的tests文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day47.settings&quot;</span>)</span><br><span class="line">    <span class="comment"># 导入django并配置</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="comment"># 下面就可以书写测试代码了</span></span><br></pre></td></tr></table></figure>

<h3 id="3-必知必会十三条"><a href="#3-必知必会十三条" class="headerlink" title="3.必知必会十三条"></a>3.必知必会十三条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">all</span>()		 			<span class="comment"># 查询所有数据</span></span><br><span class="line"><span class="number">2.</span><span class="built_in">filter</span>()				<span class="comment"># 带有过滤条件的查询</span></span><br><span class="line"><span class="number">3.</span>get()					<span class="comment"># 直接拿数据对象 但是条件不存在直接报错</span></span><br><span class="line"><span class="number">4.</span>first()				<span class="comment"># 拿queryset里面的第一个数据</span></span><br><span class="line"><span class="number">5.</span>last()				<span class="comment"># 拿quertset里面的最后一个数据</span></span><br><span class="line"><span class="number">6.</span>values()				<span class="comment"># 指定获取数据的字段 select name,age from... 列表套字典</span></span><br><span class="line"><span class="number">7.</span>values_list()			<span class="comment"># 指定获取数据的字段 列表套元组</span></span><br><span class="line"><span class="number">8.</span>distinct()			<span class="comment"># 去重 去重一定要是一模一样的数据(主键千万要注意)</span></span><br><span class="line"><span class="number">9.</span>order_by()			<span class="comment"># 排序 默认升序</span></span><br><span class="line">	res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  	<span class="comment"># 默认是升序  </span></span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)   <span class="comment"># 加负号降序</span></span><br><span class="line"><span class="number">10.</span>reverse() 			<span class="comment"># 反转 前提是数据已经排序过</span></span><br><span class="line"><span class="number">11.</span>count() 				<span class="comment"># 计数 统计当前数据的个数</span></span><br><span class="line"><span class="number">12.</span>exclude()			<span class="comment"># 取反 将括号内排除在外</span></span><br><span class="line">	查询<span class="built_in">id</span>不为<span class="number">3</span>的所有图书</span><br><span class="line">		books = models.BookInfo.objects.exclude(<span class="built_in">id</span> = <span class="number">3</span>)  <span class="comment"># 与filter函数作用相反 </span></span><br><span class="line"><span class="number">13.</span>exists()				<span class="comment"># 返回布尔值 数据本身就自带布尔值 基本用不到</span></span><br></pre></td></tr></table></figure>

<h3 id="4-双下划线查询"><a href="#4-双下划线查询" class="headerlink" title="4.双下划线查询"></a>4.双下划线查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">__gt 				大于</span></span><br><span class="line"><span class="string">__gte 				大于等于 </span></span><br><span class="line"><span class="string">__lt 				小于</span></span><br><span class="line"><span class="string">__lte 				小于等于</span></span><br><span class="line"><span class="string">__in 				范围查询</span></span><br><span class="line"><span class="string">__date				日期查询</span></span><br><span class="line"><span class="string">__isnull 			是否为空 True表示为null False表示not null</span></span><br><span class="line"><span class="string">__contains 			包含 模糊查询 默认区分大小写</span></span><br><span class="line"><span class="string">__icontains 		包含 模糊查询 不区分大小写</span></span><br><span class="line"><span class="string">__endswith			以..结尾 (__iendswith 不区分大小写)</span></span><br><span class="line"><span class="string">__startswith		以..开头 (__istartswith 不区分大小写)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询价格大于200的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Books.objects.filter(price__gt=200)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Books.objects.filter(price__lt=200)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># res2 = models.Books.objects.filter(price__gte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res2)</span></span><br><span class="line">    <span class="comment"># res3 = models.Books.objects.filter(price__lte=456.23)</span></span><br><span class="line">    <span class="comment"># print(res3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 成员运算</span></span><br><span class="line">    <span class="comment"># res4 = models.Books.objects.filter(price__in=(456.23,111))</span></span><br><span class="line">    <span class="comment"># print(res4)</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 范围查询</span></span><br><span class="line">    <span class="comment"># res5 = models.Books.objects.filter(price__range=(100,456.23))</span></span><br><span class="line">    <span class="comment"># print(res5)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模糊查询</span></span><br><span class="line">    <span class="comment"># 查询书籍名称中含有字母a的书</span></span><br><span class="line">    <span class="comment"># res6 = models.Books.objects.filter(title__contains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res6)  # 区分大小写</span></span><br><span class="line">    <span class="comment"># res7 = models.Books.objects.filter(title__icontains=&#x27;a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res7)  # 忽略大小写</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日期相关</span></span><br><span class="line">    <span class="comment"># 查看出版月份是五月的书</span></span><br><span class="line">    <span class="comment"># res8 = models.Books.objects.filter(publish_time__month=5)</span></span><br><span class="line">    <span class="comment"># print(res8)</span></span><br><span class="line">    <span class="comment"># print(res8.query)</span></span><br><span class="line">    <span class="comment"># res9 = models.Books.objects.filter(publish_time__year=2021)</span></span><br><span class="line">    <span class="comment"># print(res9)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-正反向概念"><a href="#5-正反向概念" class="headerlink" title="5.正反向概念"></a>5.正反向概念</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向</span></span><br><span class="line">	外键字段在我这里,我查你就是正向</span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">	外键字段不在我这里,我查你就是反向</span><br><span class="line">    </span><br><span class="line">    book ---&gt; 外键字段在书那儿(正向) ---&gt;publish</span><br><span class="line">    publish ---&gt; 外键字段在书那儿(反向) ---&gt;book</span><br></pre></td></tr></table></figure>

<h3 id="6-正反向跨表查询"><a href="#6-正反向跨表查询" class="headerlink" title="6.正反向跨表查询"></a>6.正反向跨表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">正向查询按字段</span></span><br><span class="line"><span class="string">反向查询按表名小写</span></span><br><span class="line"><span class="string">		_set</span></span><br><span class="line"><span class="string">		...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">基于对象</span></span><br><span class="line"><span class="string">	正向查询:</span></span><br><span class="line"><span class="string">		当查询结果有多个的时候 必须要加.all()</span></span><br><span class="line"><span class="string">		当查询结果只有一个的时候 直接拿到数据对象不需要加.all()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	反向查询:</span></span><br><span class="line"><span class="string">        当查询结果有多个的时候 必须要加_set.all()</span></span><br><span class="line"><span class="string">        当查询结果只有一个的时候 直接拿到数据对象不需要加_set.all()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-一对多表关系外键字段的增删改"><a href="#7-一对多表关系外键字段的增删改" class="headerlink" title="7.一对多表关系外键字段的增删改"></a>7.一对多表关系外键字段的增删改</h3><h4 id="1-外键字段的增"><a href="#1-外键字段的增" class="headerlink" title="1.外键字段的增"></a>1.外键字段的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;一对多表关系外键默认级联更新级联删除&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(create)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.create(name=<span class="string">&#x27;三国演义&#x27;</span>, price=<span class="string">&#x27;999&#x27;</span>, publish_id=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.create(name=<span class="string">&#x27;孟子&#x27;</span>, price=<span class="string">&#x27;989&#x27;</span>, 	publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h4 id="2-外键字段的删"><a href="#2-外键字段的删" class="headerlink" title="2.外键字段的删"></a>2.外键字段的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(delete)</span></span><br><span class="line">    models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).delete()  <span class="comment"># 级联删除</span></span><br></pre></td></tr></table></figure>

<h4 id="3-外键字段的改"><a href="#3-外键字段的改" class="headerlink" title="3.外键字段的改"></a>3.外键字段的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(update)</span></span><br><span class="line"><span class="comment"># 1.直接写外键字段 id</span></span><br><span class="line">	models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">6</span>).update(publish_id=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.虚拟字段 对象</span></span><br><span class="line">    publish_obj = models.Publish.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">8</span>).update(publish=publish_obj)</span><br></pre></td></tr></table></figure>

<h3 id="8-多对多第三张表数据的增删改"><a href="#8-多对多第三张表数据的增删改" class="headerlink" title="8.多对多第三张表数据的增删改"></a>8.多对多第三张表数据的增删改</h3><h4 id="1-第三张表数据的增"><a href="#1-第三张表数据的增" class="headerlink" title="1.第三张表数据的增"></a>1.第三张表数据的增</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第三张表添加数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    向第三张表中添加数据之前要拿到任一张表的某个对象</span></span><br><span class="line"><span class="string">    再通过正反向概念实现第三张表的数据添加</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增(add(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="built_in">print</span>(book_obj.authors)  <span class="comment"># 相当于拿到第三张表</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(1, 2, 3)  # 书籍主键为1的书籍绑定主键为1,2,3的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.add(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.add(1,2,3)</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    author_obj.book_set.add(book_obj)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">add给第三张表添加数据:</span></span><br><span class="line"><span class="string">	括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">	已存在的数据不可重复添加 </span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据增加)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-第三张表数据的改"><a href="#2-第三张表数据的改" class="headerlink" title="2.第三张表数据的改"></a>2.第三张表数据的改</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改(set(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.set([2,3,4])  # 括号内必须放一个可迭代对象</span></span><br><span class="line">    author_obj1 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj2 = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.<span class="built_in">set</span>([author_obj1, author_obj2])</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># author_obj.book_set.set([1,2])</span></span><br><span class="line">    book_obj1 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    book_obj2 = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">set</span>([book_obj1,book_obj2])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">set修改第三张表中的数据:</span></span><br><span class="line"><span class="string">    括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">    括号内必须放一个可迭代对象</span></span><br><span class="line"><span class="string">    set会将第三张表中已存在数据更新为括号内指定数据</span></span><br><span class="line"><span class="string">    (站在任一张表的角度都可以实现对第三张表的数据)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-第三张表数据的删"><a href="#3-第三张表数据的删" class="headerlink" title="3.第三张表数据的删"></a>3.第三张表数据的删</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删(remove(&#x27;主键id&#x27; or &#x27;对象&#x27;))</span></span><br><span class="line"></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># book_obj.authors.remove(1,2)  # 删除主键为1的书籍所关联的主键为1,2的作者</span></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.remove(author_obj)</span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.remove(<span class="number">1</span>,<span class="number">3</span>)	<span class="comment"># 删除主键为1的作者所关联的主键为1,3的书籍</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj.book_set.remove(book_obj)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">remove删除第三张表中的数据:</span></span><br><span class="line"><span class="string">   括号内不仅可以放作者主键id 还可以放作者对象 支持多个</span></span><br><span class="line"><span class="string">   remove会将第三张表中已存在数据删除</span></span><br><span class="line"><span class="string">   (站在任一张表的角度都可以实现对第三张表的数据删除)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-第三张表数据的查"><a href="#4-第三张表数据的查" class="headerlink" title="4.第三张表数据的查"></a>4.第三张表数据的查</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查</span></span><br><span class="line"></span><br><span class="line">	book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    book_obj.authors.first()  <span class="comment"># 查一个,默认第一个</span></span><br><span class="line">    book_obj.authors.<span class="built_in">all</span>()  <span class="comment"># 查所有</span></span><br><span class="line"></span><br><span class="line">    author_obj = models.Authors.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj.book_set.first()</span><br><span class="line">    author_obj.book_set.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h3 id="9-多表查询"><a href="#9-多表查询" class="headerlink" title="9.多表查询"></a>9.多表查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################基于对象的跨表查询#####################</span></span><br><span class="line">    <span class="comment"># 子查询:将一张表的查询结果当做另外一条SQL语句的条件(括号括起来)</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=4).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.publish</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.title)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># 先查询书籍对象</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Author.None</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # &lt;QuerySet [&lt;Author: 作者对象:oscar&gt;, &lt;Author: 作者对象:egon&gt;]&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者这里 所以是正向查询</span></span><br><span class="line">    <span class="comment"># res = author_obj.author_detail</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line">    <span class="comment"># print(res.phone)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.查询东方出版社出版的书籍</span></span><br><span class="line">    <span class="comment"># 先查询出版社对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(title=&#x27;东方出版社&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里 自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># 先查询jason数据对象</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在书那里自己没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)  # app01.Book.None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># 先查询120数据对象</span></span><br><span class="line">    <span class="comment"># author_detail_obj = models.AuthorDetail.objects.filter(phone=120).first()</span></span><br><span class="line">    <span class="comment"># 外键字段在作者那里本身没有 所以是反向</span></span><br><span class="line">    <span class="comment"># res = author_detail_obj.author</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="comment"># print(res.age)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">########################基于双下滑线的跨表查询</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.查询北方出版社出版的书籍名称</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(title=&#x27;北方&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询jason写过的书籍</span></span><br><span class="line">    <span class="comment"># res =models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;book__title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询电话是120的作者</span></span><br><span class="line">    <span class="comment"># res =models.AuthorDetail.objects.filter(phone=120).values(&#x27;author__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    <span class="comment">############进阶操作#############</span></span><br><span class="line">    <span class="comment"># 1.查询书籍主键为4的出版社名称</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=4).values(&#x27;publish__title&#x27;,&#x27;title&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.filter(book__pk=4)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为3的作者姓名</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__name&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的地址</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__addr)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 反向查询高阶部分</span></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;).values(&#x27;addr&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询书籍主键为3的作者的电话号码</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).values(&#x27;authors__author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.AuthorDetail.objects.filter(author__book__pk=3).values(&#x27;phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Author.objects.filter(book__pk=3).values(&#x27;author_detail__phone&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br></pre></td></tr></table></figure>

<h3 id="10-聚合查询-aggregate"><a href="#10-聚合查询-aggregate" class="headerlink" title="10.聚合查询(aggregate)"></a>10.聚合查询(aggregate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询</span></span><br><span class="line">关键字:</span><br><span class="line">    aggregate()</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;max min sum count avg&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max,Min,Sum,Avg,Count</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 求书的最高价格</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.aggregate(Max(&#x27;price&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.aggregate(Sum(&#x27;price&#x27;),Avg(&#x27;price&#x27;),Count(&#x27;pk&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br></pre></td></tr></table></figure>

<h3 id="11-分组查询-annotate"><a href="#11-分组查询-annotate" class="headerlink" title="11.分组查询(annotate)"></a>11.分组查询(annotate)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组查询</span></span><br><span class="line">关键字:</span><br><span class="line">	annotate()</span><br><span class="line">	annotate前放values那么按其括号内字段分组</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1.统计每一本书的作者个数</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).values(&#x27;title&#x27;, &#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># 2.统计出每个出版社卖的最便宜的书的价格</span></span><br><span class="line">    <span class="comment"># res = models.Publish.objects.annotate(not_expensive=Min(&#x27;book__price&#x27;)).values(&#x27;title&#x27;,&#x27;not_expensive&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.统计不止一个作者的图书</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.annotate(author_num=Count(&#x27;authors__pk&#x27;)).filter(author_num__gt=1).values(&#x27;title&#x27;,&#x27;author_num&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 4.查询各个作者出的书的总价格</span></span><br><span class="line">    <span class="comment"># res = models.Author.objects.annotate(sum_price=Sum(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;sum_price&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;如果你按照表里面某个指定的字段分组&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;publish_time&#x27;).annotate()</span></span><br></pre></td></tr></table></figure>

<h3 id="12-F查询"><a href="#12-F查询" class="headerlink" title="12.F查询"></a>12.F查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">当查询条件的左右两边数据都来自于表中则可以使用F查询</span></span><br><span class="line"><span class="string">F查询还可以统一修改表中的字段数据(数字)</span></span><br><span class="line"><span class="string">	导入语句:</span></span><br><span class="line"><span class="string">        from django.db.models import F,Value</span></span><br><span class="line"><span class="string">        from django.db.models.functions import Concat</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># F查询</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">    <span class="comment"># 1.查询库存数大于卖出数的书籍</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(kucun__gt=F(&#x27;maichu&#x27;))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 2.将所有的书籍价格上涨100块</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.update(price=F(&#x27;price&#x27;) + 100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 3.将所有的书籍名称加上&quot;爆款&quot;后缀</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># models.Book.objects.update(title=F(&#x27;title&#x27;) + &#x27;爆款&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># from django.db.models.functions import Concat</span></span><br><span class="line">    <span class="comment"># from django.db.models import Value</span></span><br><span class="line">    <span class="comment"># ret3 = models.Book.objects.update(title=Concat(F(&#x27;title&#x27;), Value(&#x27;爆款&#x27;)))</span></span><br></pre></td></tr></table></figure>

<h4 id="针对字符串不能直接拼接-需导入模块"><a href="#针对字符串不能直接拼接-需导入模块" class="headerlink" title="针对字符串不能直接拼接 需导入模块"></a>针对字符串不能直接拼接 需导入模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;针对字符串不能直接拼接 需要额外导入模块操作&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Concat</span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Value</span><br><span class="line">    </span><br><span class="line">    ret = models.Book.objects.update(title=Concat(F(<span class="string">&#x27;title&#x27;</span>), Value(<span class="string">&#x27;爆款&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="13-Q查询"><a href="#13-Q查询" class="headerlink" title="13.Q查询"></a>13.Q查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.filter默认只支持and连接查询条件如果需要修改则需要使用Q</span></span><br><span class="line"><span class="string">        from django.db.models import Q</span></span><br><span class="line"><span class="string">        filter(Q(),Q())</span></span><br><span class="line"><span class="string">        filter(Q()|Q())</span></span><br><span class="line"><span class="string">        filter(~Q(),~Q())</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">2.查询条件还可以由变量名模式改为字符串形式</span></span><br><span class="line"><span class="string">        q = Q()</span></span><br><span class="line"><span class="string">        q.connector=&#x27;or&#x27;	# 改变查询参数之间关系 默认是and</span></span><br><span class="line"><span class="string">        q.children.append((&#x27;字段名&#x27;,&#x27;需要查询的数据&#x27;))</span></span><br><span class="line"><span class="string">        filter(q)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.查询书名是三国演义爆款或者库存是100的书籍</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;filter()括号内可以写多个参数 逗号隔开 默认只支持and连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(title=&#x27;三国演义爆款&#x27;,kucun=100)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;),Q(kucun=100))  # and</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100))  # or</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.filter(~Q(title=&#x27;三国演义爆款&#x27;)|Q(kucun=100)) # not</span></span><br><span class="line">    <span class="comment"># print(res1.query)</span></span><br></pre></td></tr></table></figure>

<h4 id="Q查询进阶用法"><a href="#Q查询进阶用法" class="headerlink" title="Q查询进阶用法"></a>Q查询进阶用法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;Q进阶用法&#x27;&#x27;&#x27;</span></span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">   <span class="comment"># condition = input(&#x27;请输入你需要按照什么字段查询数据&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># data = input(&#x27;请输入你需要查询的数据名称&gt;&gt;&gt;:&#x27;)</span></span><br><span class="line">   <span class="comment"># q = Q()  # 生成一个Q对象</span></span><br><span class="line">   <span class="comment"># q.children.append((condition,data))</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.filter(q)</span></span><br><span class="line">   <span class="comment"># print(res)</span></span><br><span class="line">   q = Q()</span><br><span class="line">   q.connector = <span class="string">&#x27;or&#x27;</span>  <span class="comment"># 可以修改连接条件</span></span><br><span class="line">   q.children.append((<span class="string">&#x27;title__contains&#x27;</span>,<span class="string">&#x27;三&#x27;</span>))</span><br><span class="line">   q.children.append((<span class="string">&#x27;price__gt&#x27;</span>,<span class="number">200</span>))  <span class="comment"># 可以添加多个条件 并且也是and关系</span></span><br><span class="line">   res = models.Book.objects.<span class="built_in">filter</span>(q)</span><br><span class="line">   <span class="built_in">print</span>(res)</span><br><span class="line">   <span class="built_in">print</span>(res.query)</span><br></pre></td></tr></table></figure>

<h3 id="14-事务"><a href="#14-事务" class="headerlink" title="14.事务"></a>14.事务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.什么是事务?</span></span><br><span class="line"><span class="string">	事务是数据库操作的最小工作单元,作为逻辑工作单元执行一系列操作,这些操作作为一个整体一起向系统提交,要么都执行,要么都不执行,事务是一组不可分割的操作机集合</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2.事务四大特性 	ACID</span></span><br><span class="line"><span class="string">	1.原子性:</span></span><br><span class="line"><span class="string">		事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做</span></span><br><span class="line"><span class="string">	2.一致性:</span></span><br><span class="line"><span class="string">		事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态</span></span><br><span class="line"><span class="string">	3.独立性:</span></span><br><span class="line"><span class="string">		一个事务的执行不能其它事务干扰</span></span><br><span class="line"><span class="string">	4.持久性:</span></span><br><span class="line"><span class="string">		永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MySQL</span></span><br><span class="line"><span class="string">	start transcation</span></span><br><span class="line"><span class="string">	commit</span></span><br><span class="line"><span class="string">	rollback</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="comment"># 创建一条订单数据</span></span><br><span class="line">            models.Order.objects.create(num=<span class="string">&quot;110110111&quot;</span>, product_id=<span class="number">1</span>, count=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 能执行成功</span></span><br><span class="line">     		models.Product.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(kucun=F(<span class="string">&quot;kucun&quot;</span>) - <span class="number">1</span>, maichu=F(<span class="string">&quot;maichu&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<h4 id="执行原生SQL语句"><a href="#执行原生SQL语句" class="headerlink" title="执行原生SQL语句"></a>执行原生SQL语句</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.raw(<span class="string">&#x27;select * from app01_book&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h4 id="数据库三大范式"><a href="#数据库三大范式" class="headerlink" title="数据库三大范式"></a>数据库三大范式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.第一范式(确保每列保持原子性)</span><br><span class="line">	确保每一个字段都必须是不可拆分的原子值</span><br><span class="line">2.第二范式(确保表中的每列都和主键相关)</span><br><span class="line">	一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中</span><br><span class="line">3.第三范式(确保每列都和主键列直接相关,而不是间接相关)</span><br><span class="line">	每一列数据都和主键直接相关，而不能间接相关</span><br></pre></td></tr></table></figure>

<h3 id="15-模型层字段及参数"><a href="#15-模型层字段及参数" class="headerlink" title="15.模型层字段及参数"></a>15.模型层字段及参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">models.AutoField(primary_key=<span class="literal">True</span>)		<span class="comment"># 主键字段</span></span><br><span class="line">models.CharField(max_length=<span class="number">32</span>)			<span class="comment"># varchar(32)</span></span><br><span class="line">models.IntergeField()					<span class="comment"># 整型</span></span><br><span class="line">models.DateField()						<span class="comment"># 年月日</span></span><br><span class="line">models.DateTimeField()					<span class="comment"># 年月日时分秒</span></span><br><span class="line">	auto_now								<span class="comment"># 记录每次修改时间</span></span><br><span class="line">    auto_now_add							<span class="comment"># 记录第一次修改时间</span></span><br><span class="line">models.DecimalField()					<span class="comment"># 浮点型</span></span><br><span class="line">	max_digits								<span class="comment"># 总位数</span></span><br><span class="line">    decimal_places							<span class="comment"># 小数位</span></span><br><span class="line">models.BooleanField()					<span class="comment"># 布尔值类型</span></span><br><span class="line">	给这个字段传布尔值会自动转换成数字<span class="number">0</span>或<span class="number">1</span></span><br><span class="line">    一般用在状态二选一</span><br><span class="line">TextField()								<span class="comment"># 存储大段文本(bbs项目会使用)</span></span><br><span class="line">EmailField()							<span class="comment"># 存储邮箱格式数据</span></span><br><span class="line">FileField()								<span class="comment"># 存储数据路径(bbs项目会使用)</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义字段"><a href="#自定义字段" class="headerlink" title="自定义字段"></a>自定义字段</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;自定义字段&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCharField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,max_length,*args,**kwargs</span>):</span></span><br><span class="line">        self.max_length = max_length</span><br><span class="line">        <span class="built_in">super</span>().__init__(max_length=max_length,*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_type</span>(<span class="params">self, connection</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;char(%s)&#x27;</span>%self.max_length</span><br></pre></td></tr></table></figure>

<h4 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">max_length			<span class="comment"># 指定长度</span></span><br><span class="line">varbose_name		<span class="comment"># 字段解释</span></span><br><span class="line">default				<span class="comment"># 字段默认值</span></span><br><span class="line">null				<span class="comment"># 字段可以为空</span></span><br><span class="line">auto_now			<span class="comment"># date字段参数 记录每次修改时间</span></span><br><span class="line">auto_now_add		<span class="comment"># date字段参数 记录第一次修改时间</span></span><br><span class="line">to					<span class="comment"># 指定关联哪张表的主键</span></span><br><span class="line">unique				<span class="comment"># 唯一约束</span></span><br><span class="line">db_index			<span class="comment"># 索引</span></span><br><span class="line">choices				<span class="comment"># 存对应关系(一般元组套元组)</span></span><br></pre></td></tr></table></figure>

<h3 id="16-choices参数"><a href="#16-choices参数" class="headerlink" title="16.choices参数"></a>16.choices参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># choices参数</span></span><br><span class="line">创建用户表</span><br><span class="line">	性别</span><br><span class="line">    	两到三种状态</span><br><span class="line">    学历</span><br><span class="line">    	也是有限个</span><br><span class="line">    在职状态</span><br><span class="line">    	也是有限个</span><br><span class="line">    婚姻</span><br><span class="line">    	也是有限个</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;针对某个字段可以列举完全的情况 一般都是使用choices参数&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    host = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>,<span class="string">&#x27;在线&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>,<span class="string">&#x27;待上线&#x27;</span>),</span><br><span class="line">        (<span class="number">3</span>,<span class="string">&#x27;宕机&#x27;</span>),</span><br><span class="line">        (<span class="number">4</span>,<span class="string">&#x27;待上架&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    status = models.IntegerField(choices=status_choices)</span><br><span class="line"></span><br><span class="line">    desc_choices = (</span><br><span class="line">        (<span class="string">&#x27;哈哈&#x27;</span>,<span class="string">&#x27;哈哈哈哈哈哈&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;呵呵&#x27;</span>,<span class="string">&#x27;呵呵呵呵呵呵&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘿嘿&#x27;</span>,<span class="string">&#x27;嘿嘿嘿嘿嘿嘿&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;嘻嘻&#x27;</span>,<span class="string">&#x27;嘻嘻嘻嘻嘻嘻&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">32</span>,choices=desc_choices)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">*****获取对应关系*****</span><br><span class="line">.get_字段名_display()</span><br></pre></td></tr></table></figure>

<h3 id="17-查看原生SQL语句方法"><a href="#17-查看原生SQL语句方法" class="headerlink" title="17.查看原生SQL语句方法"></a>17.查看原生SQL语句方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>测试环境</span><br><span class="line">	自己拷贝代码</span><br><span class="line"><span class="number">2.</span>pycharm自带的测试环境</span><br><span class="line">    python console</span><br><span class="line"><span class="number">3.</span>配置文件查看所有orm内部SQL语句</span><br><span class="line">    <span class="comment"># 直接拷贝到配置文件中即可</span></span><br><span class="line">        LOGGING = &#123;</span><br><span class="line">        <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            	&#125;,</span><br><span class="line">        	&#125;</span><br><span class="line">    	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-ORM查询优化-数据库查询优化"><a href="#18-ORM查询优化-数据库查询优化" class="headerlink" title="18.ORM查询优化(数据库查询优化)"></a>18.ORM查询优化(数据库查询优化)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">惰性查询</span><br><span class="line">	用不到的数据即使写了orm语句也不会执行</span><br><span class="line">        <span class="number">1.</span>only与defer</span><br><span class="line">        <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>only与defer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.values(&#x27;title&#x27;)  # 列表套字典</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.only(&#x27;title&#x27;)  # 列表套对象</span></span><br><span class="line">    <span class="comment"># print(res1)</span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.price)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    only括号内写什么字段</span></span><br><span class="line"><span class="string">        生成的对象就含有对应的属性 在查找该属性的时候不再走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则每次都会走数据库查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res1 = models.Book.objects.defer(&#x27;title&#x27;)	# 列表套对象</span></span><br><span class="line">    <span class="comment"># # print(res1)  </span></span><br><span class="line">    <span class="comment"># for i in res1:</span></span><br><span class="line">    <span class="comment">#     # print(i.title)</span></span><br><span class="line">    <span class="comment">#     print(i.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    defer与only刚好相反</span></span><br><span class="line"><span class="string">        生成的对象就不含有对应的属性 在查找该属性的时候需要每次走数据库查询</span></span><br><span class="line"><span class="string">        但是一旦查找括号内没有的字段属性 则不需要走数据库查询</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># res = models.Book.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># print(res.publish.title)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>select_related与prefetch_related</span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.Book.objects.select_related(&#x27;publish&#x27;)</span></span><br><span class="line">    <span class="comment"># for i in res:</span></span><br><span class="line">    <span class="comment">#     print(i.publish.title)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select_related相当于连表操作</span></span><br><span class="line"><span class="string">        先将models后面的表和括号内外键字段关联的表连接起来</span></span><br><span class="line"><span class="string">        之后一次性把所有的数据封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    res = models.Book.objects.prefetch_related(<span class="string">&#x27;publish&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(i.publish.title)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    prefetch_related相当于子查询</span></span><br><span class="line"><span class="string">        先查询models后面的表的所有的数据</span></span><br><span class="line"><span class="string">        然后将括号内外键关联的表的数据全部查询出来</span></span><br><span class="line"><span class="string">        之后整合到一起封装到数据对象中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">总结:</span><br><span class="line">    <span class="number">1.</span>only与defer</span><br><span class="line">        only:查询括号内的字段不需要走数据库 查询括号内以外的字段每次都要走数据库</span><br><span class="line">        defer:查询括号内字段要走数据库 查询括号内以外字段时不需要走数据库</span><br><span class="line">    <span class="number">2.</span>select_related与prefertch_related</span><br><span class="line">    	select_related:相当于链表操作,先将models后的表与括号内指定外键字段关联的表拼接,再把所有数据封装到数据对象中</span><br><span class="line">        prefertch_related:相当于子查询,先将models后的表所有数据查询出来,再将括号内指定外键字段关联的表所有数据查询出来,再整合到一起封装到数据对象中</span><br></pre></td></tr></table></figure>

<h3 id="19-框架设计模型-MTV与MVC"><a href="#19-框架设计模型-MTV与MVC" class="headerlink" title="19.框架设计模型(MTV与MVC)"></a>19.框架设计模型(MTV与MVC)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MTV</span><br><span class="line">	M:models模型层</span><br><span class="line">    T:templates模板层</span><br><span class="line">	V:views视图层</span><br><span class="line">MVC</span><br><span class="line">	M:models模型层</span><br><span class="line">    V:views视图层</span><br><span class="line">    C:controller控制层</span><br><span class="line">        </span><br><span class="line">django框架自称是MTV 其实本质也是MVC</span><br></pre></td></tr></table></figure>

<h3 id="20-多对多表关系三种创建方式"><a href="#20-多对多表关系三种创建方式" class="headerlink" title="20.多对多表关系三种创建方式"></a>20.多对多表关系三种创建方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">第一种(全自动):  </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     <span class="string">&#x27;&#x27;&#x27;第三张表的扩展性极差 eg:无法添加额外的字段&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第二种(纯手动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">        book_id = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">        author_id = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">        desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;第三张表可以自定义 但是orm查询不太方便&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">第三种(半自动):</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Books</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>,</span><br><span class="line">                                     through=<span class="string">&#x27;Books2Author&#x27;</span>,</span><br><span class="line">                                     through_fields=(<span class="string">&#x27;book&#x27;</span>,<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">                                     )</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    	<span class="comment"># books = models.ManyToManyField(to=&#x27;Books&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through=&#x27;Books2Author&#x27;,</span></span><br><span class="line">    	<span class="comment">#                                through_fields=(&#x27;author&#x27;,&#x27;book&#x27;)</span></span><br><span class="line">    	<span class="comment">#                                )</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Books2Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    	book = models.ForeignKey(to=<span class="string">&#x27;Books&#x27;</span>)</span><br><span class="line">    	author = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line">    	desc = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;扩展性高 无法使用add\set\remove\clear 其他操作不影响&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">through_fields字段先后顺序</span></span><br><span class="line"><span class="string">	判断本质:</span></span><br><span class="line"><span class="string">		通过第三张表查询对应的的表 需要用到哪个字段就把哪个字段放前面</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/15/%E6%A8%A1%E6%9D%BF%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/03/15/%E6%A8%A1%E6%9D%BF%E5%B1%82/" class="post-title-link" itemprop="url">Django之模板层</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-03-15 18:20:25" itemprop="dateCreated datePublished" datetime="2019-03-15T18:20:25+08:00">2019-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Django%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Django入门</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模板层"><a href="#模板层" class="headerlink" title="模板层"></a>模板层</h1><h3 id="1-模板语法传值"><a href="#1-模板语法传值" class="headerlink" title="1.模板语法传值"></a>1.模板语法传值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/Dominic-Ji/articles/<span class="number">11109067.</span>html<span class="comment">#_label15</span></span><br><span class="line">    </span><br><span class="line">注释</span><br><span class="line">	&lt;!--HTML注释--&gt;	浏览器能够查看</span><br><span class="line">    &#123;<span class="comment">#模板语法注释#&#125;    浏览器查看不了</span></span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># python基本数据类型</span></span><br><span class="line">    f = <span class="number">1.1</span></span><br><span class="line">    i = <span class="number">11</span></span><br><span class="line">    s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">    l = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line">    d = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&quot;jason&quot;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>&#125;</span><br><span class="line">    t = (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>)</span><br><span class="line">    se = &#123;<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>&#125;</span><br><span class="line">    b = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 函数(自动加括号调用函数 展示的是函数的返回值)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">args</span>):</span>  <span class="comment"># 模板语法不支持给函数传递额外的参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;from func&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;下午有点困&#x27;</span></span><br><span class="line">    <span class="comment"># 面向对象</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params"><span class="built_in">object</span></span>):</span>  <span class="comment"># 自动加括号实例化产生对象</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_obj</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from obj&#x27;</span></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_cls</span>(<span class="params">cls</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from cls&#x27;</span></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">get_func</span>():</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;from func&#x27;</span></span><br><span class="line">    obj = MyClass()</span><br><span class="line">       </span><br><span class="line"><span class="comment"># 后端给前端传值</span></span><br><span class="line">    <span class="comment"># 1.指名道姓的传(需要传的值较少)</span></span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">&#x27;reg.html&#x27;</span>,&#123;...&#125;)</span><br><span class="line">    <span class="comment"># 2.一次性批量传(效率偏低) 为了教学方便我们使用locals居多</span></span><br><span class="line">    	<span class="keyword">return</span> render(request,<span class="string">&#x27;reg.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">        </span><br><span class="line">总结:</span><br><span class="line">	<span class="number">1.</span>当向前端传递一个函数时候,函数会自动加括号调用,前端展示的是函数的返回值</span><br><span class="line">    <span class="number">2.</span>当向前端传递一个类的时候,类会自动加括号实例化产生对象,前端展示的是对象</span><br><span class="line">    <span class="number">3.</span>当向前端传递一个对象的时候,前端展示的是对象的内存地址,可通过点的方法获取属性或调用方法</span><br><span class="line">    <span class="number">4.</span>模板语法不支持传参,若函数或类需要接收参数,不支持使用</span><br><span class="line">    <span class="number">5.</span>前端接收到后端传递过来的容器类型数据,内部元素可使用句点符(.)获取(.数字 数字就是索引 字典用.key) </span><br></pre></td></tr></table></figure>

<h3 id="2-模板语法取值"><a href="#2-模板语法取值" class="headerlink" title="2.模板语法取值"></a>2.模板语法取值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">取值只能使用句点符(.)</span><br><span class="line">&lt;p&gt;&#123;&#123; l<span class="number">.0</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.username &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; d.hobby<span class="number">.3</span>.addr &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-模板语法之过滤器-内置方法"><a href="#3-模板语法之过滤器-内置方法" class="headerlink" title="3.模板语法之过滤器(内置方法)"></a>3.模板语法之过滤器(内置方法)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">过滤器: </span><br><span class="line">    管道符 左侧当做过滤器的第一个参数 右侧有时候还可以支持再传一个参数(冒号开头)</span><br><span class="line">    </span><br><span class="line">&lt;p&gt;统计长度:&#123;&#123; l|length &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;自增运算:&#123;&#123; i|add:<span class="number">123</span> &#125;&#125;、拼接操作:&#123;&#123; s|add:<span class="string">&#x27;去你妹的&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;日期转换:&#123;&#123; ctime|date:<span class="string">&#x27;Y-m-d&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文件大小:&#123;&#123; file_size|filesizeformat &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取字符(三个点也算):&#123;&#123; desc|truncatechars:<span class="number">6</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;截取单词(三个点不算):&#123;&#123; desc|truncatewords:<span class="number">3</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;切片操作:&#123;&#123; s|<span class="built_in">slice</span>:<span class="string">&#x27;0:4&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;默认值(判断布尔值):&#123;&#123; b|default:<span class="string">&#x27;这个东西布尔值是False&#x27;</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht|safe &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; xss &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;文本转义:&#123;&#123; ht1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    </span><br><span class="line">后端转义</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line">    ht1 = <span class="string">&#x27;&lt;h1&gt;一级标题&lt;/h1&gt;&#x27;</span></span><br><span class="line">    ht1 = mark_safe(ht1)</span><br></pre></td></tr></table></figure>

<h3 id="4-模板语法之标签"><a href="#4-模板语法之标签" class="headerlink" title="4.模板语法之标签"></a>4.模板语法之标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#125;&#125;	变量相关(引用变量值)</span><br><span class="line">&#123;% %&#125;	逻辑相关(流程控制 模块方法)</span><br><span class="line"></span><br><span class="line">&lt;p&gt;标签: 流程控制&lt;/p&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> lll %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.first %&#125;</span><br><span class="line">        &lt;p&gt;这是我的第一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">elif</span> forloop.last %&#125;</span><br><span class="line">        &lt;p&gt;这是我的最后一次循环&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        &lt;p&gt;该对象里面没有值&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">    <span class="keyword">if</span>语句支持 <span class="keyword">and</span> 、<span class="keyword">or</span>、==、&gt;、&lt;、!=、&lt;=、&gt;=、<span class="keyword">in</span>、<span class="keyword">not</span> <span class="keyword">in</span>、<span class="keyword">is</span>、<span class="keyword">is</span> <span class="keyword">not</span>判断</span><br></pre></td></tr></table></figure>

<h3 id="5-自定义过滤器-标签-inclusion-tag"><a href="#5-自定义过滤器-标签-inclusion-tag" class="headerlink" title="5.自定义过滤器 标签 inclusion_tag"></a>5.自定义过滤器 标签 inclusion_tag</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在应用下创建一个名字必须叫templatetags文件夹</span><br><span class="line"><span class="number">2.</span>在该文件夹内创建一个任意名称的py文件</span><br><span class="line"><span class="number">3.</span>在py文件内必须要书写两行固定的代码</span><br><span class="line">	<span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line">    register = Library()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">is_safe=<span class="literal">False</span>,name=<span class="string">&#x27;aaa&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_plus</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义标签(自定义函数)</span></span><br><span class="line"><span class="meta">@register.simple_tag(<span class="params">name=<span class="string">&#x27;bbb&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c,d</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%s-%s-%s-%s&#x27;</span>%(a,b,c,d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义inclusion_tag(自行概括)</span></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params">filename=<span class="string">&#x27;ccc.html&#x27;</span>,name=<span class="string">&#x27;myinc&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">n</span>):</span></span><br><span class="line">    new_l = [<span class="string">&#x27;第%s页&#x27;</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">locals</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 详解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">name=<span class="string">&#x27;baby&#x27;</span> </span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_sum</span>(<span class="params">v1，v2</span>) :</span></span><br><span class="line">	<span class="keyword">return</span> v1 + v2</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">&#123;% load mytag %&#125;</span><br><span class="line">&lt;p&gt;&#123;&#123; n|baby:<span class="number">666</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义标签(参数可以有多个)    类似于自定义函数</span></span><br><span class="line"><span class="meta">@register.simple_tag(<span class="params">name=<span class="string">&#x27;plus&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">a,b,c,d</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;%s-%s-%s-%s&#x27;</span>%(a,b,c,d)</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">标签多个参数彼此之间空格隔开</span><br><span class="line">&lt;p&gt;&#123;% plus <span class="string">&#x27;jason&#x27;</span> <span class="number">123</span> <span class="number">123</span> <span class="number">123</span> %&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义inclusion_tag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">内部原理</span></span><br><span class="line"><span class="string">	先定义一个方法</span></span><br><span class="line"><span class="string">	在页面上调用该方法并且可以传值</span></span><br><span class="line"><span class="string">    该访法会生成一些数据然后传递给一个htm1页面</span></span><br><span class="line"><span class="string">    之后将渲染好的结果放到调用的位置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params"><span class="string">&#x27;left_menu.html&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">left</span>(<span class="params">n</span>):</span> </span><br><span class="line">	data = [<span class="string">&#x27;第&#123;&#125;项&#x27;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">		<span class="comment">#第一种</span></span><br><span class="line">		<span class="comment"># return &#123;&#x27;data&#x27;:data&#125; 	# 将data传递给1eft_menu.html</span></span><br><span class="line">		<span class="comment">#第二种</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">locals</span>() 		<span class="comment"># 将data传递给left_menu.html</span></span><br><span class="line"><span class="comment"># 使用    </span></span><br><span class="line">left_menu.html 页面</span><br><span class="line">	&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> data %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; foo &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">	&lt;/ul&gt;</span><br><span class="line">    </span><br><span class="line">使用到该方法页面:</span><br><span class="line">	&#123;% load mytag %&#125;</span><br><span class="line">	&#123;% left 数字 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 总结:当html页面某一个地方的页面需要传参数才能够动态的渲染出来，并且在多个页面上都需要使用到该局部那么就考虑将该局部页面做成inclusion_tag形式</span></span><br><span class="line">(在讲bbs的时候会使用到)</span><br></pre></td></tr></table></figure>

<h3 id="6-模板的继承-使用较多"><a href="#6-模板的继承-使用较多" class="headerlink" title="6.模板的继承(使用较多)"></a>6.模板的继承(使用较多)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">需求</span><br><span class="line">	页面主体不变 部分区域变化</span><br><span class="line"></span><br><span class="line">模板继承</span><br><span class="line">	<span class="number">1.</span>需要现在母版中使用block提前划定区域</span><br><span class="line">    	&#123;% block 区域名称 %&#125;</span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="number">2.</span>在子版中先继承再局部替换</span><br><span class="line">    	&#123;% extends <span class="string">&#x27;母版.html&#x27;</span> %&#125;</span><br><span class="line">        </span><br><span class="line">        &#123;% block 区域名称 %&#125;</span><br><span class="line">    		自定义内容</span><br><span class="line">		&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">	母版一般情况下都应该至少含有三个区域</span><br><span class="line">    	css区域</span><br><span class="line">        content区域</span><br><span class="line">        js区域</span><br><span class="line">    </span><br><span class="line">补充</span><br><span class="line">	&#123;&#123; block.<span class="built_in">super</span> &#125;&#125;  调用母版内容</span><br></pre></td></tr></table></figure>

<h3 id="7-模板的导入-了解"><a href="#7-模板的导入-了解" class="headerlink" title="7.模板的导入(了解)"></a>7.模板的导入(了解)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#x27;myform.html&#x27; %&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="左大大的博客">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="左大大的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="左大大">
<meta property="article:tag" content="Python Linux Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>左大大的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">左大大的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="左大大"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">左大大</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">103</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/10/Llinux%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AE%89%E8%A3%85Django/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/10/Llinux%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AE%89%E8%A3%85Django/" class="post-title-link" itemprop="url">Llinux系统内安装Django</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-10 17:27:55" itemprop="dateCreated datePublished" datetime="2020-12-10T17:27:55+08:00">2020-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">其他分类</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Llinux系统内安装Django"><a href="#Llinux系统内安装Django" class="headerlink" title="Llinux系统内安装Django"></a>Llinux系统内安装Django</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、安装Python</span><br><span class="line">	yum install python3 -y</span><br><span class="line"></span><br><span class="line">2、安装django</span><br><span class="line">	pip3 install django==1.11.11</span><br><span class="line"></span><br><span class="line">3.创建任意一个文件夹,并切换至该文件夹下</span><br><span class="line">	[root@localhost ~]<span class="comment"># mkdir django</span></span><br><span class="line">	[root@localhost ~]<span class="comment"># cd django</span></span><br><span class="line">	</span><br><span class="line">4.在该文件夹下创建一个django项目</span><br><span class="line">	[root@localhost django]<span class="comment"># django-admin startproject linux</span></span><br><span class="line">	</span><br><span class="line">5.切换到项目文件夹下创建一个应用app01</span><br><span class="line">	[root@localhost django]<span class="comment"># cd linux</span></span><br><span class="line">	[root@localhost linux]<span class="comment"># django-admin startapp app01</span></span><br><span class="line"></span><br><span class="line">6.修改settings配置文件(/linux/linux/settings.py)</span><br><span class="line">	ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]        <span class="comment"># 内加上&#x27;*&#x27;</span></span><br><span class="line">	</span><br><span class="line">7.若启动项目后访问不了则需关闭系统防火墙</span><br><span class="line">	查看防火墙:</span><br><span class="line">		[root@localhost linux]<span class="comment"># systemctl status firewalld</span></span><br><span class="line">	若显示开启则需要关闭:</span><br><span class="line">		[root@localhost linux]<span class="comment"># systemctl disable --now firewalld</span></span><br><span class="line">		</span><br><span class="line">8.启动django项目</span><br><span class="line">	[root@localhost linux]<span class="comment"># python3 manage.py runserver 0.0.0.0:8001</span></span><br><span class="line">	</span><br><span class="line">9.浏览器输入IP地址跟上端口号访问(系统ip地址)</span><br><span class="line">	http://192.168.126.100:8001/      </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/10/%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E8%87%B3GitHub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/10/%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E8%87%B3GitHub/" class="post-title-link" itemprop="url">本地项目上传github</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-10 17:27:55" itemprop="dateCreated datePublished" datetime="2020-11-10T17:27:55+08:00">2020-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">其他分类</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="前期配置"><a href="#前期配置" class="headerlink" title="前期配置"></a>前期配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">设置git 的user name和email</span><br><span class="line">    git config --global user.name <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    git config --global user.email  <span class="string">&quot;xxx@xxx.com&quot;</span></span><br><span class="line"></span><br><span class="line">设置ssh key</span><br><span class="line">	ssh-keygen -t rsa -C <span class="string">&quot;xxx@xxx.com&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="上传本地项目到githup"><a href="#上传本地项目到githup" class="headerlink" title="上传本地项目到githup"></a>上传本地项目到githup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.打开Git切换到D盘,创建project目录并切换到project目录下</span><br><span class="line">	$ <span class="built_in">cd</span> /d</span><br><span class="line">	$ mkdir project</span><br><span class="line">	$ <span class="built_in">cd</span>/project</span><br><span class="line"></span><br><span class="line">2.执行git init 初始化操作,project目录下会出现.git文件夹</span><br><span class="line">	将想要上传的项目或文件复制到project目录下</span><br><span class="line"></span><br><span class="line">3.建立远程仓库链接,使用ssh方式链接githup仓库</span><br><span class="line">	若提示错误：fatal: remote origin already exists.</span><br><span class="line">	先删除远程仓库(git remote rm origin),再添加仓库链接</span><br><span class="line">	$ git remote add origin git@github.com:Zdd0128/Book.git</span><br><span class="line">	(git@github.com:Zdd0128/BBS.git)</span><br><span class="line"></span><br><span class="line">4.执行<span class="string">&quot;git add .&quot;</span>将本地文件添加至远程仓库内</span><br><span class="line">	$ git add .</span><br><span class="line">	并添加描述性信息</span><br><span class="line">	$ git commit -m <span class="string">&quot;Book&quot;</span></span><br><span class="line"></span><br><span class="line">5.使用git push方式实现远程githup仓库同步</span><br><span class="line">	(若报错黄色字体则执行:$ git pull --rebase origin master)</span><br><span class="line">	$ git push origin master</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/Celery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/10/Celery/" class="post-title-link" itemprop="url">Celery</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-10 18:20:25" itemprop="dateCreated datePublished" datetime="2020-10-10T18:20:25+08:00">2020-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Celery/" itemprop="url" rel="index"><span itemprop="name">Celery</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Celery"><a href="#Celery" class="headerlink" title="Celery"></a>Celery</h1><h2 id="1-Celery介绍"><a href="#1-Celery介绍" class="headerlink" title="1.Celery介绍"></a>1.Celery介绍</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># celery(芹菜)</span></span><br><span class="line">	分布式的异步任务框架</span><br><span class="line"><span class="comment"># celery能干什么?</span></span><br><span class="line">	异步任务，延迟任务，定时任务</span><br><span class="line">    </span><br><span class="line">	异步执行：解决耗时任务,将耗时操作任务提交给Celery去异步执行，如发送短信/邮件、消息推送、音视频处理等</span><br><span class="line">	延迟执行：解决延迟任务</span><br><span class="line">	定时执行：解决周期(周期)任务,比如每天数据统计</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.celery可以不依赖任何服务器，通过自身命令，启动服务</span></span><br><span class="line"><span class="string">2.celery服务为为其他项目服务提供异步解决任务需求的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意:</span></span><br><span class="line"><span class="string">	会有两个服务同时运行，一个是项目服务，一个是celery服务，项目服务将需要异步处理的任务交给celery服务，celery就会在需要时异步完成项目的需求</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">eg:</span></span><br><span class="line"><span class="string">    人是一个独立运行的服务 | 医院也是一个独立运行的服务</span></span><br><span class="line"><span class="string">    正常情况下，人可以完成所有健康情况的动作，不需要医院的参与；但当人生病时，就会被医院接收，解决人生病问题</span></span><br><span class="line"><span class="string">    人生病的处理方案交给医院来解决，所有人不生病时，医院独立运行，人生病时，医院就来解决人生病的需求</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">Sanic框架:</span><br><span class="line">    python3<span class="number">.5</span>以上，不支持win,怎么办?</span><br><span class="line">        <span class="number">1.</span>选择使用mac开发</span><br><span class="line">        <span class="number">2.</span>装乌班图</span><br><span class="line">        <span class="number">3.</span>win远程连接linux开发</span><br><span class="line">    </span><br><span class="line">uwgi(不支持win)+django</span><br></pre></td></tr></table></figure>

<h2 id="2-Celery架构"><a href="#2-Celery架构" class="headerlink" title="2.Celery架构"></a>2.Celery架构</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 消息中间件(broker)</span></span><br><span class="line">	Celery本身不提供消息服务，但是可以方便的和第三方提供的消息中间件集成。包括Redis等</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务执行单元(workers)</span></span><br><span class="line">	Worker是Celery提供的任务执行的单元，worker并发的运行在分布式的系统节点中(本质:一个work就是一个进程)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务结果存储(backend)</span></span><br><span class="line">	Task result store用来存储Worker执行的任务的结果，Celery支持以不同方式存储任务的结果，包括 redis等</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210729184821772.png" alt="image-20210729184821772"></p>
<h2 id="3-Celery基本使用"><a href="#3-Celery基本使用" class="headerlink" title="3.Celery基本使用"></a>3.Celery基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装:</span></span><br><span class="line">	pip install celery</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.x版本</span></span><br><span class="line">	pip install eventlet</span><br><span class="line">	celery -A celery_task worker -l info -P eventlet</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux中启动work</span></span><br><span class="line">    celery -A celery_task worker -l info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动beat的命令(负责每隔几秒钟，向任务队列中提交任务)</span></span><br><span class="line">	celery -A celery_task beat -l info</span><br></pre></td></tr></table></figure>

<h3 id="3-1普通使用"><a href="#3-1普通使用" class="headerlink" title="3.1普通使用"></a>3.1普通使用</h3><p><strong>新建celery_task.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line">backend=<span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span>  <span class="comment"># 结果存储位置</span></span><br><span class="line">broker=<span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span>   <span class="comment"># 消息中间件存放位置</span></span><br><span class="line">app=Celery(<span class="string">&#x27;test&#x27;</span>,broker=broker,backend=backend)  <span class="comment"># 传一个字符串,相当于名字</span></span><br></pre></td></tr></table></figure>

<p><strong>新建add_task.py添加任务</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery_task <span class="keyword">import</span> add</span><br><span class="line"><span class="comment"># res=add(1,2)  # 同步调用</span></span><br><span class="line">res=add.delay(<span class="number">3</span>,<span class="number">4</span>)  <span class="comment"># 异步调用 把任务提交到redis</span></span><br><span class="line"><span class="built_in">print</span>(res) 	<span class="comment"># 返回一个uuid：b20f827d-dcf5-4fdf-a646-5abb963dc1d3</span></span><br></pre></td></tr></table></figure>

<p><strong>新建get_result.py查询任务</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery_task <span class="keyword">import</span> app  				<span class="comment"># 自己写的app</span></span><br><span class="line"><span class="keyword">from</span> celery.result <span class="keyword">import</span> AsyncResult  		<span class="comment"># celery模块下的</span></span><br><span class="line"><span class="built_in">id</span> = <span class="string">&#x27;b20f827d-dcf5-4fdf-a646-5abb963dc1d3&#x27;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = AsyncResult(<span class="built_in">id</span>=<span class="built_in">id</span>, app=app)</span><br><span class="line">    <span class="keyword">if</span> a.successful():</span><br><span class="line">        result = a.get()  <span class="comment"># task中return的数据:7</span></span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">elif</span> a.failed():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;任务失败&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> a.status == <span class="string">&#x27;PENDING&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;任务等待中被执行&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> a.status == <span class="string">&#x27;RETRY&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;任务异常后正在重试&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> a.status == <span class="string">&#x27;STARTED&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;任务已经开始被执行&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="启动worker"><a href="#启动worker" class="headerlink" title="启动worker"></a>启动worker</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win</span></span><br><span class="line">    pip install eventlet</span><br><span class="line">	celery -A celery_task worker -l info -P eventlet</span><br><span class="line">    </span><br><span class="line"><span class="comment"># linux</span></span><br><span class="line">	celery -A celery_task worker -l info</span><br></pre></td></tr></table></figure>

<h3 id="3-2封装成包结构"><a href="#3-2封装成包结构" class="headerlink" title="3.2封装成包结构"></a>3.2封装成包结构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包结构:</span></span><br><span class="line">	celery_task   	<span class="comment"># 包名</span></span><br><span class="line">        __init__.py  	</span><br><span class="line">        user_task.py  	<span class="comment"># 任务存放路径</span></span><br><span class="line">        order_task.py  	<span class="comment"># 任务存放路径</span></span><br><span class="line">        home_task.py  	<span class="comment"># 任务存放路径</span></span><br><span class="line">        celery.py  		<span class="comment"># app所在文件,必须叫celery</span></span><br></pre></td></tr></table></figure>

<p><strong>celery.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有app的这个py文件，必须叫celery</span></span><br><span class="line">    <span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line">    backend = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span>  <span class="comment"># 结果存储</span></span><br><span class="line">    broker = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span>  <span class="comment"># 消息中间件</span></span><br><span class="line">    app = Celery(<span class="string">&#x27;test&#x27;</span>, broker=broker, backend=backend, include=[</span><br><span class="line">        <span class="string">&#x27;celery_task.home_task&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;celery_task.order_task&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;celery_task.user_task&#x27;</span></span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>

<p><strong>home_task.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"><span class="meta">@app.task  </span><span class="comment"># home模块的任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br></pre></td></tr></table></figure>

<p><strong>order_task.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"><span class="meta">@app.task  </span><span class="comment"># order模块的任务,写文件任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_file</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;D:\lqz2\luffy_api\log\a.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(s)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p><strong>user_task.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app</span><br><span class="line"><span class="meta">@app.task  </span><span class="comment"># user模块的任务,发送带内心</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_sms</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%s手机号，短信发送成功&#x27;</span>%s</span><br></pre></td></tr></table></figure>

<h2 id="4-celery执行不同的任务"><a href="#4-celery执行不同的任务" class="headerlink" title="4.celery执行不同的任务"></a>4.celery执行不同的任务</h2><h3 id="4-1Celery执行异步任务"><a href="#4-1Celery执行异步任务" class="headerlink" title="4.1Celery执行异步任务"></a>4.1Celery执行异步任务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将写好任务的py文件导入,调用任务并传入需要的参数(关键字:delay)</span></span><br><span class="line">    <span class="keyword">from</span> celery_task.user_task <span class="keyword">import</span> send_sms</span><br><span class="line">    send_sms.delay(<span class="string">&#x27;18953675221&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-2Celery执行延迟任务"><a href="#4-2Celery执行延迟任务" class="headerlink" title="4.2Celery执行延迟任务"></a>4.2Celery执行延迟任务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将写好任务的py文件导入,调用任务并传入需要的参数(关键字:apply_async)</span></span><br><span class="line">    <span class="keyword">from</span> celery_task.user_task <span class="keyword">import</span> send_sms</span><br><span class="line">    <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line">    <span class="comment"># 当前utc时间,往后推10s</span></span><br><span class="line">    eta=datetime.utcnow() + timedelta(seconds=<span class="number">10</span>)  <span class="comment"># 时间对象计算</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># args是列表，send_sms的参数，eta是延迟时间，时间对象</span></span><br><span class="line">    send_sms.apply_async(args=[<span class="string">&#x27;1888888&#x27;</span>,],eta=eta)</span><br></pre></td></tr></table></figure>

<h3 id="4-3Celery执行定时任务"><a href="#4-3Celery执行定时任务" class="headerlink" title="4.3Celery执行定时任务"></a>4.3Celery执行定时任务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定时任务直接在celery.py中书写即可,需要配合beat提交任务来完成</span></span><br><span class="line">	celery -A celery_task beat -l info</span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">    celery.py文件:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line">    backend = <span class="string">&#x27;redis://127.0.0.1:6379/1&#x27;</span>  <span class="comment"># 结果存储</span></span><br><span class="line">    broker = <span class="string">&#x27;redis://127.0.0.1:6379/2&#x27;</span>  <span class="comment"># 消息中间件</span></span><br><span class="line">    app = Celery(<span class="string">&#x27;test&#x27;</span>, broker=broker, backend=backend, include=[</span><br><span class="line">        <span class="string">&#x27;celery_task.home_task&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;celery_task.order_task&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;celery_task.user_task&#x27;</span></span><br><span class="line">    ])</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 定时任务直接写在celery文件内:</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment"># 修改时区</span></span><br><span class="line">        app.conf.timezone = <span class="string">&#x27;Asia/Shanghai&#x27;</span>		<span class="comment"># 时区(修改时区)</span></span><br><span class="line">        app.conf.enable_utc = <span class="literal">False</span>				<span class="comment"># 是否使用UTC,配合时区使用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 任务的定时配置</span></span><br><span class="line">        <span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line">        <span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line">        app.conf.beat_schedule = &#123;</span><br><span class="line">            <span class="string">&#x27;send_sms_5&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;celery_task.user_task.send_sms&#x27;</span>,  <span class="comment"># 要执行的任务</span></span><br><span class="line">                <span class="string">&#x27;schedule&#x27;</span>: timedelta(seconds=<span class="number">5</span>),	<span class="comment"># 每隔五秒执行一次</span></span><br><span class="line">                <span class="string">&#x27;args&#x27;</span>: (<span class="number">189533333</span>,),</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;add_3&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;celery_task.home_task.add&#x27;</span>,  	<span class="comment"># 要执行的任务</span></span><br><span class="line">                <span class="string">&#x27;schedule&#x27;</span>:crontab(hour=<span class="number">8</span>,day_of_week=<span class="number">1</span>), <span class="comment"># 每周一早八点执行</span></span><br><span class="line">                <span class="string">&#x27;args&#x27;</span>: (<span class="number">6</span>,<span class="number">8</span>),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/05/Docker-compose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/05/Docker-compose/" class="post-title-link" itemprop="url">Docker-Compose</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-05 18:20:25" itemprop="dateCreated datePublished" datetime="2020-10-05T18:20:25+08:00">2020-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h1><h2 id="1-Docker-Compose安装与卸载"><a href="#1-Docker-Compose安装与卸载" class="headerlink" title="1.Docker-Compose安装与卸载"></a>1.Docker-Compose安装与卸载</h2><h3 id="1-1Docker-Compose简介"><a href="#1-1Docker-Compose简介" class="headerlink" title="1.1Docker-Compose简介"></a>1.1Docker-Compose简介</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 什么是Docker-Compose</span><br><span class="line">	Compose 是 Docker 容器进行编排的工具，定义和运行多容器的应用，可以做到一条命令启动多个容器，使用Docker-Compose不再需要使用shell脚本来启动容器。 </span><br><span class="line"></span><br><span class="line">	Compose 通过一个配置文件来管理多个Docker容器，在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动，停止和重启应用，和应用中的服务以及所有依赖服务的容器，非常适合组合使用多个容器进行开发的场景。</span><br><span class="line"></span><br><span class="line">	docker-compose默认的模板文件是 docker-compose.yaml，其中定义的每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）来自动构建。其它大部分指令都跟 docker run 中的类似。</span><br><span class="line"></span><br><span class="line">	如果使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 docker-compose.yml 中再次设置。</span><br><span class="line"></span><br><span class="line">使用Compose 基本上分为三步：</span><br><span class="line">    1.Dockerfile 定义应用的运行环境</span><br><span class="line">    2.docker-compose.yaml 定义组成应用的各服务</span><br><span class="line">    3.docker-compose up 启动整个应用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Docker-Compose将所管理的容器分为三层:</span><br><span class="line">	1.工程（project）</span><br><span class="line">	2.服务（service）</span><br><span class="line">	3.容器（container）</span><br></pre></td></tr></table></figure>

<h3 id="1-2安装Docker-Compose"><a href="#1-2安装Docker-Compose" class="headerlink" title="1.2安装Docker-Compose"></a>1.2安装Docker-Compose</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在线安装:</span></span><br><span class="line">	1.运行以下命令以下载Docker Compose的当前稳定版本</span><br><span class="line">		curl -L &quot;https://github.com/docker/compose/releases/download/1.26.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line">	2.将可执行权限应用于二进制文件</span><br><span class="line">		chmod +x /usr/local/bin/docker-compose</span><br><span class="line">	3.验证安装是否成功(能看到版本号表示安装成功)</span><br><span class="line">		docker-compose version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 离线安装</span></span><br><span class="line">	GitHub下载对应的版本，这里选择的是1.26.2 的 docker-compose-Linux-x86_64</span><br><span class="line">	1.将下载的文件移至bin目录</span><br><span class="line">		mv /home/sangang/docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class="line">	2.添加执行权限</span><br><span class="line">		chmod +x /usr/local/bin/docker-compose</span><br><span class="line">	3.验证安装是否成功</span><br><span class="line">		docker-compose --version</span><br><span class="line"><span class="meta">		</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pip安装</span></span><br><span class="line">    pip install -U docker-compose</span><br><span class="line">    (卸载:pip uninstall docker-compose)</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新pip:</span></span><br><span class="line">    pip install --upgrade pip</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装补全工具:</span></span><br><span class="line">	为了方便输入命令，也可以安装Docker的补全提示工具帮忙快速输入命令：</span><br><span class="line">	安装补全工具</span><br><span class="line">		yum install bash-completion</span><br><span class="line">	下载Docker-compose脚本</span><br><span class="line">		curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="1-3Docker-Compose卸载"><a href="#1-3Docker-Compose卸载" class="headerlink" title="1.3Docker-Compose卸载"></a>1.3Docker-Compose卸载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果是二进制包方式安装的，删除二进制文件即可：</span></span><br><span class="line">    rm /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="2-Docker-Compose常用命令"><a href="#2-Docker-Compose常用命令" class="headerlink" title="2.Docker-Compose常用命令"></a>2.Docker-Compose常用命令</h2><h3 id="2-1Docker-Compose命令格式"><a href="#2-1Docker-Compose命令格式" class="headerlink" title="2.1Docker-Compose命令格式"></a>2.1Docker-Compose命令格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span><br><span class="line">命令选项如下：</span><br><span class="line">    -f，–file FILE指定Compose模板文件，默认为docker-compose.yml，可以多次指定。</span><br><span class="line">    -p，–project-name NAME指定项目名称，默认将使用所在目录名称作为项目名。</span><br><span class="line">    -x-network-driver 使用Docker的可拔插网络后端特性（需要Docker 1.9+版本）</span><br><span class="line">    -x-network-driver DRIVER指定网络后端的驱动，默认为bridge（需要Docker 1.9+版本）</span><br><span class="line">    -verbose输出更多调试信息</span><br><span class="line">    -v，–version打印版本并退出</span><br></pre></td></tr></table></figure>

<h3 id="2-2常用命令"><a href="#2-2常用命令" class="headerlink" title="2.2常用命令"></a>2.2常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -h						# 查看帮助</span><br><span class="line">docker-compose up						# 启动所有服务 </span><br><span class="line">docker-compose down						# 结束所有服务</span><br><span class="line">docker-compose start 容器名			  # 启动某服务</span><br><span class="line">	-t # n秒后停止(默认十秒)</span><br><span class="line">docker-compose restart 容器名			  # 重启某服务</span><br><span class="line">docker-compose pause 容器名			  # 暂停运行某服务</span><br><span class="line">docker-compose unpause 容器名        	  # 恢复运行某服务</span><br><span class="line">docker-compose stop	容器名 			  # 停止某服务</span><br><span class="line">docker-compose ps						# 列出项目中目前的所有容器</span><br><span class="line">	-q # 只显示id</span><br><span class="line">docker-compose logs 容器名				  # 查看指定服务日志</span><br><span class="line">docker-compose pull						# 拉取服务依赖的镜像</span><br><span class="line">docker-compose version					# 打印版本信息</span><br><span class="line">docker-compose rm 容器名				  # 删除服务容器,要先stop停止</span><br><span class="line">	-f 	# 强制删除</span><br><span class="line">	-v  # 删除容器挂载</span><br><span class="line">docker-compose run 						# 在指定服务上执行一个命令</span><br><span class="line">	eg:docker-compose run ubuntu ping docker.com</span><br><span class="line">docker-compose scale 					# 设置指定服务运行的容器个数</span><br><span class="line">	eg:docker-compose scale web=3 db=2</span><br><span class="line">docker-compose top 容器名				  # 查看某个服务容器内运行的进程</span><br><span class="line"></span><br><span class="line">docker-compose -f docker-compose.yaml up -d	# -f 指定使用的Compose模板文件，默认为docker-compose.yaml，可以多次指定。</span><br></pre></td></tr></table></figure>

<h2 id="3-Docker-Compose模板文件"><a href="#3-Docker-Compose模板文件" class="headerlink" title="3.Docker-Compose模板文件"></a>3.Docker-Compose模板文件</h2><h4 id="3-1docker-compose-yml"><a href="#3-1docker-compose-yml" class="headerlink" title="3.1docker-compose.yml"></a>3.1docker-compose.yml</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.0&quot;</span><br><span class="line">services:</span><br><span class="line">  django:</span><br><span class="line">    image: django:v3</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:8000&quot;</span><br><span class="line">    container_name: django</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7.</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: root</span><br><span class="line">    container_name: mysql</span><br><span class="line">    volumes:</span><br><span class="line">    - &quot;/root/docker-compose/mysql/data:/var/lib/mysql&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  django:</span><br><span class="line">  </span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一份标准配置文件应该包含version、services、networks三大部分</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 最关键的就是services和 networks两个部分</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2docker-compose指令"><a href="#3-2docker-compose指令" class="headerlink" title="3.2docker-compose指令"></a>3.2docker-compose指令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> services标签下的第二级标签是django,即服务名称,自定义</span></span><br><span class="line">	eg:</span><br><span class="line">		version: &quot;3.0&quot;</span><br><span class="line">        services:</span><br><span class="line">          django:</span><br><span class="line">            ...</span><br><span class="line">		</span><br><span class="line"><span class="meta">		</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> image		指定为镜像名称或镜像ID 如果镜像在本地不存在 Compose 将会尝试拉取这个镜像</span></span><br><span class="line">	eg:</span><br><span class="line">        image: redis</span><br><span class="line">        image: ubuntu:14.04</span><br><span class="line">        image: tutum/influxdb</span><br><span class="line">        image: a4bc65fd</span><br><span class="line">		</span><br><span class="line"><span class="meta">		</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ports		指定容器映射端口</span></span><br><span class="line">	eg:</span><br><span class="line">        ports:</span><br><span class="line">          	- &quot;8000:8000&quot;</span><br><span class="line">         </span><br><span class="line">         </span><br><span class="line"><span class="meta">#</span><span class="bash"> container_name 		指定容器名称(默认:项目名称_服务名称_序号)</span></span><br><span class="line">	eg:</span><br><span class="line">		container_name: django</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volumes	数据卷所挂载路径设置	宿主机路径(HOST:CONTAINER)或加上访问模式(HOST:CONTAINER:ro)</span></span><br><span class="line">    eg:</span><br><span class="line">    	volumes:</span><br><span class="line">          - /var/lib/mysql	# 指定一个路径,Docker自动在创建一个数据卷(这个路径是容器内部的)</span><br><span class="line">          - /opt/data:/var/lib/mysql	# 使用绝对路径挂载数据卷</span><br><span class="line">          - ./cache:/tmp/cache			# 以Compose配置文件为中心的相对路径作为数据卷挂载到容器</span><br><span class="line">          - datavolume:/var/lib/mysql	# 已经存在的命名的数据卷</span><br><span class="line">          - ~/configs:/etc/configs/:ro	# 使用用户的相对路径(~/表示/home/&lt;用户目录&gt;/或/root/）</span><br><span class="line">          </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> working_dir	指定容器中工作目录。</span></span><br><span class="line">	eg:</span><br><span class="line">		working_dir: /code</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> args 添加构建参数，这些参数是仅在构建过程中可访问的环境变量</span>  </span><br><span class="line">	eg:</span><br><span class="line">	首先， 在Dockerfile中指定参数:</span><br><span class="line">        ARG fendo</span><br><span class="line">        ARG password</span><br><span class="line"></span><br><span class="line">        RUN echo &quot;Build number: $fendo&quot;</span><br><span class="line">        RUN script-requiring-password.sh &quot;$password&quot;</span><br><span class="line">     然后指定 build 下的参数,可以传递映射或列表:</span><br><span class="line">     	build:						</span><br><span class="line">          context: .</span><br><span class="line">          args:</span><br><span class="line">            fendo: 1</span><br><span class="line">            password: fendo</span><br><span class="line">      或:</span><br><span class="line">        build:</span><br><span class="line">          context: .</span><br><span class="line">       	  args:</span><br><span class="line">        	- fendo=1</span><br><span class="line">        	- password=fendo</span><br><span class="line">     指定构建参数时可以省略该值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> build		自动构建生成镜像(需要 Dockerfile)</span></span><br><span class="line">	用法一:	</span><br><span class="line">        version: &quot;3.0&quot;</span><br><span class="line">        services:</span><br><span class="line">          django:</span><br><span class="line">            build: ./django				# 直接指定 Dockerfile 文件夹的路径(相对绝对都可以)</span><br><span class="line">            							# 自动去该文件夹寻找Dockefile文件并构建镜像</span><br><span class="line"> </span><br><span class="line"> 	用法二:</span><br><span class="line">        version: &quot;3.0&quot;</span><br><span class="line">        services:</span><br><span class="line">          django:</span><br><span class="line">            build:</span><br><span class="line">              context: ./django					# Dockerfile 的文件路径或 git 仓库的url</span><br><span class="line">              dockerfile: Dockerfile-py			# 指定 Dockerfile 文件名</span><br><span class="line">              args:								# 指定构建镜像时的变量</span><br><span class="line">                NAME: py17</span><br><span class="line"> </span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span>	覆盖容器启动后默认执行的命令</span></span><br><span class="line">	eg:</span><br><span class="line">		command: echo &quot;hello world&quot;</span><br><span class="line">		</span><br><span class="line"><span class="meta">		</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> depends_on		指定在某容器之后启动</span></span><br><span class="line">	eg:</span><br><span class="line">        services:</span><br><span class="line">          django:</span><br><span class="line">            depends_on:		# django服务在mysql服务启动后再启动</span><br><span class="line">              - mysql	</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> env_file		从文件中获取环境变量 可以为单独的文件路径或列表</span></span><br><span class="line">	eg:</span><br><span class="line">		env_file: .env</span><br><span class="line"></span><br><span class="line">        env_file:  </span><br><span class="line">          -./common.env  </span><br><span class="line">          -./apps/web.env  </span><br><span class="line">          -/opt/secrets.env</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line"><span class="meta">#</span><span class="bash"> environment	设置环境变量 数组或字典两种格式</span></span><br><span class="line">	eg:</span><br><span class="line">		environment:  </span><br><span class="line">          RACK_ENV: development  </span><br><span class="line">          SESSION_SECRET: </span><br><span class="line"></span><br><span class="line">        environment:  </span><br><span class="line">          - RACK_ENV=development  </span><br><span class="line">          - SESSION_SECRET</span><br><span class="line">             	</span><br><span class="line">             	</span><br><span class="line"><span class="meta">#</span><span class="bash"> healthcheck	通过命令检查容器是否健康运行</span></span><br><span class="line">	eg:</span><br><span class="line">		healthcheck: </span><br><span class="line">          test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]  </span><br><span class="line">          interval: 10s  		# </span><br><span class="line">          timeout: 10s  		# 超时时间</span><br><span class="line">          retries: 3</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line"><span class="meta">#</span><span class="bash"> networks		配置容器连接的网络</span></span><br><span class="line">	eg:</span><br><span class="line">		version: &quot;3&quot;</span><br><span class="line">        services:   </span><br><span class="line"></span><br><span class="line">          some-service:    </span><br><span class="line">            networks:     		# 表示该容器使用some-network和other-network网络</span><br><span class="line">             -some-network     </span><br><span class="line">             -other-network  </span><br><span class="line"></span><br><span class="line">        networks:  				</span><br><span class="line">          some-network:  </span><br><span class="line">          other-network:</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart: always		 	指定容器退出后的重启策略为始终重启</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> read_only: <span class="literal">true</span> 		 	只读模式挂载容器的 root 文件系统,不可对容器内容进行修改</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> stdin_open: <span class="literal">true</span> 		 	打开标准输入，可以接受外部输入</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tty: <span class="literal">true</span>					模拟一个伪终端</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> $ 读取变量 Compose模板文件支持动态读取主机的系统环境变量和当前目录下的.env文件中的变量</span></span><br><span class="line">	eg:</span><br><span class="line">		version: &quot;3&quot;</span><br><span class="line">        services: </span><br><span class="line"></span><br><span class="line">        db:  </span><br><span class="line">          image: &quot;mongo:$&#123;MONGO_VERSION&#125;&quot;	# 从运行它的环境中读取变量$&#123;MONGO_VERSION&#125;的值</span><br><span class="line">        # 如果执行MONGO_VERSION=3.2,docker-compose up 则会启动一个 mongo:3.2 镜像的容器</span><br><span class="line">        # 如果执行MONGO_VERSION=2.8,docker-compose up 则会启动一个 mongo:2.8 镜像的容器</span><br></pre></td></tr></table></figure>

<h4 id="3-3Docker-Compose-模板文件详解"><a href="#3-3Docker-Compose-模板文件详解" class="headerlink" title="3.3Docker-Compose.模板文件详解"></a>3.3Docker-Compose.模板文件详解</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">version           # 指定compose文件的版本</span><br><span class="line">    services      # 定义所有的service信息, services下面的第一级别的key是一个service的名称</span><br><span class="line"> </span><br><span class="line">        build     # 指定包含构建上下文的路径, </span><br><span class="line">        		  # 或作为一个对象，该对象具有 context 和指定的 dockerfile 文件以及 args 参数值</span><br><span class="line">            context      # 指定Dockerfile文件所在的路径</span><br><span class="line">            dockerfile   # 指定context指定的目录下面的Dockerfile的名称(默认为 Dockerfile)</span><br><span class="line">            args         # args: Dockerfile 在 build 过程中需要的参数 </span><br><span class="line">            			 # 等同docker container build --build-arg 的作用</span><br><span class="line">            			 </span><br><span class="line">        command               # 覆盖容器启动后默认执行的命令, 支持 shell 格式和 [] 格式</span><br><span class="line">        container_name        # 指定容器的名称 (等同于 docker run --name 的作用)</span><br><span class="line">        depends_on            # 定义容器启动顺序 </span><br><span class="line">            eg:</span><br><span class="line">                docker-compose up 以依赖顺序启动服务，下面例子中redis和db服务web启动前启动</span><br><span class="line">                默认情况下使用 docker-compose up web 这样的方式启动 web 服务时</span><br><span class="line">                也会启动 redis 和 db 两个服务，因为在配置文件中定义了依赖关系</span><br><span class="line">                </span><br><span class="line">                version: &#x27;3&#x27;</span><br><span class="line">                services:</span><br><span class="line">                    web:</span><br><span class="line">                        build: .</span><br><span class="line">                        depends_on:</span><br><span class="line">                            - db      </span><br><span class="line">                            - redis  </span><br><span class="line">                    redis:</span><br><span class="line">                        image: redis</span><br><span class="line">                    db:</span><br><span class="line">                        image: postgres                             </span><br><span class="line"> </span><br><span class="line">        dns                   # 设置DNS地址(等同于 docker run --dns 的作用)</span><br><span class="line">        dns_search            # 设置DNS搜索域(等同于 docker run --dns-search 的作用)</span><br><span class="line">        entrypoint            # 覆盖容器的默认entrypoint指令 </span><br><span class="line">        					  # 等同于docker run --entrypoint的作用</span><br><span class="line">        env_file              # 从指定文件中读取变量设置为容器中的环境变量, </span><br><span class="line">        					  # 可以是单个值或者一个文件列表environment的值覆盖env_file的值</span><br><span class="line">            文件格式：</span><br><span class="line">                RACK_ENV=development </span><br><span class="line"> </span><br><span class="line">        environment           # 设置环境变量， environment 的值可以覆盖 env_file 的值 </span><br><span class="line">        					  # 等同于 docker run --env 的作用)</span><br><span class="line"> </span><br><span class="line">        expose                # 暴露端口, 但是不能和宿主机建立映射关系 </span><br><span class="line">        					  # 类似于 Dockerfile 的 EXPOSE 指令</span><br><span class="line">        					  </span><br><span class="line">        healthcheck           # v2.1 以上版本, 定义容器健康状态检查</span><br><span class="line">        					  # 类似于 Dockerfile 的 HEALTHCHECK 指令</span><br><span class="line">        					  </span><br><span class="line">            test              	# 检查容器检查状态的命令, 该选项必须是一个字符串或者列表</span><br><span class="line">            				  	# 第一项必须是 NONE, CMD 或 CMD-SHELL, </span><br><span class="line">            				  	# 如果其是一个字符串则相当于 CMD-SHELL 加该字符串</span><br><span class="line">                NONE                # 禁用容器的健康状态检测</span><br><span class="line">                CMD                 # test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]</span><br><span class="line">            interval: 1m30s      # 每次检查之间的间隔时间</span><br><span class="line">            timeout: 10s         # 运行命令的超时时间</span><br><span class="line">            retries: 3           # 重试次数</span><br><span class="line">            start_period: 40s    # v3.4 以上新增的选项, 定义容器启动时间间隔</span><br><span class="line">            disable: true        # true 或 false, 表示是否禁用健康状态检测和　test: NONE 相同</span><br><span class="line"> </span><br><span class="line">        image                 # 指定 docker 镜像, 可以是远程仓库镜像、本地镜像</span><br><span class="line">        init                  # v3.7 中新增的参数,true或false表示是否在容器中运行一个init, 它接收信号并传递给进程</span><br><span class="line"> </span><br><span class="line">        isolation             # 隔离容器技术, 在 Linux 中仅支持 default 值</span><br><span class="line">        labels                # 使用 Docker 标签将元数据添加到容器</span><br><span class="line">        					  # 类似于Dockerfile 中的 LABELS </span><br><span class="line"> </span><br><span class="line">        logging               # 设置容器日志服务</span><br><span class="line">            driver                # 指定日志记录驱动程序, 默认 json-file </span><br><span class="line">            					  # 等同于 docker run --log-driver </span><br><span class="line">            options               # 指定日志的相关参数 (等同于 docker run --log-opt)</span><br><span class="line">                max-size              # 设置单个日志文件的大小, 当到达这个值后会进行日志滚动操作</span><br><span class="line">                max-file              # 日志文件保留的数量</span><br><span class="line">                </span><br><span class="line">        network_mode          # 指定网络模式 (等同于 docker run --net,swarm部署时将忽略该选项) </span><br><span class="line">        networks              # 将容器加入指定网络 (等同于 docker network connect)</span><br><span class="line">        					  # networks 可以位于 compose 文件顶级键和 services 键的二级键	</span><br><span class="line">            aliases               # 同一网络上的容器可以使用服务名称或别名连接到其中一个服务的容器</span><br><span class="line">            ipv4_address      # IP V4 格式</span><br><span class="line">            ipv6_address      # IP V6 格式</span><br><span class="line"> </span><br><span class="line">            示例:</span><br><span class="line">                version: &#x27;3.7&#x27;</span><br><span class="line">                services: </span><br><span class="line">                    test: </span><br><span class="line">                        image: nginx:1.14-alpine</span><br><span class="line">                        container_name: mynginx</span><br><span class="line">                        command: ifconfig</span><br><span class="line">                        networks: </span><br><span class="line">                            app_net:       # 调用下面 networks 定义的 app_net 网络</span><br><span class="line">                            ipv4_address: 172.16.238.10</span><br><span class="line">                networks:</span><br><span class="line">                    app_net:</span><br><span class="line">                        driver: bridge</span><br><span class="line">                        ipam:</span><br><span class="line">                            driver: default</span><br><span class="line">                            config:</span><br><span class="line">                                - subnet: 172.16.238.0/24</span><br><span class="line"> </span><br><span class="line">        pid: &#x27;host&#x27;           # 共享宿主机的 进程空间(PID)</span><br><span class="line">        ports                 # 建立宿主机和容器之间的端口映射关系, ports 支持两种语法格式</span><br><span class="line">            语法格式示例:</span><br><span class="line">                - &quot;3000&quot;               # 暴露容器的3000端口, </span><br><span class="line">                					   # 宿主机的端口由 docker 随机映射一个没有被占用的端口</span><br><span class="line">                - &quot;3000-3005&quot;          # 暴露容器的3000~3005端口,</span><br><span class="line">               						   # 宿主机的端口由docker随机映射没有被占用的端口</span><br><span class="line">                - &quot;8000:8000&quot;          # 容器的 8000 端口和宿主机的 8000 端口建立映射关系</span><br><span class="line">                - &quot;9090-9091:8080-8081&quot;</span><br><span class="line">                - &quot;127.0.0.1:8001:8001&quot;       # 指定映射宿主机的指定地址的  </span><br><span class="line">                - &quot;6060:6060/udp&quot;             # 指定协议</span><br><span class="line"> </span><br><span class="line">            LONG 语法格式示例:(v3.2 新增的语法格式)</span><br><span class="line">                ports:</span><br><span class="line">                    - target: 80                    # 容器端口</span><br><span class="line">                      published: 8080               # 宿主机端口</span><br><span class="line">                      protocol: tcp                 # 协议类型</span><br><span class="line">                      mode: host                    # host 在每个节点上发布主机端口</span><br><span class="line">                      								# ingress对于群模式端口进行负载均衡</span><br><span class="line">                      								</span><br><span class="line">    	stop_signal         # 指定停止容器发送的信号 默认为 SIGTERM </span><br><span class="line">        			    # SIGTERM类似于kill PID; SIGKILL 相当于 kill -9 PID; </span><br><span class="line"> </span><br><span class="line">        sysctls             # 设置容器中的内核参数 (在使用 swarm 部署时将忽略该选项)</span><br><span class="line">        ulimits             # 设置容器的 limit</span><br><span class="line">        userns_mode         # 如果Docker守护程序配置了用户名称空间, 则禁用此服务的用户名称空间 </span><br><span class="line">        volumes             # 定义容器和宿主机的卷映射关系</span><br><span class="line">        					# 和 networks 一样可以位于 services 键的二级键和 compose 顶级键</span><br><span class="line">        					# 如果需要跨服务间使用则在顶级键定义, 在 services 中引用</span><br><span class="line">            语法格式示例:</span><br><span class="line">                volumes:</span><br><span class="line">                   - /var/lib/mysql    # 容器内/var/lib/mysql -&gt; 宿主机的一个随机目录中</span><br><span class="line">                   - /opt/data:/var/lib/mysql  # 容器内/var/lib/mysql -&gt; 宿主机/opt/data</span><br><span class="line">                   - ./cache:/tmp/cache        # 容器内/var/lib/mysql -&gt; 宿主机compose文件</span><br><span class="line">                   - ~/configs:/etc/configs/:ro  # 映射容器宿主机的目录到容器中去 权限只读</span><br><span class="line">                   - datavolume:/var/lib/mysql   # datavolume为volumes顶级键定义的目录直接调用</span><br><span class="line"> </span><br><span class="line">        restart             # 定义容器重启策略</span><br><span class="line">            no                    # 禁止自动重启容器(默认)</span><br><span class="line">            always                # 无论如何容器都会重启</span><br><span class="line">            on-failure            # 当出现 on-failure 报错时, 容器重新启动</span><br><span class="line"> </span><br><span class="line">        	其他选项：</span><br><span class="line">            	domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, 				stdin_open, tty, user, working_dir</span><br><span class="line">            	上面这些选项都只接受单个值和 docker run 的对应参数类似</span><br><span class="line"> </span><br><span class="line">        	对于值为时间的可接受的值：</span><br><span class="line">            	2.5s</span><br><span class="line">            	10s</span><br><span class="line">            	1m30s</span><br><span class="line">            	2h32m</span><br><span class="line">            	5h34m56s</span><br><span class="line"> </span><br><span class="line">            	时间单位: us, ms, s, m， h</span><br><span class="line"> </span><br><span class="line">        	对于值为大小的可接受的值：</span><br><span class="line">            	2b</span><br><span class="line">            	1024kb</span><br><span class="line">            	2048k</span><br><span class="line">            	300m</span><br><span class="line">            	1gb</span><br><span class="line"> </span><br><span class="line">            单位: b, k, m, g 或者 kb, mb, gb</span><br><span class="line"> </span><br><span class="line">    networks          # 定义 networks 信息</span><br><span class="line">        driver        # 指定网络模式, 大多数情况下, 它 bridge 于单个主机和 overlay Swarm 上</span><br><span class="line">            bridge         # Docker 默认使用 bridge 连接单个主机上的网络</span><br><span class="line">            overlay        # overlay 驱动程序创建一个跨多个节点命名的网络</span><br><span class="line">            host           # 共享主机网络名称空间(等同于 docker run --net=host)</span><br><span class="line">            none           # 等同于 docker run --net=none</span><br><span class="line">            </span><br><span class="line">        ipam             # 自定义 IPAM 配置. 这是一个具有多个属性的对象, 每个属性都是可选的</span><br><span class="line">            driver           # IPAM 驱动程序, bridge 或者 default</span><br><span class="line">            config           # 配置项</span><br><span class="line">                subnet           # CIDR格式的子网，表示该网络的网段</span><br><span class="line"> </span><br><span class="line">        external      # 外部网络,如果设置为true则docker-compose up不会尝试创建它,不存在则报错</span><br><span class="line">        name                  # v3.5 以上版本, 为此网络设置名称</span><br></pre></td></tr></table></figure>

<h2 id="4-可视化工具"><a href="#4-可视化工具" class="headerlink" title="4.可视化工具"></a>4.可视化工具</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.0&#x27;</span><br><span class="line">services:</span><br><span class="line">  portainer:</span><br><span class="line">    image: portainer/portainer-ce</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;8001:8000&quot;</span><br><span class="line">    - &quot;9001:9000&quot;</span><br><span class="line">    container_name: portainer</span><br><span class="line">    networks:</span><br><span class="line">      - &quot;portainer&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    - &quot;/root/docker-compose/portainer_data:/data&quot;</span><br><span class="line">    healthcheck:</span><br><span class="line">      test: [&quot;CMD&quot;, &quot;ping&quot;, &quot;-c1&quot;, &quot;-t1&quot;, &quot;portainer&quot;]</span><br><span class="line">      interval: 30s</span><br><span class="line">      timeout: 10s</span><br><span class="line">      retries: 3</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  portainer:</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/18/Dockerfile%E5%8F%8A%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/18/Dockerfile%E5%8F%8A%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7/" class="post-title-link" itemprop="url">Docker数据卷容器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-18 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-18T18:20:25+08:00">2020-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h1><h3 id="1-什么是容器数据卷"><a href="#1-什么是容器数据卷" class="headerlink" title="1.什么是容器数据卷?"></a>1.什么是容器数据卷?</h3><p><strong>docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像!<br>数据?如果数据都在容器种,那么我们容器删除,数据就会丢失! <strong>需求:数据可以持久化</strong></p>
<p>MySQL,容器删了,删库跑路!<strong>需求:MySQL数据可以存储在本地</strong></p>
<p>容器之间可以有一个数据共享的技术,Docker容器中产生的数据,同步到本地!</p>
<p>这就是卷技术!目录的挂载,将我们容器内的目录,挂载到Linux上面!</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623211008399.png" alt="image-20210623211008399"></p>
<p><strong>总结:容器的持久化和同步操作!容器间也是可以数据共享的!</strong></p>
<h3 id="2-使用数据卷"><a href="#2-使用数据卷" class="headerlink" title="2.使用数据卷"></a>2.使用数据卷</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 方式一:</span></span><br><span class="line">	直接用命令来挂载 -v</span><br><span class="line">	</span><br><span class="line">docker run -it -v 主机目录:容器内目录</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost ~]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动起来的时候可以通过docker inspect 容器id 查看详情</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623211509819.png" alt="image-20210623211509819"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试文件同步? 同步</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再来测试</span></span><br><span class="line">	1.停止容器</span><br><span class="line">	2.宿主机上修改文件</span><br><span class="line">	3.启动容器</span><br><span class="line">	4.容器内的数据依旧是同步的!</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 好处:</span></span><br><span class="line">	以后修改只需要在本地修改即可,容器内会自动同步</span><br></pre></td></tr></table></figure>

<h3 id="3-MySQL数据同步"><a href="#3-MySQL数据同步" class="headerlink" title="3.MySQL数据同步"></a>3.MySQL数据同步</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取镜像</span></span><br><span class="line">[root@locahost ~]# docker pull mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行容器,需要做数据挂载</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意:安装启动mysql,要配置密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方测试:docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=密码 -d mysql:版本号</span></span><br><span class="line">			--name 		some-mysql --&gt; 容器名称 j</span><br><span class="line">			-e 			MYSQL_ROOT_PASSWORD --&gt; 设置环境变量,登录使用的密码</span><br><span class="line">			</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动mysql</span></span><br><span class="line">[root@locahost ~]# docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=000128 --name mysql01 mysql:5.7.</span><br><span class="line"></span><br><span class="line">-d 后台运行</span><br><span class="line">-p 端口映射</span><br><span class="line">-v 卷挂载</span><br><span class="line">-e 环境配置</span><br><span class="line">--name 容器名字</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动成功之后,在本地使用navicat测试链接</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> navicat-连接到服务器的3310 --- 3310 和容器内的 3306映射,这个时候我们就可以连接上了</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在本地测试创建一个数据库,查看映射的路径是否同步</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假如我们将容器删除,我们挂载到本地的数据卷依旧没有丢失,这就实现了容器数据持久化功能</span></span><br></pre></td></tr></table></figure>

<h3 id="4-具名和匿名挂载"><a href="#4-具名和匿名挂载" class="headerlink" title="4.具名和匿名挂载"></a>4.具名和匿名挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载</span></span><br><span class="line">	-v 容器内路径</span><br><span class="line">	docker run -d -p --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 产看所有的卷的情况</span></span><br><span class="line">[root@localhost ~]# docker volume ls</span><br><span class="line">local     4bd64dd4b13903597be2e8adb9f10b71ac914275b14ce05a7d3cc73ba450e994</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里发现,这就是匿名挂载,我们在 -v 只写了容器内的路径,没有写容器外的路径</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载</span></span><br><span class="line">	-v 卷名:容器内路径</span><br><span class="line">	docker run -d -P --name nginx02 -v jm-nginx:/etc/nginx nginx</span><br><span class="line">	</span><br><span class="line">[root@localhost ~]# docker run -d -P --name nginx02 -v jm-nginx:/etc/nginx nginx</span><br><span class="line">39679975eb534b9e59af561575acceb4609b0dffacdf39b78a13dbe5042085e2</span><br><span class="line">[root@localhost ~]# docker volume ls</span><br><span class="line">local     jm-nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v 卷名:容器内路径</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下这个卷</span></span><br><span class="line">[root@localhost ~]# docker volume inspect jm-nginx </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-06-23T10:03:13+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/jm-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;jm-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的docker容器内的卷,没有指定目录的情况下都是在 <strong>/var/lib/docker/volumes/xxx/_data</strong><br>通过具名挂载可以方便的找到我们的一个卷,大多数情况使用 <strong>具名挂载</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如何确定是具名挂载还是匿名挂载,亦或是指定路径挂载</span></span><br><span class="line">-v 容器内路径				 # 匿名挂载</span><br><span class="line">-v 卷名:容器内路径		  		# 具名挂载</span><br><span class="line">-v /宿主机路径:/容器内路径      # 指定路径挂载</span><br></pre></td></tr></table></figure>

<p><strong>拓展:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 -v 容器内路径:ro rw 改变读写权限</span></span><br><span class="line">ro		readonly  	# 只读</span><br><span class="line">rw  	readwrite	# 可读可写</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一旦设置了这个容器权限,容器对我们挂载出来的内容就有限定了</span></span><br><span class="line">	docker run -d -p --name nginx01 -v jm-nginx:/etc/mginx:ro nginx</span><br><span class="line">	docker run -d -p --name nginx02 -v jm-nginx:/etc/mginx:rw nginx</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro 只要看到ro就说明这个路径只能通过宿主机来操作,容器内部是无法操作的</span></span><br></pre></td></tr></table></figure>

<h3 id="5-初识Dockerfile"><a href="#5-初识Dockerfile" class="headerlink" title="5.初识Dockerfile"></a>5.初识Dockerfile</h3><p>Dockerfile就是用来构建docker镜像的构建文件,其实就是命令脚本</p>
<p>通过这个脚本可以生成镜像,镜像是一层一层的,脚本是一个个的命令,每个命令都是一层</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 构建命令:</span></span><br><span class="line">	[root@localhost docker-test-volume]# docker build -f /home/docker-test-volume/dockerfile01 -t zqw/centos:v2 .</span><br><span class="line"></span><br><span class="line">        -f 脚本绝对路径或相对路径</span><br><span class="line">        -t 构建的镜像名称:版本</span><br><span class="line">        注意:末尾有个点</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个dockerfile文件 名字可以随机 建议 Dockerfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件中书写以下内容 指令(大写) 参数</span></span><br><span class="line">	FROM centos</span><br><span class="line"></span><br><span class="line">    VOLUME [&quot;/volume01&quot;,&quot;/volume02&quot;]</span><br><span class="line">    CMD echo &quot;---end---&quot;</span><br><span class="line">    CMD /bin/bash</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里每个命令 就是镜像的一层</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623202240010.png" alt="image-20210623202240010"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动自己写的构建的容器</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623202608911.png" alt="image-20210623202608911"></p>
<p>这个目录卷外部一定有一个同步的目录!</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623203026359.png" alt="image-20210623203026359"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前自己构建的容器详情</span></span><br><span class="line">[root@localhost docker-test-volume]# docker inspect ded446dc764b</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623203247634.png" alt="image-20210623203247634"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个文件测试是否同步? 同步</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623204009280.png" alt="image-20210623204009280"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623204106885.png" alt="image-20210623204106885"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这种方式未来使用非常多 因为我们通常会构建自己的镜像</span><br><span class="line">假设构建镜像时没有挂载卷 要手动镜像挂载 -v 卷名:容器内路径</span><br></pre></td></tr></table></figure>

<h4 id="1-实战"><a href="#1-实战" class="headerlink" title="1.实战"></a>1.实战</h4><h5 id="两个或多个mysql同步数据"><a href="#两个或多个mysql同步数据" class="headerlink" title="两个或多个mysql同步数据"></a>两个或多个mysql同步数据</h5><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623204639277.png" alt="image-20210623204639277"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动三个容器 通过自己写的镜像启动</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623222016775.png" alt="image-20210623222016775"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623222337132.png" alt="image-20210623222337132"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623222726463.png" alt="image-20210623222726463"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试:删除mysql01,查看mysql02和mysql03是否还可以访问这个文件? 可以</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623205631302.png" alt="image-20210623205631302"></p>
<p>多个mysql实现数据共享</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@locahost ~]# docker run -d -p 3306:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=000128 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">[root@locahost ~]# docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=000128 --name mysql02 --volume-from mysql01 mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个时候,可以实现两个数据库容器数据同步</span></span><br></pre></td></tr></table></figure>

<h5 id="结论"><a href="#结论" class="headerlink" title="结论:"></a><strong>结论:</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">容器之间配置信息的传递,数据卷容器的生命周期一直持续到没有容器使用为止</span><br><span class="line">但是一旦你持久化到了本地,这时候本地的数据是不会删除的!</span><br></pre></td></tr></table></figure>

<h4 id="2-DockerFile"><a href="#2-DockerFile" class="headerlink" title="2.DockerFile"></a>2.DockerFile</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile</span></span><br><span class="line">	是用来构建docker镜像的文件,命令参数脚本</span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建步骤:</span></span><br><span class="line">	1.编写一个dockerfile文件</span><br><span class="line">	2.docker build构建成为一个镜像</span><br><span class="line">	3.docker run运行镜像</span><br><span class="line">	4.docker push发布镜像(DockerHub,阿里云镜像仓库)</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 很多官方镜像都是基础包,很多功能都没有,通常会自己搭建自己的镜像</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625215142189.png" alt="image-20210625215142189"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625215302203.png" alt="image-20210625215302203"></p>
<h4 id="3-DockerFile构建过程"><a href="#3-DockerFile构建过程" class="headerlink" title="3.DockerFile构建过程"></a>3.DockerFile构建过程</h4><p><strong>基础知识:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 很多指令</span>   </span><br><span class="line">    1.每个保留关键字(指令)都必须是大写字母</span><br><span class="line">    2.执行从上到下顺序执行</span><br><span class="line">    3.# 表示注释</span><br><span class="line">    4.每个指令都会创建提交一个新的镜像层,并提交</span><br></pre></td></tr></table></figure>

<p><strong><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623225049216.png" alt="image-20210623225049216"></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">步骤:开发,部署,运维...缺一不可</span><br><span class="line">    DockerFile:构建文件,定义了一切步骤,源代码</span><br><span class="line">    Dockerimages:通过DockerFile构建生成的镜像,最终发布和运行的产品</span><br><span class="line">    Docker容器:容器就是镜像运行起来提供服务的</span><br></pre></td></tr></table></figure>

<h4 id="4-DockerFile指令"><a href="#4-DockerFile指令" class="headerlink" title="4.DockerFile指令"></a>4.DockerFile指令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM                # 基础镜像,一切从这里开始构建	centos</span><br><span class="line">MAINTAINER			# 镜像是谁写的,姓名+邮箱</span><br><span class="line">RUN					# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD 				# 步骤:mysql镜像,这个mysql压缩包!添加内容</span><br><span class="line">WORKDIR				# 镜像的工作目录</span><br><span class="line">VOLUME				# 挂载的目录</span><br><span class="line">EXPOSE				# 暴露端口配置</span><br><span class="line">CMD 				# 指定这个容器启动的时候要运行的命令,只有一个会生效,可被替代</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令,可以追加命令</span><br><span class="line">ONBUILD				# 当构建一个被继承 DockerFile 这个时候就会运行 ONBUILD 的指令 触发指令</span><br><span class="line">COPY				# 类似ADD,将我们文件拷贝到镜像中</span><br><span class="line">ENV					# 构建的时候设置环境变量!</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623225637275.png" alt="image-20210623225637275"></p>
<h4 id="5-实战测试"><a href="#5-实战测试" class="headerlink" title="5.实战测试"></a>5.实战测试</h4><p>DockerHub 中99%镜像都是从这个基础镜像过来的 FROM scratch,然后配置需要的软件和配置来进行构建的</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623231025969.png" alt="image-20210623231025969"></p>
<h5 id="创建一个自己的centos"><a href="#创建一个自己的centos" class="headerlink" title="创建一个自己的centos"></a>创建一个自己的centos</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.编写DockerFile的文件</span></span><br><span class="line">    FROM centos</span><br><span class="line">    MAINTAINER zqw&lt;1912419375@qq.com&gt;</span><br><span class="line"></span><br><span class="line">    ENV MYPATH /usr/local</span><br><span class="line">    WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">    RUN yum install vim -y</span><br><span class="line">    RUN yum install net-tools -y</span><br><span class="line"></span><br><span class="line">    EXPOSE 8080</span><br><span class="line"></span><br><span class="line">    CMD echo $MYPATH</span><br><span class="line">    CMD echo &quot;---end---&quot;</span><br><span class="line">    CMD /bin/bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.通过文件构建镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令: docker build -f DockerFile文件名 -t 镜像名:版本 .</span></span><br><span class="line">Successfully built c27f723a3ebd</span><br><span class="line">Successfully tagged mycentos:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.测试运行</span></span><br></pre></td></tr></table></figure>

<p><strong>增强之后的镜像</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623234234979.png" alt="image-20210623234234979"></p>
<p>我们可以列出本地镜像的变更历史—-&gt;<strong>docker  history  镜像id</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210623234539171.png" alt="image-20210623234539171"></p>
<h4 id="6-CMD和ENTRYPOINT区别"><a href="#6-CMD和ENTRYPOINT区别" class="headerlink" title="6.CMD和ENTRYPOINT区别"></a>6.CMD和ENTRYPOINT区别</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD 				# 指定这个容器启动的时候要运行的命令,只有一个会生效,可被替代</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令,可以追加命令</span><br></pre></td></tr></table></figure>

<h5 id="测试CMD"><a href="#测试CMD" class="headerlink" title="测试CMD"></a>测试CMD</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写 dockerfile 文件</span></span><br><span class="line">[root@localhost DockerFile]# vim cmdceshi</span><br><span class="line">	FROM centos</span><br><span class="line">	CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">[root@localhost DockerFile]# docker build -f cmdceshi -t cmdceshi:v1 .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> run运行,ls -a 命令生效</span></span><br><span class="line">[root@localhost DockerFile]# docker run cmdceshi:v1 </span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">...</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 想追加一个命令 -l   ls -al</span></span><br><span class="line">[root@localhost DockerFile]# docker run cmdceshi:v1 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cmd的情况下 -l 替换了CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]命令,-l 不是命令所以报错</span></span><br></pre></td></tr></table></figure>

<h5 id="测试ENTRYPOINT"><a href="#测试ENTRYPOINT" class="headerlink" title="测试ENTRYPOINT"></a>测试ENTRYPOINT</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost DockerFile]# vim entrypointceshi</span><br><span class="line">	FROM centos</span><br><span class="line">	ENTRTPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">[root@localhost DockerFile]# docker build -f entrypointceshi -t entrypointceshi:v1 .</span><br><span class="line">Sending build context to Docker daemon  4.608kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 673b7e68516b</span></span><br><span class="line">Removing intermediate container 673b7e68516b</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> f38defef2395</span></span><br><span class="line">Successfully built f38defef2395</span><br><span class="line">Successfully tagged entrypointceshi:v1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost DockerFile]# docker run entrypointceshi:v1</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">...</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 追加命令是直接拼接在 ENTRTPOINT 命令的后面---&gt;ls -al</span></span><br><span class="line">[root@localhost DockerFile]# docker run entrypointceshi:v1 -l</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.   1 root root   6 Jun 24 00:30 .</span><br><span class="line">drwxr-xr-x.   1 root root   6 Jun 24 00:30 ..</span><br><span class="line">-rwxr-xr-x.   1 root root   0 Jun 24 00:30 .dockerenv</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ps: DockerFile中很多命令都十分相似,最好的学习就是对比测试</span></span><br></pre></td></tr></table></figure>

<h4 id="7-实战-BBS项目镜像"><a href="#7-实战-BBS项目镜像" class="headerlink" title="7.实战:BBS项目镜像"></a>7.实战:BBS项目镜像</h4><h5 id="构建过程"><a href="#构建过程" class="headerlink" title="构建过程"></a>构建过程</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 首先创建一个文件夹,在该文件夹下创建一个名为Dockerfile的文件</span></span><br><span class="line"></span><br><span class="line">1.准备好项目,编写Dockerfile文件(官方命名Dockerfile,build自动寻找该文件,就不用-f指定)</span><br><span class="line">	FROM centos</span><br><span class="line">    MAINTAINER zqw&lt;1912419375@qq.com&gt;</span><br><span class="line"></span><br><span class="line">    RUN yum install python3 -y</span><br><span class="line">    RUN pip3 install django==1.11.11 bs4 pymysql pillow</span><br><span class="line"></span><br><span class="line">    ADD BBS05 /root/BBS05/</span><br><span class="line">    WORKDIR /root/BBS05</span><br><span class="line"></span><br><span class="line">    EXPOSE 8000</span><br><span class="line">    ENTRYPOINT python3 manage.py runserver 0.0.0.0:8000</span><br><span class="line">   </span><br><span class="line">2.构建镜像</span><br><span class="line">	[root@localhost BBS02]# docker build -t django:v3</span><br><span class="line"></span><br><span class="line">3.启动并本地测试</span><br><span class="line">	[root@localhost BBS02]# docker run -d -P --name django django:v1 </span><br><span class="line">		977307a52bb3daf0d924ebdcc602b6c9c8c1c3deff1a32aacbfdcee51b10a343</span><br><span class="line">	[root@localhost BBS02]# docker ps</span><br><span class="line">	CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line">	977307a52bb3   django:v1   &quot;/bin/sh -c &#x27;python3…&quot;   3 seconds ago   Up 2 	 seconds   0.0.0.0:49167-&gt;8000/tcp, :::49167-&gt;8000/tcp   django</span><br><span class="line">	浏览器访问随机生成的端口49167</span><br></pre></td></tr></table></figure>

<h5 id="提交镜像至DockerHub"><a href="#提交镜像至DockerHub" class="headerlink" title="提交镜像至DockerHub"></a>提交镜像至DockerHub</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 镜像提交至DockerHub的过程</span></span><br><span class="line">    1.地址hub.docker.com 注册自己的账号!</span><br><span class="line">    2.确定这个账号可以登录</span><br><span class="line">    3.在服务器上提交自己的镜像</span><br><span class="line">    </span><br><span class="line">1.登录dockerhub</span><br><span class="line">	[root@localhost ~]# docker login</span><br><span class="line"></span><br><span class="line">2.提交镜像,docker push</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意:首先应该将镜像名称改成仓库路径(zdd0128/python3)跟上版本</span></span><br><span class="line">	[root@localhost ~]# docker tag 镜像id zdd0128/python3:v1</span><br><span class="line">	[root@localhost ~]# docker push zdd0128/python3:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为容器添加一个版本</span></span><br><span class="line">	docker tag [id] 镜像名称:镜像版本 </span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看帮助</span> </span><br><span class="line">[root@CZP ~]# docker login --help</span><br><span class="line">Usage:	docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>

<h5 id="提交镜像至阿里云仓库"><a href="#提交镜像至阿里云仓库" class="headerlink" title="提交镜像至阿里云仓库"></a>提交镜像至阿里云仓库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 镜像提交至阿里云仓库的过程</span></span><br><span class="line">	1.登陆阿里云</span><br><span class="line">	2.找到容器镜服务</span><br><span class="line">	3.创建名称空间和仓库</span><br><span class="line">	</span><br><span class="line">1.登录阿里云</span><br><span class="line">	[root@localhost ~]# docker login registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"></span><br><span class="line">2.提交镜像,docker push</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意:首先应该将镜像名称改成仓库路径并跟上版本</span></span><br><span class="line">	docker tag 镜像id registry.cn hangzhou.aliyuncs.com/zdd0128/project_bbs:djangov1</span><br><span class="line">	docker push registry.cn-hangzhou.aliyuncs.com/zdd0128/project_bbs:djangov1</span><br></pre></td></tr></table></figure>

<h5 id="小结"><a href="#小结" class="headerlink" title="小结:"></a>小结:</h5><p>镜像构建提交流程图</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625230604263.png" alt="image-20210625230604263"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/12/Docker%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/12/Docker%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">Docker网络</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-12 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-12T18:20:25+08:00">2020-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h1><h3 id="理解Docker0"><a href="#理解Docker0" class="headerlink" title="理解Docker0"></a>理解Docker0</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625091157445.png" alt="image-20210625091157445"></p>
<p><strong>如图三个网络</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">问题:docker 是如何处理网络访问的?</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625091951813.png" alt="image-20210625091951813"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> [root@localhost ~]<span class="comment"># docker run -d -it --name django django:v2</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的内部网络地址 ip addr	容器启动的时候会得到一个 eth0@if34 ip地址,是由docker0分配</span></span><br><span class="line">[root@localhost ~]# docker exec -it django ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">39: eth0@if40: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> 思考:linux主机能不能ping通容器内部</span></span><br><span class="line">[root@localhost /]# ping 172.18.0.3</span><br><span class="line">PING 172.18.0.3 (172.18.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.3: icmp_seq=1 ttl=64 time=0.037 ms</span><br><span class="line">64 bytes from 172.18.0.3: icmp_seq=2 ttl=64 time=0.121 ms</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> linux主机能ping通docker容器内部</span></span><br></pre></td></tr></table></figure>

<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.每启动一个docker容器,docker就会给docker容器分配一个ip,只要安装了docker,就会有一个网卡docker0桥接模式,使用的技术是veth-pair技术</span><br></pre></td></tr></table></figure>

<h5 id="再次测试ip-addr"><a href="#再次测试ip-addr" class="headerlink" title="再次测试ip addr"></a>再次测试ip addr</h5><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625110536039.png" alt="image-20210625110536039"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.再启动一个容器测试,发现又多了一对网卡信息</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625110139708.png" alt="image-20210625110139708"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这些这些容器带来的网卡都是一对一对的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> veth-pair 就是一对的虚拟设备接口,他们都是成对出现的,一端连着协议,一段彼此相连</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正因为这个特性,veth-pair 充当一个桥梁</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OpenStac,Docker容器之间的连接,ovs的连接,都是使用veth-pair技术</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">3.测试django01和django02是否可以ping通</span><br><span class="line">    [root@localhost ~]# docker exec -it django01 ping 172.17.0.3</span><br><span class="line">    PING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">    64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=0.124 ms</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    [root@localhost ~]# docker exec -it django02 ping 172.17.0.2</span><br><span class="line">    PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">    64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.190 ms</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论:</span></span><br><span class="line">	容器之间通过ip地址可以相互ping通</span><br><span class="line">	容器之间通过容器名称不可以相互ping通</span><br></pre></td></tr></table></figure>

<h5 id="网络模型图"><a href="#网络模型图" class="headerlink" title="网络模型图:"></a><strong>网络模型图:</strong></h5><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625114316763.png" alt="image-20210625114316763"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">结论:</span><br><span class="line">	django01 和django02是公用的一个路由器,docker0</span><br><span class="line">	所有的容器不指定网络的情况下,都是docker0路由的,docker会给我们的容器分配一个默认可用ip</span><br></pre></td></tr></table></figure>

<h5 id="小结"><a href="#小结" class="headerlink" title="小结:"></a><strong>小结:</strong></h5><p>​        Docker使用的是linux桥接,宿主机中是一个docker容器的网桥(docker0)</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625114632626.png" alt="image-20210625114632626"></p>
<p>Docker中所有的网络接口都是虚拟的,虚拟的转发效率高(内网传递)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps:只要容器删除对应的网桥一对就没了</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625120358874.png" alt="image-20210625120358874"></p>
<h5 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">高可用!</span><br><span class="line"><span class="meta">#</span><span class="bash">思考:</span></span><br><span class="line">	编写一个微服务,database url=ip,项目不重启,数据库ip换掉了,怎么处理这个问题?</span><br><span class="line">	可以用名称来进行访问容器</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">[root@localhost ~]# docker exec -it django02 ping django01</span><br><span class="line">ping: django01: Name or service not known</span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping django2</span><br><span class="line">ping: django2: Name or service not known</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如何解决容器名称ping不通?</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过--link 容器名 就可以解决网络联通问题</span></span><br><span class="line">[root@localhost ~]# docker run -d -it --name django03 --link django02 django:v2</span><br><span class="line">df78d1a7a88a8466cd4ec5c6015f2cf4a6c2f955eeaeea9fde6edd90f7e5e63f</span><br><span class="line">[root@localhost ~]# docker exec -it django03 ping django02</span><br><span class="line">PING django02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from django02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.143 ms</span><br><span class="line">64 bytes from django02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.077 ms</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 反向可以ping通吗?</span></span><br><span class="line">[root@localhost ~]# docker exec -it django02 ping django03</span><br><span class="line">ping: django03: Name or service not known</span><br></pre></td></tr></table></figure>

<p><strong>探究</strong>:inspect</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625120532263.png" alt="image-20210625120532263"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">hosts:</span><br><span class="line">	配置本地绑定</span><br><span class="line">eg:</span><br><span class="line">	127.0.0.1 ww.baidu.com  # 请求百度会直接转发到127.0.0.1 </span><br><span class="line">	</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看hosts配置 在这里发现原理</span></span><br><span class="line">[root@localhost ~]# docker exec -it django03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	django02 f877b7f32c16  </span><br><span class="line">172.17.0.4	df78d1a7a88a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 本质:--link就是我们在hosts配置中增加了一个172.17.0.3	django02 f877b7f32c16(不建议使用)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更多的是自定义网络,不使用docker0(官方网桥,很多功能局限)</span></span><br><span class="line">	docker0问题:不支持容器名连接访问</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看django02发现没有配置上述相关信息,所以ping不通</span></span><br><span class="line">[root@localhost ~]# docker exec -it django02 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	f877b7f32c16</span><br></pre></td></tr></table></figure>

<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看所有docker网络</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625194038689.png" alt="image-20210625194038689"></p>
<h5 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker网络模式</span>	</span><br><span class="line">    bridge:桥接 docker默认(自己创建也使用bridge模式)</span><br><span class="line">    none:不配置网络</span><br><span class="line">    host:和宿主机共享网络</span><br><span class="line">    container:容器网络连通(用的少,局限性大)</span><br></pre></td></tr></table></figure>

<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们直接启动的命令 --net bridge 而这个就是我们的的docker0</span></span><br><span class="line">docker run -d -p --name django django:v1</span><br><span class="line">docker run -d -p --name django --net bridge django:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker0特点:默认,域名(容器名)不能访问 --link可以打通连接</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自定义一个网络</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> --driver bridge				网络模式</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> --subnet 192.168.0.0/16		子网地址  (192.168.0.2&lt;--&gt;192.168.255.255)</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> -gateway 192.168.0.1			网关</span></span><br><span class="line">[root@localhost ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">0931009e997f0c812b0c65980e4b00464bd498a59390a32719a27af9f5cea936</span><br><span class="line">[root@localhost ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME                    DRIVER    SCOPE</span><br><span class="line">37d9dd39eba1   bridge                  bridge    local</span><br><span class="line">0d2ead8c4bbd   django                  bridge    local</span><br><span class="line">eaa007dae7ac   docker-compose_django   bridge    local</span><br><span class="line">4390198b7777   host                    host      local</span><br><span class="line">f8fedee819b4   ls                      bridge    local</span><br><span class="line">0931009e997f   mynet                   bridge    local</span><br></pre></td></tr></table></figure>

<p><strong>自己的网络:</strong></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625195403214.png" alt="image-20210625195403214"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -d -P --name nginx01 --net mynet nginx</span><br><span class="line">11bf5d03197fcbebc94c23ed5c6f94da2fd56aa66a1b71fc268a907223e0b928</span><br><span class="line">[root@localhost ~]# docker run -d -P --name nginx02 --net mynet nginx</span><br><span class="line">34e466b9717610f8ef64f4461f45045ff2ba75601252edefc7b144233c368b73</span><br><span class="line">[root@localhost ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;0931009e997f0c812b0c65980e4b00464bd498a59390a32719a27af9f5cea936&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-25T19:50:34.325511356+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;11bf5d03197fcbebc94c23ed5c6f94da2fd56aa66a1b71fc268a907223e0b928&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;nginx01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;23a533baca75e6d2c47dc7e7af4e3dd057398597c91df0cf5483be0a9f6cf944&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;34e466b9717610f8ef64f4461f45045ff2ba75601252edefc7b144233c368b73&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;nginx02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;569b06b3d66d39078f124aa3a5a95163e6f7a17a7eb3899cb34e88457846e38c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次测试ping连接</span></span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.070 ms</span><br><span class="line">...</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 现在不使用--link也可以ping名字了</span></span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping django02</span><br><span class="line">PING django02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from django02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.026 ms</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ps:我们自定义的网络docker都已经帮我们维护好了对应关系,推荐使用</span><br><span class="line">好处:</span><br><span class="line">	redis:不同的集群使用不同的网络,保证集群是安全和健康的</span><br><span class="line">	mysql:不同的集群使用不同的网络,保证集群是安全和健康的</span><br></pre></td></tr></table></figure>

<h3 id="网络联通"><a href="#网络联通" class="headerlink" title="网络联通"></a>网络联通</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 不同网络之间容器是不可以相互ping通的</span></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                                         NAMES</span><br><span class="line">98c858bfaf24   django:v1   &quot;/bin/sh -c &#x27;python3…&quot;   27 seconds ago   Up 26 seconds   0.0.0.0:49165-&gt;8000/tcp, :::49165-&gt;8000/tcp   django2</span><br><span class="line">06348589c8dc   django:v1   &quot;/bin/sh -c &#x27;python3…&quot;   32 seconds ago   Up 31 seconds   0.0.0.0:49164-&gt;8000/tcp, :::49164-&gt;8000/tcp   django1</span><br><span class="line">9a8f3e131abc   django:v1   &quot;/bin/sh -c &#x27;python3…&quot;   8 minutes ago    Up 8 minutes    0.0.0.0:49163-&gt;8000/tcp, :::49163-&gt;8000/tcp   django02</span><br><span class="line">90dbc178391d   django:v1   &quot;/bin/sh -c &#x27;python3…&quot;   8 minutes ago    Up 8 minutes    0.0.0.0:49162-&gt;8000/tcp, :::49162-&gt;8000/tcp   django01</span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping django2</span><br><span class="line">ping: django2: Name or service not known</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625202248049.png" alt="image-20210625202248049"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625201003268.png" alt="image-20210625201003268"></p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625201136426.png" alt="image-20210625201136426"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试打通 django1 - mynet</span></span><br><span class="line">[root@localhost ~]# docker network connect mynet django1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连通之后就是将 django1 放到了 mynet 网络下</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个容器两个IP地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云服务:公网ip,私网ip</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625201433570.png" alt="image-20210625201433570"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> django1 连通ok</span></span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping django1</span><br><span class="line">PING django1 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from django1.mynet (192.168.0.4): icmp_seq=1 ttl=64 time=0.043 ms</span><br><span class="line">...</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> django2 是依旧打不通的</span></span><br><span class="line">[root@localhost ~]# docker exec -it django01 ping django2</span><br><span class="line">ping: django2: Name or service not known</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论:假设要跨网络操作别人,就需要使用 docker network connect 连通...</span></span><br></pre></td></tr></table></figure>

<h3 id="实战-部署Redis集群"><a href="#实战-部署Redis集群" class="headerlink" title="实战:部署Redis集群"></a>实战:部署Redis集群</h3><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625202736139.png" alt="image-20210625202736139"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建网卡</span></span><br><span class="line">docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">    [root@localhost ~]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">    4f3b3875a14fe3377640ec1f67cc8c36929b04f855924ca4601e0bc23473b8ef</span><br><span class="line">    [root@localhost ~]# docker network ls</span><br><span class="line">    NETWORK ID     NAME                    DRIVER    SCOPE</span><br><span class="line">    37d9dd39eba1   bridge                  bridge    local</span><br><span class="line">    402236585e48   none                    null      local</span><br><span class="line">    4f3b3875a14f   redis                   bridge    local</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过脚本创建六个redis配置(直接粘贴回车)</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过脚本运行六个redis(直接粘贴回车)</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf </span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建集群配置</span></span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16</span><br><span class="line">:6379  --cluster-replicas 1  </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 6388012edd045565b10c4888342f32f912e4d794 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 8ee73c4a63da38012fe53e64b37309b7b238751b 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 941a3b5e627d34abab777424b0ae744896d1de7e 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: d912cfbdb0b5d747dc65eb8d78bc63c217f5574c 172.38.0.14:6379</span><br><span class="line">   replicates 941a3b5e627d34abab777424b0ae744896d1de7e</span><br><span class="line">S: 38a0007b20f12a45a7d97aac4e336c50e37a47bf 172.38.0.15:6379</span><br><span class="line">   replicates 6388012edd045565b10c4888342f32f912e4d794</span><br><span class="line">S: 36c3c37d4f10af8b367ea43d73b2e765672768c5 172.38.0.16:6379</span><br><span class="line">   replicates 8ee73c4a63da38012fe53e64b37309b7b238751b</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">....</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 6388012edd045565b10c4888342f32f912e4d794 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 36c3c37d4f10af8b367ea43d73b2e765672768c5 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8ee73c4a63da38012fe53e64b37309b7b238751b</span><br><span class="line">M: 8ee73c4a63da38012fe53e64b37309b7b238751b 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 38a0007b20f12a45a7d97aac4e336c50e37a47bf 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 6388012edd045565b10c4888342f32f912e4d794</span><br><span class="line">S: d912cfbdb0b5d747dc65eb8d78bc63c217f5574c 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 941a3b5e627d34abab777424b0ae744896d1de7e</span><br><span class="line">M: 941a3b5e627d34abab777424b0ae744896d1de7e 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">停止redis并删除容器</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker stop redis-$&#123;port&#125;; \</span><br><span class="line">docker rm redis-$&#123;port&#125;;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker exec -it redis-1 /bin/sh #redis默认没有bash</span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379  --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<p><strong>docker搭建redis集群完成</strong>:</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625204849552.png" alt="image-20210625204849552"></p>
<p><strong>使用docker之后,所有技术都会慢慢变得简单起来</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/10/Docker%E9%95%9C%E5%83%8F%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/10/Docker%E9%95%9C%E5%83%8F%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Docker镜像详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-10 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-10T18:20:25+08:00">2020-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Docker镜像详解"><a href="#Docker镜像详解" class="headerlink" title="Docker镜像详解"></a>Docker镜像详解</h1><h3 id="1-镜像是什么"><a href="#1-镜像是什么" class="headerlink" title="1.镜像是什么?"></a>1.镜像是什么?</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 镜像是什么?</span></span><br><span class="line">	镜像就是一个轻量级的,可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码,运行时,库,环境变量和配置文件。</span><br><span class="line">	所有的应用,直接打包docker镜像,就可以直接跑起来!</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如何得到镜像:</span></span><br><span class="line">    1.从远程仓库下载</span><br><span class="line">    2.朋友拷贝给你</span><br><span class="line">    3.自己制作一个镜像 DockerFile</span><br></pre></td></tr></table></figure>

<h3 id="2-Docker镜像加载原理"><a href="#2-Docker镜像加载原理" class="headerlink" title="2.Docker镜像加载原理"></a>2.Docker镜像加载原理</h3><h4 id="1-UnionFs-联合文件系统查询"><a href="#1-UnionFs-联合文件系统查询" class="headerlink" title="1.UnionFs(联合文件系统查询)"></a>1.UnionFs(联合文件系统查询)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> UnionFs(联合文件系统查询)</span></span><br><span class="line">	我们下载的时候看到的一层一层就是这个</span><br><span class="line"></span><br><span class="line">	UnionFs(联合文件系统): Union文件系统(UnionFS)是一种分层,轻量级并且高性能的文件系统,它支持对文件系统的修改作为一次提交来一层层的叠加,同时可以将不同目录挂载到同一个虚拟文件系统下,Union文件系统是Docker镜像的基础,镜像可以通过分层来进行继承,基于基础镜像(没有父镜像),可以制作各种具体的应用镜像</span><br><span class="line"></span><br><span class="line">特性: </span><br><span class="line">	一次同时加载多个文件系统,但从外面看起来,只能看到一个文件系统,联合加载会把各层文件系统叠加起来,这样最终的文件系统会包含所有底层的文件和目录结构</span><br></pre></td></tr></table></figure>

<h4 id="2-Docker镜像加载原理-1"><a href="#2-Docker镜像加载原理-1" class="headerlink" title="2.Docker镜像加载原理"></a>2.Docker镜像加载原理</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker的镜像实际上由一层一层的文件系统组成,这种层级的文件系统UnionFS</span><br><span class="line"></span><br><span class="line">bootfs(boot file system)主要包含bootlloader和kernel,bootfs主要是引导加载kernel,Linux刚启动时会加载bootfs文件系统,在docker镜像的最底层是bootfs,这一层与我们典型的Linux/Unix系统是一样的,包含boot加载器和内核,当boot加载完成之后整个内核就在内存中了,此时内存的使用权已由bootfa转交给内核,此时系统也会卸载bootfs</span><br><span class="line"></span><br><span class="line">rootfs(root file system),在bootfs之上,包含的就是典型Linux系统中的/dev, /proc,/bin, /etc等标准目录和文件,rootfs就是各种不同的操作系统发行版,比如Ubuntu, CentOS等等</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213313404.png" alt="image-20210625213313404"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G,为什么Docker这里才200M?</p>
<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213335327.png" alt="image-20210625213335327"></p>
<p>对于一个精简的OS,rootfs可以很小,只需要包含基本的命令,工具和程序库就可以了,因为底层直接用Host的kernel,自己只需要提供rootFS就可以了。由此可见对于不同的linux发行版,bootfs基本是一致的,rootfs会有差别,因此不同的发行版可以共用bootfs</p>
<h4 id="3-分层理解"><a href="#3-分层理解" class="headerlink" title="3.分层理解"></a>3.分层理解</h4><h5 id="分层的镜像"><a href="#分层的镜像" class="headerlink" title="分层的镜像"></a>分层的镜像</h5><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213443543.png" alt="image-20210625213443543"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 思考: 为什么Docker镜像要采用这种分层的结构呢?</span></span><br><span class="line">	最大好处,我觉得莫过于资源共享了!比如有多个镜像都从相同的Base镜像构建而来,那么宿主机</span><br><span class="line"></span><br><span class="line">只需在磁盘上保留一份base镜像,同时内存中也只需要加载一份base镜像,这样就可以为所有的容器服务了,而且镜像的每一层都可以被共享</span><br><span class="line"></span><br><span class="line">查看镜像分层的方式可以通过 docker image inspect 命令</span><br><span class="line"></span><br><span class="line">[root@CZP ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                 latest              2622e6cca7eb        32 hours ago        132MB</span><br><span class="line">portainer/portainer   latest              cd645f5a4769        9 days ago          79.1MB</span><br><span class="line">redis                 latest              36304d3b4540        13 days ago         104MB</span><br><span class="line">...</span><br><span class="line">[root@CZP ~]# docker image inspect redis</span><br><span class="line">[</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:ffc9b21953f4cd7956cdf532a5db04ff0a2daa7475ad796f1bad58cfbaf77a07&quot;,</span><br><span class="line">                &quot;sha256:d4e681f320297add0ede0554524eb9106d8c3eb3a43e6e99d79db6f76f020248&quot;,</span><br><span class="line">                &quot;sha256:59bd5a888296b623ae5a9efc8f18285c8ac1a8662e5d3775a0d2d736c66ba825&quot;,</span><br><span class="line">                &quot;sha256:c112794a20c5eda6a791cbec8700fb98eab30671a2248ac7e2059b475c46c45f&quot;,</span><br><span class="line">                &quot;sha256:bf8b736583f08c02b92f8a75ac5ea181e4d74107876177caa80ddad8b6b57a72&quot;,</span><br><span class="line">                &quot;sha256:6ef422d19214800243b28017d346c7ab9bfe63cb198a39312d1714394b232449&quot;</span><br><span class="line">            ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h5 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">	所有的镜像都起始于一个基础镜像层,当进行修改或增加新的内容时,就会在当前镜像层之上,创建一个新的镜像层</span><br><span class="line"></span><br><span class="line">	举一个简单的例子,假如基于Ubuntu Linux 16.64创建一个新的镜像,这就是新镜像的第一层,如果在该镜像中添加python包,就会在该镜像之上创建第二个镜像层; 如果继续添加一个安全补丁,就会创建第三个镜像层</span><br><span class="line"></span><br><span class="line">该镜像已经包含3个镜像层,如下图所示(这只是一个简单的例子)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213609656.png" alt="image-20210625213609656"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在添加额外的镜像层的同时,镜像始终保持是当前所有镜像的组合,理解这一点非常重要,下图举了一个简单的例子,每个镜像层包含3个文件,而镜像包含了两个镜像层的6个文件</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213631474.png" alt="image-20210625213631474"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">上图中的镜像层跟之前图中的略有区别,主要是便于展示文件</span><br><span class="line"></span><br><span class="line">下图中展示了一个稍微复杂的三层镜像,在外部看来整个镜像只有6个文件,这是因为最上层的文件7是文件5的一个更新版本</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213700157.png" alt="image-20210625213700157"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	这种情况下,上层镜像层中的文件覆盖了底层镜像层中的文件,这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</span><br><span class="line"></span><br><span class="line">	Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多层镜像层对外展示为统一的文件系统</span><br><span class="line"></span><br><span class="line">	Lunux上可用的存储引擎有AUFS,Overlay2,Device Mapper,Btrfs以及ZFS,顾名思义,每种存储引擎都是基于Linux对应的文件系统或者块设备技术,并且每种存储引擎都有其独有的性能特点</span><br><span class="line"></span><br><span class="line">	Docker在Windows上仅支持windosfilter一种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]</span><br><span class="line"></span><br><span class="line">下图展示了与系统显示相同的三层镜像,所有的镜像层堆叠合并,对外提供统一的视图层</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213730502.png" alt="image-20210625213730502"></p>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Docker镜像都是只读的,当容器启动时,一个新的可写层被加载到镜像的顶部!</span><br><span class="line">这一层就是我们通常所说的容器层,容器之下的都叫镜像层</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625213822039.png" alt="image-20210625213822039"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如何提交一个自己的镜像?</span></span><br></pre></td></tr></table></figure>

<h3 id="3-commit镜像-构建镜像"><a href="#3-commit镜像-构建镜像" class="headerlink" title="3.commit镜像(构建镜像)"></a>3.commit镜像(构建镜像)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker commit 提交容器成为一个新的镜像</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">命令和git原理类似</span></span><br><span class="line">	docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名:[tag]</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> eg:</span></span><br><span class="line">	[root@CZP ~]# docker ps</span><br><span class="line">94b00b6f6172        tomcat:9.0            &quot;catalina.sh run&quot;        17 hours ago        Up 17 hours         0.0.0.0:8080-&gt;8080/tcp                           tomcat</span><br><span class="line">d458bc50a808        nginx                 &quot;/docker-entrypoint.…&quot;   18 hours ago        Up 18 hours         0.0.0.0:80-&gt;80/tcp                               nginx01</span><br><span class="line">63d4c4115212        36304d3b4540          &quot;docker-entrypoint.s…&quot;   22 hours ago        Up 22 hours         0.0.0.0:6379-&gt;6379/tcp                           redis</span><br><span class="line">[root@CZP ~]# docker commit -a=&quot;czp&quot; -m=&quot;add basic webapps app&quot; 94b00b6f6172 tomcat_9.0:1.0</span><br><span class="line">sha256:75e6ea173695b146c9ddf9d5865e7bdeb78e69c84d2d3520e516cd9f498a1e9a</span><br><span class="line">[root@CZP ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat_9.0            1.0                 75e6ea173695        8 seconds ago       652MB</span><br><span class="line">nginx                 latest              2622e6cca7eb        33 hours ago        132MB</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/10/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/10/Redis/" class="post-title-link" itemprop="url">Redis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-10 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-10T18:20:25+08:00">2020-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="1-Redis介绍和安装"><a href="#1-Redis介绍和安装" class="headerlink" title="1.Redis介绍和安装"></a>1.Redis介绍和安装</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考:</span></span><br><span class="line">	https://www.cnblogs.com/liuqingzheng/articles/<span class="number">9833534.</span>html</span><br><span class="line">        </span><br><span class="line"><span class="comment"># redis:</span></span><br><span class="line">	是一个key-value存储系统,非关系型数据库(nosql数据库),数据存在于内存中,缓存数据库</span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis支持5大数据类型:</span></span><br><span class="line">	字符串,列表,<span class="built_in">hash</span>(字典),集合,有序集合</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Redis有哪些好处?</span></span><br><span class="line">	<span class="number">1.</span>速度快：缓存数据库(内存)</span><br><span class="line">    <span class="number">2.</span>支持丰富数据类型：<span class="number">5</span>大数据类型</span><br><span class="line">    <span class="number">3.</span>支持事务：通过管道实现(单实例上有效)</span><br><span class="line">    <span class="number">4.</span>丰富的特性：可用于缓存,消息队列，按key设置过期时间，过期自动删除</span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis对比memcached?</span></span><br><span class="line">	相同点:</span><br><span class="line">        两者都是内存数据库</span><br><span class="line">    不同点:</span><br><span class="line">        <span class="number">1.</span>redis类型丰富,有<span class="number">5</span>大类型,但memcached只支持字符串类型</span><br><span class="line">    	<span class="number">2.</span>redis支持持久化,但memcached不支持持久化</span><br><span class="line">    	<span class="number">3.</span>redis速度比mencached快</span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis特点</span></span><br><span class="line">	<span class="number">1.</span>可以持久化</span><br><span class="line">	<span class="number">2.</span>单线程，单进程</span><br><span class="line">    	-redis最新版本是<span class="number">6.</span>x</span><br><span class="line">        -<span class="number">6.</span>x之前是单线程，单进程</span><br><span class="line">        </span><br><span class="line"><span class="comment"># redis单线程为什么这么快？并发量：10w(实际6w左右)</span></span><br><span class="line">	<span class="number">1.</span>纯内存操作</span><br><span class="line">    <span class="number">2.</span>使用了io多路复用模型(自身使用epoll   windows使用select)</span><br><span class="line">    <span class="number">3.</span>因为是单线程，不存在线程间切换，节省资源</span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis服务:</span></span><br><span class="line">	客户端,服务端(同mysql,是存数据的地方)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># redis安装:</span></span><br><span class="line">	<span class="number">1.</span>redis使用c语言写的,开源,它不支持windows</span><br><span class="line">    <span class="number">2.</span>第三方,基于redis源码，自行修改，编译成windows平台可以运行的(win平台：维护到 <span class="number">3.</span>x版本),以<span class="number">3.</span>x为例</span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis官网:</span></span><br><span class="line">	http://redis.cn/</span><br><span class="line">    	<span class="number">1.</span>官网提供了c源码，需要自行下载，编译</span><br><span class="line">    	<span class="number">2.</span>win平台,自己找一个安装包(非官方提供)</span><br><span class="line">        </span><br><span class="line">    https://github.com/microsoftarchive/redis</span><br><span class="line">        <span class="number">1.</span>Redis-x64-<span class="number">3.2</span><span class="number">.100</span>.msi：</span><br><span class="line">        	安装一路下一步</span><br><span class="line">        <span class="number">2</span>图形化界面的客户端：redis-desktop-manager：</span><br><span class="line">        	一开始免费，后来收费了;安装一路下一步</span><br><span class="line">        </span><br><span class="line"><span class="comment"># redis监听端口默认是:</span></span><br><span class="line">	<span class="number">6379</span></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动redis服务</span></span><br><span class="line">	方法一:</span><br><span class="line">        在任意路径下敲：redis-server    <span class="comment"># 等同于mysqld</span></span><br><span class="line">    方法二:</span><br><span class="line">        win平台，已经做成了服务，把服务启动即可</span><br><span class="line">    	-<span class="string">&quot;D:\Program Files\Redis\redis-server.exe&quot;</span> --service-run <span class="string">&quot;D:\Program Files\Redis\redis.windows-service.conf&quot;</span></span><br><span class="line"><span class="comment"># 客户端连接</span></span><br><span class="line">	-第一种方式：在任意路径下敲：redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">6379</span>   <span class="comment"># 等同于  mysql -h -P</span></span><br><span class="line">    	-如果连本地的<span class="number">6379</span>端口，直接敲redis-cli</span><br><span class="line">    -使用客户端连接</span><br><span class="line">    -使用python操作：pip3 install redis</span><br></pre></td></tr></table></figure>

<h2 id="1-2普通连接和连接池"><a href="#1-2普通连接和连接池" class="headerlink" title="1.2普通连接和连接池"></a>1.2普通连接和连接池</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis普通连接</span></span><br><span class="line">	<span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line">	<span class="comment"># 1.先拿到一个redis连接</span></span><br><span class="line">	conn=Redis(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,port=<span class="number">6380</span>) <span class="comment"># 自行指定端口(默认6379)</span></span><br><span class="line">	<span class="comment"># conn=Redis()</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment"># 2.操作redis</span></span><br><span class="line">	conn.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;lqz&#x27;</span>)	<span class="comment"># set设置值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3.关闭redis</span></span><br><span class="line">	conn.close()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># redis连接池</span></span><br><span class="line">	<span class="keyword">import</span> redis</span><br><span class="line">	<span class="comment"># 1.生成一个连接数为3的连接池</span></span><br><span class="line">    POOL=redis.ConnectionPool(max_connections=<span class="number">3</span>,host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">6380</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 2.从连接池中拿出一个连接，给conn</span></span><br><span class="line">	conn=redis.Redis(connection_pool=POOL)</span><br><span class="line">    </span><br><span class="line">	<span class="comment"># 3.操作redis</span></span><br><span class="line">	conn.get(<span class="string">&#x27;name&#x27;</span>) <span class="comment"># get获取值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.关闭redis</span></span><br><span class="line">	conn.close()  <span class="comment"># 不是关闭连接，把该连接，放回到连接池</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把POOL以单例形式使用(以模块导入方式)</span></span><br><span class="line">    <span class="keyword">import</span> redis</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">from</span> pool <span class="keyword">import</span> POOL 	<span class="comment"># 以模块形式导入，是天然单例</span></span><br><span class="line">    conn=redis.Redis(connection_pool=POOL)</span><br><span class="line">    <span class="comment"># conn2=redis.Redis(connection_pool=POOL)</span></span><br><span class="line">    <span class="comment"># conn3=redis.Redis(connection_pool=POOL)</span></span><br><span class="line">    <span class="comment"># conn4=redis.Redis(connection_pool=POOL)</span></span><br><span class="line"></span><br><span class="line">    conn.<span class="built_in">set</span>(<span class="string">&#x27;age&#x27;</span>,<span class="number">19</span>)</span><br><span class="line">    conn.close()  <span class="comment"># 不是关闭连接，把该连接，放回到连接池</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Redis-五大数据类型"><a href="#3-Redis-五大数据类型" class="headerlink" title="3.Redis 五大数据类型"></a>3.Redis 五大数据类型</h2><h3 id="3-1字符串"><a href="#3-1字符串" class="headerlink" title="3.1字符串"></a>3.1字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>(name, value, ex=<span class="literal">None</span>, px=<span class="literal">None</span>, nx=<span class="literal">False</span>, xx=<span class="literal">False</span>)   <span class="comment"># 重点	设值</span></span><br><span class="line">mset(*args, **kwargs)         		<span class="comment"># 重点	批量设值</span></span><br><span class="line">get(name)                    		<span class="comment"># 重点	取值</span></span><br><span class="line">mget(keys, *args)             		<span class="comment"># 重点	批量取值</span></span><br><span class="line">strlen(name)                     	<span class="comment"># 重点	获取&#x27;name&#x27;字节长度</span></span><br><span class="line">incr(self, name, amount=<span class="number">1</span>)          <span class="comment"># 重点	指定&#x27;name&#x27;自增,默认自增一</span></span><br><span class="line"></span><br><span class="line">setnx(name, value)</span><br><span class="line">setex(name, value, time)</span><br><span class="line">psetex(name, time_ms, value)</span><br><span class="line">getset(name, value)</span><br><span class="line">getrange(key, start, end)</span><br><span class="line">setrange(name, offset, value)</span><br><span class="line">setbit(name, offset, value)</span><br><span class="line">getbit(name, offset)</span><br><span class="line">bitcount(key, start=<span class="literal">None</span>, end=<span class="literal">None</span>)</span><br><span class="line">incrbyfloat(self, name, amount=<span class="number">1.0</span>)</span><br><span class="line">decr(self, name, amount=<span class="number">1</span>)</span><br><span class="line">append(key, value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn=redis.Redis()</span><br><span class="line"></span><br><span class="line"><span class="comment"># set:放字符串值</span></span><br><span class="line">	参数详解:</span><br><span class="line">		ex:过期时间（秒）</span><br><span class="line">		px:过期时间（毫秒）</span><br><span class="line">		nx:若设置为<span class="literal">True</span>,只有name不存在时,当前<span class="built_in">set</span>操作才执行,存在,不修改,执行无效果</span><br><span class="line">		xx:若设置为<span class="literal">True</span>,只有name存在时,当前<span class="built_in">set</span>操作才执行，存在,修改,不存在,不会设置新值</span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;,ex=3)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;,px=3000)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;lqz&#x27;,nx=True)</span></span><br><span class="line"><span class="comment"># res=conn.set(&#x27;name&#x27;,&#x27;19&#x27;,xx=True)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get 获取值</span></span><br><span class="line"><span class="comment"># res=conn.get(&#x27;name&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mset 批量设置值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.mset(&#123;&#x27;name&#x27;:&#x27;lqz&#x27;,&#x27;age&#x27;:19,&#x27;sex&#x27;:&#x27;男&#x27;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mget  批量获取值</span></span><br><span class="line"><span class="comment"># res=conn.mget([&#x27;name&#x27;,&#x27;age&#x27;])</span></span><br><span class="line"><span class="comment"># res=conn.mget(&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.setex(name, value, time)</span></span><br><span class="line"><span class="comment"># conn.psetex(name, time_ms, value)</span></span><br><span class="line"><span class="comment"># conn.set(name, valeu, px=time)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.getset(&#x27;name&#x27;, &#x27;刘亦菲&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.getrange(&#x27;name&#x27;,3,5)  #前闭后闭区间 拿字节</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># print(str(res,encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.setrange(&#x27;name&#x27;,0,&#x27;lqzzzzzzz&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.setrange(&#x27;name&#x27;,0,&#x27;qq&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##获取和设置比特位</span></span><br><span class="line"><span class="comment"># setbit(name, offset, value)</span></span><br><span class="line"><span class="comment"># getbit(name, offset)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(conn.getbit(&#x27;name&#x27;,3))</span></span><br><span class="line"><span class="comment"># conn.setbit(&#x27;name&#x27;,0,1)</span></span><br><span class="line"><span class="comment"># print(conn.getbit(&#x27;name&#x27;,0))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(conn.strlen(&#x27;name&#x27;))  # 指的是字节     获取字节长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.incr(&#x27;age&#x27;)   # 让该键自增1</span></span><br><span class="line"><span class="comment"># conn.incrby(&#x27;age&#x27;,3)   # 让该键自增3</span></span><br><span class="line"><span class="comment"># conn.incrbyfloat(&#x27;age&#x27;, amount=1.1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.append(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;nb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="3-2hash-字典"><a href="#3-2hash-字典" class="headerlink" title="3.2hash(字典)"></a>3.2hash(字典)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">hset(name, key, value)   			<span class="comment"># 重点	设值</span></span><br><span class="line">hmset(name, mapping)   				<span class="comment"># 重点	批量设值</span></span><br><span class="line">hget(name,key)        				<span class="comment"># 重点	取值</span></span><br><span class="line">hmget(name, keys, *args)  			<span class="comment"># 重点	批量取值</span></span><br><span class="line">hlen(name)              			<span class="comment"># 重点	计算长度</span></span><br><span class="line">hincrby(name, key, amount=<span class="number">1</span>)   		<span class="comment"># 重点	自增</span></span><br><span class="line"></span><br><span class="line">hgetall(name)</span><br><span class="line">hkeys(name)</span><br><span class="line">hvals(name)</span><br><span class="line">hexists(name, key)</span><br><span class="line">hdel(name,*keys)</span><br><span class="line">hincrbyfloat(name, key, amount=<span class="number">1.0</span>)</span><br><span class="line">hscan(name, cursor=<span class="number">0</span>, match=<span class="literal">None</span>, count=<span class="literal">None</span>)</span><br><span class="line">hscan_iter(name, match=<span class="literal">None</span>, count=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn=redis.Redis()</span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.hset(&#x27;users&#x27;,&#x27;name&#x27;,&#x27;egon&#x27;)</span></span><br><span class="line"><span class="comment"># conn.hset(&#x27;users&#x27;,&#x27;age&#x27;,&#x27;19&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hget(&#x27;users&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hget(&#x27;users&#x27;,&#x27;name&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.hmset(&#x27;h1&#x27;,&#123;&#x27;name&#x27;:&#x27;lqz&#x27;,&#x27;age&#x27;:19&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hmget(&#x27;h1&#x27;,[&#x27;name&#x27;,&#x27;age&#x27;])</span></span><br><span class="line"><span class="comment"># res=conn.hmget(&#x27;h1&#x27;,&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hlen(&#x27;users&#x27;)  # 统计键值对的个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hkeys(&#x27;users&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hvals(&#x27;users&#x27;)</span></span><br><span class="line"><span class="comment"># hvals(name)</span></span><br><span class="line"><span class="comment"># print(str(res[2],encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hexists(&#x27;users&#x27;,&#x27;age1&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.hdel(&#x27;users&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.hincrby(&#x27;h1&#x27;, &#x27;age&#x27;,7)</span></span><br><span class="line"><span class="comment"># conn.hincrbyfloat(&#x27;h1&#x27;, &#x27;age&#x27;, amount=-1.01)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(1000):</span></span><br><span class="line"><span class="comment">#     conn.hset(&#x27;htest&#x27;,i,&#x27;第%s个鸡蛋&#x27;%i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###hash（字典）类型是无序的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hgetall(&#x27;htest&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.hscan(&#x27;htest&#x27;, cursor=0,count=500)  # 用的少</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># res=conn.hscan(&#x27;htest&#x27;, cursor=254,count=499)  # 用的少</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># res=conn.hscan(&#x27;htest&#x27;, cursor=511,count=2)  # 用的少</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># print(len(res[1]))</span></span><br><span class="line"></span><br><span class="line">res=conn.hscan_iter(<span class="string">&#x27;htest&#x27;</span>, count=<span class="number">20</span>)   <span class="comment"># 把hash类型的所有数据都打印出来，比hgetall节省内存</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(item[<span class="number">1</span>],encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="3-3列表"><a href="#3-3列表" class="headerlink" title="3.3列表"></a>3.3列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">llen(name)           					<span class="comment"># 重点	计算长度</span></span><br><span class="line">linsert(name, where, refvalue, value)  	<span class="comment"># 重点	指定位置插值</span></span><br><span class="line"></span><br><span class="line">lpush(name,values)   			<span class="comment"># 设值,自左向右依次放在第一个位置</span></span><br><span class="line">rpush(name,values)   			<span class="comment"># 设值,自右向左依次放在第一个位置</span></span><br><span class="line">lpushx(name,value)				<span class="comment"># 设值,从第一个位置放入</span></span><br><span class="line">lset(name, index, value)		<span class="comment"># 指定索引位置并放入值</span></span><br><span class="line">lrem(name, count, value)        <span class="comment"># 删除值</span></span><br><span class="line">lpop(name)             			<span class="comment"># 从左侧弹出</span></span><br><span class="line">lindex(name, index)</span><br><span class="line">lrange(name, start, end)		<span class="comment"># 取索引范围内的值,前闭后闭</span></span><br><span class="line">ltrim(name, start, end)</span><br><span class="line">rpoplpush(src, dst)</span><br><span class="line">blpop(keys, timeout)          	<span class="comment"># 阻塞式弹出</span></span><br><span class="line">brpoplpush(src, dst, timeout=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn=redis.Redis()</span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.lpush(&#x27;list1&#x27;,&#x27;1&#x27;)  #左侧插入，上部</span></span><br><span class="line"><span class="comment"># conn.lpush(&#x27;list1&#x27;,&#x27;lqz&#x27;)</span></span><br><span class="line"><span class="comment"># conn.rpush(&#x27;list1&#x27;,&#x27;egon&#x27;)  #右侧插入，下部</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.rpushx(&#x27;list1&#x27;,&#x27;刘亦菲&#x27;)  # 只有name存在才能插入</span></span><br><span class="line"><span class="comment"># conn.lpushx(&#x27;list2&#x27;,&#x27;刘亦菲&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(conn.llen(&#x27;list1&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.linsert(&#x27;list1&#x27;,&#x27;before&#x27;,&#x27;egon&#x27;,&#x27;迪丽热巴&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.linsert(&#x27;list1&#x27;,&#x27;AFTER&#x27;,&#x27;egon&#x27;,&#x27;古力娜扎&#x27;)</span></span><br><span class="line"><span class="comment"># conn.linsert(&#x27;list1&#x27;,&#x27;AFTER&#x27;,&#x27;1&#x27;,&#x27;99999&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.lset(&#x27;list1&#x27;,3,66666) # 修改某个位置的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果count=0,表示删除所有符合条件的，删除所有66666</span></span><br><span class="line"><span class="comment"># conn.lrem(&#x27;list1&#x27;,0,&#x27;66666&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果count=1，表示从左侧删除1个符合条件的，删除1个99999</span></span><br><span class="line"><span class="comment"># conn.lrem(&#x27;list1&#x27;,1,&#x27;99999&#x27;)</span></span><br><span class="line"><span class="comment"># 如果count=-2，表示从底部，从右侧，删除符合条件的2个</span></span><br><span class="line"><span class="comment"># conn.lrem(&#x27;list1&#x27;,-2,&#x27;99999&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.lpop(&#x27;list1&#x27;)</span></span><br><span class="line"><span class="comment"># res=conn.rpop(&#x27;list1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.lindex(&#x27;list1&#x27;,1)  #返回某个索引的值  列表操作 l[0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.lrange(&#x27;list1&#x27;, 0, 4)  # 前闭后闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.ltrim(&#x27;list1&#x27;, 1, 3)  #修剪，不符合范围的都删除，前闭后闭</span></span><br><span class="line"><span class="comment"># conn.lpush(&#x27;list2&#x27;,&#x27;李易峰&#x27;,&#x27;刘亦菲&#x27;,&#x27;迪丽热巴&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.rpoplpush(&#x27;list1&#x27;, &#x27;list2&#x27;)</span></span><br><span class="line"></span><br><span class="line">res=conn.blpop(<span class="string">&#x27;list2&#x27;</span>,timeout=<span class="number">2</span>)   <span class="comment"># 阻塞式弹出,通过它做一些分布式任务，可以用来做消息队列</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># brpoplpush(src, dst, timeout=0)</span></span><br><span class="line"></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="3-4其他操作-通用"><a href="#3-4其他操作-通用" class="headerlink" title="3.4其他操作(通用)"></a>3.4其他操作(通用)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">delete(*names)			<span class="comment"># 根据删除redis中的任意数据类型</span></span><br><span class="line">exists(name)			<span class="comment"># 检测redis的name是否存在</span></span><br><span class="line">keys(pattern=<span class="string">&#x27;*&#x27;</span>)		<span class="comment"># 根据模型获取redis的name</span></span><br><span class="line">expire(name ,time)		<span class="comment"># 为某个redis的某个name设置超时时间</span></span><br><span class="line">rename(src, dst)		<span class="comment"># 对redis的name重命名为</span></span><br><span class="line">move(name, db)			<span class="comment"># 将redis的某个值移动到指定的db下</span></span><br><span class="line">randomkey()				<span class="comment"># 随机获取一个redis的name（不删除）</span></span><br><span class="line"><span class="built_in">type</span>(name)				<span class="comment"># 查看类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通用操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">conn=redis.Redis()</span><br><span class="line"><span class="comment"># conn.delete(&#x27;h1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(conn.exists(&#x27;name&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.keys(&#x27;list*&#x27;)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.expire(&#x27;list1&#x27;,3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.rename(&#x27;sex&#x27;,&#x27;sex111&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.move(&#x27;sex111&#x27;,2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.randomkey()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res=conn.type(&#x27;users&#x27;)</span></span><br><span class="line">res=conn.<span class="built_in">type</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h2 id="4-管道-事务的实现"><a href="#4-管道-事务的实现" class="headerlink" title="4.管道(事务的实现)"></a>4.管道(事务的实现)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 借助于管道实现</span></span><br><span class="line">    <span class="keyword">import</span> redis</span><br><span class="line">    conn=redis.Redis()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 开启一个管道</span></span><br><span class="line">    pip_line=conn.pipeline(transaction=<span class="literal">True</span>)  	</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 往管道中放一个命令</span></span><br><span class="line">    pip_line.decr(<span class="string">&#x27;zhangsan&#x27;</span>,<span class="number">100</span>)     </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;程序崩了&#x27;</span>)		<span class="comment"># 上下两个命令都不会执行</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 往管道中放一个命令</span></span><br><span class="line">    pip_line.incrby(<span class="string">&#x27;wo&#x27;</span>,<span class="number">100</span>)     </span><br><span class="line">    </span><br><span class="line">	<span class="comment"># 把管道中的命令一次性执行</span></span><br><span class="line">    pip_line.execute()                       	</span><br><span class="line"></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<h2 id="5-Django使用Redis"><a href="#5-Django使用Redis" class="headerlink" title="5.Django使用Redis"></a>5.Django使用Redis</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一:</span></span><br><span class="line">	通用方式,任何web框架都实用</span><br><span class="line">    <span class="keyword">from</span> luffy_api.utils.pool <span class="keyword">import</span> POOL</span><br><span class="line">    <span class="keyword">import</span> redis</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    	<span class="comment"># 从连接池中取出一个连接并使用</span></span><br><span class="line">        conn=redis.Redis(connection_pool=POOL)</span><br><span class="line">        res=conn.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 方式二:</span></span><br><span class="line">	Django提供</span><br><span class="line">    <span class="number">1.</span>安装django_redis模块</span><br><span class="line">    	pip3 install django_redis</span><br><span class="line">        </span><br><span class="line">    <span class="number">2.</span>配置文件中配置,如下:</span><br><span class="line">    	CACHES = &#123;</span><br><span class="line">            <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;BACKEND&quot;</span>: <span class="string">&quot;django_redis.cache.RedisCache&quot;</span>,</span><br><span class="line">                <span class="string">&quot;LOCATION&quot;</span>: <span class="string">&quot;redis://127.0.0.1:6379&quot;</span>,</span><br><span class="line">                <span class="string">&quot;OPTIONS&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;CLIENT_CLASS&quot;</span>: <span class="string">&quot;django_redis.client.DefaultClient&quot;</span>,</span><br><span class="line">                    <span class="comment"># 连接池大小为100</span></span><br><span class="line">                    <span class="string">&quot;CONNECTION_POOL_KWARGS&quot;</span>: &#123;<span class="string">&quot;max_connections&quot;</span>: <span class="number">100</span>&#125;  </span><br><span class="line">                    <span class="comment"># &quot;PASSWORD&quot;: &quot;123&quot;,  # 有密码就写密码</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;	</span><br><span class="line">        </span><br><span class="line">     <span class="number">3.</span>使用:</span><br><span class="line">        <span class="keyword">from</span> django_redis <span class="keyword">import</span> get_redis_connection</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">            conn=get_redis_connection()</span><br><span class="line">            res=conn.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;okkkkk&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 注意:</span></span><br><span class="line">    一旦这样配置,django中的缓存,也会使用redis</span><br><span class="line">    eg:</span><br><span class="line">        cache.<span class="built_in">set</span>(<span class="string">&#x27;key&#x27;</span>,python的任意对象)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/06/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/06/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Docker常用命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-06 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-06T18:20:25+08:00">2020-08-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h1><h2 id="1-Docker概述"><a href="#1-Docker概述" class="headerlink" title="1.Docker概述"></a>1.Docker概述</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Docker为什么会出现?</span><br><span class="line">	一款产品:开发-上线 两套环境,应用配置!</span><br><span class="line">	开发 — 运维 问题: 项目在我的电脑上可以运行!版本更新,导致服务不可用!对于运维来说,考验就十分大</span><br><span class="line">	环境配置是十分的麻烦.每一个机器都要部署环境(集群Redis, ES, Hadoop…)! 费时费力</span><br><span class="line">	发布一个项目(Jar+ (Redis,ES, Hadoop)),项目为什么不带上环境安装打包</span><br><span class="line">	在服务器上配置十分麻烦,不能够跨平台</span><br><span class="line">	Windows开发,发布到Linux</span><br><span class="line">		传统开发: 开发人员做项目,运维人员做部署</span><br><span class="line">		现在: 开发打包部署上线,一套流程做完</span><br><span class="line"></span><br><span class="line">java – apk – 发布(应用商店) --使用者使用apk-- 安装即用</span><br><span class="line">java — jar(环境) — 打包上线自带环境(镜像) —(Docker仓库: 商店) — 下载我们发布的镜像 — 直接运行即可</span><br><span class="line"></span><br><span class="line">Docker是基于Go语言开发的开源项目!</span><br><span class="line"></span><br><span class="line">官网: https://www.docker.com/ </span><br><span class="line">文档地址: https://docs.docker.com/get-docker/</span><br><span class="line">仓库地址: https://hub.docker.com/</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625205617881.png" alt="image-20210625205617881"></p>
<h3 id="Docker能干嘛"><a href="#Docker能干嘛" class="headerlink" title="Docker能干嘛?"></a>Docker能干嘛?</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">之前的虚拟机技术</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625205845101.png" alt="image-20210625205845101"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 虚拟机技术缺点:</span></span><br><span class="line">	1. 资源占用十分多</span><br><span class="line">    2. 冗余技术多</span><br><span class="line">    3. 启动很慢</span><br><span class="line">    </span><br><span class="line">容器化技术:</span><br><span class="line">	容器化技术不是一个完整的操作系统</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625205941342.png" alt="image-20210625205941342"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 比较Docker和虚拟机技术的不同</span></span><br><span class="line">    传统的虚拟机,虚拟出一条硬件,运行一个完整的操作系统,然后在这个系统上安装和运行软件</span><br><span class="line">    每个容器间都是互相隔离的,每一个容器内都有一个属于自己的文件系统,互不影响</span><br><span class="line">    容器内的应用直接运行在宿主机的内容,容器是没有自己的内核的,也没有虚拟我们的硬件,所以就轻便了</span><br></pre></td></tr></table></figure>

<h3 id="DevOps-开发-运维"><a href="#DevOps-开发-运维" class="headerlink" title="DevOps(开发,运维)"></a>DevOps(开发,运维)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">更快速的交付和部署:</span><br><span class="line">    传统: 一堆帮助文档,安装程序</span><br><span class="line">    Docker: 一键运行打包镜像发布测试</span><br><span class="line"></span><br><span class="line">更便捷的升级和扩缩容:</span><br><span class="line">    使用了Docker之后,我们部署应用就像搭积木一样!</span><br><span class="line">    项目打包为一个镜像,扩展,服务器A!服务器B</span><br><span class="line"></span><br><span class="line">更简单的系统运维:</span><br><span class="line">    在容器化之后,我们开发,测试环境都是高度一致的</span><br><span class="line">    更高效的计算资源利用:</span><br><span class="line"></span><br><span class="line">Docker是内核级别的虚拟化, 可以在一个物理机上运行很多的容器实例! 服务器的性能可以被压榨到极致</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Docker安装"><a href="#2-Docker安装" class="headerlink" title="2.Docker安装"></a>2.Docker安装</h2><h3 id="Docker基本组成-三大核心"><a href="#Docker基本组成-三大核心" class="headerlink" title="Docker基本组成(三大核心)"></a>Docker基本组成(三大核心)</h3><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625210235586.png" alt="image-20210625210235586"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">镜像(image):</span><br><span class="line">	docker镜像好比一个模板,可以通过这个模板来创建容器服务,tomcat镜像===&gt;run==&gt;tomcat01容器(提供服务器)</span><br><span class="line">	通过这个镜像可以创建多个容器(最终服务运行或者项目运行就是在容器中的)</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">容器(container):</span><br><span class="line">	Docker利用容器技术,独立运行一个或者一个组应用,通过镜像来创建的</span><br><span class="line">	启动,停止,删除,基本命令!</span><br><span class="line"></span><br><span class="line">仓库(repository):</span><br><span class="line">	仓库就是存放镜像的地方!</span><br><span class="line">	仓库分为共有仓库和私有仓库</span><br><span class="line">    Docker Hub(默认是国外的)</span><br><span class="line">    阿里云… 都有容器服务器(配置镜像加速)</span><br></pre></td></tr></table></figure>

<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><h4 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">准备: </span><br><span class="line">    1.需要会一点点Linux基础</span><br><span class="line">    2.CentOS7</span><br><span class="line">    3.使用Xshell连接远程服务器</span><br></pre></td></tr></table></figure>

<h4 id="2-环境查看"><a href="#2-环境查看" class="headerlink" title="2.环境查看"></a>2.环境查看</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看系统内核</span></span><br><span class="line">    [root@iZ2zeheduaqlfxyl598si8Z /]# uname -r</span><br><span class="line">    3.10.0-1062.18.1.el7.x86_64</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash">系统版本</span></span><br><span class="line">    [root@CZP ~]# cat /etc/os-release</span><br><span class="line">    NAME=&quot;CentOS Linux&quot;</span><br><span class="line">    VERSION=&quot;7 (Core)&quot;</span><br><span class="line">    ID=&quot;centos&quot;</span><br><span class="line">    ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">    VERSION_ID=&quot;7&quot;</span><br><span class="line">    PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">    ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">    CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">    HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">    BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">    CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">    CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">    REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">    REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br></pre></td></tr></table></figure>

<h4 id="3-安装Docker"><a href="#3-安装Docker" class="headerlink" title="3.安装Docker"></a>3.安装Docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.卸载旧的版本</span></span><br><span class="line">    $ sudo yum remove docker \</span><br><span class="line">                      docker-client \</span><br><span class="line">                      docker-client-latest \</span><br><span class="line">                      docker-common \</span><br><span class="line">                      docker-latest \</span><br><span class="line">                      docker-latest-logrotate \</span><br><span class="line">                      docker-logrotate \</span><br><span class="line">                      docker-engine</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.需要安装的包</span></span><br><span class="line">	yum install -y yum-utils</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.设置镜像仓库</span></span><br><span class="line">	yum-config-manager \</span><br><span class="line">    	--add-repo \</span><br><span class="line">    	https://download.docker.com/linux/centos/docker-ce.repo #默认国外</span><br><span class="line"></span><br><span class="line">    yum-config-manager \</span><br><span class="line">        --add-repo \</span><br><span class="line">        https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #推荐</span><br><span class="line">        </span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.更新yum软件包索引</span></span><br><span class="line">	yum makecache fast</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.安装docker</span>    </span><br><span class="line">	sudo yum install docker-ce docker-ce-cli containerd.io </span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.启动docker</span></span><br><span class="line">    systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> 7.查看docker版本</span></span><br><span class="line">	docker version</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载镜像</span></span><br><span class="line">	docker pull [要下载的软件]</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看下载的镜像</span></span><br><span class="line">	docker images</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载Docker</span></span><br><span class="line">    yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">    rm -rf /var/lib/docker#docker默认工作路径</span><br></pre></td></tr></table></figure>

<h4 id="4-阿里云配置镜像加速"><a href="#4-阿里云配置镜像加速" class="headerlink" title="4.阿里云配置镜像加速"></a>4.阿里云配置镜像加速</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625211151183.png" alt="image-20210625211151183"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">执行命令:</span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"> 	</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   &quot;registry-mirrors&quot;: [&quot;https://gojs472d.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">    </span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">    </span><br><span class="line">    4.sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="5-Docker-run运行流程图"><a href="#5-Docker-run运行流程图" class="headerlink" title="5.Docker run运行流程图"></a>5.Docker run运行流程图</h4><p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625211707236.png" alt="image-20210625211707236"></p>
<h4 id="6-底层原理"><a href="#6-底层原理" class="headerlink" title="6.底层原理"></a>6.底层原理</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Docker是怎么工作的?</span></span><br><span class="line">    Docker是一个C/S结构的系统,Docker的守护进程运行在主机上.通过Socket从客户端访问!</span><br><span class="line">    DockerServer接收到Docker-Client的指令,就会执行这个命令!</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625211907269.png" alt="image-20210625211907269"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Docker为什么比VM快?</span></span><br><span class="line">    1.Docker有着比虚拟机更少的抽象层</span><br><span class="line">    2.Docker利用的是宿主机的内核,vm需要的是Guest OS</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625211955591.png" alt="image-20210625211955591"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所以说,新建一个容器的时候,docker不需要像虚拟机一样重新安装一个操作系统内核,虚拟机是加载Guest OS,分钟级别的,而docker是利用宿主机的操作系统,省略了这个复杂的过程</span><br></pre></td></tr></table></figure>

<h2 id="2-Docker常用命令"><a href="#2-Docker常用命令" class="headerlink" title="2.Docker常用命令"></a>2.Docker常用命令</h2><h3 id="1-帮助命令"><a href="#1-帮助命令" class="headerlink" title="1.帮助命令"></a>1.帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker version 	# 显示版本信息</span><br><span class="line">docker info 		# 显示docker系统信息 包括镜像和容器数量</span><br><span class="line">docker --help		# 帮助命令</span><br><span class="line"></span><br><span class="line">ps:</span><br><span class="line">	帮助文档地址:https://docs.docker.com/reference/</span><br></pre></td></tr></table></figure>

<h3 id="2-镜像命令"><a href="#2-镜像命令" class="headerlink" title="2.镜像命令"></a>2.镜像命令</h3><p><strong>docker images</strong> 查看所本地主机上的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY       TAG              IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx            latest           d1a364dc548d   3 weeks ago     133MB</span><br><span class="line">python           3.6-alpine3.13   ac438c122d19   4 weeks ago     40.8MB</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解释</span></span><br><span class="line">REPOSITORY		镜像的仓库源</span><br><span class="line">TAG				镜像的标签</span><br><span class="line">IMAGE ID		镜像的id</span><br><span class="line">CREATED			镜像的创建时间</span><br><span class="line">SIZE			镜像的大小</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">  -a, --all             # 列出所有的镜像</span><br><span class="line">  -q, --quiet           # 只显示镜像的id</span><br></pre></td></tr></table></figure>

<p><strong>docker search</strong>  搜索镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search mysql</span><br><span class="line">NAME         DESCRIPTION         							STARS     OFFICIAL   </span><br><span class="line">mysql       MySQL is a widely used, open-source relation…   11028     [OK]       </span><br><span class="line">mariadb     MariaDB Server is a high performing open sou…   4178      [OK] </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项 通过收藏来过滤</span></span><br><span class="line">	--filter=STARS=3000 	# 搜索出来的镜像就是STARS大于3000的</span><br><span class="line">	</span><br><span class="line">[root@localhost ~]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   </span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11028     [OK]       </span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   4178      [OK]   </span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker search mysql --filter=STARS=5000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   </span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11028     [OK]  </span><br></pre></td></tr></table></figure>

<p><strong>docker pull</strong>  下载镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  下载镜像 docker pull 镜像名[:tag]</span></span><br><span class="line">[root@localhost ~]# docker pull mysql</span><br><span class="line">Using default tag: latest	 # 如果不写 tag,默认 latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">69692152171a: Already exists 	# 分层下载,docker images的核心 联合文件系统</span><br><span class="line">1651b0be3df3: Already exists </span><br><span class="line">951da7386bc8: Already exists </span><br><span class="line">0f86c95aa242: Already exists </span><br><span class="line">37ba2d8bd4fe: Already exists </span><br><span class="line">6d278bb05e94: Already exists </span><br><span class="line">Digest: sha256:d50098d7fcb25b1fcb24e2d3247cae3fc55815d64fec640dc395840f8fa80969 </span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest	# 真实地址</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker pull mysql  等价于 docker.io/library/mysql:latest</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定版本下载</span></span><br><span class="line">[root@localhost ~]# docker pull mysql:5.7</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>docker rmi</strong>  删除镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost BBS05]# docker rmi -f 镜像id   					# 删除指定镜像</span><br><span class="line">[root@localhost BBS05]# docker rmi -f 镜像id 镜像id 镜像id	 	 # 删除多个镜像</span><br><span class="line">[root@localhost BBS05]# docker rmi -f $(docker images -aq)	   	 # 删除全部镜像</span><br></pre></td></tr></table></figure>

<h3 id="3-容器命令"><a href="#3-容器命令" class="headerlink" title="3.容器命令"></a>3.容器命令</h3><p><strong>说明:我们有了镜像才可以创建容器,linux,下载一个centos镜像测试学习</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost BBS05]# docker pull centos</span><br></pre></td></tr></table></figure>

<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:</span></span><br><span class="line">--name=&#x27;name&#x27;    	容器名字  django01 django02 ,用来区分容器</span><br><span class="line">-d					后台方式运行</span><br><span class="line">-it					使用交互的方式运行,进入当前容器查看内容</span><br><span class="line">-p					指定容器端口 -p 8080:8080</span><br><span class="line">	-p ip:主机端口:容器端口</span><br><span class="line">	-p 主机端口:容器端口(常用)</span><br><span class="line">	-p 容器端口</span><br><span class="line">	容器端口</span><br><span class="line">-P(大写)			   随机指定端口</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试 启动并进入容器</span></span><br><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@2ec114690ab4 /]# ls 	# 查看容器内的centos 基础版本 很多命令不完善</span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从容器中退回主机</span></span><br><span class="line">[root@2ec114690ab4 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost /]# ls</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>

<p><strong>列出所有的运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps 命令</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 列出当前正在运行的容器</span></span><br><span class="line">-a  # 列出当前正在运行的容器+历史运行过的容器</span><br><span class="line">-n=?  # 显示最近创建的容器</span><br><span class="line">-q  # 只显示容器的编号</span><br><span class="line"></span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@localhost /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND       CREATED       STATUS         PORTS     </span><br><span class="line">  NAMES</span><br><span class="line">2ec114690ab4   centos    &quot;/bin/bash&quot;   3 minutes ago   Exited (0) About a minute ago     recursing_margulis</span><br><span class="line">7e7ef03a1c59   centos    &quot;/bin/bash&quot;   5 minutes ago   Exited (130) 5 minutes ago  </span><br><span class="line">  xenodochial_pike</span><br></pre></td></tr></table></figure>

<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit   # 直接容器停止并退出</span><br><span class="line">Ctrl + p + Q  # 容器不停止退出</span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id					# 删除指定容器(不能删除正在运行的容器 强制删除 rm -f)</span><br><span class="line">docker rm -f $(docker ps -aq)	 # 删除所有容器	</span><br><span class="line">docker ps -a -q|xargs docker rm  # 删除所有的容器</span><br></pre></td></tr></table></figure>

<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id 			# 启动容器</span><br><span class="line">docker restart 容器id 		# 重启容器</span><br><span class="line">docker stop 容器id 			# 停止容器</span><br><span class="line">docker kill 容器id 			# 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h2 id="3-常用其他命令"><a href="#3-常用其他命令" class="headerlink" title="3.常用其他命令"></a>3.常用其他命令</h2><p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker run -d 镜像名</span></span><br><span class="line">[root@localhost /]# docker run -d centos</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 问题: docker ps 发现centos停止了</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常见的坑: docker 容器使用后台运行,就必须要有一个前台进程,docker发现没有应用,就会自动停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx 容器启动后,发现自己没有提供服务,就会立刻停止,就是没有程序了</span></span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail 容器,没有日志</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自己编写一段shell脚本</span></span><br><span class="line">[root@localhost /]# docker run -d centos /bin/sh -c &quot;while true;do echo zqw;sleep 1;done&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">[root@localhost /]<span class="comment"># docker ps</span></span></span><br><span class="line">CONTAINER ID   IMAGE      </span><br><span class="line">2ec114690ab4   centos</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示日志</span></span><br><span class="line">-tf				# 显示日志</span><br><span class="line">--tail number   # 要显示的日志条数</span><br><span class="line">[root@localhost /]# docker logs -tf --tail 10 2ec114690ab4</span><br></pre></td></tr></table></figure>

<p><strong>查看容器中进程信息</strong>ps</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker top 容器id</span></span><br><span class="line">[root@localhost /]# docker top 2ec114690ab4</span><br><span class="line">UID			PID		PPID	C		STIME		TTY</span><br><span class="line">root		22891	22875	0		21:21		?</span><br><span class="line">root		22821	22815	0		21:26		?</span><br></pre></td></tr></table></figure>

<p><strong>查看镜像元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令</span>  </span><br><span class="line">docker inspect  容器id</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost /]# docker inspect 2ec114690ab4</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通常容器都是使用后台方式运行的,需要进入容器修改一些配置</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">方式一:</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">1b8da83525a2   centos    &quot;/bin/bash&quot;   28 minutes ago   Up 28 minutes             jovial_turing</span><br><span class="line"></span><br><span class="line">[root@localhost /]# docker exec -it 1b8da83525a2 /bin/bash</span><br><span class="line">[root@1b8da83525a2 /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 12:03 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         15      0  0 12:32 pts/1    00:00:00 /bin/bash</span><br><span class="line">root         29     15  0 12:32 pts/1    00:00:00 ps -ef</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式二:</span></span><br><span class="line">docker attach 容器id</span><br><span class="line">[root@localhost /]# docker attach 1b8da83525a2</span><br><span class="line">正在执行当前的代码...</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span> 	 	<span class="comment"># 进入容器后开启一个新的终端(进程),可以在里面操作(常用)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach		<span class="comment"># 进入容器正在执行的终端,不会启动新的进程!</span></span></span><br></pre></td></tr></table></figure>

<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径  目的的主机路径</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前主机目录下</span></span><br><span class="line">[root@localhost home]# ls</span><br><span class="line">[root@localhost home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">1b8da83525a2   centos    &quot;/bin/bash&quot;   39 minutes ago   Up 39 minutes             jovial_turing</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入docker容器内部</span></span><br><span class="line">[root@localhost home]# docker attach 1b8da83525a2</span><br><span class="line">[root@1b8da83525a2 /]# cd /home</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内新建一个文件</span></span><br><span class="line">[root@1b8da83525a2 home]# touch home.py</span><br><span class="line">[root@1b8da83525a2 home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@localhost home]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                         PORTS     NAMES</span><br><span class="line">1b8da83525a2   centos         &quot;/bin/bash&quot;              40 minutes ago   Exited (0) 14 seconds ago                jovial_turing</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将这个文件拷贝出来到主机上</span></span><br><span class="line">[root@localhost home]# docker cp 1b8da83525a2:/home/home.py /home</span><br><span class="line">[root@localhost home]# ls</span><br><span class="line">home.py</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝是一个手动过程 -v 卷的技术 可以实现同步</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\左旗伟\AppData\Roaming\Typora\typora-user-images\image-20210625212502098.png" alt="image-20210625212502098"></p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">attach      Attach  to a running container # 进入容器内部,不启动新的进程</span><br><span class="line">build       Build an image from a Dockerfile # 通过dockerfile 定制镜像</span><br><span class="line">commit      Create a new image from a container&#x27;s changes #提交当前容器为新的镜像</span><br><span class="line">cp          Copy files/folders between a container and the local filesystem #从容器中拷贝指定的文件或者目录到宿主机上</span><br><span class="line">create      Create a new container # 创建一个新的容器,同run 但不启动容器</span><br><span class="line">diff        Inspect changeson a container&#x27;s filesystem # 查看docker容器变化</span><br><span class="line">events      Get real time events from the server# 从docker服务获取容器实时事件</span><br><span class="line">exec        Run a command in a running container# 在已存在的容器上运行命令</span><br><span class="line">expo		Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">history     Show the history of an image</span><br><span class="line">images      List images</span><br><span class="line">import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">info        Display system-wide information</span><br><span class="line">inspect     Return low-level information on Docker objects</span><br><span class="line">kill        Kill one or more running containers</span><br><span class="line">load        Load an image from a tar archive or STDIN</span><br><span class="line">login       Log in to a Docker registry</span><br><span class="line">logout      Log out from a Docker registry</span><br><span class="line">logs        Fetch the logs of a container</span><br><span class="line">pause       Pause all processes within one or more containers</span><br><span class="line">port        List port mappings or a specific mapping for the container</span><br><span class="line">ps          List containers</span><br><span class="line">pull        Pull an image or a repository from a registry</span><br><span class="line">push        Push an image or a repository to a registry</span><br><span class="line">rename      Rename a container</span><br><span class="line">restart     Restart one or more containers</span><br><span class="line">rm          Remove one or more containers</span><br><span class="line">rmi         Remove one or more images</span><br><span class="line">run         Run a command in a new container</span><br><span class="line">save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">search      Search the Docker Hub for images</span><br><span class="line">start       Start one or more stopped containers</span><br><span class="line">stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">stop        Stop one or more running containers</span><br><span class="line">tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">top         Display the running processes of a container</span><br><span class="line">unpause     Unpause all processes within one or more containers</span><br><span class="line">update      Update configuration of one or more containers</span><br><span class="line">version     Show the Docker version information</span><br><span class="line">wait        Block until one or more containers stop, then print their exit codes</span><br></pre></td></tr></table></figure>

<p><img src="D:\python课程\课程笔记\Linux\截图\常用命令01.png" alt="常用命令01"></p>
<p><img src="D:\python课程\课程笔记\Linux\截图\常用命令02.png" alt="常用命令02"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/04/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="左大大">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="左大大的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/04/Docker/" class="post-title-link" itemprop="url">Docker精简版</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-04 18:20:25" itemprop="dateCreated datePublished" datetime="2020-08-04T18:20:25+08:00">2020-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1-什么是Docker"><a href="#1-什么是Docker" class="headerlink" title="1.什么是Docker?"></a>1.什么是Docker?</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.个人见解：</span><br><span class="line">	Docker就是一个高性能的VM，并且不会浪费资源，主要用于Linux环境的虚拟化，类似VBox这种虚拟机，不同的是Docker专门为了服务器虚拟化，并支持镜像分享等功能。</span><br><span class="line"></span><br><span class="line">	Docker 是一个开源项目,诞生于2013年初,最初是dotCloud公司内部的一个业余项目。它基于Google公司推出的 Go语言实现。项目后来加入了Linux基金会，遵从了Apache2.0协议,项目代码在 GitHub上进行维护。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-Docker作用"><a href="#2-Docker作用" class="headerlink" title="2.Docker作用"></a>2.Docker作用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Docker的主要目标：</span><br><span class="line">	通过对应用组件的封装、分发、部署、运行等生命周期的管理，达到应用级别的一次封装，到处运行。</span><br><span class="line">	小贴士：这里的应用组件，可以是WEB应用，也可以是一套数据库服务，甚至可以是一个操作系统编译器。</span><br></pre></td></tr></table></figure>

<h3 id="3-Docker虚拟化特点"><a href="#3-Docker虚拟化特点" class="headerlink" title="3.Docker虚拟化特点"></a>3.Docker虚拟化特点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">虚拟化特点:</span><br><span class="line">	1. 环境隔离</span><br><span class="line">	2.更快的交付和部署</span><br><span class="line">	3.更高效的利用资源</span><br><span class="line">	4.更轻松的迁移和扩展</span><br><span class="line">	5.更轻松的管理和更新</span><br></pre></td></tr></table></figure>

<h3 id="4-Docker概念和使用"><a href="#4-Docker概念和使用" class="headerlink" title="4.Docker概念和使用"></a>4.Docker概念和使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.Docker三大核心概念</span><br><span class="line">	1.镜像(Image):</span><br><span class="line">		Docker镜像就相当于是一个root文件系统。比如官方镜像ubuntu:16.04就包含了完整的一套 Ubuntu16.04最小系统的root文件系统。</span><br><span class="line">	2.容器(Container)</span><br><span class="line">		镜像和容器的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等</span><br><span class="line">	3. 仓库(Repository)</span><br><span class="line">		用来保存镜像的仓库。当我们构建好自己的镜像之后，需要存放在仓库中，当我们需要启动一个镜像时，可以在仓库中下载下来。</span><br></pre></td></tr></table></figure>

<h3 id="5-Docker安装"><a href="#5-Docker安装" class="headerlink" title="5.Docker安装"></a>5.Docker安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">若之前安装过老版本的Docker,则要清理残留</span></span><br><span class="line"><span class="string">[root@python ~]# yum remove docker \</span></span><br><span class="line"><span class="string">    docker-client \</span></span><br><span class="line"><span class="string">    docker-client-latest \</span></span><br><span class="line"><span class="string">    docker-common \</span></span><br><span class="line"><span class="string">    docker-latest \</span></span><br><span class="line"><span class="string">    docker-latest-logrotate \</span></span><br><span class="line"><span class="string">    docker-logrotate \</span></span><br><span class="line"><span class="string">    docker-engine</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">1.更换系统yum源</span><br><span class="line">	<span class="comment"># 先备份原来的yum源</span></span><br><span class="line">	[root@python ~]<span class="comment"># cp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span></span><br><span class="line">	<span class="comment"># 更换yum源</span></span><br><span class="line">	[root@python ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"></span><br><span class="line">2. 建立yum源缓存</span><br><span class="line">	[root@python ~]<span class="comment"># yum makecache</span></span><br><span class="line">	</span><br><span class="line">3.更新操作系统</span><br><span class="line">	[root@python ~]<span class="comment"># yum update -y --exclud=kernel*</span></span><br><span class="line"></span><br><span class="line">4.安装基础软件</span><br><span class="line">	[root@localhost ~]<span class="comment"># yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br><span class="line">	</span><br><span class="line">5.安装Docker yum源</span><br><span class="line">	[root@localhost ~]<span class="comment"># yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line"></span><br><span class="line">6.安装Docker</span><br><span class="line">	<span class="comment"># 建立元数据缓存</span></span><br><span class="line">	[root@localhost ~]<span class="comment"># yum makecache fast</span></span><br><span class="line">	<span class="comment"># 安装Docker</span></span><br><span class="line">	[root@localhost ~]<span class="comment"># yum -y install docker-ce</span></span><br><span class="line"></span><br><span class="line">7.启动Docker</span><br><span class="line">	[root@localhost ~]<span class="comment"># systemctl start docker</span></span><br><span class="line">	</span><br><span class="line">8.验证Docker启动</span><br><span class="line">	[root@localhost ~]<span class="comment"># docker run -p 8080:80 -d nginx</span></span><br><span class="line">    ps：测试能够通过8080访问我们的服务器就算成功</span><br><span class="line">   </span><br><span class="line">设置开机启动:</span><br><span class="line">	[root@alvin-test-os ~]<span class="comment"># systemctl enable --now docker</span></span><br></pre></td></tr></table></figure>

<h3 id="6-Docker镜像"><a href="#6-Docker镜像" class="headerlink" title="6.Docker镜像"></a>6.Docker镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker镜像启动容器的模板，镜像一般情况下定义的是容器启动的服务。</span></span><br><span class="line"></span><br><span class="line">获取镜像</span><br><span class="line">	docker pull nginx(官方镜像名称)</span><br><span class="line">	docker pull registry.cn-hangzhou.aliyuncs.com/alvinos/docsfiy:v2(其他镜像路径)</span><br><span class="line">	</span><br><span class="line">1、公共的仓库(dockerHub[官方]、阿里云镜像仓库、华为云镜像仓库、腾讯云镜像仓库)</span><br><span class="line">    registry.cn-hangzhou.aliyuncs.com/alvinos/docsfiy:v2</span><br><span class="line"></span><br><span class="line">		镜像仓库URL：registry.cn-hangzhou.aliyuncs.com(默认：docker.io)</span><br><span class="line">		命名空间：alvinos(默认：library)</span><br><span class="line">		仓库名称：docsfiy</span><br><span class="line">		版本号：v2（默认：latest）</span><br><span class="line"></span><br><span class="line">2、私有的仓库（Harbor）</span><br><span class="line">	登录仓库：</span><br><span class="line">		docker login 仓库url(默认：docker.io)</span><br><span class="line">		</span><br><span class="line">3、获取镜像</span><br><span class="line">	docker pull [镜像名称or镜像路径]</span><br><span class="line">	</span><br><span class="line">4、镜像名称修改（tag）</span><br><span class="line">	docker tag [原来的tag] [新的tag]</span><br><span class="line">	一般将镜像名称改成被提交仓库路径(registry.cn-hangzhou.aliyuncs.com/zdd0128/nginx)</span><br><span class="line">	eg:</span><br><span class="line">		docker tag [镜像名称]:[镜像版本] [新的镜像名称]:[新的镜像版本]</span><br><span class="line">		docker tag [镜像id] [新的镜像名称]:[新的镜像版本]</span><br><span class="line">		docker tag d1a364dc548d(镜像id) registry.cn-hangzhou.aliyuncs.com/zdd0128/nginx:v1</span><br><span class="line">				</span><br><span class="line">5、获取当前系统上所有的docker镜像</span><br><span class="line">	docker image ls 或 docker images</span><br><span class="line">		-a : 列出系统中所有的临时镜像</span><br><span class="line">		--digests=<span class="literal">true</span> ： 列出系统中所有镜像的数字摘要值</span><br><span class="line">		-q : 仅显示镜像ID</span><br><span class="line">		</span><br><span class="line">6、上传镜像</span><br><span class="line">	1、创建阿里云仓库</span><br><span class="line">		产品--&gt;容器镜像--&gt;个人--&gt;添加仓库--&gt;添加名称空间</span><br><span class="line">	2、登录阿里云仓库</span><br><span class="line">		docker login --username=zdd1912419375 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">	3、修改镜像名称</span><br><span class="line">		docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/zdd0128/nginx:[镜像版本号]</span><br><span class="line">	4、上传镜像</span><br><span class="line">		docker push registry.cn-hangzhou.aliyuncs.com/zdd0128/nginx:[镜像版本号]</span><br><span class="line">		</span><br><span class="line">7、查看镜像详细信息</span><br><span class="line">	docker inspect [镜像名称|ID]</span><br><span class="line">		-f : 获取镜像部分详细信息</span><br><span class="line">８、删除镜像</span><br><span class="line">	docker rmi [镜像ID或镜像名称]</span><br><span class="line">		-f : 强制删除镜像</span><br><span class="line">	清空机器上所有的镜像</span><br><span class="line">	docker rmi $(docker images -q)</span><br><span class="line"></span><br><span class="line">案例:部署Django项目</span><br><span class="line">	1、拉取镜像</span><br><span class="line">		docker pull alvinos/django:v3</span><br><span class="line">	2、启动</span><br><span class="line">		docker run -d -p 8080:80 alvinos/django:v3</span><br><span class="line">	3、关闭服务</span><br><span class="line">		docker stop [容器名称]</span><br></pre></td></tr></table></figure>

<h4 id="Docker启动mysql"><a href="#Docker启动mysql" class="headerlink" title="Docker启动mysql"></a>Docker启动mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">启动mysql容器</span><br><span class="line">	docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=密码 -d mysql:版本号</span><br><span class="line">		--name 		some-mysql --&gt; 容器名称 j</span><br><span class="line">		-e 			MYSQL_ROOT_PASSWORD --&gt; 设置环境变量,登录使用的密码</span><br><span class="line">进入该容器</span><br><span class="line">	docker exec -it some-mysql /bin/bash</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">添加数据库用户</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 创建用户并授权</span></span><br><span class="line">		GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;000128&#x27; WITH GRANT OPTION;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 刷新权限</span></span><br><span class="line">		FLUSH PRIVILEGES;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="7-Docker容器"><a href="#7-Docker容器" class="headerlink" title="7.Docker容器"></a>7.Docker容器</h3><h4 id="容器基本命令"><a href="#容器基本命令" class="headerlink" title="容器基本命令"></a>容器基本命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">容器(container)</span><br><span class="line">	对外提供服务的实例，容器的本质是进程。</span><br><span class="line"></span><br><span class="line">1、运行一个容器</span><br><span class="line">	格式：</span><br><span class="line">		docker run [参数] [镜像名称|ID] [启动容器执行的命令]</span><br><span class="line">		</span><br><span class="line">		启动命令：不指定则执行默认的启动命令，指定则执行指定的命令。</span><br><span class="line">		镜像名称|ID：可以使用镜像名称，也可以使用镜像ID</span><br><span class="line">		参数：使用什么参数在添加什么参数。</span><br><span class="line">		</span><br><span class="line">		docker create + docker start = docker run</span><br><span class="line">	</span><br><span class="line">	前提：</span><br><span class="line">		docker容器启动的前提：至少有一个应用进程运行在前台。</span><br><span class="line">	</span><br><span class="line">	启动流程：</span><br><span class="line">        1、检查本地是否存在需要被使用的镜像，如果存在则直接使用，如果不存在则去公网下载。</span><br><span class="line">        2、根据镜像创建容器</span><br><span class="line"></span><br><span class="line">    参数：</span><br><span class="line">   		-d : 以守护进程方式运行</span><br><span class="line">   		-p : （固定）端口映射</span><br><span class="line">   		-P : （随机）端口映射</span><br><span class="line">   		-i : 打开标准输出</span><br><span class="line">   		-t : 创建一个终端</span><br><span class="line">   		-v : 将宿主主机上的目录映射到容器中</span><br><span class="line">   		--rm : 当容器的生命周期结束时立即删除容器</span><br><span class="line">   		--name : 将容器自定义一个容器名称， 将容器的名称加入DNS解析</span><br><span class="line">   		-e : 设置容器内部的环境变量</span><br><span class="line">   		-h : 设置容器内部的主机名</span><br><span class="line"></span><br><span class="line">127.0.0.1 回环网络</span><br><span class="line">172.16.1.100 </span><br><span class="line"></span><br><span class="line">2、展示docker容器列表</span><br><span class="line">	docker ps 默认情况下展示当前系统上所有的正在运行的容器</span><br><span class="line">	格式：</span><br><span class="line">		docker ps</span><br><span class="line">	解释：</span><br><span class="line">		CONTAINER ID：容器ID</span><br><span class="line">		IMAGE		：镜像ID|镜像名称</span><br><span class="line">		COMMAND		：容器启动执行的命令</span><br><span class="line">		CREATED		：创建距离现在的时间</span><br><span class="line">		STATUS		：状态</span><br><span class="line">		PORTS		：端口信息</span><br><span class="line">		NAMES		：容器的名称</span><br><span class="line">	</span><br><span class="line">	参数：</span><br><span class="line">		-a : 展示所有的容器</span><br><span class="line">		-q : 仅仅展示容器的ID</span><br><span class="line"></span><br><span class="line">3、删除容器</span><br><span class="line">	格式：</span><br><span class="line">		docker rm [容器的名称|ID]</span><br><span class="line">	</span><br><span class="line">	参数：</span><br><span class="line">		-f : 强制删除</span><br><span class="line">		</span><br><span class="line">	docker rm -f $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line">4、创建容器</span><br><span class="line">	格式：</span><br><span class="line">		docker create </span><br><span class="line"></span><br><span class="line">5、启动容器</span><br><span class="line">	格式：</span><br><span class="line">		docker start </span><br><span class="line"></span><br><span class="line">6、进入容器</span><br><span class="line">	1、attach</span><br><span class="line">		解释：建立一个宿主主机到容器中pid为1的进程上的一个管道，但是一旦attach断开连接，docker容器随即退出。</span><br><span class="line">	2、exec（推荐）</span><br><span class="line">		解释：使用其可以在宿主主机上执行一个容器内部的命令。</span><br><span class="line">		docker exec -it relaxed_bhabha bash</span><br><span class="line">	3、nsenter</span><br><span class="line">		解释：建立一个宿主主机和容器之间的一个管道。</span><br><span class="line">		nsenter --target $( docker inspect -f &#123;&#123;.State.Pid&#125;&#125; elegant_margulis ) --mount --uts --ipc --net --pid</span><br><span class="line">		</span><br><span class="line">	4、ssh</span><br></pre></td></tr></table></figure>

<h4 id="容器和镜像的导入导出"><a href="#容器和镜像的导入导出" class="headerlink" title="容器和镜像的导入导出"></a>容器和镜像的导入导出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1、export和import</span><br><span class="line">	解释：针对的点是容器</span><br><span class="line">	</span><br><span class="line">	格式：</span><br><span class="line">		docker export -o [打包的文件名] [容器ID或名称]</span><br><span class="line">		docker export -o django.tar elegant_margulis</span><br><span class="line">		</span><br><span class="line">		docker import [文件名] [镜像名及版本号]</span><br><span class="line">		docker import django.tar django:v1</span><br><span class="line"></span><br><span class="line">2、save和load</span><br><span class="line">	解释：针对的点的镜像</span><br><span class="line">	</span><br><span class="line">	格式：</span><br><span class="line">		docker save -o [打包的文件名]  镜像名称及版本号</span><br><span class="line">		docker save -o python.tar python:3.6.8 alvinos/django:v3</span><br><span class="line">		</span><br><span class="line">		docker load &lt; [打包的文件名]</span><br><span class="line">		docker load &lt; python.tar</span><br><span class="line"></span><br><span class="line">3、import及export 和 save及load之间的区别</span><br><span class="line">	1、import可以自定义镜像名称，load则不行</span><br><span class="line">	2、save可以同时保存多个镜像，export则不能一次保存多个容器</span><br><span class="line">	3、save保存的镜像体积要大于export保存的镜像体积</span><br><span class="line">	4、两者之间互不能导入</span><br></pre></td></tr></table></figure>

<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1、什么是容器，什么是docker？</span><br><span class="line">    通过镜像运行起来的对外可以提供服务的一个进程实例。</span><br><span class="line">    docker是使用容器的一个软件。</span><br><span class="line"></span><br><span class="line">2、安装</span><br><span class="line">    windows</span><br><span class="line">    linux</span><br><span class="line">    1、配置yum源</span><br><span class="line">    2、安装需要依赖的软件</span><br><span class="line">    3、yum install docker-ce</span><br><span class="line">    4、启动 systemctl start docker</span><br><span class="line">    5、测试 docker run -d -p 8080:80 nginx</span><br><span class="line"></span><br><span class="line">3、镜像</span><br><span class="line">    启动容器的模板。</span><br><span class="line">	1、下载镜像</span><br><span class="line">		docker pull [仓库URL]/[命名空间名]/[仓库名]:[版本号]</span><br><span class="line">	2、镜像列表</span><br><span class="line">		docker images 或 docker image ls</span><br><span class="line">	3、增加镜像名称</span><br><span class="line">		docker tag [原名称] [新名词]</span><br><span class="line">	4、登录镜像仓库</span><br><span class="line">		docker login [仓库URL]</span><br><span class="line">	5、上传镜像</span><br><span class="line">		docker push [仓库URL]/[命名空间名]/[仓库名]:[版本号]</span><br><span class="line">	6、删除镜像</span><br><span class="line">		docker rmi [镜像名称]</span><br><span class="line">	7、查看镜像详细信息</span><br><span class="line">		docker inspect [镜像名称或ID]</span><br><span class="line">	</span><br><span class="line">		7.1、获取某一项信息</span><br><span class="line">			docker inspect -f &quot;&#123;&#123; .Id &#125;&#125;&quot; [镜像名称或ID]</span><br></pre></td></tr></table></figure>

<h3 id="8-linux网络"><a href="#8-linux网络" class="headerlink" title="8.linux网络"></a>8.linux网络</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个命名空间</span><br><span class="line">	ip netns add test01</span><br><span class="line"># 查看创建过的命名空间</span><br><span class="line">	ip netns list</span><br><span class="line"></span><br><span class="line"># 创建Veth设备对</span><br><span class="line">	ip link add veth type veth peer name veth001</span><br><span class="line"></span><br><span class="line"># 将Veth设备对分发至test01命名空间</span><br><span class="line">	ip link set veth001 netns test01</span><br><span class="line"></span><br><span class="line"># 将test01中veth001分配IP</span><br><span class="line">	ip netns exec test01 ip addr add 172.16.0.111/20 dev veth001</span><br><span class="line">	ip addr add 172.16.0.112/20 dev veth</span><br><span class="line">				</span><br><span class="line"># 重启veth设备对</span><br><span class="line">	ip netns exec test01 ip link set dev veth001 up/down</span><br></pre></td></tr></table></figure>

<h3 id="9-Docker网络模式"><a href="#9-Docker网络模式" class="headerlink" title="9.Docker网络模式"></a>9.Docker网络模式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1、HOST模式</span><br><span class="line">	使用宿主主机的网卡</span><br><span class="line">	docker run --network host [镜像名称|ID]</span><br><span class="line"></span><br><span class="line">2、container模式</span><br><span class="line">	共享一个容器的网络</span><br><span class="line">	docker run -d --network &quot;container:[共享容器名称]&quot; nginx</span><br><span class="line">	</span><br><span class="line">3、none模式</span><br><span class="line">	不为容器提供任何网络。</span><br><span class="line">	docker run -d --network none centos</span><br><span class="line">	</span><br><span class="line">4、网桥</span><br><span class="line">	将多个容器使用docker网桥进行地址转换的方式实现网路互通</span><br><span class="line"></span><br><span class="line">	1、创建网桥</span><br><span class="line">	docker network create chenyang</span><br><span class="line">	</span><br><span class="line">	2、查看网桥</span><br><span class="line">	docker network ls</span><br><span class="line">	</span><br><span class="line">	3、使用网桥</span><br><span class="line">	docker run -d --network chenyang nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10-Docker-network"><a href="#10-Docker-network" class="headerlink" title="10.Docker network"></a>10.Docker network</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1、展示当前主机上网桥列表</span><br><span class="line">	docker network ls</span><br><span class="line"></span><br><span class="line">2、创建网桥</span><br><span class="line">	docker network create</span><br><span class="line">    </span><br><span class="line">    参数：</span><br><span class="line">    	-d : 指定网桥的类型</span><br><span class="line">    	--gateway : 指定网关</span><br><span class="line">    	--subnet : 指定子网</span><br><span class="line"></span><br><span class="line">3、查看网桥的详细信息</span><br><span class="line">	docker network inspect [网桥名称|id]</span><br><span class="line"></span><br><span class="line">4、删除网桥</span><br><span class="line">	docker network rm </span><br><span class="line"></span><br><span class="line">5、清空空闲的并且是自创的网桥</span><br><span class="line">	docker network prune -f</span><br><span class="line"></span><br><span class="line">6、连接上一个网桥</span><br><span class="line">	docker network connect [参数] [网桥名称] [容器名称]</span><br><span class="line"></span><br><span class="line">7、断开链接</span><br><span class="line">	docker network disconnect [参数] [网桥名称] [容器名称]</span><br></pre></td></tr></table></figure>

<h3 id="11-Docker-compose"><a href="#11-Docker-compose" class="headerlink" title="11.Docker-compose"></a>11.Docker-compose</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装:"></a>安装:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker-compose是容器编排工具，需要注意的是，docker-compose只是单机的容器编排工具。</span><br><span class="line"></span><br><span class="line">1、docker-compose 默认的配置文件为：docker-compose.yaml</span><br><span class="line"></span><br><span class="line">2、安装docker-compose</span><br><span class="line">	1、下载</span><br><span class="line">		sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line">		</span><br><span class="line">		curl -L https://get.daocloud.io/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line">		</span><br><span class="line">	2、chmod +x docker-compose-Linux-x86_64</span><br><span class="line">	3、mv docker-compose-Linux-x86_64 /usr/local/bin/</span><br><span class="line">	4、ln -s /usr/local/bin/docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class="line">	5、curl -L https://raw.githubusercontent.com/docker/compose/1.25.5/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>

<h4 id="Docker-compose-yaml文件"><a href="#Docker-compose-yaml文件" class="headerlink" title="Docker-compose.yaml文件"></a>Docker-compose.yaml文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.0&quot;</span><br><span class="line">services:</span><br><span class="line">  django:</span><br><span class="line">    image: django:v3</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:8000&quot;</span><br><span class="line">    container_name: django</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: root</span><br><span class="line">    container_name: mysql</span><br><span class="line">    volumes:</span><br><span class="line">    - &quot;/root/docker-compose/mysql/data:/var/lib/mysql&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis</span><br><span class="line">    networks:</span><br><span class="line">      - django</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  django:</span><br></pre></td></tr></table></figure>

<h4 id="Docker-compose指令"><a href="#Docker-compose指令" class="headerlink" title="Docker-compose指令"></a>Docker-compose指令</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">django:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./django</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">django:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./django</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-py</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">NAME:</span> <span class="string">py17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># command</span></span><br><span class="line"><span class="string">设置容器启动命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># depends_on ： 指定在某容器之后启动</span></span><br><span class="line"><span class="comment"># env_file ： 指定环境变量文件</span></span><br></pre></td></tr></table></figure>

<h4 id="Docker-compose参数"><a href="#Docker-compose参数" class="headerlink" title="Docker-compose参数"></a>Docker-compose参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动：docker-compose up</span></span><br><span class="line"><span class="comment"># 删除：docker-compose down</span></span><br><span class="line"><span class="comment"># 停止：docker-compose stop</span></span><br><span class="line"><span class="comment"># 删除容器：docker-compose rm </span></span><br><span class="line"><span class="comment"># 重启：docker-compose restart [容器的名称]</span></span><br><span class="line"><span class="comment"># 进入容器：docker-compose exec [参数] [service] [CMD]</span></span><br><span class="line"><span class="comment"># 容器列表：docker-compose ps</span></span><br><span class="line"><span class="comment"># 查看容器进程：docker-compose top </span></span><br><span class="line"><span class="comment"># 暂停运行：docker-compose pause</span></span><br><span class="line"><span class="comment"># 恢复运行：docker-compose unpause</span></span><br></pre></td></tr></table></figure>

<h4 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.0&#x27;</span><br><span class="line">services:</span><br><span class="line">  portainer:</span><br><span class="line">    image: portainer/portainer-ce</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;8001:8000&quot;</span><br><span class="line">    - &quot;9001:9000&quot;</span><br><span class="line">    container_name: portainer</span><br><span class="line">    networks:</span><br><span class="line">      - &quot;portainer&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    - &quot;/root/docker-compose/portainer_data:/data&quot;</span><br><span class="line">    healthcheck:</span><br><span class="line">      test: [&quot;CMD&quot;, &quot;ping&quot;, &quot;-c1&quot;, &quot;-t1&quot;, &quot;portainer&quot;]</span><br><span class="line">      interval: 30s</span><br><span class="line">      timeout: 10s</span><br><span class="line">      retries: 3</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  portainer:</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">左大大</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
